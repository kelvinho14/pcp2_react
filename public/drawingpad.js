/**
   Zwibbler

   Copyright 2019 Hanov Solutions Inc. All Rights Reserved. This software is
   NOT open source. For licensing information, contact the author.

   steve.hanov@gmail.com

   @license
 */
   ;(function(globalModule){var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function () { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function () { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __values = (this && this.__values) || function (o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function da(){da=function(){};ba.Symbol||(ba.Symbol=ea)}var ea=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function fa(){da();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return ha(this)}});fa=function(){}}function ha(c){var a=0;return ia(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function ia(c){fa();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function ja(c,a){fa();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}function la(c,a){if(a){var b=ba;c=c.split(".");for(var d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
la("Array.prototype.values",function(c){return c?c:function(){return ja(this,function(a,b){return b})}});function ma(c){fa();var a=c[Symbol.iterator];return a?a.call(c):ha(c)}
la("Promise",function(c){function a(a){this.Ek=0;this.Qq=void 0;this.ri=[];var b=this.Mo();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}}function b(){this.Uf=null}function d(b){return b instanceof a?b:new a(function(a){a(b)})}if(c)return c;b.prototype.Ps=function(a){null==this.Uf&&(this.Uf=[],this.$x());this.Uf.push(a)};b.prototype.$x=function(){var a=this;this.Qs(function(){a.Az()})};var e=ba.setTimeout;b.prototype.Qs=function(a){e(a,0)};b.prototype.Az=function(){for(;this.Uf&&this.Uf.length;){var a=
this.Uf;this.Uf=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.ay(n)}}}this.Uf=null};b.prototype.ay=function(a){this.Qs(function(){throw a;})};a.prototype.Mo=function(){function a(a){return function(e){d||(d=!0,a.call(b,e))}}var b=this,d=!1;return{resolve:a(this.VC),reject:a(this.Iq)}};a.prototype.VC=function(b){if(b===this)this.Iq(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.OD(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;
case "function":d=!0;break a;default:d=!1}d?this.UC(b):this.Tt(b)}};a.prototype.UC=function(a){var b=void 0;try{b=a.then}catch(l){this.Iq(l);return}"function"==typeof b?this.PD(b,a):this.Tt(a)};a.prototype.Iq=function(a){this.xw(2,a)};a.prototype.Tt=function(a){this.xw(1,a)};a.prototype.xw=function(a,b){if(0!=this.Ek)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.Ek);this.Ek=a;this.Qq=b;this.Bz()};a.prototype.Bz=function(){if(null!=this.ri){for(var a=0;a<this.ri.length;++a)f.Ps(this.ri[a]);
this.ri=null}};var f=new b;a.prototype.OD=function(a){var b=this.Mo();a.sl(b.resolve,b.reject)};a.prototype.PD=function(a,b){var d=this.Mo();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};a.prototype.then=function(b,d){function e(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(A){f(A)}}:b}var c,f,h=new a(function(a,b){c=a;f=b});this.sl(e(b,c),e(d,f));return h};a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.sl=function(a,b){function d(){switch(e.Ek){case 1:a(e.Qq);
break;case 2:b(e.Qq);break;default:throw Error("Unexpected state: "+e.Ek);}}var e=this;null==this.ri?f.Ps(d):this.ri.push(d)};a.resolve=d;a.reject=function(b){return new a(function(a,d){d(b)})};a.race=function(b){return new a(function(a,e){for(var c=ma(b),f=c.next();!f.done;f=c.next())d(f.value).sl(a,e)})};a.all=function(b){var e=ma(b),c=e.next();return c.done?d([]):new a(function(a,b){function f(b){return function(d){h[b]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,d(c.value).sl(f(h.length-
1),b),c=e.next();while(!c.done)})};return a});la("Array.prototype.keys",function(c){return c?c:function(){return ja(this,function(a){return a})}});
la("String.prototype.startsWith",function(c){return c?c:function(a,b){if(null==this)throw new TypeError("The 'this' value for String.prototype.startsWith must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype.startsWith must not be a regular expression");var d=this+"";a+="";var e=d.length,c=a.length;b=Math.max(0,Math.min(b|0,d.length));for(var h=0;h<c&&b<e;)if(d[b++]!=a[h++])return!1;return h>=c}});
la("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});la("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}});la("Array.prototype.entries",function(c){return c?c:function(){return ja(this,function(a,b){return[a,b]})}});
la("Array.from",function(c){return c?c:function(a,b,d){fa();b=null!=b?b:function(a){return a};var e=[],c=a[Symbol.iterator];if("function"==typeof c){a=c.call(a);for(var h=0;!(c=a.next()).done;)e.push(b.call(d,c.value,h++))}else for(c=a.length,h=0;h<c;h++)e.push(b.call(d,a[h],h));return e}});function na(c,a){return Object.prototype.hasOwnProperty.call(c,a)}
la("WeakMap",function(c){function a(a){this.Nj=(f+=Math.random()+1).toString();if(a){da();fa();a=ma(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}}function b(a){na(a,e)||aa(a,e,{value:{}})}function d(a){var d=Object[a];d&&(Object[a]=function(a){b(a);return d(a)})}if(function(){if(!c||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),d=new c([[a,2],[b,3]]);if(2!=d.get(a)||3!=d.get(b))return!1;d.delete(a);d.set(b,4);return!d.has(a)&&4==d.get(b)}catch(n){return!1}}())return c;
var e="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var f=0;a.prototype.set=function(a,d){b(a);if(!na(a,e))throw Error("WeakMap key fail: "+a);a[e][this.Nj]=d;return this};a.prototype.get=function(a){return na(a,e)?a[e][this.Nj]:void 0};a.prototype.has=function(a){return na(a,e)&&na(a[e],this.Nj)};a.prototype.delete=function(a){return na(a,e)&&na(a[e],this.Nj)?delete a[e][this.Nj]:!1};return a});
la("Map",function(c){function a(){var a={};return a.qa=a.next=a.head=a}function b(a,b){var d=a.vf;return ia(function(){if(d){for(;d.head!=a.vf;)d=d.qa;for(;d.next!=d.head;)return d=d.next,{done:!1,value:b(d)};d=null}return{done:!0,value:void 0}})}function d(a,b){var d=b&&typeof b;"object"==d||"function"==d?f.has(b)?d=f.get(b):(d=""+ ++h,f.set(b,d)):d="p_"+b;var e=a.jj[d];if(e&&na(a.jj,d))for(a=0;a<e.length;a++){var c=e[a];if(b!==b&&c.key!==c.key||b===c.key)return{id:d,list:e,index:a,Rc:c}}return{id:d,
list:e,index:-1,Rc:void 0}}function e(b){this.jj={};this.vf=a();this.size=0;if(b){b=ma(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),b=new c(ma([[a,"s"]]));if("s"!=b.get(a)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var d=b.entries(),e=d.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||
"t"!=e.value[1]||!d.next().done?!1:!0}catch(v){return!1}}())return c;da();fa();var f=new WeakMap;e.prototype.set=function(a,b){a=0===a?0:a;var e=d(this,a);e.list||(e.list=this.jj[e.id]=[]);e.Rc?e.Rc.value=b:(e.Rc={next:this.vf,qa:this.vf.qa,head:this.vf,key:a,value:b},e.list.push(e.Rc),this.vf.qa.next=e.Rc,this.vf.qa=e.Rc,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.Rc&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.jj[a.id],a.Rc.qa.next=a.Rc.next,a.Rc.next.qa=
a.Rc.qa,a.Rc.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.jj={};this.vf=this.vf.qa=a();this.size=0};e.prototype.has=function(a){return!!d(this,a).Rc};e.prototype.get=function(a){return(a=d(this,a).Rc)&&a.value};e.prototype.entries=function(){return b(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return b(this,function(a){return a.key})};e.prototype.values=function(){return b(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var d=this.entries(),
e;!(e=d.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var h=0;return e});
la("Set",function(c){function a(a){this.Re=new Map;if(a){a=ma(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.Re.size}if(function(){if(!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new c(ma([a]));if(!d.has(a)||1!=d.size||d.add(a)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=a||f.value[1]!=a)return!1;f=e.next();return f.done||f.value[0]==a||4!=f.value[0].x||
f.value[1]!=f.value[0]?!1:e.next().done}catch(h){return!1}}())return c;da();fa();a.prototype.add=function(a){a=0===a?0:a;this.Re.set(a,a);this.size=this.Re.size;return this};a.prototype.delete=function(a){a=this.Re.delete(a);this.size=this.Re.size;return a};a.prototype.clear=function(){this.Re.clear();this.size=0};a.prototype.has=function(a){return this.Re.has(a)};a.prototype.entries=function(){return this.Re.entries()};a.prototype.values=function(){return this.Re.values()};a.prototype.keys=a.prototype.values;
a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(a,d){var b=this;this.Re.forEach(function(e){return a.call(d,e,e,b)})};return a});
var q=function(){function c(a,b){this.type=a;this.values=b}c.Rl=function(a){a.toLowerCase()in c.Xr&&(a=c.Xr[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/,f=/hsl\( *([0-9]+) *, *([0-9]+)% *, *([0-9]+)% *\)/;var h=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])?/i.exec(a);if(null!==h)a=parseInt(h[1],16)/255,b=parseInt(h[2],16)/255,d=parseInt(h[3],
16)/255,h=h[4]?parseInt(h[4],16)/255:1;else if(h=e.exec(a),null!==h)a=parseFloat(h[1])/255,b=parseFloat(h[2])/255,d=parseFloat(h[3])/255,h=parseFloat(h[4]);else if(h=d.exec(a),null!==h)a=parseFloat(h[1])/255,b=parseFloat(h[2])/255,d=parseFloat(h[3])/255,h=1;else if(h=b.exec(a),null!==h)a=parseInt(h[1],16),a=(16*a+a)/255,b=parseInt(h[2],16),b=(16*b+b)/255,d=parseInt(h[2],16),d=(16*d+d)/255,h=1;else if(h=f.exec(a),null!==h)a=parseFloat(h[1])/360,b=parseFloat(h[2])/100,h=parseFloat(h[3])/100,0==b?b=
h=d=h:(d=.5>h?h*(1+b):h+b-h*b,e=2*h-d,b=oa(e,d,a+1/3),h=oa(e,d,a),d=oa(e,d,a-1/3)),a=b,b=h,h=1;else return null;return new c(c.RGBA,[a,b,d,h])};c.lf=function(a){return c.Rl(a)||new c(c.RGBA,[1,0,1,1])};c.AF=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};c.prototype.toString=function(){function a(a){a=pa(a);return 16>a?"0"+a.toString(16):a.toString(16)}var b=this.Th(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):
"rgba("+pa(b.values[0])+","+pa(b.values[1])+","+pa(b.values[2])+","+b.values[3]+")"};c.prototype.Th=function(a){return c.Ny[this.type][a](this)};c.prototype.ec=function(a){a.type!==this.type&&(a=a.Th(this.type));if(this.type===c.Fh){var b=this.values[0],d=a.values[0];b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*
(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.prototype.ez=function(a){var b=a;var d=this.Th(q.Un);b=b.Th(q.Un);a=d.values[0];var e=d.values[1],c=d.values[2],h=b.values[0],k=b.values[1],l=b.values[2];b=qa(ra(e,2)+ra(c,2));d=qa(ra(k,2)+ra(l,2));var n=(b+d)/2;n=.5*(1-qa(ra(n,7)/(ra(n,7)+ra(25,7))));e*=1+n;var r=(1+n)*k;k=qa(ra(e,2)+ra(c,2));n=qa(ra(r,2)+ra(l,2));var v=sa(c,e);r=sa(l,r);c=h-a;l=
n-k;if(0===b*d)e=0;else if(180>=ta(r-v))e=r-v;else if(180<r-v)e=r-v-360;else if(-180>r-v)e=r-v+360;else throw Error();e=2*qa(k*n)*ua(va/180*e/2);a=(a+h)/2;h=(k+n)/2;if(0===b*d)d=v+r;else if(180>=ta(v-r))d=(v+r)/2;else if(180<ta(v-r)&&360>v+r)d=(v+r+360)/2;else if(180<ta(v-r)&&360<=v+r)d=(v+r-360)/2;else throw Error();b=1-.17*xa(va/180*(d-30))+.24*xa(va/180*d*2)+.32*xa(va/180*(3*d+6))-.2*xa(va/180*(4*d-63));d=30*za(-ra((d-275)/25,2));k=qa(ra(h,7)/(ra(h,7)+ra(25,7)));a=1+.015*ra(a-50,2)/qa(20+ra(a-
50,2));n=1+.045*h;b=1+.015*h*b;d=-2*k*ua(va/180*d*2);return qa(ra(c/(1*a),2)+ra(l/(1*n),2)+ra(e/(1*b),2)+l/(1*n)*d*(e/(1*b)))};c.RGBA=0;c.hs=1;c.Fh=2;c.Un=3;c.cF=3;c.Be="transparent";c.Lc="#ffffff";c.Oa="#000000";c.Ny=[[Aa,Ba,Ca,Da],[Ea,Aa,Fa,Ga],[Ha,Ia,Aa,Ja],[Ka,La,Ma,Aa]];c.Xr={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",
burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",
darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",
lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",
mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",
purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",
yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Na=.9505,Oa=1,Pa=1.089;function Ha(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),h=d*(1-e*b);b=d*(1-(1-e)*b);var k=e=0,l=0;switch(Math.floor(a/60)%6){case 0:e=d;k=b;l=f;break;case 1:e=h;k=d;l=f;break;case 2:e=f;k=d;l=b;break;case 3:e=f;k=h;l=d;break;case 4:e=b;k=f;l=d;break;case 5:e=d,k=f,l=h}return new q(q.RGBA,[e,k,l,c.values[3]])}
function Ca(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new q(q.Fh,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function Ga(c){function a(a){return a>6/29*(6/29)*(6/29)?Math.pow(a,1/3):1/3*(29/6)*(29/6)*a+4/29}var b=a(c.values[1]/Oa);return new q(q.Un,[116*b-16,500*(a(c.values[0]/Na)-b),200*(b-a(c.values[2]/Pa)),c.values[3]])}
function La(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new q(q.hs,[b>e?Na*b*b*b:3*(b-16/116)*e*e*Na,a>e?Oa*a*a*a:3*(a-16/116)*e*e*Oa,d>e?Pa*d*d*d:3*(d-16/116)*e*e*Pa,c.values[3]])}function Ba(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new q(q.hs,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function Ea(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new q(q.RGBA,b)}function Aa(c){return new q(c.type,c.values.concat())}function Da(c){return Ga(Ba(c))}function Ka(c){return Ea(La(c))}function Fa(c){return Ca(Ea(c))}
function Ia(c){return Ba(Ha(c))}function Ja(c){return Da(Ha(c))}function Ma(c){return Fa(La(c))}var qa=Math.sqrt,ra=Math.pow,xa=Math.cos,Qa=Math.atan2,ua=Math.sin,ta=Math.abs,za=Math.exp,va=Math.PI;function sa(c,a){if(0===c&&0===a)return 0;c=Qa(c,a)*(180/va);return 0<=c?c:c+360}function pa(c){return Math.min(Math.floor(256*c),255)}function oa(c,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(a-c)*b:.5>b?a:b<2/3?c+(a-c)*(2/3-b)*6:c};function Ra(c,a){void 0===a&&(a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");for(var b="",d,e,f,h,k,l,n=0;n<c.length;)d=c[n++],e=c[n++],f=c[n++],h=d>>2,d=(d&3)<<4|e>>4,k=(e&15)<<2|f>>6,l=f&63,isNaN(e)?k=l=64:isNaN(f)&&(l=64),b=b+a.charAt(h)+a.charAt(d)+a.charAt(k)+a.charAt(l);return b};function Sa(c){for(var a=c.length,b=0,d,e,f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d)if(f===a&&(b+=3),e=c.charCodeAt(f),56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b+=4;continue}}else b+=3;b=127>=d?b+1:2047>=d?b+2:b+3}b=new Uint8Array(b);var h=-1;for(f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d){if(f===a){b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;break}e=c.charCodeAt(f);if(56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b[h+=1]=240|d>>>
18;b[h+=1]=128|d>>>12&63;b[h+=1]=128|d>>>6&63;b[h+=1]=128|d&63;continue}}else{b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;continue}}127>=d?b[h+=1]=0|d:(2047>=d?b[h+=1]=192|d>>>6:(b[h+=1]=224|d>>>12,b[h+=1]=128|d>>>6&63),b[h+=1]=128|d&63)}return b};var u=new (function(){function c(){this.disabled={};this.Qe=[];this.it=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.AB(a,arguments)}};c.prototype.addListener=function(a){this.Qe.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.Qe.length;b++)if(this.Qe[b]===a){this.Qe.splice(b,1);break}};c.prototype.wz=
function(){this.it||(this.it=!0,this.addListener(function(a,b){console.log(a+": "+b)}))};c.prototype.AB=function(a,b){var d=[],e;if(0!==this.Qe.length){var c=b[0].split("%s");d.push(c[0]);for(e=1;e<c.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(c[e]);b=
d.join("");d=0;for(e=this.Qe;d<e.length;d++)(0,e[d])(a,b)}};return c}());function Ta(c){return parseFloat(c||"")||0}
var Va=function(){function c(a){this.da=a}c.prototype.Za=function(a){for(var b in a){if(0<=b.indexOf("-"))throw Error("setStyle: styles must be camelcase; not "+b);this.da.style[b]=""+a[b]}return this};c.prototype.sk=function(a){for(var b in a)this.da.setAttribute(b,a[b]);return this};c.prototype.Vd=function(a){a.appendChild(this.da);return this};c.prototype.Sp=function(a){a.parentNode&&a.parentNode.insertBefore(this.da,a.nextSibling)};c.prototype.insertBefore=function(a){a.parentNode&&a.parentNode.insertBefore(this.da,
a);return this};c.prototype.remove=function(){this.da.parentNode&&this.da.parentNode.removeChild(this.da);return this};c.prototype.Me=function(a){return window.getComputedStyle(this.da)[a]||""};c.prototype.gc=function(){var a=this.da.getBoundingClientRect();return{top:a.top+window.pageYOffset,left:a.left+window.pageXOffset,width:a.width,height:a.height}};c.prototype.vk=function(a){var b=(b=this.PA())?b.gc():{left:0,top:0};this.da.style.left=a.left-b.left+"px";this.da.style.top=a.top-b.top+"px"};c.prototype.PA=
function(){if(!(this.da instanceof HTMLElement)||"fixed"===this.Me("position"))return Ua(document.body);for(var a=this.da.parentElement;a&&"static"===Ua(a).Me("position");)a=a.parentElement;return a?Ua(a):null};c.prototype.am=function(){var a=window.getComputedStyle(this.da),b={left:Ta(a.marginLeft),top:Ta(a.marginTop),right:Ta(a.marginRight),bottom:Ta(a.marginBottom),eq:0,Tq:0,Dr:0,wo:0};"content-box"===a.boxSizing&&(b.eq+=Ta(a.borderLeftWidth)+Ta(a.paddingLeft),b.Dr+=Ta(a.borderTopWidth)+Ta(a.paddingTop),
b.Tq+=Ta(a.borderRightWidth)+Ta(a.paddingRight),b.wo+=Ta(a.borderBottomWidth)+Ta(a.paddingBottom));return b};c.prototype.le=function(a){this.da.classList.add(a);return this};c.prototype.zr=function(a,b){b?this.da.classList.add(a):this.da.classList.remove(a)};c.prototype.addEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.da.addEventListener(a[e],b,d);return this};c.prototype.removeEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<
a.length;e++)this.da.removeEventListener(a[e],b,d);return this};c.prototype.matches=function(a){var b=this.da;if(this.da.matches)return this.da.matches(a);if(b.msMatchesSelector)return b.msMatchesSelector(a);b=0;for(a=a.split(",");b<a.length;b++){var d=a[b];d=d.trim();if(0!=d.length)return"["==d[0]?this.da.hasAttribute(d.substr(1,d.length-2)):this.da.tagName===d.toUpperCase()}return!1};c.prototype.query=function(a,b){this.matches(a)&&b(this.da);Array.prototype.forEach.call(this.da.querySelectorAll(a),
b)};c.prototype.clear=function(){for(;null!==this.da.firstChild;)this.da.removeChild(this.da.firstChild);return this};c.prototype.ug=function(a){this.da.innerText=a;return this};return c}();function Ua(c,a){if("string"===typeof c){if("<"==c[0])return a=Ua.Xo(c),new Va(a[0]);c=new Va(document.createElement(c));a&&c.sk(a);return c}return new Va(c)}var Wa=null;
(function(c){c.tc=function(a){return"jQuery"in window&&a instanceof window.jQuery?a[0]:a instanceof HTMLElement?a:"string"===typeof a?document.querySelector(a):null};c.km=function(){var a=document.documentElement,b=a.scrollWidth>a.clientWidth;a=a.scrollHeight>a.clientHeight?c.Wg():0;b=b?c.Wg():0;return{width:window.innerWidth-a,height:window.innerHeight-b,left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}};c.Wg=function(){if(null===
Wa){var a=document.createElement("div");a.style.visibility="hidden";a.style.width="100px";document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%";a.appendChild(d);d=d.offsetWidth;a.parentNode.removeChild(a);Wa=b-d}return Wa};c.du=function(){for(var a=document.getElementsByTagName("*"),b=0,d=0;d<a.length;d++){var e=parseInt(c(a[d]).Me("z-index"),10)||0;e>b&&(b=e)}return b};c.Xo=function(a){var b=document.createElement("div");
b.innerHTML=a;a=[];for(var d=b.firstChild;d;)d instanceof HTMLElement&&a.push(d),d=d.nextSibling;for(d=0;d<a.length;d++)b.removeChild(a[d]);return a};c.xf=function(a,b){if(!(a instanceof HTMLElement))return!1;switch(a.tagName){case "INPUT":case "TEXTAREA":case "OPTION":case "SELECT":return!0;case "BUTTON":return b instanceof KeyboardEvent?"Enter"===b.key:!0}return a.isContentEditable?!0:!1};c.nB=function(a){var b=a;if(!("ZwibblerTainted"in b)){if(!(a instanceof HTMLCanvasElement)){var d=document.createElement("canvas");
d.getContext("2d").drawImage(a,0,0,1,1,0,0,1,1);a=d}try{a.getContext("2d").getImageData(0,0,1,1),b.ZwibblerTainted=!1}catch(e){b.ZwibblerTainted=!0}}return b.ZwibblerTainted}})(Ua||(Ua={}));
function Xa(c){return new Promise(function(a,b){var d=new XMLHttpRequest;c.mimeType&&d.overrideMimeType(c.mimeType);c.withCredentials&&(d.withCredentials=!0);c.responseType&&(d.responseType=c.responseType);var e=c.method||"GET",f=c.oC||{},h=c.url,k="",l=!0,n=!1,r=null,v;for(v in f){if(f[v]instanceof Blob){n=!0;e="POST";break}l||(k+="&");l=!1;k+=v+"="+encodeURIComponent(f[v])}"GET"===e&&0<k.length&&(h+="?"+k,k="");if(n){r=new FormData;for(var x in f)r.append(x,f[x])}d.onreadystatechange=function(){if(4===
d.readyState)if(200===d.status)a(d);else{var e=d.statusText;0===d.status?e="Could not contact server.":d.getResponseHeader("status")&&(e=d.getResponseHeader("status"));b(Error(d.status+" "+e))}};d.open(e,h,!0);if(c.headers)for(var w in c.headers)d.setRequestHeader(w,c.headers[w]);var y="string"===typeof c.data?c.data:r?r:k;c.contentType?d.setRequestHeader("Content-type","application/json"):"POST"!==e||n||d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.cancel&&c.cancel.then(function(){d.abort()});
c.nt?setTimeout(function(){d.send(y)},c.nt):d.send(y)})}
var Ya=function(){function c(){this.Up=[];this.cc=null}c.prototype.Qp=function(a){for(var b=0,d=this.Up;b<d.length;b++)if(d[b]===a)return;this.Up.push(a);this.cc||(this.cc=document.createElement("style"),document.head&&document.head.insertBefore(this.cc,document.head.firstChild));this.cc.appendChild(document.createTextNode(a))};c.prototype.Ta=function(){this.cc&&(Ua(this.cc).remove(),this.cc=null);this.Up.length=0};return c}(),Za=function(){function c(){this.input=null}c.prototype.Ta=function(){this.input&&
this.input.parentNode&&this.input.parentNode.removeChild(this.input)};c.prototype.open=function(a){var b=this;return new Promise(function(d){b.input&&b.input.parentNode&&b.input.parentNode.removeChild(b.input);b.input=document.createElement("input");b.input.style.display="none";b.input.setAttribute("id","ZwibblerFileInput");b.input.setAttribute("type","file");"string"===typeof a.capture&&b.input.setAttribute("capture",a.capture);document.body.appendChild(b.input);a.accept&&b.input.setAttribute("accept",
a.accept);var e=new FileReader,c="";b.input.addEventListener("change",function(){var b=this.files;b&&0<b.length&&(c=b[0].type,"data-uri"===a.format?e.readAsDataURL(b[0]):"text"===a.format?e.readAsText(b[0]):"ArrayBuffer"===a.format?e.readAsArrayBuffer(b[0]):"File"===a.format&&d({contentType:c,data:b[0]}))});e.addEventListener("load",function(){d({contentType:c,data:e.result})});b.input.value="";b.input.click()})};return c}(),$a=function(){function c(){this.Fb=[];this.log=u.create("FileSaver")}c.prototype.Ta=
function(){for(var a=this.Fb.length-1;0<=a;a--)this.at(this.Fb[a])};c.prototype.at=function(a){clearTimeout(a.timeout);window.URL.revokeObjectURL(a.VB);a.anchor.parentNode&&a.anchor.parentNode.removeChild(a.anchor);for(var b=0;b<this.Fb.length;b++)if(this.Fb[b]===a){this.Fb.splice(b,1);break}};c.prototype.cD=function(a,b){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var e=new ArrayBuffer(d.length),c=new Uint8Array(e),h=0;h<d.length;h++)c[h]=d.charCodeAt(h);d=[e];a=
{type:a};try{var k=new File(d,b,a)}catch(l){k=new Blob(d,a)}this.ew(k,b)};c.prototype.ew=function(a,b){var d=this;this.Ta();if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,b);else{var e=window.URL.createObjectURL(a),c=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,h=!!navigator.userAgent.toLowerCase().match(/(iphone|ipad)/);this.log("isIPadPro=%s isIPad=%s isPDF=%s",c,h,"application/pdf"===a.type);this.log("Using blob object url %s",e);if(h)this.log("iIOS; open in new tab"),
window.open(e,"_blank");else{this.log("Sane browser; open using <a download> tag");var k={VB:e,timeout:0,anchor:document.createElement("a")};this.Fb.push(k);k.anchor.innerHTML="download";k.anchor.setAttribute("href",e);k.anchor.setAttribute("download",b);k.anchor.style.display="none";document.body.appendChild(k.anchor);k.anchor.click();k.timeout=setTimeout(function(){d.at(k)},1E3)}}};return c}(),ab=function(){function c(a,b){this.element=a;this.kg=null;"ResizeObserver"in window&&(this.kg=new window.ResizeObserver(function(){b()}),
this.kg.observe(a))}c.prototype.Ta=function(){this.kg&&this.kg.unobserve(this.element)};c.tx=function(){return"ResizeObserver"in window};return c}(),z=Ua;var bb=function(){function c(a,b,d,e,c){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===c&&(c=0);this.Nc=a;this.left=b;this.top=d;this.right=e;this.bottom=c;this.zIndex=1;this.insertBefore=null;this.va=document.createElement("div")}c.prototype.wf=function(){this.va&&z(this.va).remove()};c.prototype.show=function(a){z(this.va).Za({position:"fixed",background:this.Nc,left:this.left+"px",top:this.top+"px",right:this.right+"px",bottom:this.bottom+"px",display:"block"}).le("zwibbler-popup-overlay");
this.va.addEventListener("click",a);this.va.style.zIndex=this.zIndex.toString();this.insertBefore?this.insertBefore.parentNode&&this.insertBefore.parentNode.insertBefore(this.va,this.insertBefore):document.body.appendChild(this.va)};return c}();var cb=u.create("DRAGSORT");
function db(c){function a(a){"dragover"!==a.type&&cb(a.type);for(var b=a.target;b.parentNode!==c.parent&&b.parentNode;)b=b.parentNode;if(1===b.nodeType&&b.getAttribute("draggable")&&"false"!==b.getAttribute("draggable").toLowerCase()&&b.parentNode===c.parent)if("dragstart"===a.type){for(var d=c.parent.children,e=0;e<d.length;e++)null!==d[e].getAttribute(c.Us)&&d[e].setAttribute("sort-index",e.toString());a.dataTransfer.setData("text",b.id);a.dataTransfer.dropEffect="move";h=f=b;a.stopPropagation()}else"dragover"===
a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.xq),h=b,h.classList.add(c.xq),a.preventDefault()):"dragend"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.xq),b=parseInt(h.getAttribute("sort-index")||"0"),d=parseInt(f.getAttribute("sort-index")||"0"),c.eC(d,b),a.preventDefault(),a.stopPropagation()):"drop"===a.type&&(a.preventDefault(),a.stopPropagation())}var b=c.parent.wx;c.parent.wx=!0;for(var d=c.parent.children,e=0;e<d.length;e++)null!==d[e].getAttribute(c.Us)&&d[e].setAttribute("draggable",
"true");if(b)return function(){};z(c.parent).addEventListener("dragstart dragover dragend drop",a);var f,h;return function(){z(c.parent).removeEventListener("dragstart dragover dragend drop",a)}};var eb=function(){function c(a,b){this.name=b;this.va=z("div").Za({borderTop:"1px solid #888",padding:"5px",cursor:"default"}).Vd(a);this.update(0)}c.prototype.update=function(a){this.va.da.innerText=this.name+"... "+Math.round(100*a)+"%"};c.prototype.error=function(a){var b=this,d=document.createElement("input");d.setAttribute("type","button");d.value="OK";d.addEventListener("click",function(){b.done()});this.va.da.innerText=this.name+"... "+a+" ";this.va.da.appendChild(d)};c.prototype.done=function(){this.va.remove()};
c.all=[];return c}();var gb=function(){function c(a,b,d){this.parentElement=a;this.stack=[];this.uh=!1;this.Kf=[];this.VD=!1;this.Cv="red";this.first=z("CANVAS",{width:b,height:d}).Vd(a).da;this.stack.push({canvas:this.first,ma:this.first.getContext("2d"),Yi:{}});this.pe=c.$r(this.stack[0].ma);this.width=this.first.width;this.height=this.first.height;this.cl(this.first)}c.prototype.GD=function(a){for(var b=0,d=this.stack;b<d.length;b++)d[b].canvas.style.outline="4px solid "+a;this.Cv=a};c.prototype.Hx=function(){if(void 0===
a)var a=this.stack.length;var b=z("CANVAS").Za({position:"absolute",left:this.first.offsetLeft+"px",top:this.first.offsetTop+"px",pointerEvents:"none",outline:"4px solid "+this.Cv}).le("zwibbler-overlay").da;this.cl(b);this.stack.splice(a,0,{canvas:b,ma:b.getContext("2d"),Yi:{}});a===this.stack.length-1?this.parentElement.insertBefore(b,null):this.parentElement.insertBefore(b,this.stack[a+1].canvas);b.getContext("2d")};c.prototype.Od=function(a,b,d){var e=this;this.stack[a].Yi[b]=d;if(!this.uh){var c=
(new Date).getTime();this.uh=!0;requestAnimationFrame(function(){var a=(new Date).getTime(),b=e.qp();e.uh=!1;for(var d=0,f=e.stack;d<f.length;d++){var r=f[d],v=!0,x;for(x in r.Yi){var w=r.ma;v&&(w.setTransform(b,0,0,b,0,0),w.clearRect(0,0,e.width,e.height),v=!1);r.Yi[x](w,b)}r.Yi={}}if(e.VD){e.Kf.push({Pb:a,latency:a-c,sz:(new Date).getTime()-a});25<e.Kf.length&&e.Kf.shift();w=f=d=0;for(r=e.Kf;w<r.length;w++)v=r[w],d+=v.latency,f+=v.sz;d=Math.round(d/e.Kf.length*10)/10;f=Math.round(f/e.Kf.length*
10)/10;a=1<e.Kf.length?Math.round(e.Kf.length/((a-e.Kf[0].Pb)/1E3)*100)/100:0;w=e.get(0);w.setTransform(b,0,0,b,0,0);w.fillStyle="white";b="latency="+d+"ms drawTime="+f+"ms fps="+a;w.fillRect(0,0,w.measureText("latency=MM.MMms drawTime=MM.MMms fps=MM").width,13);w.textBaseline="top";w.font="10px arial";w.fillStyle="red";w.fillText(b,2,2)}})}};c.prototype.get=function(a){return this.stack[a].ma};c.prototype.qp=function(){var a=c.$r(this.stack[0].ma);if(a!==this.pe){this.pe=a;a=0;for(var b=this.stack;a<
b.length;a++)this.cl(b[a].canvas)}return this.pe};c.prototype.tg=function(a,b){this.width=a;this.height=b;a=0;for(b=this.stack;a<b.length;a++)this.cl(b[a].canvas)};c.$r=function(a){return(window.devicePixelRatio||1)/(a.QE||a.LB||a.OB||a.UB||a.gy||1)};c.prototype.cl=function(a){a.width=this.width*this.pe;a.height=this.height*this.pe;a.style.width=this.width+"px";a.style.height=this.height+"px";a.getContext("2d").setTransform(this.pe,0,0,this.pe,0,0)};return c}();var ib=function(){function c(){this.items=[];this.next=0;this.Yf=!1;this.log=u.create("UNDOSTACK")}c.prototype.wa=function(a,b,d){void 0===b&&(b=!1);a=a instanceof hb?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].sc(d);for(d=this.top();d;)if(d[d.length-1].eh(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.Yf=!0;this.next=this.items.length}};c.prototype.Xc=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.df()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].Xc(a);return this.Yf=!0}return!1};c.prototype.ye=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.cf()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].sc(a);return this.Yf=!0}return!1};c.prototype.df=function(){return 0<this.next};c.prototype.cf=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.Yf=
!1};c.prototype.top=function(){return this.items.length?this.items[this.items.length-1]:null};c.prototype.gu=function(){return this.items.length};return c}(),hb=function(){function c(){}c.prototype.sc=function(){};c.prototype.Xc=function(){};c.prototype.eh=function(){return!1};return c}();function jb(c,a,b){this.Na=c;this.sn=a;this.fn=b;this.wn=0}
var kb=0,lb=new (function(){function c(){this.$b=[];this.xr=!1;this.log=u.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.$b.length);for(var b=0;b<this.$b.length;b++)this.$b[b].Na.complete?this.$b[b].fn(this.$b[b].Na,this.$b[b].sn):5E3>this.$b[b].wn?(this.$b[b].wn+=250,a.push(this.$b[b])):this.$b[b].fn(this.$b[b].Na,this.$b[b].sn);this.$b=a;this.$b.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.xr=!1)};c.prototype.load=
function(a,b,d){var e=this;void 0===d&&(d=!1);0==kb?this.us(a,b,d):setTimeout(function(){e.us(a,b,d)},kb)};c.prototype.us=function(a,b,d){function e(a){for(var b=0;b<c.$b.length;b++){var d=c.$b[b];if(d.Na===a)return c.$b.splice(b,1),d}return null}var c=this,h=document.createElement("img"),k=new jb(h,a,b);this.$b.push(k);var l=0<=a.indexOf("://"),n="://"+window.location.host,r=0!==a.indexOf("data:")&&l&&-1===a.indexOf(n);r&&!d&&(this.log("Using cross origin request for img"),h.crossOrigin="");h.addEventListener("load",
function(){if(h.complete){var a=e(h);a&&b(h,a.sn)}else c.xr||(c.xr=!0,setTimeout(c.timeout,250),k.wn=250)},!1);h.addEventListener("error",function(){c.log("Error loading %s; useCors=%s disableCors=%s",a,r,d);e(h);!r||d?b(null,k.sn):c.load(a,b,!0)},!1);h.src=a};c.prototype.sD=function(a){kb=a};return c}());var mb=function(){function c(){this.images={}}c.prototype.add=function(a,b){var d=this.images[a];d||(d={Na:null,Xm:0},lb.load(b,function(a){d.Na=a}),this.images[a]=d);d.Xm+=1};c.prototype.release=function(a){var b=this.images[a];b&&(--b.Xm,0>=b.Xm&&delete this.images[a])};c.prototype.get=function(a){return(a=this.images[a])&&a.Na?a.Na:null};return c}();var ob=function(){function c(a){this.code="en";this.data={};this.log=u.create("LANGUAGE");this.data=this.Ev(a,{})}c.prototype.uw=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.no=function(a){this.Ev(a,this.data)};c.prototype.Ev=function(a,b){a=a.split("\n");for(var d=/^([ \t]*)([^:]+):([^:]+):(.*)/,
e=0;e<a.length;e++){var c=d.exec(a[e]);if(c){var h=c[2],k=c[3];c=c[4];h in b||(b[h]={});k in b[h]&&this.log("Warning: Replacing %s:%s",h,k);b[h][k]=c}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.qs(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.qs(a,b)};c.prototype.qs=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(a=0;a<b.length;a++)d=d.replace("^"+a,b[a]);return d};return c}();var pb=function(){function c(){this.lj=[];this.log=u.create("DESTRUCTOR")}c.prototype.add=function(a){this.lj.push(a)};c.prototype.addEventListener=function(a,b,d,e){function c(b){a.addEventListener(b,d,e);h.add(function(){a.removeEventListener(b,d,e)})}var h=this;void 0===e&&(e=!1);var k=0;for(b=b.split(" ");k<b.length;k++)c(b[k])};c.prototype.pa=function(a,b,d){a.pa(b,d);this.add(function(){a.removeListener(b,d)})};c.prototype.Ta=function(){this.log("Running %s destructors",this.lj.length);for(var a=
this.lj.length-1;0<=a;a--)this.lj[a]();this.lj.length=0};return c}();var qb=function(){function c(a,b,d){var e=this;void 0===d&&(d=!1);this.va=a;this.$j=0;this.bq={};this.Ob=!1;this.timeout=null;this.lines=[];this.filter=null;this.Cy="#5da700 #ed81ff #02ab34 #f92798 #59ff91 #ff6b80 #3cffe4 #ffd32b #5e8caa #ffdb7f #e5cdff #00c17e #f6f6f5 #9a861e #daff9d #808d40".split(" ");this.Dy="#2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #805221 #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.Rh=[];var c=new Ya;c.Qp('\n\n.z-inner-debug.black {\n    background: #000;\n    white-space: pre-wrap;\n}\n\n.z-inner-debug.white {\n    background: #fff;\n}\n\n.z-debug-panel {\n    font-family: "monospace";\n    font-size: 12px;\n    display: flex;\n    flex-flow: column nowrap;\n    text-align: left;\n}\n\n.z-inner-debug {\n    flex: 1 1 auto;\n    overflow: scroll;\n}\n\n.z-inner-debug.black div {\n    border-bottom: 1px solid #222;\n    margin-bottom: 3px;\n}\n\n.z-inner-debug.white div {\n    border-bottom: 1px solid #eee;\n    margin-bottom: 3px;\n}\n');
a.classList.add("z-debug-panel");var h=0;z("input").sk({type:"text",placeholder:"regexp...",onclick:"this.select()"}).Vd(a).addEventListener("input",function(a){h&&window.clearTimeout(h);h=setTimeout(function(){e.xD(a.target.value);h=0},200)});this.ae=z("div").le("z-inner-debug").Vd(a).da;z("button").Vd(this.va).Za({flex:"0 0 auto"}).ug("Scroll to bottom/top").addEventListener("click",function(){e.ae.scrollTop=e.Rs()?0:e.ae.scrollHeight});this.xB=u.addListener(function(a,b){return e.Gs(a,b)});b.add(function(){u.removeListener(e.xB);
c.Ta()});this.Gs("DEBUG","Debug window starting");z(this.ae).le(d?"white":"black");this.Rh=d?this.Dy:this.Cy}c.prototype.show=function(){this.va.style.display="flex";this.Ob=!0;this.js();this.ae.scrollTop=this.ae.scrollHeight};c.prototype.wf=function(){this.va.style.display="none";this.Ob=!1};c.prototype.bA=function(a){a in this.bq||(this.bq[a]=this.Rh[this.$j],this.$j=(this.$j+1)%this.Rh.length);return this.bq[a]};c.prototype.Gs=function(a,b){var d=this,e=0;for(b=b.split("\n");e<b.length;e++)this.lines.push({key:a,
line:b[e]});this.Ob&&null===this.timeout&&(this.timeout=setTimeout(function(){d.timeout=null;d.js()},100))};c.prototype.xD=function(a){if(2>a.length)this.filter=null;else try{this.filter=new RegExp(a,"i")}catch(d){}for(a=this.ae.firstChild;a;){var b=a;1===b.nodeType&&"DIV"===b.tagName&&(!this.filter||this.filter.exec(b.textContent)?b.style.display="block":b.style.display="none");a=a.nextSibling}};c.prototype.Rs=function(){return this.ae.scrollTop>=this.ae.scrollHeight-this.ae.clientHeight};c.prototype.js=
function(){for(var a=this.Rs(),b=0,d=this.lines;b<d.length;b++){var e=d[b],c=this.bA(e.key),h=document.createElement("div");h.style.color=c;e=e.key+": "+e.line;this.filter&&!this.filter.exec(e)&&(h.style.display="none");h.appendChild(document.createTextNode(e));this.ae.appendChild(h)}a&&(this.ae.scrollTop=this.ae.scrollHeight);this.lines.length=0};return c}();var rb=u.create("EventEmitter"),sb=function(){function c(){this.bk=!1;this.lb={};this.Je=[];this.Kl={}}c.prototype.ta=function(a){for(var b=this,d=1;d<arguments.length;d++);this.Je.push(Array.prototype.slice.apply(arguments));1===this.Je.length&&setTimeout(function(){for(var a=0;a<b.Je.length;a++)b.Qo.apply(b,b.Je[a]);b.Je.length=0},0)};c.prototype.rc=function(a){for(var b=1;b<arguments.length;b++);this.Je.push(Array.prototype.slice.apply(arguments));if(1===this.Je.length){for(b=0;b<this.Je.length;b++)this.Qo.apply(this,
this.Je[b]);this.Je.length=0}};c.prototype.cg=function(a){for(var b=this,d=1;d<arguments.length;d++);d=Array.prototype.slice.apply(arguments);var e=d[0];e in this.Kl||setTimeout(function(){var a=b.Kl[e];delete b.Kl[e];b.Qo.apply(b,a)},0);this.Kl[e]=d};c.prototype.Qo=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a in this.lb){d=this.lb[a];this.bk||rb("Emit %s",a);for(var e=0;e<d.length;e++)d[e].apply(null,b)}};c.prototype.pa=function(a,b){this.lb||(this.lb={});var d=0;
for(a=a.split(" ");d<a.length;d++)this.bind(a[d],b)};c.prototype.once=function(a,b){function d(){e.Nw(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.lb?this.lb[a].push(b):this.lb[a]=[b];return b};c.prototype.removeListener=function(a,b){return this.Nw(a,b)};c.prototype.Nw=function(a,b){var d,e;if(a in this.lb){var c=this.lb[a];var h=d=0;for(e=c.length-1;d<=e;h=d+=1)if(c[h]===b){c.splice(h,1);break}0===c.length&&delete this.lb[a]}};c.prototype.aj=function(){this.lb=
{}};return c}();var tb=function(c){function a(){var a=c.call(this)||this;a.keys={};a.bk=!0;a.$D=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(a,b){return b.length-a.length}).join("|"),"g");a.log=u.create("KEYMAP");a.mm=function(b){a.dB(b)};return a}__extends(a,c);a.prototype.map=function(a,d,e){void 0===e&&(e=!0);a=a.toLowerCase().split(",");var b;if("string"===typeof d)for(d=d.split(","),
b=0;b<a.length;b++)for(var c=0;c<d.length;c++)this.ks(a[b],d[c],!e);else for(b=0;b<a.length;b++)this.ks(a[b],d,!e)};a.prototype.Hr=function(a,d){this.map(a,d,!1)};a.prototype.ks=function(a,d,e){if(0!==a.length){var b=!1;0===a.indexOf("up:")&&(a=a.substr(3),b=!0);var c=a.match(this.$D)||[],k=!1,l=!1,n=!1,r=!1,v=[],x;for(x=0;x<c.length;x++)switch(c[x]){case "alt":n=!0;break;case "control":case "ctrl":l=!0;break;case "shift":k=!0;break;case "home":v.push(36);break;case "end":v.push(35);break;case "pageup":v.push(33);
break;case "pagedown":v.push(34);break;case "delete":case "del":v.push(46);break;case "backspace":v.push(8);break;case "up":v.push(38);break;case "right":v.push(39);break;case "down":v.push(40);break;case "left":v.push(37);break;case "escape":case "esc":v.push(27);break;case "enter":v.push(13);break;case "ins":case "insert":v.push(45);break;case "space":v.push(32);break;case "f4":v.push(115);break;case "meta":case "command":case "cmd":case "\u2318":r=!0;break;default:alert("key entry not found: "+
c[x])}var w=this;c=function(a){b&&(a="up:"+a);k&&-1===a.indexOf("-shift")&&(a+="-shift");l&&-1===a.indexOf("-control")&&(a+="-control");n&&-1===a.indexOf("-alt")&&(a+="-alt");r&&-1===a.indexOf("-meta")&&(a+="-meta");"string"===typeof d?w.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,d):w.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,"function()");if(e){if(a in w.keys){for(var c=[],f=0,h=w.keys[a];f<h.length;f++){var x=h[f];x!==d&&c.push(x)}w.keys[a]=c}}else if(a in w.keys){f=w.keys[a];for(c=
0;c<f.length&&f[c]!==d;c++);c===f.length&&w.keys[a].push(d)}else w.keys[a]=[d]};if(0===v.length)switch(a.toLowerCase()){case "alt":c("18");break;case "shift":c("16");break;case "control":case "ctrl":c("17");break;default:switch(a=a.toUpperCase().charAt(a.length-1),a){case "=":c("107-shift");c("187");c("61");break;case "+":c("107");c("61-shift");break;case "-":c("109");c("189");c("173");break;default:v.push(a.charCodeAt(0))}}for(x=0;x<v.length;x++)c(""+v[x])}};a.prototype.zA=function(a){var b="";"keyup"===
a.type&&(b="up:");a.keyCode&&(b+=a.keyCode);if(a.shiftKey||16===a.keyCode)b+="-shift";if(a.ctrlKey||17===a.keyCode)b+="-control";if(a.altKey||18===a.keyCode)b+="-alt";a.metaKey&&(b+="-meta");return b};a.prototype.translate=function(a){var b=[],e=this.zA(a);e in this.keys&&(b=this.keys[e]);(32>a.keyCode||126<=a.keyCode)&&this.log("%s",e);return b};a.prototype.dB=function(a){for(var b=0,e=this.translate(a);b<e.length;b++){var c=e[b];"string"===typeof c?(this.log("action: %s",c),this.rc("*",c,a)):c(a)}};
a.prototype.Ss=function(a){var b;void 0===b&&(b=!1);a.addEventListener("keydown",this.mm,b);a.addEventListener("keyup",this.mm,b)};a.prototype.detach=function(a,d){void 0===d&&(d=!1);a.removeEventListener("keydown",this.mm,d);a.removeEventListener("keyup",this.mm,d)};return a}(sb);var ub={1:"INITIAL CONNECTION",2:"APPEND",3:"SET-KEY",4:"BROADCAST",128:"ERROR",129:"ACK/NACK",130:"KEY-INFORMATION",131:"SET-KEY-ACK",255:"CONTINUATION"},vb={0:"No",1:"Yes"},wb={0:"NACK",1:"ACK"};function B(c,a,b,d){return{length:c,type:a,name:b,pF:d}}
var xb={1:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(2,0,"protocolVersion"),B(4,0,"maxSize"),B(1,0,"creationMode",{0:"POSSIBLY_CREATE",1:"NEVER_CREATE",2:"ALWAYS_CREATE"}),B(8,0,"offset"),B(1,0,"docIDLength"),B(-1,1,"docID"),B(-2,1,"data")],2:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(8,0,"offset"),B(-2,1,"data")],3:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(2,0,"requestID"),B(1,0,"lifetime",{0:"CLIENT-LIFETIME",1:"SESSION-LIFETIME"}),B(4,0,"oldVersion"),B(4,0,"newVersion"),B(4,0,"nameLength"),
B(-1,1,"name"),B(4,0,"valueLength"),B(-1,1,"value")],4:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(4,0,"dataLength"),B(-1,1,"data")],128:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(2,0,"errorCode",{0:"UNSPECIFIED",1:"DOES_NOT_EXIST",2:"ALREADY_EXISTS",3:"INVALID_OFFSET"}),B(-2,1,"description")],129:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(2,0,"ack",wb),B(8,0,"offset")],130:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(0,2,"keys"),B(4,0,"version"),B(4,0,"nameLength"),B(-1,1,"name"),B(4,0,"valueLength"),
B(-1,1,"value")],131:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(2,0,"ack",wb),B(2,0,"requestID")],255:[B(1,0,"messageType",ub),B(1,0,"more",vb),B(-2,1,"data")]};
function yb(c){var a=xb[c.messageType];if(!a)throw Error("no encoder for message type "+c.messageType);for(var b=[],d=0;d<a.length;d++){var e=a[d];if(!(e.name in c))throw Error("missing field "+e.name);var f=c[e.name];if(0===e.type){var h=b;e=e.length;do--e,h.push(Math.floor(f/Math.pow(2,8*e)%256));while(0<e)}else if(f instanceof Uint8Array)for(h=0;h<f.length;h++)b.push(f[h]);else for(h=b,f=Sa(f),e=0;e<f.length;e++)h.push(f[e])}return new Uint8Array(b)}
function zb(c){var a=xb[c[0]];if(!a)return null;for(var b={},d=b,e=0,f=0,h="",k=0,l=0;l<a.length;l++){var n=a[l],r;if(2===n.type)h=n.name,b={},d[h]=[b],k=l;else{if(0===n.type){e=f;var v=n.length;for(r=0;v;)r=256*r+c[e],--v,e+=1;r=e=r;f+=n.length}else{v=e;-2===n.length&&(v=c.length-f,b[n.name+"_length"]=v);r=v;void 0===r&&(r=c.length-f);r=Ab(c,f,f+r);for(var x="",w=0;w<r.length;w++){var y=r[w];if(0===(y&128))x+=String.fromCharCode(y);else if(192===(y&224)){var A=r[++w]&63;x+=String.fromCharCode((y&
31)<<6|A)}else if(224===(y&240)){A=r[++w]&63;var E=r[++w]&63;x+=String.fromCharCode((y&31)<<12|A<<6|E)}else if(240===(y&248)){A=r[++w]&63;E=r[++w]&63;var M=r[++w]&63;y=(y&7)<<18|A<<12|E<<6|M;65535<y&&(y-=65536,x+=String.fromCharCode(y>>>10&1023|55296),y=56320|y&1023);x+=String.fromCharCode(y)}}r=x;f+=v}b[n.name]=r;f<c.length&&l+1==a.length&&h.length&&(b={},d[h].push(b),l=k)}}return d}function Ab(c,a,b){return c.slice?c.slice(a,b):new Uint8Array(Array.prototype.slice.call(c,a,b))}
var Bb=function(c){function a(a,d){var b=c.call(this)||this;b.xc=a;b.Em=d;a.binaryType="arraybuffer";a.onopen=function(){b.ta({type:"open"})};a.onerror=function(){b.ta({type:"error"});a.onerror=a.onclose=null};a.onclose=function(){b.ta({type:"close"});a.onerror=a.onclose=null};a.onmessage=function(a){b.ta({type:"message",message:new Uint8Array(a.data)})};return b}__extends(a,c);a.prototype.close=function(){this.xc.close()};a.prototype.read=function(){return __awaiter(this,void 0,void 0,function(){var a,
d,e,c,h;return __generator(this,function(b){switch(b.label){case 0:a=[],b.label=1;case 1:return[4,this.fv()];case 2:d=b.sent();if("message"!==d.type||0===a.length&&!d.message[1])return[2,d];e=0;c=d.message;a.length&&(e=2);for(h=e;h<c.length;h++)a.push(c[h]);return d.message[1]?[3,1]:[2,{type:"message",message:new Uint8Array(a)}];case 3:return[2]}})})};a.prototype.send=function(a){var b=this.xc,e=0,c=a.length;c>this.Em&&(c=this.Em,a[1]=1);b.send(Ab(a,e,e+c));for(e+=c;e<a.length;){c=a.length-e;c>this.Em-
2&&(c=this.Em-2);var h={messageType:255,more:e+c<a.length?1:0,data:Ab(a,e,e+c)};b.send(yb(h));e+=c}};return a}(function(){function c(){this.Qr=[];this.lb=[]}c.prototype.fv=function(){var a=this;return(new Promise(function(b){a.lb.length?b(a.lb.shift()):a.Qr.push(b)})).then(null,function(a){throw a;})};c.prototype.ta=function(a){this.Qr.length?this.Qr.shift()(a):this.lb.push(a)};return c}()),Db=function(){function c(){var a=this;this.timeout=0;this.uq=function(){a.cancel();a.resolve&&(a.resolve(),
a.resolve=null)};this.resolve=null}c.prototype.wait=function(a){var b=this;return new Promise(function(d){b.resolve=d;b.timeout=setTimeout(function(){return b.uq()},a);window.addEventListener("online",b.uq)})};c.prototype.cancel=function(){clearTimeout(this.timeout);window.removeEventListener("online",this.uq)};return c}(),Eb=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.ma=a;b.kD=d;b.latency=e;b.WebSocket=f;b.log=u.create("Sharing");b.keys={};b.Du="";b.st="";b.yv=function(){b.Gg()};
b.Pm=function(){};b.Ah=!1;b.connected=!1;b.xc=null;b.Av=function(){for(var a=0,d=b.ma.hu();a<d.length;a++){var e=d[a];b.BD(e.name,e.value,e.persistent)}b.Gg()};b.Pc=0;b.Cn=!1;b.yd="";b.Eq=[];b.lk=[];b.dn=[];b.RB=1;b.Sj=0;return b}__extends(a,c);a.prototype.CD=function(a){this.latency=a};a.prototype.start=function(a,d){var b=this;this.st=a;return new Promise(function(e,c){b.log("Start shared session: createMode=%s",d);b.Pm=e;b.ma.pa("local-changes",b.yv);b.ma.pa("local-keys",b.Av);if(1===d)b.ht(a,
d,"").then(null,c);else{e=b.ma.Cp();if(""===e)throw Error("getLocalChanges() returned null on first batch");b.Du=e;b.ht(a,d,e).then(null,c)}})};a.prototype.stop=function(){this.log("stop() -- shut down session");this.Ah=!1;this.xc&&this.xc.close();this.ma.removeListener("local-changes",this.yv);this.ma.removeListener("local-keys",this.Av);this.Sj&&clearTimeout(this.Sj)};a.prototype.Zq=function(a){this.Eq.push(a);this.Gg()};a.prototype.BD=function(a,d,e){try{d=JSON.stringify(d)}catch(n){throw console.error("Object cannot be converted to JSON: ",
d),n;}for(var b=null,c=0,k=this.lk;c<k.length;c++){var l=k[c];l.name===a&&(b=l)}c=0;k=1;a in this.keys&&(c=this.keys[a].version,k=c+1);e||(k=c=0);b?b.value=d:(b={name:a,value:d,oldVersion:c,newVersion:k,xC:e,Hf:this.RB++},this.lk.push(b))};a.prototype.ht=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c,k;return __generator(this,function(f){switch(f.label){case 0:this.Ah=!0,b=0,f.label=1;case 1:if(!this.Ah)return[3,10];this.connected=!1;if(!b)return[3,3];this.log("Waiting %sms before reconnecting",
b);c=new Db;return[4,c.wait(b)];case 2:f.sent(),f.label=3;case 3:return b=Math.max(Math.min(2*b,3E5),1E3),[4,this.connect()];case 4:return f.sent()?[4,this.hB(a,d,e)]:[3,1];case 5:if(!f.sent())return[3,1];this.Pm&&(this.Pm(),this.Pm=function(){});this.ta("connected");d=1;this.yd=this.Du=e="";this.connected=!0;this.Gg();f.label=6;case 6:return f.trys.push([6,8,,9]),[4,this.Vx()];case 7:return f.sent(),[3,9];case 8:return k=f.sent(),k instanceof Error&&this.log("Synchronization error: "+k.message),
console.log("Synchronization error: ",k),[3,9];case 9:return this.connected=!1,b=0,this.ta("connect-error"),[3,1];case 10:return[2]}})})};a.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(b){switch(b.label){case 0:return a=this.kD,this.xc&&this.xc.close(),this.xc=d=new Bb(new this.WebSocket(a),102400),this.log("Connect to %s; wait for event",a),[4,d.fv()];case 1:e=b.sent();if("open"!==e.type)return this.log("Received unexpected event: %s",
e.type),[2,!1];this.log("Connected to %s",a);return[2,!0]}})})};a.prototype.hB=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.log("Send INIT message docLen=%s changes=%s",this.Pc,e.toString().length);if(!this.xc)throw Error("ws is null");try{this.xc.send(yb({messageType:1,more:0,maxSize:102400,protocolVersion:2,creationMode:d,offset:this.Pc,docIDLength:Sa(a).length,docID:a,data:e}))}catch(l){throw console.log("Got error ",
l),l;}return[4,this.xc.read()];case 1:b=f.sent();if("message"!=b.type)return this.log("Expected message; got "+b.type),[2,!1];c=zb(b.message);if(128===c.messageType)throw this.log("Got error response: %s",c.description),Error(c.description);2===c.messageType&&(0<c.offset&&e.length&&this.ma.Wj(e),this.log("Got initial changes at offset %s=>%s",c.offset,c.offset+c.data_length),(c.data.length||0===c.offset)&&this.ma.Eg(c.data,0===c.offset),0===c.offset&&(this.yd=""),this.Pc=c.offset+c.data_length);this.log("Connected and initialized.");
return[2,!0]}})})};a.prototype.JD=function(a){(this.Cn=a)||this.Gg()};a.prototype.Gg=function(){var a=this;this.log("Check changes; changesSent=%s; paused=%s",this.yd,this.Cn);this.Sj||this.Cn||(this.Sj=setTimeout(function(){var b;a.Sj=0;a.log("inner checkChanges: connected=%s ws=%s",!!a.connected,!!a.xc);if(a.connected&&a.xc){""===a.yd&&(a.yd=a.ma.Cp(),a.log("getLocalChanges: %s",a.yd),a.yd&&(a.log("Sent changes %s->%s",a.Pc,a.Pc+a.yd.length),a.xc.send(yb({messageType:2,offset:a.Pc,more:0,data:a.yd}))));
for(var e=0,c=a.Eq;e<c.length;e++){var h=c[e];a.xc.send(yb({messageType:4,more:0,dataLength:Sa(h).length,data:h}))}e=a.Eq.length=0;for(c=a.lk;e<c.length;e++)h=c[e],a.xc.send(yb({messageType:3,more:0,requestID:h.Hf,lifetime:h.xC?1:0,oldVersion:h.oldVersion,newVersion:h.newVersion,nameLength:Sa(h.name).length,name:h.name,valueLength:Sa(h.value).length,value:h.value}));(b=a.dn).push.apply(b,a.lk);a.lk.length=0}},this.latency))};a.prototype.Vx=function(){return __awaiter(this,void 0,void 0,function(){var a,
d,e,c,h,k,l,n;return __generator(this,function(b){switch(b.label){case 0:return[4,this.xc.read()];case 1:a=b.sent();if("message"!==a.type)return this.log("Expected message; got "+a.type),[2];d=zb(a.message);if(2===d.messageType){if(this.Pc!==d.offset)throw Error("Error: docLength ="+this.Pc+" but got offset "+d.offset);this.ma.Eg(d.data,!1);this.log("From server: APPEND "+this.Pc+"->"+(this.Pc+d.data_length));this.Pc+=d.data_length;this.Gg()}else if(129===d.messageType)d.ack?(this.log("Received ACK "+
this.Pc+"=>"+d.offset),this.ma.Wj(this.yd),this.yd="",this.Pc=d.offset):(this.log("Received NACK "+this.Pc+"!="+d.offset+" "+this.yd.substr(0,22)),this.yd="",this.Gg());else if(4===d.messageType)this.ta("broadcast",d.data);else if(130===d.messageType){e=[];c=0;for(h=d.keys;c<h.length;c++)k=h[c],k.value=""===k.value?null:JSON.parse(k.value),l={name:k.name,value:k.value,version:k.version},e.push(k),null===l.value?delete this.keys[l.name]:this.keys[l.name]=l;this.ta("set-keys",e)}else if(131===d.messageType)for(n=
0;n<this.dn.length;n++){if(k=this.dn[n],k.Hf===d.requestID){this.log("key %s ACKED:%s",k.name,d.ack);d.ack&&(this.keys[k.name]={name:k.name,value:k.value,version:k.newVersion});this.dn.splice(n,1);break}}else throw Error("Unexpected message type "+d.messageType);b.label=2;case 2:return[3,0];case 3:return[2]}})})};return a}(sb);var Fb=function(){function c(a){this.next=a}c.prototype.Vw=function(a){for(var b=0;b<a.length;b++)this.Ib(a.charCodeAt(b))};c.prototype.Ib=function(a){this.next.Ib(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.Vg=function(){return this.next.Vg()};return c}(),Gb=function(){function c(){this.data="";this.log=u.create("BYTESTREAM")}c.prototype.Vw=function(a){for(var b=0;b<a.length;b++)this.Ib(a.charCodeAt(b))};c.prototype.Vg=function(){return this};c.prototype.Ib=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.vc=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.prototype.toBlob=function(a){for(var b=new Uint8Array(this.data.length),d=0;d<this.data.length;d++)b[d]=this.data.charCodeAt(d);return new Blob([b],{type:a})};c.fs=function(a,b){c.Zr[a]=b};c.zg=function(a){var b=new c;a=a.split(",");
a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.Zr[e](b))}return b};c.Zr={};return c}();var Hb=function(c){function a(a){a=c.call(this,a)||this;a.Zi=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}__extends(a,c);a.prototype.Ib=function(a){this.Zi=this.Zi<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.Ib(this.keys.charCodeAt(this.Zi>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.Ib(this.keys.charCodeAt(this.Zi>>this.size-6&63)),this.Zi=this.size=0);for(;a--;)this.next.Ib(61);
this.next.flush()};return a}(Fb);Gb.fs("Base64Encoder",function(c){return new Hb(c)});var Ib=function(c){function a(a){a=c.call(this,a)||this;a.jh=0;a.We=0;a.Yu=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];a.log=u.create("BITWRITER");return a}__extends(a,c);a.prototype.Ib=function(a){this.Uw(a,8)};a.prototype.Uw=function(a,d){this.jh=this.jh<<d|a&this.Yu[d];for(this.We+=d;8<=this.We;)this.next.Ib(this.jh>>>this.We-8&255),this.We-=8,this.jh&=this.Yu[this.We]};a.prototype.flush=function(){this.We&&(this.next.Ib(this.jh<<8-this.We),this.jh=this.We=0);this.next.flush()};return a}(Fb);var Jb=function(c){function a(a){var b=c.call(this,a)||this;b.mi=258;b.mF=0;b.Bh=0;b.first=!0;b.cj=[];b.Cq=[];b.to=[];b.vF=0;b.Go=9;b.log=u.create("LZWEncoder");b.iy=new Ib(a);b.ms();return b}__extends(a,c);a.prototype.Ib=function(a){if(this.first)this.Bh=a,this.first=!1;else{var b=this.zx(this.Bh,a);void 0!==this.cj[b]?this.Bh=this.cj[b]:(this.al(this.Bh),this.cj[b]=this.mi,this.Cq[b]=this.Bh,this.Bh=this.to[b]=a,4095>this.mi?(this.mi+=1,this.Go=Math.ceil(Math.log(this.mi)/Math.log(2))):this.ms())}};
a.prototype.zx=function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.cj[c]||this.Cq[c]===a&&this.to[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.ms=function(){this.al(a.bx);this.mi=258;this.Go=9;this.cj.length=0;this.Cq.length=0;this.to.length=0};a.prototype.flush=function(){this.first||(this.al(this.Bh),this.al(a.ix))};a.prototype.al=function(a){this.iy.Uw(a,this.Go)};a.bx=256;a.ix=257;return a}(Fb);Gb.fs("LZWEncoder",function(c){return new Jb(c)});function Kb(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function Lb(c,a){var b;var d={};a=c.indexOf(a||"?");0<=a&&(c=c.substr(a+1));a=c.indexOf("#");0<=a&&(c=c.substr(0,a));c=c.split("&");a=0;for(b=c.length;a<b;a++){var e=c[a];var f=e.split("=");e=Kb(f[0]);"/"==e[0]&&-1===e.indexOf(".")&&(e=e.substr(1));f=1<f.length?Kb(f[1]):"";e.length&&(d[e]=f)}return d}function Mb(){if(void 0===c)var c=window.location.hash;return Lb(c,"#")}
function Nb(c){void 0===c&&(c=window.location.href);return Lb(c,"?")};var Ob=u.create("CONFIG"),Pb=function(c){function a(a,d,e){var b=c.call(this)||this;b.Tg={};for(var h in d)b.Tg[h.toLowerCase()]=h;b.options=JSON.parse(JSON.stringify(d));for(var k in e)k.toLowerCase()in b.Tg||alert("Zwibbler: Unknown option '"+k+"'"),b.set(k,e[k],!0);a.addEventListener(window,"hashchange",function(){Ob("Reload parameters from url hash");b.fq()});a.add(function(){b.lb={}});b.fq();for(var l in b.options)Ob("%s=%s",l,b.options[l]);return b}__extends(a,c);a.prototype.fq=function(){var a=
Mb(),d;for(d in a)this.set(d,a[d])};a.prototype.has=function(a){return a.toLowerCase()in this.Tg};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);if(this.has(a)){if(a.toLowerCase()in this.Tg&&(a=this.Tg[a.toLowerCase()]),a=this.Mt(a,d))Ob("Set config %s=%s",a.name,a.value),d=this.options[a.name],this.options[a.name]=a.value,e||d===a.value||(this.rc("update",a.name,a.value,d),this.rc(a.name,a.value,!1))}else console.warn("Warning: %s is not a configuration option.",a)};a.prototype.Mt=function(a,
d){if("string"===typeof d&&"number"===typeof this.options[a]&&(d=parseFloat(d),isNaN(d))){console.log(Error("Config option "+a+" expects a number"));return}return{name:a,value:d}};a.prototype.pa=function(a,d){if("update"!==a&&!(a in this.options))throw Error(a+" is not a valid config setting.");"update"!==a&&d(this.options[a],!0,null);return c.prototype.pa.call(this,a,d)};a.prototype.get=function(a){if(!this.has(a))throw Error(a+" is not a valid config setting.");a.toLowerCase()in this.Tg&&(a=this.Tg[a.toLowerCase()]);
return this.options[a]};return a}(sb);var Rb={style:"\n.zwibbler-colour-panel {\n    overflow:hidden;\n    border-top: 1px solid black;\n    white-space: nowrap;\n    font-size: 0;\n}\n\n.zwibbler-colour-panel div { \n    display: inline-block;\n}",qm:'<div class="zwibbler-colour-panel" z-style="{height:ColourPanelWidth()+\'px\'}">\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'clear\'}"\n        z-on:click="setColour(\'rgba(0,0,0,0.0)\', true)"\n        z-on:contextmenu="setColour(\'rgba(0,0,0,0.0)\', false)">\n    </canvas>\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'transparent\'}"\n        z-on:click="setOpacity(0.5, true)"\n        z-on:contextmenu="setOpacity(0.5, false)">\n    </canvas>\n    <div z-for="colour in ColourPanelColours"\n        z-style="{width: ColourPanelWidth()+\'px\', height: ColourPanelWidth()+\'px\', background: colour}"\n        z-on:click="setColour(colour, true)"\n        z-on:contextmenu="setColour(colour, false)">\n    </div>\n</div>\n',
controller:function(c){var a=Qb(),b=c.ma||c;a.shift();a.shift();c.ColourPanelColours=a;c.ColourPanelWidth=function(){return b.Bc("useTouch")?40:20}}};
function Qb(){function c(b){for(var d=30;100>d;d+=20)b.values[2]=d/100,a.push(b.toString())}var a=[q.Be,"rgba(0,0,0,0.5)",q.Oa,q.Lc,"#000088","#008800","#008888","#880000","#880088","#884400","#888888","#444444","#0000ff","#00ff00","#00ffff","#ff0000","#ff00ff","#ffff00"];c(new q(q.Fh,[0,0,0,1]));for(var b=0;720>b;b+=35){var d=new q(q.Fh,[b,.5,0,1]);c(d)}return a};var Sb=HTMLElement,Tb=Object,Ub;
(function(c){function a(a){return{type:a,match:function(b){return typeof b===a}}}function b(a){return{type:a.name,match:function(b){return b instanceof a}}}function d(a){return{type:""+a,match:function(b){return b===a}}}function e(a){return{type:a.type+"[]",match:function(b){return b instanceof Array&&(0===b.length||a.match(b[0]))}}}function f(a){return{type:a.type+"?",match:function(b){return void 0===b||null===b||a.match(b)}}}c.Tn=b;c.ud=d;c.Eh={type:"any",match:function(a){return"undefined"!==typeof a}};
c.Qk=e;c.cb=f;c.kb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++)b.push(a[d].type);return{type:"("+b.join("|")+")",match:function(b){for(var d=0;d<a.length;d++)if(!0===a[d].match(b))return!0;return!1}}};c.Zc=function(a,b){return{type:a,match:function(a){if("object"!==typeof a)return!1;for(var d in b)if(!b[d].match(a[d]))return"The "+d+" member should be a "+b[d].type+", not "+Vb(a[d]);return!0}}};c.Sk=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=
arguments[b];return{type:"("+a.join("|")+")",match:function(b){for(var d=0;d<a.length;d++)if(a[d]===b)return!0;return!1}}};c.ox=f(c.Eh);c.Hh=d(null);c.String=a("string");c.Qb=f(c.String);c.Number={type:"number",match:function(a){return"number"===typeof a&&isFinite(a)?!0:a+" is not a number."}};c.Sa=f(c.Number);c.Tk=e(c.Number);c.Function=a("function");c.Rf=f(c.Function);c.Boolean=a("boolean");c.rd=f(c.Boolean);c.HTMLElement=b(Sb);c.Object=b(Tb);c.sd=f(c.Object);c.eF=e(c.Object);c.dc={type:"integer",
match:function(a){return"number"===typeof a&&(a|0)===a?!0:a+" is not a whole number."}};c.ke=f(c.dc);c.kx=e(c.dc);c.ga=function(a,b){for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];for(e=0;e<d.length;e++){var c=d[e],f=b[e],h=c.match(f);if(!0!==h)throw console.log("arguments: ",b),Error("Error calling "+a+": "+Wb(e+1)+" argument is '"+Vb(f)+"' but expected '"+c.type+"'. "+(!1===h?"":h)+"'");}}})(Ub||(Ub={}));
function Wb(c){switch(c%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"}function Vb(c){return c instanceof Array?c.length?Vb(c[0])+"[]":"Array":null===c?"null":typeof c}var C=Ub;var Xb=function(){function c(){var a=this;this.BC=new Promise(function(b,d){a.resolve=b;a.reject=d})}c.prototype.then=function(a,b){return this.BC.then(a,b)};return c}();var Yb=new Xb;var Zb=u.create("MISC");function cc(c){var a=document.createElement("canvas");c&&c.appendChild(a);a.style.background="transparent";return a}function dc(){return 0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")}function ec(c,a){c=q.lf(c);c.values[3]=a;return c.toString()}function fc(c,a){a=a?z(a).gc():z.km();var b=z(c).gc();b.left=Math.min(b.left,a.left+a.width-c.offsetWidth);b.top=Math.min(b.top,a.top+a.height-c.offsetHeight);z(c).vk(b)}
function gc(c,a){"erase"===a?(a=c.xx)?(c.save(),c.strokeStyle=q.Oa,c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.lineWidth+=2,a(),c.restore()):(c.strokeStyle=q.Oa,c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())}
function hc(){for(var c=0;c<arguments.length;c++);c=arguments[0];for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}return c}function ic(c,a){if("string"===typeof a)switch(typeof c){case "number":a=parseFloat(a);break;case "boolean":a=a&&"0"!==a&&"false"!==a}return a}
function jc(c,a,b){if("image/bmp"===a){a:if(a=c.getContext("2d"),null===a)b="error";else{var d=a.getImageData(0,0,c.width,c.height);c=d.width;var e=d.height;a=c*e*3;var f=a+54,h=[66,77,f&255,f>>8&255,f>>16&255,f>>24&255,0,0,0,0,54,0,0,0],k=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,e&255,e>>8&255,e>>16&255,e>>24&255,1,0,24,0,0,0,0,0,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];a=(4-3*c%4)%4;d=d.data;f=c<<2;for(var l=Gb.zg("Base64Encoder"),n=0;n<h.length;n++)l.Ib(h[n]);for(n=
0;n<k.length;n++)l.Ib(k[n]);do{h=f*(e-1);for(k=0;k<c;k++)n=k<<2,l.Ib(d[h+n+2]),l.Ib(d[h+n+1]),l.Ib(d[h+n]);for(h=0;h<a;h++)l.Ib(0)}while(--e);l.flush();switch(b){case "data-uri":b="data:image/bmp;base64,"+l.Vg().toString();break a;case "blob":b=l.Vg().toBlob("image/bmp");break a;default:throw Error(b+" encoding not supported with image/bmp");}}return b}c=c.toDataURL(a);switch(b){case "blob":b=c.substring(c.indexOf(":")+1,c.indexOf(";"));c=c.substr(c.indexOf(",")+1);a="";e=0;l={A:0,B:1,C:2,D:3,E:4,
F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(c=c.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");e<c.length;)h=l[c.charAt(e++)],k=l[c.charAt(e++)],d=l[c.charAt(e++)],f=l[c.charAt(e++)],h=h<<2|k>>4,k=(k&15)<<4|d>>2,n=(d&3)<<6|f,a+=String.fromCharCode(h),
64!==d&&(a+=String.fromCharCode(k)),64!==f&&(a+=String.fromCharCode(n));c=a;a=new Uint8Array(c.length);for(d=0;d<c.length;d++)a[d]=c.charCodeAt(d);return new Blob([a],{type:b});case "data-uri":return c;default:throw Error(b+" encoding not supported for "+a);}};u.create("Graphics",!0);
var F=function(){function c(a,b){this.x=a;this.y=b}c.prototype.ec=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.dd=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.tr=function(a){return new c(this.x-a.x,this.y-a.y)};c.prototype.qt=function(a,b){var d=a.x,e=a.y,c=this.x,h=this.y,k=b.x-d;b=b.y-e;var l=k*k+b*b;if(0===l)return this.ec(a);
a=((c-d)*k+(h-e)*b)/l;1<a?a=1:0>a&&(a=0);d=d+a*k-c;e=e+a*b-h;return Math.sqrt(d*d+e*e)};return c}(),kc=function(){function c(a,b){this.width=a;this.height=b}c.prototype.mE=function(){return new G(0,0,this.width,this.height)};c.prototype.toString=function(){return"Size("+this.width+","+this.height+")"};c.prototype.Lt=function(a,b){var d=1;void 0!==a&&void 0!==b?d=Math.min(a/this.width,b/this.height):void 0!==a?d=a/this.width:void 0!==b&&(d=b/this.height);this.width*=d;this.height*=d;return d};return c}();
function lc(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function mc(c,a,b,d){var e=lc(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function nc(c){c.x*=-1;c.y*=-1;return c}
var G=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.Xv()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.Ag=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,h=1;h<a.length;h++)a[h].x<b&&(b=a[h].x),a[h].x>d&&(d=a[h].x),a[h].y<e&&(e=a[h].y),a[h].y>f&&(f=a[h].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.dd=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Dh=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.Fu=function(a){a.x>this.x&&(this.width-=a.x-this.x,this.x=a.x);a.x+a.width<
this.x+this.width&&(this.width-=this.x+this.width-a.x-a.width);a.y>this.y&&(this.height-=a.y-this.y,this.y=a.y);a.y+a.height<this.y+this.height&&(this.height-=this.y+this.height-a.y-a.height)};c.prototype.Gr=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>
a.y+a.height};c.prototype.lC=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.Wi=function(){return this.width*this.height};c.prototype.Dv=function(a){return this.lC(a)?(Math.min(this.right(),a.right())-Math.max(this.x,a.x))*(Math.min(this.bottom(),a.bottom())-Math.max(this.y,a.y)):0};c.prototype.Oc=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.Xv=
function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.Hd=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=
Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.ne=function(){return new F(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};c.prototype.Ho=function(a){var b=this.x,d=this.y;this.right()>a.right()&&(this.x-=this.right()-a.right());this.bottom()>
a.bottom()&&(this.y-=this.bottom()-a.bottom());this.y<a.y&&(this.y=a.y);this.x<a.x&&(this.x=a.x);return{x:this.x-b,y:this.y-d}};return c}();function oc(c){return 0!==c?c:-Infinity===1/c?-1E-11:1E-11}
var H=function(){function c(){this.log=u.create("MATRIX");if(0===arguments.length)this.m11=1,this.m21=this.m12=0,this.m22=1,this.Ga=this.Fa=0;else if(1===arguments.length)if("string"===typeof arguments[0]){var a=arguments[0].match(/-?\d+\.?[\de\-]*/g);if(!a||6!=a.length)throw Error("Bad initializer for matrix: "+arguments[0]);this.m11=parseFloat(a[0]);this.m21=parseFloat(a[1]);this.m12=parseFloat(a[2]);this.m22=parseFloat(a[3]);this.Fa=parseFloat(a[4]);this.Ga=parseFloat(a[5])}else{if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";
this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Fa=arguments[0][4];this.Ga=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Fa=arguments[4],this.Ga=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.Fa+"    "+this.m21+" "+this.m22+" "+this.Ga+"    0 0 1 ]"};c.prototype.vc=function(){return[this.m11,this.m12,this.m21,this.m22,this.Fa,this.Ga]};
c.prototype.Iu=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Fa&&0===this.Ga};c.prototype.dd=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Fa===a.Fa&&this.Ga===a.Ga};c.prototype.multiply=function(a){var b=new c;b.m11=oc(this.m11*a.m11+this.m12*a.m21);b.m21=this.m21*a.m11+this.m22*a.m21;b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=oc(this.m21*a.m12+this.m22*a.m22);b.Fa=this.m11*a.Fa+this.m12*a.Ga+this.Fa;b.Ga=this.m21*
a.Fa+this.m22*a.Ga+this.Ga;if(!b.isFinite())throw Error("Multiplied matrix has NaN values: "+b.Of()+" after multiplying with "+a.Of());return b};c.prototype.isFinite=function(){function a(a){return isFinite(a)&&"number"===typeof a}return a(this.m11)&&a(this.m12)&&a(this.m21)&&a(this.m22)&&a(this.Fa)&&a(this.Ga)};c.prototype.apply=function(a,b){return new F(this.m11*a+this.m12*b+this.Fa,this.m21*a+this.m22*b+this.Ga)};c.prototype.mc=function(a,b){void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,
this.m12,this.m22,this.Fa,this.Ga):a.transform(this.m11,this.m21,this.m12,this.m22,this.Fa,this.Ga)};c.prototype.clone=function(){return new c(this.m11,this.m12,this.m21,this.m22,this.Fa,this.Ga)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Ga-this.Fa*this.m22)/a,(this.Fa*this.m21-this.m11*this.Ga)/a)};c.prototype.An=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),
h=Math.sqrt(d*d+e*e);return new c(a/f,d/h,b/f,e/h,this.Fa,this.Ga)};c.prototype.vb=function(){var a=Math.sqrt(this.m11*this.m11+this.m21*this.m21),b=Math.sqrt(this.m12*this.m12+this.m22*this.m22);0>this.m11&&(a=-a);0>this.m22&&(b=-b);return new F(a,b)};c.prototype.Zp=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new pc(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new qc(a,b,d))};c.prototype.Of=function(){return"matrix("+
this.m11+", "+this.m21+", "+this.m12+", "+this.m22+", "+this.Fa+", "+this.Ga+")"};c.prototype.hE=function(){return new DOMMatrix([this.m11,this.m21,this.m12,this.m22,this.Fa,this.Ga])};c.prototype.toJSON=function(){if(!this.isFinite())throw Error("Tried to encode matrix with NaN/Inf values: "+this.Of());return this.Of()};return c}(),qc=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}__extends(a,c);return a}(H),pc=function(c){function a(a,
d){return c.call(this,1,0,0,1,a,d)||this}__extends(a,c);return a}(H),rc=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}__extends(a,c);return a}(H),sc=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}__extends(a,c);return a}(H);
function tc(c,a,b,d,e,f,h,k,l,n){if(!(8<++tc.depth)){var r=(a+d)/2,v=(b+e)/2,x=(d+f)/2,w=(e+h)/2,y=(f+k)/2,A=(h+l)/2,E=(r+x)/2,M=(v+w)/2;x=(x+y)/2;w=(w+A)/2;var K=(E+x)/2,D=(M+w)/2,J=k-a,V=l-b;d=Math.abs((d-k)*V-(e-l)*J);f=Math.abs((f-k)*V-(h-l)*J);(d+f)*(d+f)<n*(J*J+V*V)?c.push(new F(K,D)):(tc(c,a,b,r,v,E,M,K,D,n),tc(c,K,D,x,w,y,A,k,l,n))}--tc.depth}(tc||(tc={})).depth=0;
function uc(c,a,b,d,e,f,h,k){if(!(8<++tc.depth)){var l=(a+d)/2,n=(b+e)/2,r=(d+f)/2,v=(e+h)/2,x=(l+r)/2,w=(n+v)/2,y=f-a,A=h-b;d=Math.abs((d-f)*A-(e-h)*y);d*d<=k*(y*y+A*A)?c.push(new F(x,w)):(uc(c,a,b,l,n,x,w,k),uc(c,x,w,r,v,f,h,k))}--tc.depth}
function vc(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var h=c[f-1].x;var k=c[f-1].y;for(d=0;d<f;d++){var l=c[d].x;var n=c[d].y;if(l>h){var r=h;var v=l;var x=k;k=n}else r=l,v=h,x=n;l<a===a<=h&&(b-x)*(v-r)<(k-x)*(a-r)&&(e=!e);h=l;k=n}return e}function wc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,h=c[e-1].y,k=c[e].x-f,l=c[e].y-h,n=((a-f)*k+(b-h)*l)/(k*k+l*l);1<n?n=1:0>n&&(n=0);f=f+n*k-a;h=h+n*l-b;if(f*f+h*h<=d)return!0}return!1}
(function(){function c(a){this.image=a}c.prototype.clear=function(){for(var a=0;a<this.image.width*this.image.height*4;a++)this.image.data[a]=0};c.prototype.getImageData=function(){return this.image};c.prototype.width=function(){return this.image.width};c.prototype.height=function(){return this.image.height};c.prototype.get=function(a,b){a=this.image.width*b*4+4*a;return this.image.data[a]|this.image.data[a+1]<<8|this.image.data[a+2]<<16|this.image.data[a+3]<<24};c.prototype.set=function(a,b,d){a=
this.image.width*b*4+4*a;this.image.data[a]=d&255;this.image.data[a+1]=d>>8&255;this.image.data[a+2]=d>>16&255;this.image.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.Oh=a;this.Yk=b;this.data=[]}c.prototype.width=function(){return this.Oh};c.prototype.height=function(){return this.Yk};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.Oh;a.height=this.Yk;a=a.getContext("2d").getImageData(0,0,this.Oh,this.Yk);for(var b=this.Oh*this.Yk,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.Oh*b+a]};c.prototype.set=function(a,b,d){this.data[this.Oh*b+a]=d};return c})();
var xc=function(){function c(a){this.closed=!1;this.fa=[];a instanceof G?this.rect(a.x,a.y,a.width,a.height):a instanceof Array&&(this.fa=a)}c.prototype.clear=function(){this.closed=!1;this.fa=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(a,b,d,e){this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.moveTo=function(a,b){this.fa.push(c.Kc,a,b)};c.prototype.lineTo=function(a,b){this.fa.push(c.qd,a,b)};c.prototype.bezierCurveTo=
function(a,b,d,e,f,h){this.fa.push(c.Qf,a,b,d,e,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.fa.push(c.Sf,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.fa.push(c.pd)};c.prototype.la=function(a){for(var b=0;b<this.fa.length;){switch(this.fa[b]){case c.Kc:a.moveTo&&a.moveTo(this.fa[b+1],this.fa[b+2]);break;case c.qd:a.lineTo&&a.lineTo(this.fa[b+1],this.fa[b+2]);break;case c.Qf:a.bezierCurveTo&&a.bezierCurveTo(this.fa[b+1],this.fa[b+
2],this.fa[b+3],this.fa[b+4],this.fa[b+5],this.fa[b+6]);break;case c.Sf:a.quadraticCurveTo&&a.quadraticCurveTo(this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4]);break;case c.pd:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.td[this.fa[b]]}};c.prototype.WC=function(){for(var a=0,b=0,d=0,e=[];a<this.fa.length;){switch(this.fa[a]){case c.pd:e.push([c.pd]);break;case c.Kc:b=this.fa[a+1];d=this.fa[a+2];break;case c.qd:e.push([c.qd,b,d]);b=this.fa[a+1];d=this.fa[a+2];break;case c.Qf:e.push([c.Qf,
this.fa[a+3],this.fa[a+4],this.fa[a+1],this.fa[a+2],b,d]);b=this.fa[a+5];d=this.fa[a+6];break;case c.Sf:e.push([c.Sf,this.fa[a+1],this.fa[a+2],b,d]),b=this.fa[a+3],d=this.fa[a+4]}a+=c.td[this.fa[a]]}this.fa.length&&e.push([c.Kc,b,d]);a=new c;for(b=e.length-1;0<=b;b--)Array.prototype.push.apply(a.fa,e[b]);a.closed=this.closed;return a};c.prototype.he=function(){for(var a=0,b,d=[],e=[d],f=!1;a<this.fa.length;){var h=c.es[this.fa[a]];this.fa[a]===c.Kc&&0<d.length&&(f?(d=[],e.push(d),f=!1):d.length=0);
this.fa[a]!==c.Kc&&(f=!0);for(b=0;b<h;b++)d.push(new F(this.fa[a+1+2*b],this.fa[a+1+2*b+1]));a+=c.td[this.fa[a]]}return e};c.prototype.transform=function(a){for(var b=0,d,e;b<this.fa.length;){e=c.es[this.fa[b]];for(d=0;d<e;d++){var f=a.apply(this.fa[b+1+2*d],this.fa[b+1+2*d+1]);this.fa[b+1+2*d]=f.x;this.fa[b+1+2*d+1]=f.y}b+=c.td[this.fa[b]]}};c.prototype.clone=function(){var a=new c;a.fa=this.fa.concat();return a};c.prototype.rl=function(a){for(var b=0,d,e=d=0,f=new G(this.fa[1]||0,this.fa[2]||0,
0,0),h;b<this.fa.length;){switch(this.fa[b]){case c.Kc:case c.qd:d=this.fa[b+1];e=this.fa[b+2];f.Gr(d,e);break;case c.Qf:var k=h=[],l=this.fa[b+5],n=this.fa[b+6];tc(k,d,e,this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4],l,n,a*a);k.push(new F(l,n));for(d=0;d<h.length;d++)f.Gr(h[d].x,h[d].y);d=this.fa[b+5];e=this.fa[b+6];break;case c.Sf:k=h=[];l=this.fa[b+3];n=this.fa[b+4];uc(k,d,e,this.fa[b+1],this.fa[b+2],l,n,a*a);k.push(new F(l,n));for(d=0;d<h.length;d++)f.Gr(h[d].x,h[d].y);d=this.fa[b+3];e=this.fa[b+
4]}b+=c.td[this.fa[b]]}return f};c.prototype.append=function(a){this.fa=this.fa.concat(a.fa)};c.prototype.Fk=function(a){for(var b=0,d=0,e=0,f=new c,h;b<this.fa.length;){switch(this.fa[b]){case c.Kc:d=this.fa[b+1];e=this.fa[b+2];f.moveTo(d,e);break;case c.qd:d=this.fa[b+1];e=this.fa[b+2];f.lineTo(d,e);break;case c.Qf:var k=h=[],l=this.fa[b+5],n=this.fa[b+6];tc(k,d,e,this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4],l,n,a*a);k.push(new F(l,n));2===h.length&&1E-4>d*(h[0].y-h[1].y)+h[0].x*(h[1].y-
e)+h[1].x*(e-h[0].y)&&(h[0]=h[1],h.length=1);for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.fa[b+5];e=this.fa[b+6];break;case c.Sf:k=h=[];l=this.fa[b+3];n=this.fa[b+4];uc(k,d,e,this.fa[b+1],this.fa[b+2],l,n,a*a);k.push(new F(l,n));for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.fa[b+3];e=this.fa[b+4];break;case c.pd:f.closePath()}b+=c.td[this.fa[b]]}return f};c.prototype.yC=function(a,b,d){void 0===d&&(d=0);for(var e=0,c=this.he();e<c.length;e++)if(vc(c[e],a,b))return!0;return 0<d&&this.Iv(a,
b,d)};c.prototype.Iv=function(a,b,d){var e=0,f=0,h=0;for(d*=d;h<this.fa.length;){switch(this.fa[h]){case c.Kc:e=this.fa[h+1];f=this.fa[h+2];break;case c.qd:var k=this.fa[h+1];var l=this.fa[h+2];var n=k-e;var r=l-f;var v=n*n+r*r;v=((a-e)*n+(b-f)*r)/v;1<v?v=1:0>v&&(v=0);e+=v*n;r=f+v*r;f=e-a;r-=b;f=f*f+r*r;if(f<=d)return!0;e=k;f=l}h+=c.td[this.fa[h]]}return!1};c.prototype.Gl=function(a,b){for(var d=0,e=0,f=b[0],h,k=new F(0,0),l;d<this.fa.length;){switch(this.fa[d]){case c.Kc:l=this.fa[d+1];h=this.fa[d+
2];a.moveTo(l,h);k=new F(l,h);break;case c.qd:l=this.fa[d+1];var n=h=this.fa[d+2],r=new F(l,n);h=k.ec(r);if(!(0>=h||0>f)){for(;h>f;)k.x+=(r.x-k.x)*f/h,k.y+=(r.y-k.y)*f/h,e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),h-=f,e=(e+1)%b.length,f=b[e];h<=f&&(k=new F(l,n),e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),f-=h)}}d+=c.td[this.fa[d]]}};c.prototype.Wi=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.fa.length;){switch(this.fa[b]){case c.Kc:d=this.fa[b+1];e=this.fa[b+2];break;case c.qd:a(this.fa[b+
1],this.fa[b+2]);break;case c.Qf:a(this.fa[b+5],this.fa[b+6]);break;case c.Sf:a(this.fa[b+3],this.fa[b+4])}b+=c.td[this.fa[b]]}return f/2};c.prototype.At=function(a){for(var b=0,d=0,e=0,f=!1;b<this.fa.length;){switch(this.fa[b]){case c.Kc:d=this.fa[b+1];e=this.fa[b+2];f=!0;break;case c.qd:a(d,e,this.fa[b+1],this.fa[b+2],f),d=this.fa[b+1],e=this.fa[b+2],f=!1}b+=c.td[this.fa[b]]}};c.prototype.ly=function(){var a=0;this.At(function(b,d,e,c){a+=lc(b,d,e,c)});return a};c.prototype.oy=function(a){var b=
new c,d=0;this.At(function(e,c,h,k,l){if(d<=a){l&&b.moveTo(e,c);l=lc(e,c,h,k);if(d+l>=a){var f=a-d;h=e+(h-e)*f/l;k=c+(k-c)*f/l}d+=l;b.lineTo(h,k)}});return b};c.Kc=0;c.qd=1;c.Qf=2;c.Sf=3;c.pd=4;c.td=[3,3,7,5,1];c.es=[1,1,3,2,0];return c}();
function yc(c,a,b,d,e,f,h){void 0===h&&(h=f);0===f&&0===h?c.rect(a,b,d,e):(d=a+d,e=b+e,c.moveTo(a+f,b),c.lineTo(d-f,b),c.quadraticCurveTo(d,b,d,b+h),c.lineTo(d,e-h),c.quadraticCurveTo(d,e,d-f,e),c.lineTo(a+f,e),c.quadraticCurveTo(a,e,a,e-h),c.lineTo(a,b+h),c.quadraticCurveTo(a,b,a+f,b),c.closePath())}function zc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var h=c[b],k=c[d-1],l=0,n=0;for(f=b+1;f<d;f++){var r=c[f].qt(h,k);r>l&&(l=r,n=f)}0<n&&l>a?(zc(c,a,b,n,e),zc(c,a,n,d,e)):e.push(h)}}
function Ac(c,a){var b=[];zc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].dd(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Bc=function(){function c(){this.oa=[];if(1===arguments.length){var a=arguments[0];if(a instanceof G)this.oa.push(new F(a.x,a.y)),this.oa.push(new F(a.right(),a.y)),this.oa.push(new F(a.right(),a.bottom())),this.oa.push(new F(a.x,a.bottom()));else if(a instanceof Array)this.oa=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.jB=function(a){var b=this.he();a=a.he();for(var d=0;d<b.length;d++){var e=b[d];if(!vc(a,e.x,e.y))return!1}return!0};c.prototype.transform=
function(a){for(var b=0;b<this.oa.length;b++)this.oa[b]=a.apply(this.oa[b].x,this.oa[b].y)};c.prototype.add=function(a,b){this.oa.push(new F(a,b))};c.prototype.Oc=function(a,b,d){void 0===d&&(d=0);return vc(this.oa,a,b)||d&&wc(this.oa,a,b,d)};c.prototype.Ws=function(){return G.Ag(this.oa)};c.prototype.clone=function(){return new c(this.oa.slice(0))};c.prototype.dd=function(a){if(this.oa.length!==a.oa.length)return!1;for(var b=0;b<this.oa.length;b++){var d=this.oa[b],e=a.oa[b];if(d.x!==e.x||d.y!==
e.y)return!1}return!0};c.prototype.Hd=function(a){for(var b=[],d=0;d<this.oa.length;d++){var e=this.oa[0===d?this.oa.length-1:d-1],c=this.oa[d],h=this.oa[d===this.oa.length-1?0:d+1],k=lc(e.x,e.y,c.x,c.y),l=lc(h.x,h.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/k+(c.x-h.x)/l)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/k+(c.y-h.y)/l)/Math.sqrt(2)*a})}this.oa=b};c.prototype.la=function(a){if(!(1>this.oa.length)){a.moveTo(this.oa[0].x,this.oa[0].y);for(var b=1;b<this.oa.length;b++)a.lineTo(this.oa[b].x,this.oa[b].y);a.closePath()}};
c.prototype.he=function(){return this.oa};c.aF=function(a,b){for(var d=0,e=0,c=!1,h=[],k=[],l=0;l<b.length;l++)k.push(0);for(;;){var n=0,r=-1;for(l=0;l<b.length;l++)if(k[l]<b[l].length){var v=b[l][k[l]];if(0===l||v<n){n=v;r=l;var x=1-k[l]%2}}if(-1===r)return h;k[r]+=1;"intersection"===a?x?(e+=1,e===b.length&&(d=n)):(e===b.length&&(h.push(d),h.push(n)),--e):x?(e+=1,0===r?(c=!0,1===e)&&(d=n):c&&2===e&&(h.push(d),h.push(n))):(c&&1===e&&(h.push(d),h.push(n)),--e,0===r&&(c=!1),c&&1===e&&(d=n))}};return c}();
function Cc(c){var a=[],b=0;for(c=c.split(",");b<c.length;b++){var d=parseFloat(c[b]);isNaN(d)||a.push(d)}return a}function Dc(c,a,b){if(0!==a.length)if(c.moveTo(a[0].x,a[0].y),0===b.length)for(b=1;b<a.length;b++)c.lineTo(a[b].x,a[b].y);else for(var d=0,e=1,f=b[0],h=a[0].clone(),k;e<a.length;)k=h.ec(a[e]),0===k?e+=1:k<=f?(h=a[e].clone(),d&1?c.moveTo(h.x,h.y):c.lineTo(h.x,h.y),f-=k,e+=1):(h.x+=(a[e].x-h.x)*f/k,h.y+=(a[e].y-h.y)*f/k,d&1?c.moveTo(h.x,h.y):c.lineTo(h.x,h.y),d=(d+1)%b.length,f=b[d])}
function Ec(c,a,b,d,e,f,h,k){b-=c;d-=a;h-=e;k-=f;var l=-h*d+b*k;if(0===l)return null;e=(h*(a-f)-k*(c-e))/l;return new F(c+e*b,a+e*d)}
function Fc(c,a){function b(a){var b,e;var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];a[b+1]&&(c[b]=d(n,a[b+1]));b+=1}return c}function d(a,b){return new F(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Fc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];c[2*b]=n;a[b+1]&&(c[2*b+1]=d(n,a[b+1]));b+=1}return c}(c))),a-1):c}
function Gc(c,a){var b=0,d=0,e=0,f=0,h=0,k=0,l=0,n=0;Hc(a,function(a,v){switch(a){case "M":for(var r=0;r<v.length;r+=2)b=v[r],d=v[r+1],0==r?(c.moveTo(b,d),e=b,f=d):c.lineTo(b,d);break;case "m":for(r=0;r<v.length;r+=2)b+=v[r],d+=v[r+1],0==r?(c.moveTo(b,d),e=b,f=d):c.lineTo(b,d);break;case "L":for(r=0;r<v.length;r+=2)b=v[r],d=v[r+1],c.lineTo(v[r],v[r+1]);break;case "l":for(r=0;r<v.length;r+=2)b+=v[r],d+=v[r+1],c.lineTo(b,d);break;case "H":for(r=0;r<v.length;r++)b=v[r],c.lineTo(b,d);break;case "h":for(r=
0;r<v.length;r++)b+=v[r],c.lineTo(b,d);break;case "V":for(r=0;r<v.length;r++)d=v[r],c.lineTo(b,d);break;case "v":for(r=0;r<v.length;r++)d+=v[r],c.lineTo(b,d);break;case "Q":for(r=0;r<v.length;r+=4)l=v[r],n=v[r+1],b=v[r+2],d=v[r+3],c.quadraticCurveTo(l,n,b,d);break;case "q":for(r=0;r<v.length;r+=4)l=v[r]+b,n=v[r+1]+d,b=v[r+2]+b,d=v[r+3]+d,c.quadraticCurveTo(l,n,b,d);break;case "T":for(r=0;r<v.length;r+=2)l=b+b-l,n=d+d-n,b=v[r],d=v[r+1],c.quadraticCurveTo(l,n,b,d);break;case "t":for(r=0;r<v.length;r+=
2)l=b+b-l,n=d+d-n,b=v[r]+b,d=v[r+1]+d,c.quadraticCurveTo(l,n,b,d);break;case "C":for(r=0;r<v.length;r+=6)h=v[r+2],k=v[r+3],b=v[r+4],d=v[r+5],c.bezierCurveTo(v[r],v[r+1],h,k,b,d);break;case "c":for(r=0;r<v.length;r+=6){var w=v[r]+b,y=v[r+1]+d;h=v[r+2]+b;k=v[r+3]+d;b=v[r+4]+b;d=v[r+5]+d;c.bezierCurveTo(w,y,h,k,b,d)}break;case "S":for(r=0;r<v.length;r+=4)w=b+b-h,y=d+d-k,c.bezierCurveTo(w,y,v[r],v[r+1],v[r+2],v[r+3]),h=v[r],k=v[r+1],b=v[r+2],d=v[r+3];break;case "s":for(r=0;r<v.length;r+=4)w=b+b-h,y=d+
d-k,c.bezierCurveTo(w,y,v[r]+b,v[r+1]+d,v[r+2]+b,v[r+3]+d),h=v[r]+b,k=v[r+1]+d,b=v[r+2]+b,d=v[r+3]+d;break;case "A":case "a":for(r=0;r<v.length;r+=7){var A=v[r+0];var E=v[r+1];w=v[r+2]/Math.PI;var M=1===v[r+3];y=1===v[r+4];var K=v[r+5],D=v[r+6];"a"==a&&(K+=b,D+=d);A=Math.abs(A);E=Math.abs(E);var J=(b-K)/2;var V=(d-D)/2;var wa=Math.cos(w)*J+Math.sin(w)*V;J=-Math.sin(w)*J+Math.cos(w)*V;V=A*A;var ka=E*E,ya=wa*wa,Y=J*J,X=ya/V+Y/ka;1<X&&(V=Math.sqrt(X),A*=V,E*=V,V=A*A,ka=E*E);ya=V*Y+ka*ya;V=Math.sqrt(Math.max(0,
(V*ka-ya)/ya));M==y&&(V=-V);ka=V*A*J/E;Y=-V*E*wa/A;ya=Math.cos(w)*ka-Math.sin(w)*Y+(b+K)/2;V=Math.sin(w)*ka+Math.cos(w)*Y+(d+D)/2;M=Ic(1,0,(wa-ka)/A,(J-Y)/E);ka=Ic((wa-ka)/A,(J-Y)/E,(-wa-ka)/A,(-J-Y)/E);y||(ka-=2*Math.PI);ka%=2*Math.PI;wa=ya;J=V;V=ka;c.translate(wa,J);c.scale(A,E);c.rotate(w);c.arc(0,0,1,M,M+V,!y);c.rotate(-w);c.scale(1/A,1/E);c.translate(-wa,-J);b=K;d=D}break;case "Z":case "z":c.closePath();b=e;d=f;break;default:throw Error("Unknown draw command: "+a);}switch(a){case "C":case "c":case "S":case "s":l=
b;n=d;break;case "Q":case "q":case "T":case "t":h=b;k=d;break;default:h=b,k=d,l=b,n=d}})}
function Hc(c,a){function b(){if(0<=h){var a=parseFloat(c.substr(h,h+f));if(isNaN(a))throw Error("Error parsing number: "+c.substr(h,h+f)+" in "+c);e.push(a);h=-1;l=k=!1}}for(var d="",e=[],f=0,h=-1,k=!1,l=!1;f<c.length;f++){var n=c[f];if(0<h&&"-"==n&&!l||k&&"."==n)b(),h=f,"."===n&&(k=!0);else if("0"<=n&&"9">=n||"-"==n||"+"==n||0<=h&&("E"==n||"e"==n)||"."==n)if(-1==h&&(h=f),"."==n)k=!0;else{if("e"===n||"E"===n)l=!0}else"A"<=n&&"Z">=n||"a"<=n&&"z">=n?(b(),""!=d&&(a(d,e),e=[],d=""),d=n):b()}b();""!=
d&&a(d,e)}function Ic(c,a,b,d){var e=(c*b+a*d)/(lc(0,0,c,a)*lc(0,0,b,d));e=Math.acos(-1>e?-1:1<e?1:e);0>c*d-a*b&&(e=-e);return e}
(function(){function c(){this.items=[];this.ra=new H}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){a=this.ra.apply(a,b);this.items.push("M",a.x,a.y)};c.prototype.lineTo=function(a,b){a=this.ra.apply(a,b);this.items.push("L",a.x,a.y)};c.prototype.transform=function(a,b,d,e,c,h){a=new H(a,
d,b,e,c,h);this.ra=this.ra.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){a=this.ra.apply(a,b);d=this.ra.apply(d,e);c=this.ra.apply(c,h);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c})();
function Jc(c,a,b,d,e){for(var f=0;f<a.length;f++){var h=a[f];if(!(2>h.length)){void 0===d&&(d=!0);void 0===e&&(e=!0);var k=h[0].x===h[h.length-1].x&&h[0].y===h[h.length-1].y,l=[],n=[],r=new F(0,0),v=r,x=r,w=r,y=r,A=[],E=b/2,M;for(M=1;M<h.length;M++){x=h[M-1];y=h[M];w=mc(x.x,x.y,y.x,y.y);r=new F(w.y,-w.x);v=new F(x.x-w.x*E-r.x*E,x.y-w.y*E-r.y*E);x=new F(x.x-w.x*E+r.x*E,x.y-w.y*E+r.y*E);if(n.length){var K=n[n.length-1];var D=A[A.length-1];v=Ec(K.x,K.y,K.x+D.x,K.y+D.y,v.x,v.y,v.x+w.x,v.y+w.y)||v;K=
l[l.length-1];x=Ec(K.x,K.y,K.x+D.x,K.y+D.y,x.x,x.y,x.x+w.x,x.y+w.y)||x}n.push(v);l.push(x);A.push(w)}k?(K=n[0],D=A[0],v=Ec(K.x,K.y,K.x+D.x,K.y+D.y,v.x,v.y,v.x+w.x,v.y+w.y)||v,K=l[0],x=Ec(K.x,K.y,K.x+D.x,K.y+D.y,x.x,x.y,x.x+w.x,x.y+w.y)||x,n[0].x=v.x,n[0].y=v.y,l[0].x=x.x,l[0].y=x.y,n.push(v),l.push(x)):(n.push(new F(y.x+w.x*E-r.x*E,y.y+w.y*E-r.y*E)),l.push(new F(y.x+w.x*E+r.x*E,y.y+w.y*E+r.y*E)));if(e){c.moveTo(n[0].x,n[0].y);for(M=1;M<n.length;M++)c.lineTo(n[M].x,n[M].y);k&&(c.closePath(),c.moveTo(l[l.length-
1].x,l[l.length-1].y))}else d&&c.moveTo(l[l.length-1].x,l[l.length-1].y);if(d){for(M=l.length-1;0<=M;M--)c.lineTo(l[M].x,l[M].y);!k&&e&&c.lineTo(n[0].x,n[0].y)}}}}
(function(){function c(a){this.oa=a;this.n=0;this.Mb=new F(0,0)}c.prototype.next=function(a){if(0===this.oa.length)return null;if(0===this.n)return this.Mb=this.oa[0].clone(),this.n+=1,this.Mb.clone();for(;this.n<this.oa.length;){var b=this.Mb.ec(this.oa[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.Mb.x+=(this.oa[this.n].x-this.Mb.x)*a/b,this.Mb.y+=(this.oa[this.n].y-this.Mb.y)*a/b,this.Mb.clone()}return null};return c})();
var Kc=function(){function c(){this.path=[]}c.prototype.Dg=function(a,b){0<this.path.length&&a===this.path[this.path.length-1].x&&b===this.path[this.path.length-1].y||this.path.push(new F(a,b))};c.prototype.Gp=function(){return this.path};return c}();function Lc(c,a){c.length>a&&(c=c.slice(c.length-a));return c}
var Mc=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Bk=[];a.order=3;a.ur=3;a.jw=Math.pow(2,a.order);a.sampleSize=a.ur+1;return a}__extends(a,c);a.prototype.Gp=function(){return this.Bk};a.prototype.Dg=function(a,d){c.prototype.Dg.call(this,a,d);this.path.length<this.sampleSize?this.Bk=Fc(this.path,this.order):(a=Lc(Fc(Lc(this.path,this.sampleSize),this.order),this.jw*this.ur),this.Bk=this.Bk.slice(0,this.Bk.length-this.jw*(this.ur-1)).concat(a))};return a}(Kc);
function Nc(c){var a,b,d,e,f,h,k;return __generator(this,function(l){switch(l.label){case 0:return 2>c.length?[2]:[4,{wi:c[0],length:0}];case 1:a=l.sent(),b=c[0],d=1,l.label=2;case 2:if(!(d<c.length))return[3,7];e=c[d];f=lc(b.x,b.y,e.x,e.y);if(1E-5>f)return d++,[3,2];h=(e.x-b.x)/f;k=(e.y-b.y)/f;l.label=3;case 3:if(!(f>a))return[3,5];b={x:b.x+h*a,y:b.y+k*a};f-=a;return[4,{wi:b,length:a}];case 4:return a=l.sent(),[3,3];case 5:return[4,{wi:{x:e.x,y:e.y},length:f}];case 6:return a=l.sent(),b=e,d++,[3,
2];case 7:return[2]}})}function Oc(c,a,b,d,e,f){void 0===d&&(d=1);void 0===e&&(e=0);void 0===f&&(f=0);var h=[];"number"!==typeof b&&(b=1===d&&0==(c&1)?Math.PI/c:1!==d&&0==(c&3)?Math.PI/c*2:0);for(var k=0;k<=c;k++){var l=Math.sin(b)*a,n=-Math.cos(b)*a;k&1&&(l*=d,n*=d);l=new F(l+e*n,n+f*n);h.push(l);b+=2*Math.PI/c}return h}
var Pc=function(){function c(a,b){void 0===b&&(b=new H);this.rj=[];this.inverse=b.inverse();for(var d=-1,e=0;e<a.length;e++){var c=a[e];d++;if(!(1>c.length))for(var h=b.apply(c[0].x,c[0].y),k=1;k<c.length;k++){var l=b.apply(c[k].x,c[k].y);if(1<Math.abs(h.y-l.y)){var n=l.y<h.y,r=Math.min(h.y,l.y),v=Math.max(h.y,l.y),x=(l.x-h.x)/(v-r);n&&(x*=-1);this.rj.push({yw:d,ii:n?l.x:h.x,Te:r,av:v,rm:x})}h=l}}this.rj.sort(function(a,b){return a.Te!=b.Te?a.Te-b.Te:a.ii-b.ii})}c.prototype.fu=function(a,b){void 0===
b&&(b=0);if(1>this.rj.length||0>=a)return[];var d=this.rj,e=this.rj[0].Te+b;b=0;for(var c=[],h=[];;){for(var k=0;k<c.length;k++)e>c[k].ib.av&&(c[k]=c[c.length-1],--c.length);if(0===c.length&&b===d.length)break;for(;b<d.length&&d[b].Te<=e;b++)d[b].av>=e&&c.push({y:e,ib:d[b]});c.sort(function(a,b){var d=a.ib.ii+(e-a.ib.Te)*a.ib.rm,c=b.ib.ii+(e-b.ib.Te)*b.ib.rm;return 1E-5<Math.abs(d-c)?d-c:a.ib.yw-b.ib.yw});for(k=1;k<c.length;k+=2){var l=c[k-1].ib,n=c[k].ib;n=n.ii+(e-n.Te)*n.rm;h.push({start:this.inverse.apply(l.ii+
(e-l.Te)*l.rm,e),end:this.inverse.apply(n,e)})}e+=a}return h};return c}();function Qc(c,a,b){c=(a.y-c.y)*(b.x-a.x)-(a.x-c.x)*(b.y-a.y);return 0==c?0:0<c?1:2}
function Rc(c){var a=c.concat();if(3>a.length)return c;for(var b=a[0].y,d=0,e=1;e<a.length;e++){var f=a[e].y;if(f<b||b===f&&a[e].x<a[d].x)b=a[e].y,d=e}var h=a[d];a[d]=a[a.length-1];--a.length;a.sort(function(a,b){var d=Qc(h,a,b);return 0==d?lc(h.x,h.y,b.x,b.y)>=lc(h.x,h.y,a.x,a.y)?-1:1:2==d?-1:1});for(e=b=0;e<a.length;e++){for(;e<a.length-1&&0==Qc(h,a[e],a[e+1]);)e++;a[b]=a[e];b++}if(2>b)return c;c=[];c.push(h);c.push(a[0]);c.push(a[1]);for(e=2;e<b;e++){for(;1<c.length&&2!=Qc(c[c.length-2],c[c.length-
1],a[e]);)c.pop();c.push(a[e])}Sc(c);return c}function Sc(c){if(!(2>c.length)){var a=c[c.length-1],b=c[0];a.x===b.x&&a.y===b.y||c.push(b)}};function Tc(c){return 0!=(c.nb&1)}function Uc(c){return 0!=(c.nb&4)}function Vc(c){return 5===(c.nb&5)&&c.da}function Wc(c){return 0!=(c.nb&8)};var Xc=u.create("BaseNode"),Zc=function(){function c(a,b){this.id=a;this.aa=b;this.nb=0;this.parent=null;this.ba={};this.children=[];this.scope=null}c.prototype.type=function(){return"BaseNode"};c.prototype.$m=function(){return this.type()};c.prototype.toString=function(){return this.type()+":"+this.id};c.prototype.dC=function(a,b){this.aa.Qd([this.id],a,b)};c.prototype.bi=function(a){this.scope||(this.scope=Yc(a,this));return this.scope};c.vd=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in
c.types?new c.types[a](b,d):null};c.prototype.Ta=function(){};c.prototype.Sg=function(a,b){b=ic(this.ba[a],b);b instanceof Array&&(b=b.slice(0));return b};c.prototype.mb=function(){var a={},b;for(b in this.ba)this.ba.hasOwnProperty(b)&&(a[b]=this.ia(b));return a};c.prototype.Nb=function(a){for(var b in a)this.setProperty(b,a[b])};c.prototype.Zg=function(a){return a in this.ba};c.prototype.nc=function(a){return this.Zg(a)||"$"===a[0]||"_"===a[0]};c.prototype.setProperty=function(a,b){b=this.Sg(a,b);
this.nc(a)?(Xc("%s:%s set %s=%s",this.id,this.type(),a,"string"===typeof b?b.substr(0,100):b),this.ba[a]=b):Xc("Property '%s' not valid for %s",a,this.type());return b};c.prototype.ia=function(a){a=this.ba[a];a instanceof Array&&(a=a.slice(0));return a};c.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);return b};c.prototype.Tp=function(a,b){this.children.splice(b,0,a)};c.prototype.pb=function(a){return this.children[a]};c.prototype.re=function(a){for(var b=0;b<this.children.length;b++)if(a===
this.pb(b))return b;return-1};c.types={};return c}();var $c=u.create("WrappedNode");function ad(c,a){var b=0;return function(){return{next:function(){return b>=c.children.length?{done:!0}:{value:c.pb(b++).bi(a)}}}}}
function Yc(c,a){var b={};b.ctx=c.ctx;b.id=a.id;b.type=a.$m();"undefined"!==typeof Proxy?(b.children=new Proxy({},{get:function(b,e){da();fa();if(e===Symbol.iterator)return ad(a,c);if("length"===e)return a.children.length;b=a.pb(e);return b instanceof Zc?b.bi(c):b}}),b.props=bd(a.ba,"",function(b,e){a.dC(b,e)})):(Object.defineProperty(b,"children",{get:function(){throw Error("Not supported in this browser");}}),Object.defineProperty(b,"props",{get:function(){throw Error("Not supported in this browser");
}}));Object.defineProperty(b,"parent",{configurable:!0,get:function(){return a.parent?a.parent.bi(c):null},set:function(b){$c("Warning; replacing parent property");a.parent=b}});Uc(a)&&Object.defineProperty(b,"element",{configurable:!0,get:function(){return a.da}});return b}
function bd(c,a,b){function d(d){if("string"===typeof d)for(var e in c)if(e.startsWith(""+a+d+"."))return bd(c,""+a+d+".",b);return null}void 0===a&&(a="");return new Proxy(c,{get:function(b,f){return"hasOwnProperty"===f?function(b){return a+b in c}:"string"===typeof f?(b=d(f))?b:c[a+f]:c[f]},has:function(b,f){return"string"===typeof f?(b=d(f))?b:a+f in c:b.hasOwnProperty(f)},set:function(d,f,h){"string"===typeof f?(c[a+f]=h,b(a+f,h)):c[f]=h;return!0}})};var cd=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.nF="DataNode";return a}__extends(a,c);a.prototype.type=function(){return"DataNode"};a.prototype.nc=function(){return!0};return a}(Zc);Zc.vd("DataNode",cd);var dd=function(){function c(){this.Fb=[]}c.prototype.NC=function(a){for(var b=0;b<this.Fb.length;b++)this.Fb[b].parent===a&&(this.Fb[b]=this.Fb[this.Fb.length-1],this.Fb.length--,b--)};c.prototype.lw=function(a,b){for(var d=0;d<this.Fb.length;d++)this.Fb[d].parent===a&&(b.length?this.Fb[d].zd=b.pop():(this.Fb[d]=this.Fb[this.Fb.length-1],this.Fb.length--,d--));for(d=0;d<b.length;d++)this.Fb.push({parent:a,zd:b[d]})};c.prototype.jp=function(a){for(var b={},d=[],e={},c=0;c<a.length;c++)b[a[c]]=1;for(a=
!0;a;){a=!1;c=0;for(var h=this.Fb;c<h.length;c++){var k=h[c];k.zd in b&&!(k.parent in e)&&(e[k.parent]=1,d.push(k.parent),a=!0)}}return d};c.prototype.sort=function(a){for(var b={},d=0,e=this.Fb;d<e.length;d++){var c=e[d];b[c.parent+":"+c.zd]=1}a.sort(function(a,d){return a.id+"_"+d.id in b?1:0})};return c}();var ed=function(){function c(a,b){var d=this;this.ma=a;this.Dl=b;this.height=0;this.x=b.x||0;this.y=b.y||0;this.VE=b.xoffset||0;this.YE=b.yoffset||0;this.width=b.width||0;this.Na=document.createElement("img");this.Na.src=b.image||"";this.Na.onload=function(){d.width=d.width||d.Na.naturalWidth;d.height=d.width/d.Na.naturalWidth*d.Na.naturalHeight;a.Od()};b.hoverImage?(this.tm=document.createElement("img"),this.tm.src=b.hoverImage):this.tm=this.Na;this.Ds=this.Na}c.prototype.Ms=function(a){return this.Dl.appliesTo?
this.Dl.appliesTo(a.id,this.ma):!0};c.prototype.nu=function(a){var b=a.ya;a=a.Pa().vb();return new G(b.x+this.x*b.width+(this.VE-this.width/2)/a.x,b.y+this.y*b.height+(this.YE-this.height/2)/a.y,this.width/a.x,this.height/a.y)};c.prototype.Db=function(a,b,d,e){var c=this.nu(a);a=a.Pa().inverse().apply(b,d);return c.Oc(a.x,a.y,e)};c.prototype.la=function(a,b,d){this.Ds.complete&&(a.save(),b.Pa().mc(a),b=this.nu(b),this.tm.complete&&d?a.drawImage(this.tm,b.x,b.y,b.width,b.height):a.drawImage(this.Ds,
b.x,b.y,b.width,b.height),a.restore())};c.prototype.click=function(a,b){if(this.Dl.onclick)try{this.Dl.onclick(a.id,this.ma,b)}catch(d){console.log("Error in decoration onclick handler: ",d)}};return c}();var fd=function(){function c(a){this.zb=a;this.ul=[];this.Zm=!0;this.log=u.create("cloudAddon");this.Gf=a.ia("cloudRadius")}c.prototype.format=function(){var a=this.zb.Md.he()[0];this.log("Format cloud; %s points",a.length);this.ul=this.zy(a,this.Gf)};c.prototype.zy=function(a,b){var d=[],e=5/6*b*2,c,h=a[a.length-1];for(c=0;c<a.length;c++){var k=a[c];var l=k.x-h.x,n=k.y-h.y,r=Math.sqrt(l*l+n*n);l/=r;n/=r;var v=r/e+.5|0;1>v&&(v=1);v=r/v;for(var x=0;x+.1*v<r;x+=v)d.push({x:h.x+x*l,y:h.y+x*n,bb:0,end:0});
h=k}e=d[d.length-1];for(c=0;c<d.length;c++)a=d[c],h=a.x-e.x,l=a.y-e.y,k=.5*Math.sqrt(h*h+l*l)/b,-1>k&&(k=-1),1<k&&(k=1),h=Math.atan2(l,h),k=Math.acos(k),k=[h-k,Math.PI+h+k],e.end=k[0],a.bb=k[1],e=a;return d};c.prototype.la=function(a){this.log("Drawing cloud with %s circles",this.ul.length);var b=15*Math.PI/180,d=this.Gf;a.beginPath();for(var e=0;e<this.ul.length;e++){var c=this.ul[e];a.arc(c.x,c.y,d,c.bb,c.end+b)}a.stroke()};return c}();var hd=function(c){function a(b,d){b=c.call(this,b,d)||this;b.rect=new G(0,0,1,1);b.Zk=!1;b.ya=new G(0,0,1,1);b.Wc=0;b.log=u.create("GraphicsNode");b.offsetX=0;b.offsetY=0;b.nb|=17;b.ba.matrix=new H;b.ba.layer="default";b.uo(a.ua);return b}__extends(a,c);a.prototype.uo=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.ba[b]=a[b])};a.prototype.clip=function(){};a.prototype.Ta=function(){};a.prototype.uf=function(){return!1!==this.ia("lockEditMode")};a.prototype.pu=function(){return!1};a.prototype.fi=
function(){return null};a.prototype.qj=function(){};a.prototype.Gu=function(){return!1};a.prototype.gr=function(){return!1};a.prototype.$g=function(){return"text"in this.ba};a.prototype.Cc=function(){var a=this.ia("layer");return a?""+a:"default"};a.prototype.ym=function(){return null!==this.parent&&null!==this.parent.parent&&"GroupNode"===this.parent.type()};a.prototype.type=function(){return"BaseNode"};a.prototype.wd=function(a){return{matrix:a.multiply(this.Pa())}};a.prototype.Pa=function(){return this.ia("matrix")};
a.prototype.Zb=function(){return this.Pa().inverse()};a.prototype.ED=function(a){this.setProperty("matrix",a)};a.prototype.Sg=function(a,d){if("shadow"===a&&("string"===typeof d||"boolean"===typeof d))return d;d=c.prototype.Sg.call(this,a,d);"matrix"===a&&"string"===typeof d?d=new H(d):"opacity"===a&&(d=parseFloat(d));return d};a.prototype.nc=function(a){switch(a){case "customData":case "tag":case "locked":case "lockSize":case "lockRotation":case "lockPosition":case "lockEditMode":case "rotationHandles":case "lockAspectRatio":case "zIndex":case "snap":case "opacity":case "shadow":case "type":return!0}return c.prototype.nc.call(this,
a)};a.prototype.Sl=function(){var a=new Bc(this.ya);a.transform(this.Pa());return a};a.prototype.Zd=function(){return this.ia("zIndex")||0};a.prototype.transform=function(a){this.ED(a.multiply(this.Pa()))};a.prototype.format=function(){};a.prototype.Db=function(a,d,e){a=this.Zb().apply(a,d);d=this.Zb().vb();d=.5*(d.x+d.y);return this.hidden()||this.ia("locked")||!this.ya.Oc(a.x,a.y,e*d)?null:this};a.prototype.sg=function(a){this.Zk=a};a.prototype.hidden=function(){return this.Zk};a.prototype.Fi=function(){};
a.prototype.Lm=function(){};a.prototype.Om=function(){};a.prototype.kk=function(a){if(a.kk){var b={"zwibbler:id":""+this.id};if("tag"in this.ba){var e=this.ba.tag;"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:tag"]=e}for(var c in this.ba){e=this.ba[c];if("_"===c.substr(0,1))c=c.substr(1);else if("tag"!==c)continue;"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:"+c]=e}a.kk(b)}};a.prototype.jk=function(a){a.jk&&a.jk()};a.prototype.la=function(a){a.save();this.kk(a);a.translate(this.offsetX,
this.offsetY);var b=this.ba.matrix;a.transform(b.m11,b.m21,b.m12,b.m22,b.Fa,b.Ga);"erase"===this.ba.strokeStyle?a.Ri?a.strokeStyle=a.Ri:(a.strokeStyle=q.Oa,a.globalCompositeOperation="destination-out"):a.strokeStyle=this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;this.ba.shadow&&gd(this.ba.shadow,a);"opacity"in this.ba&&(a.globalAlpha=this.ba.opacity);this.Tf(a);this.jk(a);a.restore()};a.prototype.Bt=function(a,d){d=d?function(b){a.fillStyle=b;a.fill()}:function(b){a.strokeStyle=
b;a.stroke()};a.Ri?(a.globalCompositeOperation="destination-out",--a.lineWidth,d(q.Oa),a.globalCompositeOperation="source-over",a.fillStyle=a.Ri,a.lineWidth+=2,d(a.Ri),--a.lineWidth):(a.globalCompositeOperation="destination-out",d(q.Oa),a.globalCompositeOperation="source-over")};a.prototype.Tf=function(){};a.prototype.resolve=function(){return!1};a.prototype.Rt=function(a,d,e,c){this.tj||(this.tj={});var b=this.tj[a];if(!b||b.Sw!==c){b&&c===b.Sw||(b={Sw:c,value:c},this.tj[a]=b);a=/url\(([^\)]+)\)/.exec(c);
var f;a&&(f=a[1]);var l=this;f&&(b.value="rgba(0, 0, 0, 0.2)",e.yf(this.id,f,function(a){l.log("Got image response.");b.value=d.createPattern(a,"repeat")||"magenta";e.qg(l.id)}))}};a.prototype.up=function(a){return this.tj&&(a=this.tj[a])?a.value:"magenta"};a.prototype.Ue=function(){return{}};a.prototype.Wl=function(){};a.prototype.Xl=function(){return null};a.prototype.pw=function(){};a.prototype.Jp=function(){return[]};a.prototype.mn=function(a,d){this.offsetX=a;this.offsetY=d};a.ua={fillStyle:"#cccccc",
strokeStyle:q.Oa,lineWidth:2,shadow:!1};return a}(Zc),id=/ *(\d+)(px)? +(\d+)(px)? +(\d+)(px)? +(.+)/i;function gd(c,a){void 0===a&&(a={});a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.shadowColor=q.Be;if("string"===typeof c){if(c=id.exec(c))a.shadowOffsetX=parseFloat(c[1]),a.shadowOffsetY=parseFloat(c[3]),a.shadowBlur=parseFloat(c[5]),a.shadowColor=c[7]}else c&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)")};var jd=function(){function c(){this.text="";this.font="10px Arial";this.Pt="Arial";this.fontSize=10;this.lines=[];this.Nr="top";this.Ij="left";this.Qj=this.bold=!1;this.textDecoration="";this.outline=null;this.zo=0;this.log=u.create("TextBox");this.rect=new G(0,0,0,this.fontSize)}c.prototype.uk=function(a,b,d,e,c){this.Pt=a;this.fontSize=b;this.bold=d;this.Qj=e;this.textDecoration=c};c.prototype.kn=function(a){this.outline=a};c.prototype.nD=function(a){this.zo=a};c.prototype.ug=function(a){this.text=
a};c.prototype.rk=function(a,b){switch(a){case "left":case "center":case "right":this.Ij=a;break;case null:break;default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.Nr=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.Qz=function(a){if(!this.outline)throw Error("formatInOutline called with no outline");for(var b=G.Ag(this.outline[0]),d=0;;){d++;var e=d*this.fontSize;if(e>b.height){this.ao(a,b.width,b.height,0,!1);this.rect.x+=
b.x;this.rect.y=b.height/2-this.rect.height/2;break}this.ao(a,0,0,b.height/2-e/2+this.zo,!0);if(this.lines.length===d)break}};c.prototype.format=function(a,b,d){this.outline?this.Qz(a):this.ao(a,b,d,0,!1)};c.prototype.ao=function(a,b,d,e,c){this.font=""+this.fontSize+'px "'+this.Pt+'"';this.bold&&(this.font="bold "+this.font);this.Qj&&(this.font="italic "+this.font);this.lines.length=0;var f=[],k=0;this.outline&&c&&(f=(new Pc(this.outline)).fu(this.fontSize,e));var l=0;a.font=this.font;c=e;this.rect.width=
b;if(0===b&&0===f.length){var n=this.text.split("\n");for(e=0;e<n.length;e++){var r=n[e];l=a.measureText(r).width;c+=this.fontSize;this.lines.push({x:0,y:c,width:l,text:r,Ok:0});this.rect.width=Math.max(this.rect.width,l);l=0;for(r=this.lines;l<r.length;l++)r[l].Ok=this.rect.width}}else{r=n=0;var v=!1,x=b,w=0,y=function(){if(k<f.length){var a=f[k].start.x,b=f[k].end.x;k+1<f.length&&(a=Math.max(a,f[k+1].start.x),b=Math.min(b,f[k+1].end.x));x=b-a;w=a;k++}};y();for(e=0;e<this.text.length;e++){var A=
this.text.charAt(e);l=a.measureText(this.text.substr(n,e-n+1)).width;111;"\n"===A?v=!0:l>=x?r?(e=r,v=!0):e>n?(--e,v=!0):f.length&&(v=!0):" "===A&&(r=e);v&&(l=" "===this.text.charAt(e)?a.measureText(this.text.substr(n,e-n)).width:a.measureText(this.text.substr(n,e-n+1)).width,c+=this.fontSize,this.lines.push({x:w,y:c,width:l,text:this.text.substr(n,e-n+1),Ok:x}),n=e+1,r=0,v=!1,this.rect.width=Math.max(this.rect.width,l),k<f.length?y():f.length&&(x=100,w=0))}if(l||"\n"===this.text.charAt(this.text.length-
1))c+=this.fontSize,this.lines.push({x:w,y:c,width:l,Ok:x,text:this.text.substr(n,e-n)}),this.rect.width=Math.max(this.rect.width,l)}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("center"===this.Ij)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x+=a.Ok/2-a.width/2;else if("right"===this.Ij)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x+=a.Ok-a.width;b&&"center"===this.Ij?this.rect.x=b/2-this.rect.width/2:b&&"right"===this.Ij&&(this.rect.x=b-this.rect.width);0===f.length&&(d&&"middle"===
this.Nr?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.Nr&&(this.rect.y=d-this.rect.height))};c.prototype.la=function(a,b,d){this.fillText(a,b,d);this.xt(a,b,d)};c.prototype.xt=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var h=this.lines[e];a.moveTo(h.x+b,h.y+d+c);a.lineTo(h.x+b+h.width,h.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();
a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)h=this.lines[e],a.moveTo(h.x+b,h.y+d+c),a.lineTo(h.x+b+h.width,h.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=
this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var kd=function(c){function a(b,d){b=c.call(this,b,d)||this;b.$a=new jd;b.fB=0;b.border={lineWidth:0,Nc:q.Oa};b.width=0;b.height=0;b.xF=0;b.yF=0;b.log=u.create("TEXT",!0);b.path=null;b.uo(a.ux);b.ba.text="lorum ipsum dolor";return b}__extends(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.Bj=function(){return void 0!==this.ia("width")?2:this.ia("wrap")?1:0};a.prototype.wd=function(a){var b=c.prototype.wd.call(this,a);2===this.Bj()&&(a=a.vb(),this.log("Scale %s",a),1E-8>Math.abs(a.x-
a.y)&&(b.fontSize=this.ba.fontSize*a.x,b.padding=(this.ba.padding||0)*a.x));return b};a.prototype.nc=function(a){switch(a){case "scaleFont":case "padding":case "width":case "height":case "baseWidth":return!0}return c.prototype.nc.call(this,a)};a.prototype.setProperty=function(a,d){switch(a){case "fillStyle":case "textFillStyle":this.ba.textFillStyle=d;this.ba.fillStyle=d;return;case "border-color":a=this.hk(this.ia("border")||"");this.setProperty("border",a.lineWidth+"px "+d);return;case "border-width":a=
this.hk(this.ia("border")||"");this.setProperty("border",d+"px "+a.Nc);return}c.prototype.setProperty.call(this,a,d)};a.prototype.mb=function(){var a=c.prototype.mb.call(this);a["border-color"]=this.ia("border-color");a["border-width"]=this.ia("border-width");return a};a.prototype.Zg=function(a){switch(a){case "border":return!0}return c.prototype.Zg.call(this,a)};a.prototype.ia=function(a){switch(a){case "border-color":return this.hk(this.ia("border")||"").Nc;case "border-width":return this.hk(this.ia("border")||
"").lineWidth}return c.prototype.ia.call(this,a)};a.prototype.kn=function(a){this.path=a};a.prototype.format=function(a){var b=this.ba.matrix,e=b.apply(0,0),c=b.apply(1,0);e=e.ec(c);c=this.Bj();var h=this.ba.text;0===c&&h.length&&10===h.charCodeAt(h.length-1)&&(h=h.substr(0,h.length-1));this.$a.ug(h);this.$a.kn(this.path);b=b.vb();this.$a.uk(this.ba.fontName,this.ba.fontSize,this.ba.bold,this.ba.italic,this.ba.textDecoration);this.path?this.$a.rk(this.ba.textAlign,this.ba.verticalAlign||"top"):this.$a.rk(this.ba.textAlign,
"top");c=this.ia("padding")||0;h=this.ia("lineWidth")+0;switch(this.Bj()){case 0:this.$a.format(a,0,0);e=this.$a.rect.width;a=this.$a.rect.height;this.ya=new G(0,-(0+this.ia("fontSize")),e,a);break;case 1:var k=this.ba.baseWidth;void 0===k&&(this.$a.format(a,0,0),k=Math.max(this.$a.rect.width,10),500<k&&(k=500),this.ba.baseWidth=k,this.log("Formatting text for first time; baseWidth=%s",k));e=Math.ceil(e*k);this.$a.format(a,e,0);a=this.$a.rect.height;this.ya=new G(0,0,k,a);break;case 2:e=this.ia("width")||
0;this.ia("height");e=(e-2*c/b.x)*b.x;this.$a.format(a,e,0);this.ya=new G(0,0,e/b.x,this.$a.rect.height+(2*c*b.y-2*c)/b.y);this.ya.x+=(c+h)/b.x;this.ya.y+=(c+h)/b.y;break;default:throw Error("TextNode: Bad Mode "+this.Bj());}this.ya.height+=.3*this.ba.fontSize/b.y;this.ya.Hd(2*c/b.x,2*c/b.y);this.ya.Hd(h/b.x,h/b.y);a=new Bc(this.ya);a.transform(this.Pa());this.rect=a.Ws();this.fB=this.rect.height;this.border=this.ba.border?this.hk(this.ba.border):{lineWidth:0,Nc:q.Oa}};a.prototype.hk=function(a){var b=
{lineWidth:0,Nc:q.Oa};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=q.Rl(a[e]))b.Nc=c.toString()}else b.lineWidth=c}return b};a.prototype.Pa=function(){return!1===this.ia("scaleFont")?c.prototype.Pa.call(this).An():c.prototype.Pa.call(this)};a.prototype.la=function(a){if(0!==this.ba.text.length){a.save();this.kk(a);"opacity"in this.ba&&(a.globalAlpha=this.ba.opacity);var b=this.ba.background;if(b||this.border.lineWidth)a.save(),this.Pa().mc(a),b&&(a.fillStyle=
b,a.fillRect(this.ya.x,this.ya.y,this.ya.width,this.ya.height)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.Nc,a.lineWidth=this.border.lineWidth,a.rect(this.ya.x,this.ya.y,this.ya.width,this.ya.height),b=this.Zb(),b.An().multiply(b).mc(a),a.stroke()),a.restore();b=this.Bj();var e=this.ba.padding||0;0!==b?this.Pa().An().mc(a):this.Pa().mc(a);a.strokeStyle=this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;var c=0,h=this.Pa().vb(),k=this.ya.height*h.y;
if(0===b&&!1!==this.ia("scaleFont"))c=-(0+this.ia("fontSize"));else if(!this.path)switch(this.log("Available: %s rect: %s",k,this.$a.rect),this.ba.verticalAlign){case "bottom":c+=k-this.$a.rect.height;break;case "middle":c+=(k-this.$a.rect.height)/2}2===b&&a.translate(e,e);"center"===this.ba.textAlign&&this.log("xshift is %s, urect=%s scaleX=%s tw=%s",0,this.ya,h.x,this.$a.rect.width);this.ba.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");0<this.ba.lineWidth&&
this.$a.strokeText(a,0,c);this.$a.fillText(a,0,c);this.$a.xt(a,0,c);this.jk(a);a.restore()}};a.ux={textFillStyle:q.Oa,fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:q.Oa,wrap:!1,textAlign:"left",bold:!1,italic:!1,background:q.Be,textDecoration:""};return a}(hd);hd.vd("TextNode",kd);var ld=function(){function c(a,b){this.qa=a;this.ja=b;this.XD=!0;this.log=u.create("MoveSegment")}c.prototype.la=function(a){a.moveTo(this.ja.x,this.ja.y)};c.prototype.Nf=function(){return this.Ad()};c.prototype.Ad=function(){return{x:1,y:0}};return c}(),md=function(){function c(a,b,d,e,c){this.qa=a;this.ja=b;this.pn=e;this.If=c;this.log=u.create("LineSegment");this.wh=0;this.Qa=new F(0,0);this.Wa=new F(0,0);this.length=0;this.from=new F(0,0);this.ja=b;this.qa=a;this.If=c;this.pn=e;d.next();this.Um=
d.next();this.Vm=d.next();this.moveTo=this.Jf=null;this.format()}c.prototype.format=function(){var a=lc(this.qa.ja.x,this.qa.ja.y,this.ja.x,this.ja.y);this.wh=this.length=a;var b=this.qa.ja.clone();this.qa instanceof c&&this.If&&(this.If=Math.min(this.If,a/2,this.qa.length/2),a=mc(this.qa.ja.x,this.qa.ja.y,this.ja.x,this.ja.y),b.x+=a.x*this.If,b.y+=a.y*this.If,this.qa.SD(this.If),this.wh-=this.If);this.from=b;null===this.Jf&&(this.Jf=this.ja);a=this.wh/10*this.pn;10<a&&(a=10);var d=b.x,e=b.y,f=this.ja.x,
h=this.ja.y;d+=a;e+=a;this.Qa=new F(d+this.Um*(f+a-d),e+this.Um*(h+a-e));d=b.x-a;f=this.ja.x-a;e=b.y-a;h=this.ja.y-a;this.Wa=new F(d+this.Vm*(f-d),e+this.Vm*(h-e))};c.prototype.SD=function(a){var b=mc(this.from.x,this.from.y,this.ja.x,this.ja.y),d=this.ja.clone();d.x-=b.x*a;d.y-=b.y*a;this.Jf=d;this.wh-=a;a=this.wh/10*this.pn;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,h=d.y;b+=a;e+=a;this.Qa=new F(b+this.Um*(c+a-b),e+this.Um*(h+a-e));this.log("RECALC ctrl1=%s",this.Qa);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;h=d.y-a;this.Wa=new F(b+this.Vm*(c-b),e+this.Vm*(h-e))};c.prototype.wk=function(a){this.qa=a;this.format();this.qa instanceof c&&(this.moveTo=this.qa.Jf)};c.prototype.la=function(a){null!==this.Jf&&(this.If&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.qa.ja.x,this.qa.ja.y,this.from.x,this.from.y)),0===this.pn?a.lineTo(this.Jf.x,this.Jf.y):a.bezierCurveTo(this.Qa.x,this.Qa.y,this.Wa.x,this.Wa.y,this.Jf.x,this.Jf.y))};c.prototype.Nf=function(){return this.qa?
mc(this.qa.ja.x,this.qa.ja.y,this.Qa.x,this.Qa.y):this.Ad()};c.prototype.Ad=function(){for(var a=this.Wa,b=lc(this.Wa.x,this.Wa.y,this.ja.x,this.ja.y),d=this.qa;20>b&&d instanceof c;)a=d.Wa,d=d.qa,b+=lc(a.x,a.y,this.ja.x,this.ja.y);return mc(a.x,a.y,this.ja.x,this.ja.y)};return c}(),nd=function(){function c(a,b,d){this.jr=d;this.ja=b;this.qa=a;this.jr=d;var e=lc(a.ja.x,a.ja.y,b.x,b.y);e||(e=1);var c=(b.x-a.ja.x)/e,h=(b.y-a.ja.y)/e;this.Wa=new F(b.x-e*d*c,b.y-e*d*h);if((b=a.Wa)&&a.qa){var k=mc(a.qa.ja.x,
a.qa.ja.y,a.ja.x,a.ja.y),l=lc(a.qa.ja.x,a.qa.ja.y,a.ja.x,a.ja.y);c=.5*(c+k.x);h=.5*(h+k.y);b.x=a.ja.x-l*d*c;b.y=a.ja.y-l*d*h}this.Qa=new F(a.ja.x+e*d*c,a.ja.y+e*d*h);this.length=e}c.prototype.wk=function(a){this.qa=a;var b=a.Wa,d=(this.ja.x-a.ja.x)/this.length,e=(this.ja.y-a.ja.y)/this.length,c=this.jr;if(b&&a.qa){var h=mc(a.qa.ja.x,a.qa.ja.y,a.ja.x,a.ja.y),k=lc(a.qa.ja.x,a.qa.ja.y,a.ja.x,a.ja.y);d=.5*(d+h.x);e=.5*(e+h.y);b.x=a.ja.x-k*c*d;b.y=a.ja.y-k*c*e}this.Qa=new F(a.ja.x+this.length*c*d,a.ja.y+
this.length*c*e)};c.prototype.la=function(a){a.bezierCurveTo(this.Qa.x,this.Qa.y,this.Wa.x,this.Wa.y,this.ja.x,this.ja.y)};c.prototype.Nf=function(){return this.qa?mc(this.qa.ja.x,this.qa.ja.y,this.Qa.x,this.Qa.y):{x:1,y:0}};c.prototype.Ad=function(){return 0<this.jr?mc(this.Wa.x,this.Wa.y,this.ja.x,this.ja.y):mc(this.qa.ja.x,this.qa.ja.y,this.ja.x,this.ja.y)};return c}(),od=function(){function c(a,b,d){this.qa=a;this.control=b;this.ja=d}c.prototype.la=function(a){a.quadraticCurveTo(this.control.x,
this.control.y,this.ja.x,this.ja.y)};c.prototype.Nf=function(){return this.qa?mc(this.qa.ja.x,this.qa.ja.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.Ad=function(){return mc(this.control.x,this.control.y,this.ja.x,this.ja.y)};return c}(),pd=function(){function c(a,b,d,e){this.qa=a;this.control=b;this.ja=d;this.Gf=e}c.prototype.la=function(a){a.arcTo(this.control.x,this.control.y,this.ja.x,this.ja.y,this.Gf)};c.prototype.Nf=function(){return{x:1,y:0}};c.prototype.Ad=function(){return mc(0,
0,1,0)};return c}(),qd=function(){function c(a,b,d,e,c,h,k){this.qa=a;this.ne=b;this.ja=d;this.Gf=e;this.nr=c;this.yz=h;this.Py=k}c.prototype.la=function(a){a.arc(this.ne.x,this.ne.y,this.Gf,this.nr,this.yz,0!==this.Py)};c.prototype.Nf=function(){return{x:1,y:0}};c.prototype.Ad=function(){return mc(0,0,1,0)};return c}(),rd=function(){function c(a,b,d,e){this.Qa=b;this.Wa=d;this.Qa=b;this.Wa=d;this.ja=e;this.qa=a}c.prototype.la=function(a){a.bezierCurveTo(this.Qa.x,this.Qa.y,this.Wa.x,this.Wa.y,this.ja.x,
this.ja.y)};c.prototype.Nf=function(){return this.qa?mc(this.qa.ja.x,this.qa.ja.y,this.Qa.x,this.Qa.y):{x:1,y:0}};c.prototype.Ad=function(){return mc(this.Wa.x,this.Wa.y,this.ja.x,this.ja.y)};return c}(),sd=function(){function c(a,b,d,e){this.qa=a;this.Qa=b;this.Wa=d;this.ja=e}c.prototype.la=function(a){if(this.qa){var b=[];this.qa.Wa&&b.push(this.qa.Wa);this.Qa&&b.push(this.Qa);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.ja.x,this.ja.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,
this.ja.x,this.ja.y)}};c.prototype.wk=function(a){this.qa=a};c.prototype.Nf=function(){return this.qa&&this.qa.Wa?mc(this.qa.ja.x,this.qa.ja.y,this.Qa.x,this.Qa.y):{x:1,y:0}};c.prototype.Ad=function(){return this.Qa?mc(this.Qa.x,this.Qa.y,this.ja.x,this.ja.y):{x:1,y:0}};return c}(),td=function(){function c(a,b,d,e,c){this.qa=a;this.ej=b;this.ja=d;this.log=u.create("SEGMENT");this.qa=a;this.ej=b;c*=2;var f=2*e.next()-1;e.next();e=this.qa.Ad();if(!this.qa.XD&&e){var k=lc(a.ja.x,a.ja.y,b.x,b.y);this.Qa=
new F(a.ja.x+.5522847498*e.x*k,a.ja.y+.5522847498*e.y*k)}else this.Qa=new F(a.ja.x+.5522847498*(b.x-a.ja.x),a.ja.y+.5522847498*(b.y-a.ja.y));this.Wa=new F(d.x-.5522847498*(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*(1-f*c));this.ja=d}c.prototype.wk=function(a){this.qa=a;var b=this.qa.Ad();if(b){var d=lc(a.ja.x,a.ja.y,this.ej.x,this.ej.y);this.Qa=new F(a.ja.x+.5522847498*b.x*d,a.ja.y+.5522847498*b.y*d)}else this.Qa=new F(a.ja.x+.5522847498*(this.ej.x-this.qa.ja.x),a.ja.y+.5522847498*(this.ej.y-this.qa.ja.y))};
c.prototype.la=function(a){a.bezierCurveTo(this.Qa.x,this.Qa.y,this.Wa.x,this.Wa.y,this.ja.x,this.ja.y)};c.prototype.Nf=function(){return this.qa?mc(this.qa.ja.x,this.qa.ja.y,this.Qa.x,this.Qa.y):{x:1,y:0}};c.prototype.Ad=function(){return mc(this.Wa.x,this.Wa.y,this.ja.x,this.ja.y)};return c}();var ud=function(){function c(a){this.Vj=this.Uj=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.Wq=a;this.reset()}c.prototype.reset=function(){this.Vj=this.Uj=this.Wq};c.prototype.next=function(){this.Vj=36969*(this.Vj&65535)+(this.Vj>>16);this.Uj=18E3*(this.Uj&65535)+(this.Uj>>16);return((this.Vj<<16)+this.Uj)/4294967295/2+.5};return c}();var vd=function(){function c(a){this.oa=a;this.n=0;this.Mb=new F(0,0)}c.prototype.next=function(a){if(0===this.oa.length)return null;if(0===this.n)return this.Mb=this.oa[0].clone(),this.n+=1,this.Mb.clone();for(;this.n<this.oa.length;){var b=this.Mb.ec(this.oa[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.Mb.x+=(this.oa[this.n].x-this.Mb.x)*a/b,this.Mb.y+=(this.oa[this.n].y-this.Mb.y)*a/b,this.Mb.clone()}return null};return c}(),wd=function(){function c(a){this.zb=a;this.Zm=
!0;this.oa=[];this.log=u.create("WaveAddon");this.Gf=a.ia("waveRadius")}c.prototype.format=function(){var a=this.zb.xo(!1).Fk(I.Pn).he();this.log("Format cloud; %s points",a[0].length);this.oa=this.PE(a,this.Gf)};c.prototype.PE=function(a,b){for(var d=[],e=0;e<a.length;e++){var c=a[e],h=new vd(c),k=1,l=[];if(!(2>c.length)){var n=0;for(var r=1;r<c.length;r++)n+=lc(c[r-1].x,c[r-1].y,c[r].x,c[r].y);b=n/Math.round(n/(2*b)+.5)/2;for(n=[];;){r=h.next(2*b);if(!r)break;n.push(r)}n.push(c[c.length-1]);h=n[0];
l.push(h);for(c=1;c<n.length;c++){r=n[c];var v=mc(h.x,h.y,r.x,r.y);var x=b,w=new F(v.y*k,-1*v.x*k);h=new F(h.x+(v.x+w.x)*x,h.y+(v.y+w.y)*x);l.push(h);l.push(r);k*=-1;h=r}for(c=2;c<l.length-1;c+=2)k=l[c-1],n=l[c+1],l[c].x=k.x+(n.x-k.x)/2,l[c].y=k.y+(n.y-k.y)/2}d.push(l)}return d};c.prototype.la=function(a){a.beginPath();for(var b=0,d=this.oa;b<d.length;b++){var e=d[b];a.moveTo(e[0].x,e[0].y);for(var c=1;c<e.length-1;c+=2)a.quadraticCurveTo(e[c].x,e[c].y,e[c+1].x,e[c+1].y)}};return c}();var xd;(function(c){function a(a){a=1664525*a+1013904223&4294967295;return function(){a=1664525*a+1013904223&4294967295;return a/4294967295+.5}}function b(a){return Math.floor(a*c.random())}c.random=Math.random;c.Ut=a;c.Wq=function(b){c.random=a(b)};c.KF=function(){c.random=Math.random};c.rF=b;c.IF=function(a){for(var d=[],c=0;c<a;c++)d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[b(63)]);return d.join("")}})(xd||(xd={}));var yd=xd;var zd=function(c){function a(a,d){var b=c.call(this)||this;b.YC=a;b.Ii=new xc;b.x=0;b.y=0;b.sh=yd.Ut(d);return b}__extends(a,c);a.prototype.la=function(a){c.prototype.la.call(this,a);this.Ii.la(a)};a.prototype.p=function(a,d){void 0===d&&(d=1);return a+(this.sh()-.5)*this.YC*d};a.prototype.moveTo=function(a,d){c.prototype.moveTo.call(this,this.p(a),this.p(d));this.Ii.moveTo(this.p(a),this.p(d));this.x=a;this.y=d};a.prototype.closePath=function(){c.prototype.closePath.call(this);this.Ii.closePath()};
a.prototype.lineTo=function(a,d){var b=this.x+.5*(a-this.x),f=this.y+.5*(d-this.y),h=this.x+.75*(a-this.x),k=this.y+.75*(d-this.y);c.prototype.bezierCurveTo.call(this,this.p(b),this.p(f),this.p(h),this.p(k),this.p(a),this.p(d));this.Ii.bezierCurveTo(this.p(b),this.p(f),this.p(h),this.p(k),this.p(a),this.p(d));this.x=a;this.y=d};a.prototype.quadraticCurveTo=function(a,d,e,f){c.prototype.quadraticCurveTo.call(this,this.p(a),this.p(d),this.p(e),this.p(f));this.Ii.quadraticCurveTo(this.p(a),this.p(d),
this.p(e),this.p(f));this.x=e;this.y=f};a.prototype.bezierCurveTo=function(a,d,e,f,h,k){c.prototype.bezierCurveTo.call(this,this.p(a),this.p(d),this.p(e),this.p(f),this.p(h),this.p(k));this.Ii.bezierCurveTo(this.p(a),this.p(d),this.p(e),this.p(f),this.p(h),this.p(k));this.x=h;this.y=k};a.prototype.kz=function(a){var b=new Pc(this.Fk(1).he(),new qc(Math.PI/4,0,0)),e=1/.3,c=e/4,h=0;for(b=b.fu(e);h<b.length;h++)e=b[h],a.moveTo(this.p(e.start.x,c),this.p(e.start.y,c)),a.lineTo(this.p(e.end.x,c),this.p(e.end.y,
c))};return a}(xc);var Ad=function(){function c(a){this.zb=a;this.uz=this.Zm=!0;this.outline=null;this.fill=new xc}c.prototype.format=function(){var a=this.zb.ia("roughness")||0;this.outline=new zd(a,this.zb.ia("seed")||0);this.zb.Aq.la(this.outline);this.zb.ia("lineWidth");this.zb.ia("closed")&&(this.fill=new xc,this.outline.kz(this.fill))};c.prototype.la=function(a){if(this.outline){var b=this.zb.ia("lineWidth")||1;this.zb.ia("closed")&&(a.beginPath(),a.lineWidth=1,a.strokeStyle=this.zb.up("fill"),this.fill.la(a),
a.stroke());a.beginPath();a.setLineDash(this.zb.Sb);a.lineWidth=b;a.strokeStyle=this.zb.ia("strokeStyle");this.outline.la(a);a.stroke()}};return c}();var I=function(c){function a(b,d){b=c.call(this,b,d)||this;b.Ea=[];b.Fg=0;b.Ud=[];b.lr=[];b.Mw=!1;b.inverse=new H;b.origin=new F(0,0);b.Sb=[];b.Aq=new xc;b.Md=new xc;b.qu=!1;b.backgroundImage=null;b.wg=null;b.log=u.create("PATHNODE");b.log("New PathNode Created");b.Sd=new kd("",d);b.Sd.setProperty("text",b.ba.text);b.uo(a.ua);b.ba.closed=!1;b.ba.commands=[];b.ba.seed=0;return b}__extends(a,c);a.prototype.moveTo=function(b,d){var e=this.ba.commands;e.push(a.Gh);e.push(b);e.push(d)};a.prototype.type=
function(){return"PathNode"};a.prototype.$g=function(){return!0};a.prototype.nc=function(a){switch(a){case "sides":case "rotation":case "radius":case "oddRadiusScaling":case "skewX":case "skewY":return!0}return c.prototype.nc.call(this,a)};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "text":case "textAlign":case "textDecoration":case "wrap":this.ba[a]=d;this.Sd.setProperty(a,d);break;case "textFillStyle":this.Sd.setProperty("fillStyle",
d);this.ba[a]=d;break;case "textBackground":this.Sd.setProperty("background",d);this.ba[a]=d;break;case "roughness":case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.ba[a]=d;break;case "backgroundImage":this.ba[a]=d,this.backgroundImage=null}};a.prototype.Sg=function(a,d){switch(a){case "roughness":"string"===typeof d&&(d=parseFloat(d))}return c.prototype.Sg.call(this,a,d)};a.prototype.ia=function(a){switch(a){case "textAlign":return this.ba[a]||
"center";case "textFillStyle":return this.ba[a]||q.Oa}return c.prototype.ia.call(this,a)};a.prototype.mb=function(){var a=c.prototype.mb.call(this);a.text&&(a.textFillStyle=a.textFillStyle||q.Oa);return a};a.prototype.Wl=function(b){for(var d=0,e=this.ba.commands,c=b/3|0,h=0;h<c;h++)d+=a.ob[e[d]]+1;h=b%3*2+1;c=e[d+h];d=e[d+h+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);this.Pa().apply(c,d)};a.prototype.Ue=function(b,d,e){for(var c=0,h=this.ba.commands.concat(),k=b/3|0,l=0;l<k;l++)c+=a.ob[h[c]]+
1;k=this.inverse.apply(d,e);l=b%3*2+1;h[c+l]=k.x;h[c+l+1]=k.y;if(0===b&&this.ba.closed){for(b=null;c<h.length;)k=a.ob[h[c]],2<=k&&(b=c),c+=k+1;b&&(c=b,k=this.inverse.apply(d,e),h[c+1]=k.x,h[c+2]=k.y)}return{commands:h}};a.prototype.OC=function(b){for(var d=this.ba.commands,e=0,c=0;c<b/3;c++)e+=a.ob[d[e]]+1;d.splice(e,a.ob[d[e]]+1)};a.prototype.Vz=function(){return this.ia("arrowXOffset")||this.ia("arrowSize")};a.prototype.zC=function(a){var b=this.ba.sides;if(!b||3>b)return a;a=new L;b=Oc(this.ba.sides,
this.ba.radius||50,this.ba.rotation,this.ba.oddRadiusScaling||1,this.ba.skewX||0,this.ba.skewY||0);for(var e=0;e<b.length;e++){var c=b[e];0===e?a.moveTo(c.x,c.y):a.lineTo(c.x,c.y)}a.closePath();return a.vc()};a.prototype.format=function(b,d){var e=this,c=null;this.Ea.length=0;this.inverse=this.ba.matrix.inverse();var h=new F(0,0),k=this.zC(this.ba.commands),l=null,n=this.ba.matrix,r=new ud(this.ba.seed);this.lr.length=0;for(var v=null,x=null,w=0;w<k.length;){switch(k[w++]){case a.Gh:h=n.apply(k[w++],
k[w++]);x=new ld(l,h);this.Ea.push(x);null===c&&(c=h);this.lr.push(h);v=null;break;case a.af:l&&(h=n.apply(k[w++],k[w++]),this.Ea.push(new md(l,h,r,this.ba.sloppiness,this.ba.roundRadius)),this.lr.push(h));break;case a.Jh:if(l){h=n.apply(k[w++],k[w++]);var y=n.apply(k[w++],k[w++]);this.Ea.push(new od(l,y,h))}break;case a.On:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);var A=k[w++];this.Ea.push(new pd(l,y,h,A))}break;case a.Nn:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);A=k[w++];
var E=k[w++],M=k[w++],K=k[w++];this.Ea.push(new qd(l,y,h,A,E,M,K))}break;case a.Rk:l&&(h=n.apply(k[w++],k[w++]),A=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.Ea.push(new rd(l,A,y,h)));break;case a.gs:l&&(h=n.apply(k[w++],k[w++]),A=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.Ea.push(new sd(l,A,y,h)));break;case a.Pi:l&&(h=n.apply(k[w++],k[w++]),this.Ea.push(new nd(l,h,this.ba.smoothness)));break;case a.Qn:l&&(h=n.apply(k[w++],k[w++]),A=n.apply(k[w++],k[w++]),this.Ea.push(new td(l,
A,h,r,this.ba.sloppiness)));break;case a.pd:this.ba.closed=!0;v&&l&&v!==l&&v.wk&&x&&(v.wk(l),l.ja=x.ja);break;default:w++}l=this.Ea[this.Ea.length-1];null!==v||l instanceof ld||(v=l)}this.origin=c||new F(0,0);this.Fg=this.Ea.length;this.Nz(r);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;this.Sb=Cc(this.ba.dashes||"");c=this.Sb.length?a.Pn:a.ax;this.Aq=this.xo(!0);this.Md=this.Aq.Fk(c);h=0+this.ia("shapeWidth");0<h&&(this.Md=this.My(this.Md,h));this.rect=
this.Md.rl(c);h=this.rect.width-2*(this.ba.lineWidth/2+1);k=this.ba.lineWidth;l=this.Md.clone();l.transform(this.Zb());this.ya=l.rl(c);this.rect.Hd(k+1,k+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);""!==this.ba.text&&(this.Sd.setProperty("textAlign",this.ba.textAlign||"center"),this.Sd.kn(this.Md.he()),this.Sd.setProperty("baseWidth",h),this.Sd.format(b),this.Sd.transform(new pc(0,this.rect.y-
this.Sd.rect.y)),this.Sd.format(b));this.Mw=0===q.lf(this.ba.fillStyle).values[3]&&!this.backgroundImage&&!this.ba.spotHighlight;this.Rt("fill",b,d,this.ba.fillStyle);this.Ud.length=0;0<this.ba.cloudRadius?this.Ud.push(new fd(this)):0<this.ba.waveRadius?this.Ud.push(new wd(this)):this.ba.doubleLine?this.Ud.push(new Bd(this)):this.ba.roughness&&this.Ud.push(new Ad(this));for(w=0;w<this.Ud.length;w++)this.Ud[w].format(b);(b=this.ia("backgroundImage"))&&null===this.backgroundImage&&d.yf(this.id,b,function(a){e.backgroundImage=
a;d.qg(e.id)});b=/url\(([^\)]+)\)/.exec(this.ia("strokeStyle"));var D;b&&(D=b[1]);!D||null!==this.wg&&this.wg.src===D?!D&&this.wg&&(this.wg=null):d.yf(this.id,D,function(a){e.wg=a;d.qg(e.id)})};a.prototype.cm=function(){return this.Md};a.prototype.Nz=function(a){function b(b,d){b=b.clone();l&&(b.x+=d.x*h*.5,b.y+=d.y*h*.5);var f=b.x-d.x*h;var n=b.y-d.y*h;var r=f+d.y*c/2;var v=n-d.x*c/2;f+=-d.y*c/2;n+=d.x*c/2;e.Ea.push(new ld(e.Ea[e.Ea.length-1],new F(f,n)));e.Ea.push(new nd(e.Ea[e.Ea.length-1],b,k));
e.Ea.push(new nd(e.Ea[e.Ea.length-1],new F(r,v),k));"solid"===e.ba.arrowStyle&&e.Ea.push(new md(e.Ea[e.Ea.length-1],new F(f,n),a,e.ba.smoothness,0))}if(this.qu=0<this.ba.arrowSize&&!this.ba.closed&&0<this.Ea.length){var e=this,c=this.ba.arrowSize+1.5*this.ba.lineWidth,h=this.ba.arrowXOffset,k=this.ba.smoothness,l=this.ba.doubleLine;null===h&&(h=c);var n=this.Ea[this.Ea.length-1];b(n.ja,n.Ad());this.ba.doubleArrow&&b(this.Ea[0].ja,nc(this.Ea[1].Nf()))}};a.prototype.close=function(){this.ba.commands.push(a.pd)};
a.prototype.ey=function(){var a=this.Ea[this.Ea.length-1];a&&8>=lc(a.ja.x,a.ja.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.My=function(a,d){this.log("ConvertToRects: width=%s",d);var b=0;a=a.fa;for(var c=0,h=0,k,l,n=new xc;b<a.length;){this.log("cmd %s %s %s",a[b],a[b+1],a[b+2]);switch(a[b]){case xc.Kc:c=a[b+1];h=a[b+2];break;case xc.qd:k=a[b+1];l=a[b+2];this.log("(%s,%s-%s,%s)",c,h,k,l);if(0<lc(c,h,k,l)){var r=mc(c,h,k,l),v=r.y*d/2;r=-r.x*d/2;n.moveTo(c+v,h+r);n.lineTo(k+v,l+r);n.lineTo(k-
v,l-r);n.lineTo(c-v,h-r);n.closePath()}c=k;h=l}b+=xc.td[a[b]]}return n};a.prototype.clip=function(a){if(this.ba.closed){var b=new xc;this.log("Clipping to a path");for(var e=0;e<this.Ea.length;e++)this.Ea[e].la(b);b.closePath();0>b.Wi()&&(b=b.WC());b.la(a)}};a.prototype.la=function(a){this.ba.spotHighlight?this.log("Not drawing node %s due to spothighlight",this.id):c.prototype.la.call(this,a)};a.prototype.Tf=function(a){var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,
b.m22,b.Fa,b.Ga);a.beginPath();a.lineCap="round";b=!0;var e=!1,c;for(c=0;c<this.Ud.length;c++)this.Ud[c].Zm&&(b=!1),this.Ud[c].uz&&(e=!0,b=!1);this.wg&&(b=!1);if(b)for(c=0;c<this.Ea.length;c++)this.Ea[c].la(a);for(c=0;c<this.Ud.length;c++)this.Ud[c].la(a);if(!b&&0<this.ba.arrowSize)for(c=this.Fg;c<this.Ea.length;c++)this.Ea[c].la(a);if(this.ba.closed){a.closePath();if(this.backgroundImage){a.fillStyle=a.createPattern(this.backgroundImage,"no-repeat")||"magenta";c=Math.max(this.rect.width/this.backgroundImage.naturalWidth,
this.rect.height/this.backgroundImage.naturalHeight);var h=this.rect.width-this.backgroundImage.naturalWidth*c,k=this.rect.height-this.backgroundImage.naturalHeight*c;a.translate(this.rect.x+h/2,this.rect.y+k/2);a.scale(c,c);a.fill();a.scale(1/c,1/c);a.translate(-this.rect.x-h/2,-this.rect.y-k/2)}else e||(a.fillStyle=this.up("fill"),a.fill());a.shadowColor=q.Be}b&&(this.Sb.length&&0<this.ba.lineWidth?(a.beginPath(),this.Md.Gl(a,this.Sb),a.lineCap="butt"):0<0+this.ia("shapeWidth")&&(a.beginPath(),
this.Md.la(a)));if(this.wg)for(b=this.Md.he(),e=this.wg,c=0;c<b.length;c++){k=b[c];if(2>k.length)break;h=0;k=Nc(k);var l=k.next();if(l.done)break;for(var n=l.value.wi,r=e.width;!l.done;){l=k.next(r);if(l.done)break;var v=l.value.wi,x=l.value.length,w=h%e.width;h+=x;r-=x;0>=r&&(r+=e.width);var y=Math.atan2(v.y-n.y,v.x-n.x);a.save();a.translate(n.x,n.y);a.rotate(y);a.translate(0,-e.height/2);a.drawImage(e,w,0,x,e.height,0,0,x,e.height);a.restore();n=v}}else 0<this.ba.lineWidth&&!e&&a.stroke();if(this.ba.arrowSize&&
"solid"===this.ba.arrowStyle){a.beginPath();for(c=this.Fg;c<this.Ea.length;c++)this.Ea[c].la(a);a.fillStyle=this.ba.strokeStyle;a.fill()}else if(this.ba.arrowSize&&this.Sb.length){a.beginPath();for(c=this.Fg;c<this.Ea.length;c++)this.Ea[c].la(a);0<this.ba.lineWidth&&a.stroke()}""!==this.ba.text&&this.Sd.la(a);a.restore()};a.prototype.Db=function(a,d,e,c){if(this.hidden()||this.ia("locked"))return null;e=Math.max(12/c+this.ba.shapeWidth/2+this.ba.lineWidth/2,e);if(a>=this.rect.x-e&&a<this.rect.x+e+
this.rect.width&&d>=this.rect.y-e&&d<this.rect.y+e+this.rect.height)if(this.ba.closed&&!this.Mw){if(this.Md.yC(a,d,e))return this}else if(this.Md.Iv(a,d,e)||""!==this.ba.text&&this.Sd.Db(a,d,e,c))return this;return null};a.prototype.xo=function(a){var b=new xc;if(0<this.ba.arrowSize&&!a)for(a=0;a<this.Fg;a++)this.Ea[a].la(b);else for(a=0;a<this.Ea.length;a++)this.Ea[a].la(b);this.ba.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.ba.commands;e.push(a.af);e.push(b);e.push(d)};
a.prototype.hj=function(b,d){var e=this.ba.commands;e.push(a.Pi);e.push(b);e.push(d)};a.prototype.uf=function(){return!1!==this.ba.editable&&!0!==this.ba.lockEditMode&&!this.ba.sides};a.prototype.gr=function(){var b=this.ba.commands;return 6===b.length&&(b[3]===a.af||b[3]===a.Pi)};a.prototype.fi=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.Fg;b++){var c=this.Ea[b];if(a>=this.Ea[b].ja.x-e&&a<this.Ea[b].ja.x+e&&d>=this.Ea[b].ja.y-
e&&d<this.Ea[b].ja.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*b+1}else if(c.Qa){if(a>=c.Qa.x-e&&a<c.Qa.x+e&&d>=c.Qa.y-e&&d<c.Qa.y+e)return 3*b+1;if(c.Wa&&a>=c.Wa.x-e&&a<c.Wa.x+e&&d>=c.Wa.y-e&&d<c.Wa.y+e)return 3*b+2}}return null};a.prototype.Xl=function(b){var d=this.ba.commands;b/=3;var e=0,c=!1,h=0,k;for(k=0;k<d.length;){var l=d[k];if(l===a.pd){c=!0;break}h+=1;k+=a.ob[d[k]]+1}0===b&&c&&(b=h-1);for(k=0;k<d.length;e++){c=null;switch(d[k]){case a.Gh:c=
"move_to";break;case a.af:c="line_to";break;case a.Jh:c="quadratic_to"}if(b===e)return c;k+=a.ob[d[k]]+1}return null};a.sx=function(b,d,e){if("number"!==typeof d)return null;d/=3;var c=0,h=[],k=new F(0,0),l=!1,n=0,r;for(r=0;r<b.length;){var v=b[r];if(v===a.pd){l=!0;break}n+=1;r+=a.ob[b[r]]+1}0===d&&l&&(d=n-1);for(r=0;r<b.length;c++){v=b[r];l=!1;d===c&&(v===a.Jh&&"line_to"===e?(h.push(a.af,b[r+1],b[r+2]),l=!0):v===a.af&&"quadratic_to"===e&&(h.push(a.Jh,b[r+1],b[r+2],(k.x+b[r+1])/2,(k.y+b[r+2])/2),
l=!0));k=new F(b[r+1],b[r+2]);if(!l)for(v=0;v<1+a.ob[b[r]];v++)h.push(b[r+v]);r+=a.ob[b[r]]+1}return h};a.prototype.Gu=function(){return!0};a.prototype.qj=function(a,d,e){function b(b,d,e){a.beginPath();a.rect(b-c,d-c,2*c,2*c);a.fillStyle=e?"#0050B7":q.Lc;a.fill();a.stroke()}a.save();a.lineWidth=1*d;a.strokeStyle=q.Oa;a.lineWidth=1;a.shadowBlur=3*d;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="rgba(0,0,0,0.2)";a.strokeStyle="#ccc";a.fillStyle=q.Lc;var c=6*d;b(this.origin.x,this.origin.y,0===
e);for(d=1;d<this.Fg;d++){var k=this.Ea[d];a.beginPath();if(k.control)a.arc(k.control.x,k.control.y,c,0,2*Math.PI),a.arc(k.control.x,k.control.y,2*c,0,2*Math.PI),e===3*d+1?a.fill():a.stroke();else if(k instanceof rd||k instanceof sd){var l=k.Qa;var n=k.Wa;var r=k.qa.ja;l&&(a.moveTo(r.x,r.y),a.lineTo(l.x,l.y),a.moveTo(l.x+c,l.y),a.arc(l.x,l.y,c,0,2*Math.PI),e===3*d+1?a.fill():a.stroke());a.beginPath();a.moveTo(k.ja.x,k.ja.y);a.lineTo(n.x,n.y);a.moveTo(n.x+c,n.y);a.arc(n.x,n.y,c,0,2*Math.PI);e===3*
d+2?a.fill():a.stroke()}b(this.Ea[d].ja.x,this.Ea[d].ja.y,e===3*d)}a.restore()};a.ex=function(a){var b=new L,e=0;for(a=a.fa;e<a.length;){switch(a[e]){case xc.Kc:b.moveTo(a[e+1],a[e+2]);break;case xc.qd:b.lineTo(a[e+1],a[e+2]);break;case xc.Qf:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case xc.Sf:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case xc.pd:b.close()}e+=xc.td[a[e]]}return b.vc()};a.ua={strokeStyle:q.Oa,fillStyle:q.Lc,fontName:"Arial",fontSize:20,lineWidth:2,
dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1,roughness:0};a.ax=8;a.Pn=2;a.Gh=0;a.af=1;a.Jh=2;a.On=3;a.Rk=4;a.Pi=5;a.Qn=6;a.pd=7;a.gs=8;a.Nn=9;a.bF=.5522847498;a.ob=[];return a}(hd);I.ob[I.Gh]=2;I.ob[I.af]=2;I.ob[I.Jh]=4;I.ob[I.On]=5;I.ob[I.Rk]=6;I.ob[I.Pi]=2;I.ob[I.Qn]=4;I.ob[I.pd]=0;I.ob[I.gs]=6;I.ob[I.Nn]=8;
var L=function(){function c(a){void 0===a&&(a=[]);this.fa=a}c.prototype.beginPath=function(){};c.prototype.Wf=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=I.ob[this.fa[e]]+1;this.fa[e+1]=b;this.fa[e+2]=d};c.prototype.moveTo=function(a,b){this.fa.push(I.Gh);this.fa.push(a);this.fa.push(b)};c.prototype.lineTo=function(a,b){this.fa.push(I.af);this.fa.push(a);this.fa.push(b)};c.prototype.hj=function(a,b){this.fa.push(I.Pi);this.fa.push(a);this.fa.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.fa.push(I.Jh);
this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b)};c.prototype.Jg=function(a,b,d,e){this.fa.push(I.Qn);this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){this.fa.push(I.Rk);this.fa.push(c);this.fa.push(h);this.fa.push(a);this.fa.push(b);this.fa.push(d);this.fa.push(e)};c.prototype.arc=function(a,b,d,e,c,h){void 0===h&&(h=!0);var f=(new qc(-c,a,b)).apply(a+d,b);this.fa.push(I.Nn);this.fa.push(f.x);this.fa.push(f.y);this.fa.push(a);
this.fa.push(b);this.fa.push(d);this.fa.push(e);this.fa.push(c);this.fa.push(h?1:0)};c.prototype.arcTo=function(a,b,d,e,c){this.fa.push(I.On);this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b);this.fa.push(c)};c.prototype.Xt=function(){for(var a=[],b=0;b<this.fa.length;){for(var d=this.fa[b],e=0;e<I.ob[d];e+=2)a.push(new F(this.fa[b+1+e],this.fa[b+1+e+1]));b+=I.ob[d]+1}a=G.Ag(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.sE=function(a,b){for(var d=0;d<this.fa.length;){for(var e=
this.fa[d],c=0;c<I.ob[e];c+=2)this.fa[d+1+c]+=a,this.fa[d+2+c]+=b;d+=I.ob[e]+1}};c.prototype.translate=function(){throw Error("Not implemented: translate");};c.prototype.scale=function(){throw Error("Not implemented: scale");};c.prototype.rotate=function(){throw Error("Not implemented: rotate");};c.prototype.closePath=function(){this.fa.push(I.pd)};c.prototype.close=function(){this.closePath()};c.prototype.vc=function(){return this.fa};return c}();L.prototype.change=L.prototype.Wf;
L.prototype.moveTo=L.prototype.moveTo;L.prototype.lineTo=L.prototype.lineTo;L.prototype.curveTo=L.prototype.hj;L.prototype.quadraticCurveTo=L.prototype.quadraticCurveTo;L.prototype.cornerTo=L.prototype.Jg;L.prototype.bezierCurveTo=L.prototype.bezierCurveTo;L.prototype.arc=L.prototype.arc;L.prototype.arcTo=L.prototype.arcTo;L.prototype.getBoundingBox=L.prototype.Xt;L.prototype.translateAll=L.prototype.sE;L.prototype.closePath=L.prototype.closePath;L.prototype.close=L.prototype.close;
L.prototype.toArray=L.prototype.vc;function Cd(){var c=new F(0,0),a=new L;a.moveTo(c.x,c.y-50);a.Jg(c.x+50,c.y-50,c.x+50,c.y);a.Jg(c.x+50,c.y+50,c.x,c.y+50);a.Jg(c.x-50,c.y+50,c.x-50,c.y);a.Jg(c.x-50,c.y-50,c.x,c.y-50);a.closePath();return a.vc()}hd.vd("PathNode",I);L.prototype.beginPath=L.prototype.beginPath;L.prototype.change=L.prototype.Wf;L.prototype.moveTo=L.prototype.moveTo;L.prototype.lineTo=L.prototype.lineTo;L.prototype.curveTo=L.prototype.hj;L.prototype.quadraticTo=L.prototype.BF;
L.prototype.cornerTo=L.prototype.Jg;L.prototype.bezierTo=L.prototype.kF;L.prototype.arc=L.prototype.arc;L.prototype.arcTo=L.prototype.arcTo;L.prototype.getBoundingBox=L.prototype.Xt;L.prototype.translate=L.prototype.translate;L.prototype.closePath=L.prototype.closePath;L.prototype.close=L.prototype.close;L.prototype.toArray=L.prototype.vc;var Bd=function(){function c(a){this.zb=a;this.Gf=0;this.Zm=!0;this.nm=!1;this.path=new xc;this.Sm=new xc;this.log=u.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.zb.ia("doubleLine"));var a=this.zb.xo(!1).Fk(I.Pn),b=this.zb.Vz();if(0<b){var d=a.ly();d>b&&(a=a.oy(d-b))}a=a.he();b=this.zb.ia("doubleLine");this.path=new xc;this.Sm=new xc;d=this.zb.ia("doubleLineDashSide");this.nm=!1;"outer"===d?(Jc(this.path,a,b,!0,!1),Jc(this.Sm,a,b,!1,!0),
this.nm=!0):"inner"===d?(Jc(this.path,a,b,!1,!0),Jc(this.Sm,a,b,!0,!1),this.nm=!0):Jc(this.path,a,b,!0,!0)};c.prototype.la=function(a){a.beginPath();this.zb.Sb.length&&this.nm?(this.Sm.Gl(a,this.zb.Sb),this.path.la(a)):this.zb.Sb.length?this.path.Gl(a,this.zb.Sb):this.path.la(a)};return c}();function Dd(c,a){function b(){var a=f.offsetWidth,b=f.offsetHeight,d=z.km();z(f).vk({left:d.left+d.width/2-a/2,top:d.top+d.height/2-b/2})}function d(a){a.target instanceof HTMLElement&&(f===a.target||f.contains(a.target))||y.hide()}function e(a){Ed(a.target)||v&&"outside"!==v&&"none"!==v&&setTimeout(function(){y.hide()},0)}void 0===a&&(a={});var f=z.tc(c);if(!f)throw Error("Zwibbler.Dialog: Bad element passed in: "+c);c=a.overlay||"transparent";var h=null===f.parentNode;"static"===z(f).Me("position")&&
(f.style.position="absolute");var k=z(f).Me("display");"none"===k&&(k="block");f.style.display="none";var l=new bb(c);l.insertBefore=f;var n=a.showNear||null,r=a.showHow||"",v=!1,x=Fd(f),w=!1,y={hide:function(){l.wf();f.style.display="none";if(y.onhide)y.onhide();window.removeEventListener("resize",b)},isShown:function(){return"none"!==z(f).Me("display")},show:function(a,e,c,h){void 0===c&&(c=!1);void 0===h&&(h=!0);var x=0,w=0,A="",E="";"number"===typeof a&&"number"===typeof e?(x=a,w=e,a=!0):(A=a||
n,E=e||r,a=!1);e=z.du()+1;f.style.zIndex=e.toString();l.zIndex=e;f.parentNode||document.body.appendChild(f);f.style.display=k;f.style.visibility="hidden";if(a)f.style.position="absolute",setTimeout(function(){var a=f.offsetWidth,b=f.offsetHeight,d=z.km(),e={left:x,top:w};e.left=Math.min(e.left,d.left+d.width-a-2);e.top=Math.min(e.top,d.top+d.height-b-3);z(f).vk(e);f.style.visibility="visible";if(y.onshow)y.onshow()},0);else if(A&&E)if(A=z.tc(A)){var M=z(A).gc();setTimeout(function(){f.style.visibility=
"visible";var a=f,b={left:M.left,top:M.top},d=E.toLowerCase().split(" ");2!==d.length&&(d=["tl","tl"]);0<=d[0].indexOf("b")&&(b.top+=M.height);0<=d[0].indexOf("r")&&(b.left+=M.width);0<=d[0].indexOf("m")&&(b.top+=M.height/2);0<=d[0].indexOf("c")&&(b.left+=M.width/2);0<=d[1].indexOf("b")&&(b.top-=a.offsetHeight);0<=d[1].indexOf("r")&&(b.left-=a.offsetWidth);0<=d[1].indexOf("c")&&(b.left-=a.offsetWidth/2);0<=d[1].indexOf("m")&&(b.top-=a.offsetHeight/2);a.style.position="absolute";d=z.km();var e=a.offsetHeight;
b.left=Math.min(b.left,d.left+d.width-a.offsetWidth);b.top=Math.min(b.top,d.top+d.height-e);z(a).vk(b);if(y.onshow)y.onshow()},0)}else{if(y.onshow)y.onshow()}else window.addEventListener("resize",b),f.style.position="absolute",setTimeout(function(){f.style.visibility="visible";b();if(y.onshow)y.onshow()},0);var K=f.querySelector("[z-focus]");K&&setTimeout(function(){K.focus()},0);v=c;"outside"===v||"inside"===v?document.body.addEventListener("pointerdown",d,!0):h&&l.show(y.hide)},destroy:function(){w||
(w=!0,y.isShown()&&y.hide(),l.wf(),window.removeEventListener("resize",b),f.removeEventListener("click",e),document.body.removeEventListener("pointerdown",d,!0),x(),h&&z(f).remove())},onshow:a.onshow||function(){},onhide:a.onhide||function(){}};f.addEventListener("click",e);return y}function Ed(c){return c instanceof HTMLElement&&(!(c instanceof HTMLElement&&"BUTTON"===c.tagName)&&z.xf(c)||c.matches("[z-no-dismiss], [z-no-dismiss] *"))}
function Fd(c){function a(a){"touchstart"===a.type?(b=a.changedTouches[0].pageX,d=a.changedTouches[0].pageY):"touchend"===a.type&&10>lc(b,d,a.changedTouches[0].pageX,a.changedTouches[0].pageY)&&setTimeout(function(){c.dispatchEvent(new Event("click"))},100)}var b=-1,d=-1;c.addEventListener("touchstart",a);c.addEventListener("touchend",a);return function(){c.removeEventListener("touchstart",a);c.removeEventListener("touchend",a)}};var Gd=u.create("FitCurve");
function Hd(c){function a(a){K.bezierCurveTo(a[1].x,a[1].y,a[2].x,a[2].y,a[3].x,a[3].y);Gd("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",a[0].x,a[0].y,a[1].x,a[1].y,a[2].x,a[2].y,a[3].x,a[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x;a=a.y-b.y;return Math.sqrt(d*d+a*a)}function h(a){return a.x*a.x+a.y*a.y}function k(a,b){var d=Math.sqrt(h(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function l(a,b,d){void 0===
d&&Gd("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function n(a,b){return{x:a.x+b.x,y:a.y+b.y}}function r(a,b){return{x:a.x*b,y:a.y*b}}function v(a,b){return{x:a.x-b.x,y:a.y-b.y}}function x(a,c,h,x,w,y){var A,X=[],R=[[],[]],D=[];var E=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var J=h-c+1;for(A=0;A<J;A++){var M={x:w.x,y:w.y};var K={x:y.x,y:y.y};k(M,d(x[A]));k(K,e(x[A]));X[A]=[M,K]}R[0][0]=0;R[0][1]=0;R[1][0]=0;R[1][1]=0;D[0]=0;for(A=D[1]=0;A<J;A++)R[0][0]+=b(X[A][0],X[A][0]),R[0][1]+=b(X[A][0],X[A][1]),
R[1][0]=R[0][1],R[1][1]+=b(X[A][1],X[A][1]),M=1-x[A],K=x[A],M=v(a[c+A],n(r(a[c],M*M*M),n(r(a[c],d(x[A])),n(r(a[h],e(x[A])),r(a[h],K*K*K))))),D[0]+=b(X[A][0],M),D[1]+=b(X[A][1],M);x=R[0][0]*R[1][1]-R[1][0]*R[0][1];A=R[0][0]*D[1]-R[0][1]*D[0];D=D[0]*R[1][1]-D[1]*R[0][1];0===x&&(x=R[0][0]*R[1][1]*1E-11);R=D/x;D=A/x;if(0>R||0>D)return R=f(a[h],a[c])/3,E[0]=a[c],E[3]=a[h],l(E[0],k(w,R),E[1]),l(E[3],k(y,R),E[2]),E;E[0]=a[c];E[3]=a[h];l(E[0],k(w,R),E[1]);l(E[3],k(y,D),E[2]);return E}function w(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function y(a){var b=Math.sqrt(Math.sqrt(h(a)));0!==b&&(a.x/=b,a.y/=b);return a}function A(a,b,d,e,c){var f,k=(d-b+1)/2;var l=0;for(f=b+1;f<d;f++){var n=w(3,e,c[f-b]);n=v(n,a[f]);n=h(n);n>=l&&(l=n,k=f)}return{$u:l,Dw:k}}function E(b,d,e,c,h,n){var r;var X=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var R=n*n;if(2===e-d+1)n=f(b[e],b[d])/3,X[0]=
b[d],X[3]=b[e],l(X[0],k(c,n),X[1]),l(X[3],k(h,n),X[2]),a(X);else{var D=[0];for(r=d+1;r<=e;r++)D[r-d]=D[r-d-1]+f(b[r],b[r-1]);for(r=d+1;r<=e;r++)D[r-d]/=D[e-d];var J=D;X=x(b,d,e,J,c,h);r=A(b,d,e,X,J);D=r.$u;r=r.Dw;if(D<n)a(X);else{if(D<R||M)for(R=0;4>R;R++){r=b;D=d;var K=e;var V=X;var ka=[];for(X=D;X<=K;X++){var wa=ka,ya=X-D,ca,Cb=V,$b=r[X],ac=J[X-D],fb=[];var nb=[];var bc=w(3,Cb,ac);for(ca=0;2>=ca;ca++)fb[ca]={x:0,y:0},fb[ca].x=3*(Cb[ca+1].x-Cb[ca].x),fb[ca].y=3*(Cb[ca+1].y-Cb[ca].y);for(ca=0;1>=
ca;ca++)nb[ca]={x:0,y:0},nb[ca].x=2*(fb[ca+1].x-fb[ca].x),nb[ca].y=2*(fb[ca+1].y-fb[ca].y);ca=w(2,fb,ac);nb=w(1,nb,ac);wa[ya]=ac-((bc.x-$b.x)*ca.x+(bc.y-$b.y)*ca.y)/(ca.x*ca.x+ca.y*ca.y+(bc.x-$b.x)*nb.x+(bc.y-$b.y)*nb.y)}K=ka;X=x(b,d,e,K,c,h);r=A(b,d,e,X,K);D=r.$u;r=r.Dw;if(D<n||M){a(X);return}J=K}K={x:0,y:0};R=v(b[r-1],b[r]);D=v(b[r],b[r+1]);K.x=(R.x+D.x)/2;K.y=(R.y+D.y)/2;R=K=y(K);E(b,d,r,c,R,n);R.x=-R.x;R.y=-R.y;E(b,r,e,R,h,n)}}}var M=!0;void 0===M&&(M=!1);var K=new xc;K.moveTo(c[0].x,c[0].y);
(function(a,b,d){var e=v(a[1],a[0]);e=y(e);var c=b-1;c=v(a[c-1],a[c]);c=y(c);E(a,0,b-1,e,c,d)})(c,c.length,25);return K};function Id(c,a,b,d,e,f){var h=!1;c.save();switch(b){case 0:case 3:var k=a.height;var l=a.width;break;default:k=a.width,l=a.height}switch(b){case 2:h=!0}c.translate(a.x,a.y);c.fillStyle="rgba(0, 0, 0, 0.2)";c.fillStyle="#ccc";c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle="black";c.strokeStyle="black";c.font="10px sans-serif";a=Math.ceil(50/e);b=f/e;var n=Math.ceil(b/a)*a;f=n;c.beginPath();if(h)for(b=(n-b)*e;b<l;)c.moveTo(0,b),c.lineTo(k,b),h=f.toString()+d,c.fillText(h,0,b+1+10),f+=a,
b+=e*a;else for(b=(n-b)*e;b<l;)c.moveTo(b,k),c.lineTo(b,0),h=f.toString()+d,c.fillText(h,b+1,10),f+=a,b+=e*a;c.stroke();c.restore()};var Ld=function(c){function a(a,d,e){void 0===e&&(e=dc()?new Jd:new Kd);var b=c.call(this)||this;b.Fd=d;b.yt=e;b.bk=!0;b.width=32;b.height=500;b.JF=0;b.lc=new G(0,0,0,0);b.qc=!1;b.Yg="auto";b.jF="#fcfcfc";b.lF="#808080";b.borderWidth=0;b.$f=0;b.Zf=100;b.Or=10;b.position=5;b.offset=0;b.log=u.create("SCROLLBAR",!0);b.bk=!0;b.canvas=cc(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.canvas.classList.add("zwibbler-scrollbar");b.canvas.classList.add("zwibbler-passthrough");
b.ma=b.canvas.getContext("2d");a.addEventListener(b.canvas,"mousedown",function(a){b.yb(a)});a.addEventListener(document.body,"mousemove",function(a){b.Eb(a)});a.addEventListener(document.body,"mouseup",function(){b.ac()});a.addEventListener(b.canvas,"touchstart",function(a){b.vq(a)});a.addEventListener(document.body,"touchmove",function(a){b.vq(a)});a.addEventListener(document.body,"touchend",function(a){b.vq(a)});b.format();return b}__extends(a,c);a.prototype.Vd=function(a){a.appendChild(this.canvas)};
a.prototype.tw=function(a){this.Yg=a;this.la()};a.prototype.moveTo=function(a,d){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.tg=function(a,d){this.width=a;this.height=d;this.canvas.width=this.width;this.canvas.height=d;this.format();this.la()};a.prototype.wf=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.Lu=function(){return"block"===this.canvas.style.display};a.prototype.ww=function(a,d,e,c){this.$f=
a;this.Zf=d-a;this.Or=e;this.position=c;this.format();this.la()};a.prototype.format=function(){var a=this.Fd?this.width:this.height;var d=this.Or/this.Zf*a;a*=(this.position-this.$f)/this.Zf;this.lc=this.Fd?new G(a,0,d,this.height):new G(0,a,this.width,d);this.lc.x=Math.round(this.lc.x);this.lc.y=Math.round(this.lc.y);this.lc.width=Math.round(this.lc.width);this.lc.height=Math.round(this.lc.height)};a.prototype.la=function(){var a=this.Wg()-this.yt.mu();if(this.Fd)var d=0;else d=a,a=0;d={Fd:this.Fd,
rect:{x:d,y:a,width:this.width-d,height:this.height-a},ge:{x:this.lc.x+d,y:this.lc.y+a,width:this.lc.width-d,height:this.lc.height-a},Yg:this.Yg};this.ma.clearRect(0,0,this.ma.canvas.width,this.ma.canvas.height);this.yt.la(this.ma,d)};a.prototype.Ft=function(a){var b=z(this.canvas).gc(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===a.type)e=a.pageX,
c=a.pageY;return new F(e-b.left,c-b.top)};a.prototype.vq=function(a){switch(a.type){case "touchstart":this.yb(a);break;case "touchend":this.ac();break;case "touchmove":this.Eb(a)}};a.prototype.Jv=function(a){a=this.Fd?a.x/this.width*this.Zf+this.$f:a.y/this.height*this.Zf+this.$f;a=Math.min(a,this.Zf-this.Or+this.$f);return a=Math.max(a,this.$f)};a.prototype.yb=function(a){a.preventDefault();a=this.Ft(a);this.lc.Oc(a.x,a.y)?this.Fd?(this.offset=a.x-this.lc.x,a.x-=this.offset):(this.offset=a.y-this.lc.y,
a.y-=this.offset):(this.position=this.Jv(a),this.offset=0,this.Fd?this.lc.x=(this.position-this.$f)/this.Zf*this.width:this.lc.y=(this.position-this.$f)/this.Zf*this.height,this.ta("scroll",this.position),this.la());this.qc=!0};a.prototype.Eb=function(a){this.qc&&(this.qc&&"mousemove"===a.type&&0===a.buttons?this.qc=!1:(a.preventDefault(),a=this.Ft(a),this.Fd?a.x-=this.offset:a.y-=this.offset,this.position=this.Jv(a),this.ta("scroll",this.position),this.format(),this.la()))};a.prototype.ac=function(){this.qc&&
(this.qc=!1)};a.prototype.Wg=function(){return this.Fd?this.height:this.width};a.hF=0;a.dF=1;a.$E=2;a.fF=3;return a}(sb),Kd=function(){function c(){}c.prototype.mu=function(){return 16};c.prototype.la=function(a,b){a.fillStyle="#e6e6e6";a.beginPath();a.rect(b.rect.x,b.rect.y,b.rect.width,b.rect.height);a.fill();a.beginPath();a.fillStyle="auto"===b.Yg?"#b9b9b9":b.Yg;a.fillRect(b.ge.x,b.ge.y,b.ge.width,b.ge.height)};return c}(),Jd=function(){function c(){}c.prototype.mu=function(){return 10};c.prototype.la=
function(a,b){a.fillStyle="auto"===b.Yg?"rgba(0,0,0,0.5)":b.Yg;a.beginPath();b.Fd?yc(a,b.ge.x,b.ge.y-1,b.ge.width,b.ge.height,4.5):yc(a,b.ge.x-1,b.ge.y,b.ge.width,b.ge.height,4.5);a.fill()};return c}();function Md(c){switch(c){case 33:return"n-resize";case 34:return"e-resize";case 36:return"s-resize";case 40:return"w-resize";case 25:return"nw-resize";case 19:return"ne-resize";case 28:return"sw-resize";case 22:return"se-resize";case 1:case 4:case 8:case 2:case 64:return"move"}return"default"}function Nd(c,a,b){return{id:c,ib:2,x:a.x+a.width,Ic:a.y,Jc:a.y+a.height,order:b}}function Od(c,a,b){return{id:c,ib:4,x:a.y+a.height,Ic:a.x,Jc:a.x+a.width,order:b}}
var Pd=function(){function c(){this.ah=[];this.Mi=[];this.Gq=[];this.order=0}c.prototype.clear=function(){this.ah.length=0;this.Mi.length=0;this.order=this.Gq.length=0};c.prototype.Hs=function(a,b){this.Gq.push({id:b,rect:a,order:this.order++});this.ah.push({id:b,ib:1,x:a.y,Ic:a.x,Jc:a.x+a.width,order:this.order});this.ah.push(Od(b,a,this.order));this.Mi.push({id:b,ib:8,x:a.x,Ic:a.y,Jc:a.y+a.height,order:this.order});this.Mi.push(Nd(b,a,this.order));this.order++};c.prototype.YD=function(a,b){var d=
8;void 0===d&&(d=10);var e=this.pl(this.Mi,{id:b,ib:8,x:a.x,Ic:a.y,Jc:a.y+a.height,order:0},Number.MAX_VALUE);e=this.pl(this.Mi,Nd(b,a,0),e);var c=this.pl(this.ah,{id:b,ib:1,x:a.y,Ic:a.x,Jc:a.x+a.width,order:0},Number.MAX_VALUE);c=this.pl(this.ah,Od(b,a,0),c);return{x:Math.abs(e)<d?e:0,y:Math.abs(c)<d?c:0}};c.prototype.Dp=function(a,b){var d=10;void 0===d&&(d=10);var e=[];this.Jw(e,this.Mi,a,b,d);this.Jw(e,this.ah,b,a,d);d=0;for(var c=this.Gq;d<c.length;d++){var h=c[d];h.rect.Oc(a,b)&&e.push({ib:64,
id:h.id,order:h.order})}e.sort(function(a,b){return b.order-a.order});return e};c.prototype.Jw=function(a,b,d,e,c){for(var f=c*c,k=0;k<b.length;k++){var l=b[k],n=Math.abs(d-l.x),r=Number.MAX_VALUE,v=0;if(!(n>c||e<l.Ic-c||e>l.Jc+c)){if(e>l.Ic+c&&e<l.Jc-c){var x=n*n;x<r&&(r=x,v=l.ib)}x=.5*(l.Ic+l.Jc);x=n*n+(e-x)*(e-x);x<f&&(r=x,v=l.ib|32);b===this.ah&&(x=n*n+(e-l.Ic)*(e-l.Ic),x<r&&(r=x,v=l.ib|24),x=n*n+(e-l.Jc)*(e-l.Jc),x<r&&(r=x,v=l.ib|18));r<f&&a.push({id:l.id,ib:v,order:l.order})}}};c.prototype.pl=
function(a,b,d){for(var e=0;e<a.length;e++){var c=a[e],h=c.x-b.x;Math.abs(h)>Math.abs(d)||b.id===c.id||50>(b.Jc<c.Ic?c.Ic-b.Jc:b.Ic>c.Jc?b.Ic-c.Jc:0)&&(d=h)}return d};return c}();var Qd=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e}c.prototype.toString=function(){return(new G(this.x,this.y,this.width,this.height)).toString()};return c}();var Rd=function(){function c(a,b){void 0===b&&(b="repeat");this.Na=a;this.repeat=b}c.prototype.loaded=function(){return this.Na instanceof HTMLImageElement?this.Na.complete:!0};c.prototype.setTransform=function(){};return c}(),Sd=function(){function c(a,b,d,e){this.cE=[];this.from=new F(a,b);this.ja=new F(d,e)}c.prototype.addColorStop=function(a,b){this.cE.push({offset:a,Nc:b})};return c}(),Ud=function(){function c(){this.stack=[];this.ra=new H;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.lineDashOffset=0;this.miterLimit=10;this.strokeStyle=this.fillStyle=q.Oa;this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)";this.Sb=[]}c.prototype.save=function(){this.stack.push({ra:this.ra.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit,
strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,Hg:this.bo(),Sb:this.Sb})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.ra=a.ra,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.lineDashOffset=
a.lineDashOffset,this.miterLimit=a.miterLimit,this.ra=a.ra,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor,this.eo(a.Hg),this.Sb=a.Sb)};c.prototype.drawImage=function(a,b,d,e,c,h,k,l,n){var f=a.width,v=a.height;a instanceof HTMLImageElement&&(f=a.naturalWidth,v=a.naturalHeight);
var x=0,w=0,y=f,A=v;void 0!==e&&void 0!==c&&void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n?(x=b,w=d,y=e,A=c,b=h,d=k,f=l,v=n):void 0!==e&&void 0!==c&&(f=e,v=c);this.Yn(a,x,w,y,A,b,d,f,v)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,b,d,e,c,h){h&&(h=e,e=c,c=h);for(;0>e;)e+=2*Math.PI;for(;0>c;)c+=2*Math.PI;e>c&&(e-=2*Math.PI);var f=2*Math.PI;var l=e%f;var n=c%f;n===l&&(n+=2*Math.PI);c=[];e=Math.PI/2;h=l<n?1:-1;var r=l;for(f=Math.min(f,Math.abs(n-l));1E-5<
f;){l=r+h*Math.min(f,e);var v=(l-r)/2,x=d*Math.cos(v),w=d*Math.sin(v),y=.5522847498*Math.tan(v);n=x+y*w;x=-w+y*x;w=-x;y=v+r;v=Math.cos(y);y=Math.sin(y);c.push({RE:d*Math.cos(r),Ic:d*Math.sin(r),SE:n*v-x*y,Jc:n*y+x*v,TE:n*v-w*y,WE:n*y+w*v,UE:d*Math.cos(l),XE:d*Math.sin(l)});f-=Math.abs(l-r);r=l}for(d=0;d<c.length;d++)e=c[d],0===d&&this.moveTo(e.RE+a,e.Ic+b),this.bezierCurveTo(e.SE+a,e.Jc+b,e.TE+a,e.WE+b,e.UE+a,e.XE+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,e){this.beginPath();
this.rect(a,b,d,e);this.stroke()};c.prototype.setTransform=function(a,b,d,e,c,h){this.ra=new H(a,d,b,e,c,h)};c.prototype.fg=function(){return this.ra.hE()};c.prototype.transform=function(a,b,d,e,c,h){a=new H(a,d,b,e,c,h);this.ra=this.ra.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};c.prototype.scale=function(a,b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,
e){this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,e){this.rect(a,b,d,e);this.fill()};c.prototype.bl=function(a){return Td(a)};c.prototype.createPattern=function(a,b){return new Rd(a,b)};c.prototype.createLinearGradient=function(a,b,d,e){return new Sd(a,b,d,e)};c.prototype.setLineDash=function(a){a.length&1&&(a=a.concat(a));this.Sb=a};return c}(),Vd=function(){function c(a){this.fontFamily="";this.fontSize=
10;this.lineHeight=this.fontVariant=this.fontWeight=this.fontStyle="normal";a=Td(a);this.fontFamily=a.fontFamily||"Arial";this.fontSize=parseFloat(a.fontSize);this.fontStyle=a.fontStyle;this.fontWeight=a.fontWeight;this.fontVariant=a.fontVariant;this.lineHeight=a.lineHeight}c.prototype.toString=function(){var a=this.fontSize+'px "'+this.fontFamily+'"';"bold"===this.fontWeight&&(a="bold "+a);"italic"===this.fontStyle&&(a="italic"+a);return a};return c}();
function Td(c){var a=null,b="10",d="normal",e="normal",f="normal",h="normal",k=!1;c=c.split(/\s+/);a:for(;;){var l=c.shift();if(!l)break;switch(l){case "normal":break;case "italic":case "oblique":d=l;break;case "small-caps":f=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":e=l;break;default:if(k){a=l;c.length&&(a+=" "+c.join(" "));2<a.length&&('"'===a.charAt(0)||"'"===a.charAt(0))&&(a=a.substr(1,a.length-
2));break a}else l=l.split("/"),b=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:d,fontVariant:f,fontWeight:e,fontSize:b,lineHeight:h,fontFamily:a}}
var Wd=function(c){function a(a){var b=c.call(this)||this;b.ma=a;return b}__extends(a,c);a.prototype.beginPath=function(){this.ma.beginPath()};a.prototype.closePath=function(){this.ma.closePath()};a.prototype.moveTo=function(a,d){a=this.ra.apply(a,d);this.ma.moveTo(a.x,a.y)};a.prototype.lineTo=function(a,d){a=this.ra.apply(a,d);this.ma.lineTo(a.x,a.y)};a.prototype.quadraticCurveTo=function(a,d,e,c){a=this.ra.apply(a,d);e=this.ra.apply(e,c);this.ma.quadraticCurveTo(a.x,a.y,e.x,e.y)};a.prototype.bezierCurveTo=
function(a,d,e,c,h,k){a=this.ra.apply(a,d);e=this.ra.apply(e,c);h=this.ra.apply(h,k);this.ma.bezierCurveTo(a.x,a.y,e.x,e.y,h.x,h.y)};a.prototype.Yn=function(){};a.prototype.bo=function(){return{}};a.prototype.eo=function(){};a.prototype.clip=function(){};a.prototype.fill=function(){};a.prototype.fillText=function(){};a.prototype.measureText=function(a){return{width:10*a.length}};a.prototype.stroke=function(){};a.prototype.strokeText=function(){};return a}(Ud);var Xd=u.create("SvgFile"),de=function(){function c(){this.rect=new G(0,0,0,0);this.ie=new G(0,0,0,0);this.Xs={};this.src="";this.ready=!1;this.cc=[];this.Bv=0;this.closed=!1}c.prototype.wq=function(a){return __awaiter(this,void 0,void 0,function(){var b,d=this;return __generator(this,function(e){switch(e.label){case 0:if(a===this.src&&this.ready)return[2];this.src=a;this.ready=!1;return[4,Xa({url:a,responseType:"document"})];case 1:b=e.sent();if(this.src!==a)throw Error("Aborted due to URL change");
Yd(b.responseXML.documentElement,function(a){return d.vC(a)});this.Bv=this.cc.length;this.ready=!0;return[2]}})})};c.prototype.Za=function(a){var b;this.cc.length=this.Bv;(b=this.cc).push.apply(b,Zd(a))};c.prototype.vC=function(a){if(a instanceof Element){switch(a.tagName.toUpperCase()){case "SVG":this.fe=a;var b=a.getAttribute("viewBox"),d=!1;var e=!1;if(b){d=[];var c=b.replace(","," ");b=0;for(c=c.split(" ");b<c.length;b++){var h=$d(c[b]);isNaN(h)||d.push(h)}if(4!==d.length)throw Error("Invalid viewBox");
this.ie.x=d[0];this.ie.y=d[1];this.ie.width=d[2];this.ie.height=d[3];d=!0}b=$d(a.getAttribute("width")||"");c=$d(a.getAttribute("height")||"");isNaN(b)||isNaN(c)||(this.rect.x=0,this.rect.y=0,this.rect.width=b,this.rect.height=c,e=!0);d&&!e?(this.rect.width=this.ie.width,this.rect.height=this.ie.height):!d&&e?(this.ie.width=this.rect.width,this.ie.height=this.rect.height):d||e||console.warn("Could not get dimensions of the SVG file. Add a viewBox attribute.");break;case "STYLE":(e=this.cc).push.apply(e,
Zd(a.textContent));break;case "PATH":e=a.getAttribute("d")||"",this.closed=this.closed||0<=e.indexOf("z")||0<=e.indexOf("Z")}(e=a.getAttribute("id"))&&(this.Xs[e]=a);return!0}};c.prototype.la=function(a,b,d){function e(a){var b=h.Wz(a,l);switch(a.tagName.toUpperCase()){case "SVG":for(var d=a.firstElementChild;null!==d;d=d.nextElementSibling)e(d);break;case "G":k.save();k.Za(b);for(d=a.firstElementChild;null!==d;d=d.nextElementSibling)e(d);k.restore();break;case "PATH":c(b,function(){b.d&&Gc(k,b.d)});
break;case "CIRCLE":c(b,function(){var b=ae(a,"cx cy r");k.arc(b.cx,b.cy,b.r,0,2*Math.PI,!1)});break;case "ELLIPSE":c(b,function(){var b=ae(a,"cx cy rx ry");k.ellipse(b.cx,b.cy,b.rx,b.ry)});break;case "LINE":c(b,function(){var b=ae(a,"x1 y1 x2 y2");k.moveTo(b.x1,b.y1);k.lineTo(b.x2,b.y2)});break;case "RECT":c(b,function(){var b=ae(a,"x y width height rx ry");a.hasAttribute("ry")?a.hasAttribute("rx")||(b.rx=b.ry):b.ry=b.rx;k.rect(b.x,b.y,b.width,b.height,b.rx,b.ry)});break;case "TEXT":c(b,function(){var b=
ae(a,"x y");k.text(a.textContent||"",b.x||0,b.y||0)});break;case "USE":var f=a.getAttribute("xlink:href")||a.getAttribute("href");if(f&&"#"===f[0])if(d=h.Xs[f.substr(1)]){f=parseFloat(a.getAttribute("x")||"0")||0;var n=parseFloat(a.getAttribute("y")||"0")||0;k.save();k.translate(f,n);f=l;l={};for(var y in f)l[y]=f[y];for(y in b)l[y]=b[y];e(d);l=f;k.restore()}else be("SVG file <use> references "+f+" which is not found")}}function c(a,b){k.save();d||k.beginPath();k.Za(a);k.wd();b();d||(k.fill(),k.stroke());
k.restore()}var h=this;void 0===b&&(b=null);void 0===d&&(d=!1);a.save();a.scale(this.rect.width/this.ie.width,this.rect.height/this.ie.height);a.translate(-this.ie.x,-this.ie.y);var k=new ce(a);k.Za({stroke:"none",fill:q.Oa,"stroke-width":"1","stroke-linejoin":"miter","stroke-miterlimit":"4"});b&&k.Za(b);var l={};e(this.fe);a.restore()};c.prototype.Wz=function(a,b){var d={},e;for(e in b)d[e]=b[e];if(b=a.getAttribute("class"))for(var c=0,h=this.cc;c<h.length;c++)for(var k=h[c],l=0,n=k.hD.split(",");l<
n.length;l++)if("."+b===n[l])for(e in k.Ts)d[e]=k.Ts[e];for(e=0;e<a.attributes.length;e++)d[a.attributes[e].name]=a.attributes[e].value;return d};return c}();function $d(c){var a=1;switch(c.substr(c.length-2).toLowerCase()){case "mm":a=96/25.4;break;case "cm":a=96/2.54;break;case "in":a=96;break;case "pt":a=96/72}return parseFloat(c)*a}function Yd(c,a){for(c=[c];c.length;){var b=c.pop();if(a(b))for(b=b.firstChild;null!==b;b=b.nextSibling)c.push(b)}}
function ae(c,a){var b={},d=0;for(a=a.split(" ");d<a.length;d++){var e=a[d];b[e]=parseFloat(c.getAttribute(e)||"")||0}return b}function Zd(c){var a=[];for(c=new ee(c);;){for(var b={},d={value:""},e=c,f=d,h="";e.match(".");){h+=".";var k={value:""};if(!e.Zu(k))break;h+=k.value;if(!e.match(","))break;h+=","}f.value=h;if(0<h.length&&c.match("{"))fe(c,b),c.match("}"),a.push({hD:d.value,Ts:b});else break}return a}
function fe(c,a){for(;;){var b={value:""},d={value:""},e=c.Ia;if(c.Zu(b)&&c.match(":")&&c.FB(d))c.match(";"),a[b.value]=d.value;else{c.Ia=e;break}}}
var ee=function(){function c(a,b){void 0===b&&(b=0);this.input=a;this.Ia=b}c.prototype.aw=function(){return this.input.substr(this.Ia)};c.prototype.match=function(a){this.Dm();return this.Ia+a.length<=this.input.length&&this.input.substr(this.Ia,a.length)==a?(this.Ia+=a.length,!0):!1};c.prototype.Dm=function(){for(;this.Ia<this.input.length;this.Ia++){var a=this.input[this.Ia];if(" "!==a&&"\n"!==a&&"\r"!==a&&"\t"!==a)break}};c.prototype.Jd=function(a){this.Dm();for(var b=this.Ia;this.Ia<this.input.length;this.Ia++){var d=
this.input[this.Ia];if(!("0"<=d&&"9">=d||"-"==d||"+"==d||"."==d||"e"==d||"E"==d))break}if(b==this.Ia)return!1;d=parseFloat(this.input.substr(b,this.Ia-b));if(isNaN(d))return this.Ia=b,!1;a.value=d;return!0};c.prototype.Zu=function(a){this.Dm();for(var b=this.Ia;this.Ia<this.input.length;this.Ia++){var d=this.input[this.Ia];if(!("a"<=d&&"z">=d||"A"<=d&&"Z">=d||"-"==d||this.Ia>b&&"0"<=d&&"9">=d))break}return this.Ia>b?(a.value=this.input.substr(b,this.Ia-b),!0):!1};c.prototype.FB=function(a){this.Dm();
for(var b=this.Ia;this.Ia<this.input.length&&";"!==this.input[this.Ia];this.Ia++);a.value=this.input.substr(b,this.Ia-b).trim();return!0};return c}(),ge={};function be(c){c in ge||(ge[c]=!0,console.warn(c))}
var he=function(){function c(a,b,d){void 0===a&&(a="normal");void 0===b&&(b="sans-serif");void 0===d&&(d="10px");this.weight=a;this.family=b;this.size=d}c.prototype.clone=function(){return new c(this.weight,this.family,this.size)};c.prototype.toString=function(){return this.weight+" "+this.size+" "+this.family};return c}(),ce=function(){function c(a){this.ma=a;this.jb={un:1,Nl:1,Ol:"nonzero",opacity:1,ra:new H,font:new he,Hn:"none"};this.rr=[]}c.prototype.save=function(){this.rr.push(this.jb);this.jb=
{un:this.jb.un,Nl:this.jb.Nl,Ol:this.jb.Ol,opacity:this.jb.opacity,ra:this.jb.ra.clone(),font:this.jb.font.clone(),Hn:this.jb.Hn};this.ma.save()};c.prototype.restore=function(){this.rr.length&&(this.jb=this.rr.pop());this.ma.restore()};c.prototype.translate=function(a,b){this.ma.translate(a,b)};c.prototype.scale=function(a,b){this.ma.scale(a,b)};c.prototype.rotate=function(a){this.ma.rotate(a)};c.prototype.beginPath=function(){this.ma.beginPath()};c.prototype.closePath=function(){this.ma.closePath()};
c.prototype.bezierCurveTo=function(a,b,d,e,c,h){this.ma.bezierCurveTo(a,b,d,e,c,h)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ma.quadraticCurveTo(a,b,d,e)};c.prototype.arc=function(a,b,d,e,c,h){this.ma.arc(a,b,d,e,c,h)};c.prototype.Za=function(a){for(var b in a)this.set(b,a[b])};c.prototype.set=function(a,b){var d=!1;switch(a){case "stroke-width":this.ma.lineWidth=parseFloat(b);break;case "fill":"none"===b&&(b="transparent");this.ma.fillStyle=b;break;case "stroke":"none"===b&&(b="transparent");
this.ma.strokeStyle=b;break;case "stroke-opacity":this.jb.un=parseFloat(b);break;case "fill-opacity":this.jb.Nl=parseFloat(b);break;case "opacity":this.jb.opacity=parseFloat(b);break;case "stroke-linejoin":this.ma.lineJoin=b;break;case "stroke-miterlimit":this.ma.miterLimit=parseFloat(b);break;case "stroke-linecap":this.ma.lineCap=b;break;case "vector-effect":"non-scaling-stroke"===b?this.jb.Hn=b:be("Unsupported SVG style: "+a+"="+b);break;case "style":d=new ee(b);var e={};fe(d,e);this.Za(e);d=!1;
break;case "transform":d=b;e=new ee(d);for(var c=new H,h=!0;;){if(e.match("translate")){var k={value:0},l={value:0},n=!1;e.match("(")&&e.Jd(k)||(n=!0);!n&&e.match(",");!n&&e.Jd(l);if(n||!e.match(")"))throw Error("Can't parse "+d);c=c.multiply(new pc(k.value,l.value))}else if(e.match("rotate")){h={value:0};k={value:0};l={value:0};n=!1;e.match("(")&&e.Jd(h)||(n=!0);n||!e.match(",")||e.Jd(k)&&e.match(",")&&e.Jd(l)||(n=!0);if(n||!e.match(")"))throw Error("Can't parse "+d);c=c.multiply(new qc(h.value/
180*Math.PI,k.value,l.value))}else if(e.match("matrix")){h={value:0};n={value:0};var r={value:0},v={value:0};k={value:0};l={value:0};if(!(e.match("(")&&e.Jd(h)&&(e.match(","),1)&&e.Jd(n)&&(e.match(","),1)&&e.Jd(r)&&(e.match(","),1)&&e.Jd(v)&&(e.match(","),1)&&e.Jd(k)&&(e.match(","),1)&&e.Jd(l)&&e.match(")")))throw Error("Can't parse "+d);c=c.multiply(new H(h.value,r.value,n.value,v.value,k.value,l.value))}else if(e.match("scale")){k={value:1};l={value:1};if(!e.match("(")||!e.Jd(k))throw Error("Can't parse "+
d);e.match(",");e.Jd(l)||(l.value=k.value);if(!e.match(")"))throw Error("Can't parse "+d+" at "+e.aw());c=c.multiply(new rc(k.value,l.value))}else{if(h)throw Error("Can't parse transform: "+d+" at "+e.aw());break}h=!1}this.jb.ra=this.jb.ra.multiply(c);d=!1;break;case "fill-rule":this.jb.Ol=b;break;case "font-family":this.jb.font.family=b;break;case "font-size":this.jb.font.size=b;break;case "font-weight":this.jb.font.weight=b;break;case "id":case "d":case "cx":case "cy":case "r":case "rx":case "ry":case "x":case "y":case "width":case "height":case "class":case "href":d=
!1;break;default:-1===a.indexOf(":")&&0!==a.indexOf("data-")&&be("Unsupported SVG style: "+a+"="+b),d=!1}d&&Xd("Apply %s=%s",a,b)};c.prototype.wd=function(){this.jb.ra.mc(this.ma)};c.prototype.fill=function(){var a=this.ma.globalAlpha;this.ma.globalAlpha=this.ma.globalAlpha*this.jb.opacity*this.jb.Nl;this.ma.fill(this.jb.Ol);this.ma.globalAlpha=a};c.prototype.stroke=function(){var a=this.ma.globalAlpha;this.ma.globalAlpha=this.ma.globalAlpha*this.jb.opacity*this.jb.un;"non-scaling-stroke"===this.jb.Hn?
(this.ma.save(),this.ma.setTransform(1,0,0,1,0,0),this.ma.stroke(),this.ma.restore()):this.ma.stroke();this.ma.globalAlpha=a};c.prototype.moveTo=function(a,b){this.ma.moveTo(a,b)};c.prototype.lineTo=function(a,b){this.ma.lineTo(a,b)};c.prototype.rect=function(a,b,d,e,c,h){yc(this.ma,a,b,d,e,c,h)};c.prototype.text=function(a,b,d){this.ma.font=this.jb.font.toString();this.ma.textBaseline="alphabetic";"transparent"!==this.ma.fillStyle&&this.ma.fillText(a,b,d);"transparent"!==this.ma.strokeStyle&&this.ma.strokeText(a,
b,d)};c.prototype.ellipse=function(a,b,d,e){var c=2*d,h=2*e;a-=d;b-=e;e=c/2*.5522848;d=h/2*.5522848;var k=a+c,l=b+h;c=a+c/2;h=b+h/2;this.ma.moveTo(a,h);this.ma.bezierCurveTo(a,h-d,c-e,b,c,b);this.ma.bezierCurveTo(c+e,b,k,h-d,k,h);this.ma.bezierCurveTo(k,h+d,c+e,l,c,l);this.ma.bezierCurveTo(c-e,l,a,h+d,a,h)};return c}();var ie="ontouchstart"in window,je="onpointerdown"in window,ke={touchstart:"down",touchmove:"move",touchend:"up",touchcancel:"up",pointerdown:"down",pointermove:"move",pointerup:"up",pointercancel:"up",mousedown:"down",mousemove:"move",mouseup:"up",wheel:"wheel"},le=[],me=function(c){function a(a,d,e,f,h,k,l,n,r,v,x,w,y,A,E,M,K,D,J,V){void 0===J&&(J=le);void 0===V&&(V=0);k=c.call(this,a,d,e,k,n,r)||this;k.type=a;k.pageX=d;k.pageY=e;k.sb=f;k.tb=h;k.startTime=l;k.pointerId=v;k.data=x;k.index=w;k.Cs=
y;k.buttons=A;k.ctrlKey=E;k.shiftKey=M;k.altKey=K;k.metaKey=D;k.oa=J;k.angle=V;k.scale=0;k.rotation=0;return k}__extends(a,c);a.prototype.clone=function(){return new a(this.type,this.pageX,this.pageY,this.sb,this.tb,this.timestamp,this.startTime,this.target,this.qb,this.pointerId,this.data,this.index,this.Cs,this.buttons,this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,this.oa,this.angle)};a.prototype.dm=function(){return this.offset({x:this.pageX,y:this.pageY},void 0)};a.prototype.rp=function(){return this.timestamp-
this.startTime};a.prototype.Vl=function(){return lc(this.pageX,this.pageY,this.sb,this.tb)};a.prototype.toString=function(){var a=c.prototype.toString.call(this)+(" "+this.rp()+"ms "+Math.round(this.Vl())+"px");0!=this.scale&&(a+=" scale="+Math.round(100*(this.scale||0))/100,a+=" "+Math.round(this.rotation||0)+"deg");return a};a.prototype.setData=function(a,d){this.data[a]=d};a.prototype.getData=function(a){return this.data[a]};a.prototype.iA=function(){var a={x:0,y:0,z:0};if("wheel"===this.qb.type){var d=
this.qb;a.x=d.deltaX;a.y=d.deltaY;a.z=d.deltaZ}return a};a.prototype.Yp=function(){switch(this.qb.type){case "touchstart":case "touchend":case "touchmove":case "touchcancel":return!0;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":return"touch"===this.qb.pointerType}return!1};return a}(function(){function c(a,b,d,e,c,h){this.type=a;this.pageX=b;this.pageY=d;this.timestamp=e;this.target=c;this.qb=h}c.prototype.toString=function(){return"["+this.type+" ("+this.qb.type+")] ("+
this.pageX+","+this.pageY+")"};c.prototype.offset=function(a,b){b=z(b).gc();return{x:a.x-b.left,y:a.y-b.top}};c.prototype.stopPropagation=function(){this.qb.stopPropagation()};c.prototype.preventDefault=function(){this.qb.preventDefault()};return c}());
function ne(c,a){var b=(new Date).getTime();return new me("down",a.pageX||0,a.pageY||0,a.sb||0,a.tb||0,a.timestamp||b,a.startTime||b,a.target||null,c,a.pointerId||0,a.data||null,a.index||0,a.Cs||0,a.buttons||0,a.ctrlKey||!1,a.shiftKey||!1,a.altKey||!1,a.metaKey||!1,a.oa||[],a.angle||0)}
var oe=u.create("TouchListener"),ve=function(c){function a(b,d){function e(b){try{f.handleEvent(b)}catch(l){if(l instanceof Error&&a.ap)a.Gm=l;else throw l;}}void 0===d&&(d={});var f=c.call(this)||this;f.da=b;f.options=d;f.Qe=[];f.Mg=[];f.active=[];f.vu={};f.Bu=0;f.bk=!0;var h=d.CE?document:b;ie?(f.Ua(b,"touchstart",e),f.Ua(h,"touchmove",e),f.Ua(h,"touchend",e),f.Ua(h,"touchcancel",e)):je&&!1!==d.Ls&&(f.Ua(b,"pointerdown",e),f.Ua(h,"pointermove",e),f.Ua(h,"pointerup",e),f.Ua(h,"pointercancel",e));
if(ie||!je||!1===d.Ls)f.Ua(b,"mousedown",e),f.Ua(h,"mousemove",e),f.Ua(h,"mouseup",e);f.Ua(b,"wheel",e);return f}__extends(a,c);a.hx=function(b,d){a.ap=!0;a.Gm=null;b=b.dispatchEvent(d);a.ap=!1;if(d=a.Gm)throw a.Gm=null,d;return b};a.prototype.Ua=function(a,d,c){this.Qe.push({element:a,event:d,fn:c});"touchmove"===d?a.addEventListener(d,c,{passive:!1,capture:!0===this.options.Dn}):a.addEventListener(d,c,!0===this.options.Dn)};a.prototype.pa=function(a,d){for(var b=0,f=a.split(" ");b<f.length;b++){var h=
f[b],k="";switch(h){case "gesturestart":case "gesturechange":case "gestureend":k="gesture";break;case "tap":case "doubletap":k="tap";break;case "swipe":k="swipe";break;case "hold":k="hold";break;case "drag":k="drag"}if(""!==k&&!this.vu[k]){switch(k){case "gesture":this.Mg.push(new pe(this));break;case "tap":this.Mg.push(new qe(this));break;case "swipe":this.Mg.push(new re(this));break;case "hold":this.Mg.push(new se(this));break;case "drag":this.Mg.push(new te(this))}this.vu[k]=!0;oe("Created new detector "+
k+" to handle "+h)}}c.prototype.pa.call(this,a,d)};a.prototype.ta=function(a,d){c.prototype.rc.call(this,a,d)};a.prototype.Ta=function(){for(var a=0,d=this.Qe;a<d.length;a++){var c=d[a];c.element.removeEventListener(c.event,c.fn,!0===this.options.Dn)}a=0;for(d=this.Mg;a<d.length;a++)c=d[a],c.Ta&&c.Ta();this.Qe.length=0;this.Mg.length=0;this.active.length=0;this.lb={}};a.prototype.handleEvent=function(a){var b=ke[a.type],c=(new Date).getTime();switch(a.type){case "touchstart":case "touchend":case "touchmove":case "touchcancel":this.Bu=
c+800;for(var f=0;f<a.changedTouches.length;f++){var h=a.changedTouches[f];this.Jj(a,b,h.identifier,h.pageX,h.pageY,c)}break;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":f=ue(a);"pointermove"===a.type&&a.buttons&&!this.Kt(a.pointerId)&&(oe("Manufactured pointerdown"),this.Jj(a,"down",a.pointerId,f.pageX,f.pageY,c));this.Jj(a,b,a.pointerId,f.pageX,f.pageY,c);if("pointercancel"===a.type)for(f=this.active.length-1;0<=f;f--)this.Jj(a,b,this.active[f].id,a.pageX,a.pageY,
c);break;case "mousedown":case "mousemove":case "mouseup":if(c<this.Bu)break;case "wheel":f=ue(a),this.Jj(a,b,0,f.pageX,f.pageY,c)}};a.prototype.Jj=function(a,d,c,f,h,k){var b=null;switch(d){case "down":b=this.Sx(c,f,h,k,a.buttons);d=new me("down",f,h,f,h,k,k,a.target,a,c,b.data,b.index,this.active.length,a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;case "move":b=this.Kt(c);d=new me("move",f,h,b?b.sb:f,b?b.tb:h,k,b?b.Pb:k,a.target,a,c,b?b.data:{},b?b.index:-1,this.active.length,a.buttons,
a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;case "up":b=this.PC(c);d=new me("up",f,h,b?b.sb:f,b?b.tb:h,k,b?b.Pb:k,a.target,a,c,b?b.data:{},b?b.index:-1,this.active.length,b?b.buttons:a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;case "wheel":d=new me(d,f,h,f,h,k,k,a.target,a,c,{},-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;default:return}null!==b&&(b.Qg=f,b.Rg=h);(b||this.da.contains(a.target))&&this.ta(d.type,d)};a.prototype.Kt=function(a){for(var b=
0,c=this.active;b<c.length;b++){var f=c[b];if(f.id===a)return f}return null};a.prototype.Sx=function(a,d,c,f,h){for(var b=0;b<this.active.length;b++){var e=this.active[b];if(e.id===a)return e.sb=e.Qg=d,e.tb=e.Rg=c,e.Pb=f,e.oa=[new F(d,c)],e}this.active.push({index:this.active.length,id:a,Pb:f,sb:d,tb:c,Qg:d,Rg:c,oa:[new F(d,c)],data:{},buttons:h});return this.active[this.active.length-1]};a.prototype.PC=function(a){for(var b=0;b<this.active.length;b++)if(this.active[b].id===a)return a=this.active[b],
this.active.splice(b,1),a;return null};a.ap=!1;a.Gm=null;return a}(sb);function ue(c){if(c.pageX===c.clientX&&c.pageY===c.clientY){var a=document.documentElement.scrollLeft+document.body.scrollLeft,b=document.documentElement.scrollTop+document.body.scrollTop;if(a||b)return{pageX:c.clientX+a,pageY:c.clientY+b}}return c}
function qe(c){var a=[];c.pa("up",function(b){if(200>b.rp()&&20>b.Vl()){var d=b.clone();d.type="tap";c.ta("tap",d);a:{for(d=0;d<a.length;d++){var e=a[d];if(300>b.timestamp-e.Pb&&20>lc(b.pageX,b.pageY,e.x,e.y)){e.x=b.pageX;e.y=b.pageY;e.Pb=b.timestamp;d=!0;break a}}4===a.length&&a.splice(0,1);a.push({x:b.pageX,y:b.pageY,id:b.pointerId,Pb:b.timestamp});d=!1}d&&(d=b.clone(),d.type="doubletap",c.ta("doubletap",d))}})}
function te(c){var a=-1,b=-1;c.pa("down",function(a){a.setData("target",a.qb.target)});c.pa("move",function(d){a!==d.sb&&b!==d.tb&&8<d.Vl()&&(a=d.sb,b=d.tb,d=d.clone(),d.type="drag",c.ta("drag",d))})}
function pe(c){function a(){for(var a=0,b=0,d=0;d<e.length;d++)oe("Active touch: id:%s %s,%s",e[d].id,e[d].Qg,e[d].Rg),a+=e[d].Qg,b+=e[d].Rg;return{x:a/e.length,y:b/e.length}}function b(a,b){for(var d=0,c=0;c<e.length;c++){var f=e[c];d+=Math.sqrt((f.Qg-a)*(f.Qg-a)+(f.Rg-b)*(f.Rg-b))}return d/e.length}function d(a,b,d,e,f){a=a.clone();a.type=b;a.pageX=d.x;a.pageY=d.y;a.scale=e;a.rotation=f;c.ta(a.type,a)}var e=[],f=!1,h=0,k=1,l=1,n={x:0,y:0};c.pa("down move up",function(r){e=c.active;switch(r.type){case "down":2<=
e.length&&!f&&(f=!0,n=a(),l=b(n.x,n.y),k=1,h=0,d(r,"gesturestart",n,k,h));break;case "move":if(2<=e.length&&f){n=a();k=b(n.x,n.y)/l;for(var v=n.x,x=n.y,w=0,y=0;y<e.length;y++){var A=Math.atan2(e[y].Rg-x,e[y].Qg-v)-Math.atan2(e[y].tb-x,e[y].sb-v);A>Math.PI?A-=2*Math.PI:A<=-Math.PI&&(A+=2*Math.PI);w+=A}h=w/e.length/Math.PI*180;d(r,"gesturechange",n,k,h)}break;case "up":f&&2>e.length&&(f=!1,d(r,"gestureend",n,k,h))}})}
function re(c){c.pa("up",function(a){var b=a.oa;if(!(200>a.Vl()||1E3<a.rp()||2>b.length)){for(var d=b[0],e=b[b.length-1],f=1;f<b.length-1;f++)if(40<b[f].qt(d,e))return!1;b=Math.atan2(e.y-d.y,e.x-d.x);oe("Swipe angle %s",b/Math.PI*180);a=a.clone();a.type="swipe";a.angle=b;c.ta("swipe",a)}})}function we(c){this.wi=c;this.time=(new Date).getTime();this.timeout=0}
var se=function(){function c(a){function b(a){var b=d.og[a];b&&(oe("Remove pointer %s",a),clearTimeout(b.timeout),delete d.og[a])}var d=this;this.og={};a.pa("down",function(c){b(c.pointerId);d.og[c.pointerId]=new we(new F(c.pageX,c.pageY));d.og[c.pointerId].timeout=setTimeout(function(){var b=c.clone();b.type="hold";b.timestamp=(new Date).getTime();a.ta("hold",b)},1E3)});a.pa("move",function(a){var c=a.pointerId;if(c in d.og){var e=d.og[c];20<(new F(a.pageX,a.pageY)).ec(e.wi)&&b(c)}});a.pa("up",function(a){b(a.pointerId)})}
c.prototype.Ta=function(){for(var a in this.og)clearTimeout(this.og[a].timeout)};return c}();var xe={type:"translate",position:new F(0,0),offset:new F(0,0),bh:""},ye={type:"translate",position:new F(0,0),offset:new F(0,0),bh:""},ze={type:"translate",position:new F(0,0),offset:new F(0,0),bh:""},Ae=function(){function c(a,b,d){this.md=a;this.ra=b;this.ya=d}c.prototype.Zs=function(){return!0};c.prototype.im=function(a,b){void 0===a&&(a=this.ra);void 0===b&&(b=1);a=a.vb();if(0===a.x||0===a.y)a.x=1,a.y=1;return new F(this.ya.x+this.ya.width*this.md.position.x+this.md.offset.x/a.x/b,this.ya.y+
this.ya.height*this.md.position.y+this.md.offset.y/a.y/b)};c.prototype.dm=function(){var a=this.im();return this.ra.apply(a.x,a.y)};c.prototype.la=function(a,b,d,c,f){a.save();f*=d;c=c.multiply(this.ra);var e=c.vb();if(0===e.x||0===e.y)e.x=1,e.y=1;e.x=1/e.x/d;e.y=1/e.y/d;d=this.im(c,d);c=c.multiply(new rc(e.x,e.y,d.x,d.y));c.mc(a);(b=b.get(this.md.bh))?(f=b.width,c=b.height,a.drawImage(b,d.x-f/2,d.y-c/2,f,c)):this.Uo(a,d,f);a.restore()};c.prototype.Uo=function(a,b){a.strokeStyle="red";a.lineWidth=
1;a.strokeRect(b.x-10,b.y-10,20,20)};c.prototype.Db=function(a,b,d,c,f){var e=a.get(this.md.bh);a=this.im(this.ra,f);b=this.ra.inverse().apply(b,d);d=this.ra.vb();d.x*=f;d.y*=f;e?(c=e.height,f=e.width/2/d.x,c=c/2/d.y):(f=c/d.x,c/=d.y);return(new G(a.x-f,a.y-c,2*f,2*c)).Oc(b.x,b.y,0)};c.prototype.eg=function(){return"default"};c.prototype.click=function(){return null};return c}(),Be=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||this;a.origin=f;return a}__extends(a,c);a.prototype.fg=function(a,
d){var b=this.ra.inverse();a=this.my(a,b,d);return this.ra.multiply((new rc(a.x,a.y,this.origin.x,this.origin.y)).multiply(b))};a.prototype.my=function(a,d,c){void 0===d&&(d=this.ra.inverse());var b=1,e=1,k=this.dm(),l=this.im();a=d.apply(k.x+a.x,k.y+a.y);l=new F(l.x-this.origin.x,l.y-this.origin.y);a=new F(a.x-this.origin.x,a.y-this.origin.y);a=(a.x*l.x+a.y*l.y)/(l.x*l.x+l.y*l.y);a=oc(a);1E-8>Math.abs(l.x)||1E-8>Math.abs(l.y)?1E-8>Math.abs(l.x)?e=a:b=a:e=b=a;c&&(a=this.ra.multiply(new rc(b,e,this.origin.x,
this.origin.y)),l=this.ra.vb(),d=a.vb(),a=Math.round(this.ya.width*d.x/c)*c,c*=Math.round(this.ya.height*d.y/c),1!==b&&0!==a&&(b=a/this.ya.width/l.x),1!==e&&0!==c&&(e=c/this.ya.height/l.y));return{x:b,y:e}};a.prototype.Uo=function(a,d,c){a.beginPath();var b=6;c&&9*b>c&&(b=c/9);a.strokeStyle=q.Oa;a.lineWidth=1;a.shadowBlur=3;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="rgba(0,0,0,0.2)";a.strokeStyle="#ccc";a.arc(d.x,d.y,b,0,2*Math.PI);a.fillStyle=q.Lc;a.fill();a.stroke();a.shadowColor=q.Be};
a.prototype.eg=function(){return.5===this.md.position.x?"ns-resize":.5===this.md.position.y?"ew-resize":this.md.position.x!==this.md.position.y?"nesw-resize":this.md.position.x===this.md.position.y?"nwse-resize":c.prototype.eg.call(this)};return a}(Ae),Ce=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||this;d=a.dm();a.origin=a.ra.apply(f.x,f.y);a.nr=Math.atan2(d.y-a.origin.y,d.x-a.origin.x);return a}__extends(a,c);a.prototype.fg=function(a,d){var b=this.dm();a=Math.atan2(b.y+a.y-this.origin.y,
b.x+a.x-this.origin.x)-this.nr;d&&(d=Math.PI/16,a=Math.floor(a/d)*d);return new qc(-a,this.origin.x,this.origin.y)};a.prototype.click=function(){return new qc(Math.PI/2,this.origin.x,this.origin.y)};a.prototype.Uo=function(a,d){a.beginPath();a.strokeStyle="#008000";a.lineWidth=3;a.moveTo(d.x,d.y);a.arc(d.x,d.y,6,0,1.5*Math.PI,!1);a.stroke()};a.prototype.eg=function(){return"crosshair"};return a}(Ae),De=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.fg=function(a){return new pc(a.x,
a.y)};a.prototype.eg=function(){return"move"};return a}(Ae),Ee=function(c){function a(){return c.call(this,ze,new H,new G(0,0,0,0))||this}__extends(a,c);a.prototype.fg=function(){return new H};return a}(Ae),Fe=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.Zs=function(){return!1};a.prototype.click=function(a){this.md.bt&&this.md.bt(a.pageX,a.pageY);return null};a.prototype.fg=function(){return new H};return a}(Ae);
function Ge(c,a,b){var d=void 0,e=new F(0,0),f=b.vb();e.x=a.x+a.width*c.position.x+c.offset.x/f.x;e.y=a.y+a.height*c.position.y+c.offset.y/f.y;switch(c.type){case "translate":return new De(c,b,a);case "scale":return d||(d=new F(a.right()-c.position.x*a.width,a.bottom()-c.position.y*a.height)),new Be(c,b,a,d);case "rotate":return d||(d=a.ne()),new Ce(c,b,a,d);case "click":return new Fe(c,b,a)}};var He=function(){function c(a,b,d,c){this.view=a;this.xi=b;this.Ga=this.Fa=0;this.qc=!1;this.log=u.create("SELECT");this.sv(d,c)}c.prototype.xb=function(a){this.log("Gesture detected; aborting select box.");this.view.Ya(this.xi);return this.xi.xb?this.xi.xb(a):!1};c.prototype.Dc=function(){this.view.Do("select")};c.prototype.yb=function(a,b){return this.sv(a,b)};c.prototype.sv=function(a,b){this.Fa=a;this.Ga=b;return this.qc=!0};c.prototype.Eb=function(a,b){if(this.qc){var d=this;this.view.scrollIntoView(a,
b);this.view.Tv("select",function(c){c.save();c.strokeStyle="#0050B7";c.lineWidth=2/d.view.scale;c.fillStyle="rgba(0, 80, 183, 0.2)";var e=new G(d.Fa+.5,d.Ga+.5,a-d.Fa,b-d.Ga);c.fillRect(e.x,e.y,e.width,e.height);c.strokeRect(e.x,e.y,e.width,e.height);c.restore()});return!0}return!1};c.prototype.ac=function(a,b){this.qc=!1;this.view.ub();this.view.fD(new G(this.Fa,this.Ga,a-this.Fa,b-this.Ga));this.view.pc();this.view.Ya(this.xi);return!0};c.prototype.Dd=function(){return"pick"};return c}();function Ie(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Je=function(){function c(a,b,d,c,f,h){this.view=a;this.handle=b;this.nE=d;this.rb=0;this.kw=new G(0,0,0,0);this.Da=[];this.Op=[];this.Ve=[];this.ig=[];this.kc=new F(0,0);this.duplicate=this.su=!1;this.log=u.create("TransformSelectionBehaviour");this.om=!1;this.yb(c,f,h)}c.prototype.xb=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.om=!0;var b=this.view.Pd(a.pageX,a.pageY,!0),d=
b.x;b=b.y;"gesturestart"===a.type&&(this.kc.x=d,this.kc.y=b);var c=d-this.kc.x,f=b-this.kc.y,h=a.scale,k=a.rotation;this.view.cn||(h=1);this.view.qk||(k=0);this.view.Ci||(f=c=0);k=-k/180*Math.PI;if(0<this.view.ha.get("snap")){var l=Math.PI/16;k=Math.floor(k/l)*l}h=new rc(h,h,this.kc.x,this.kc.y);k=new qc(k,this.kc.x,this.kc.y);c=(new pc(c,f)).multiply(h).multiply(k);this.Mv(c,d,b);"gestureend"===a.type&&this.wa(c,d,b);return!0};c.prototype.yb=function(a,b,d){var c=this;if(this.om)return!0;this.duplicate=
this.view.ha.pB(d);this.view.Kb(this.handle.eg());this.view.Xe(!0);this.duplicate?(this.Da.length=0,this.Op=this.view.Uc(!0),this.view.aa.transaction(function(){for(var a=0,b=c.view.aa.duplicate(c.view.Uc(!0),new H);a<b.length;a++){var d=c.view.aa.Aa(b[a],!1);d&&Tc(d)&&c.Da.push(d)}},!0)):(this.Da=this.view.hc(),this.Op=this.view.Uc(!0));this.Ez(this.Da);this.kc=this.kr(a,b,d);this.log("onMouseDown(%s,%s)",this.kc.x,this.kc.y);this.kw=new G(this.view.de.x,this.view.de.y,this.view.de.width,this.view.de.height);
return!0};c.prototype.Ez=function(a){this.Ve=[];for(var b=new H,d=0;d<a.length;d++)this.Ve.push(a[d].wd(b)),this.ig.push(this.Ve[d]),this.rb=this.rb||a[d].ia("snap")||0,Vc(a[d])&&(this.su=!0)};c.prototype.kr=function(a,b,d){return this.view.rb(new F(a,b),this.rb||d)};c.prototype.Eb=function(a,b,d){if(this.om)return!0;var c=this.kr(a,b,d);a=c.x;b=c.y;d=this.handle.fg(new F(c.x-this.kc.x,c.y-this.kc.y),this.view.Ip(d));this.Kv(d);this.Mv(d,a,b);return!0};c.prototype.Mv=function(a,b,d){for(var c=this,
f=0;f<this.Da.length;f++)this.Da[f].Nb(this.Ve[f]),this.ig[f]=this.Da[f].wd(a),this.Da[f].Nb(this.ig[f]);this.view.aa.Rz(this.view.ma,this.view.request,this.Da);this.view.yn(a);this.su&&this.view.aa.gt();this.view.la(function(){if(c.handle instanceof Ce){var a=c.view.ma;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/c.view.scale;a.moveTo(c.handle.origin.x,c.handle.origin.y);a.lineTo(b,d);a.stroke();a.restore()}})};c.prototype.wa=function(a,b,d){for(var c=this,f=0;f<this.Da.length;f++)this.Da[f].Nb(this.Ve[f]);
f=!1;if(a.Zp()){b={docX:b,docY:d,nodes:[]};d=0;for(f=this.Da;d<f.length;d++){var h=f[d];b.nodes.push({id:h.id,rect:new Qd(h.rect.x,h.rect.y,h.rect.width,h.rect.height),shift:{x:a.Fa,y:a.Ga}})}f=!1===this.view.xa.rc("drop-shape",b)}f||(this.duplicate&&this.view.aa.transaction(function(){for(var a=[],b=0,d=c.Da;b<d.length;b++)a.push(d[b].id);c.view.aa.Yb(a)},!0),this.view.aa.transaction(function(){if(c.duplicate)c.view.aa.duplicate(c.Op,a);else for(var b=0;b<c.Da.length;b++)c.view.aa.Bb([c.Da[b].id],
c.ig[b])}));this.Dt()};c.prototype.ac=function(a,b,d){var c=this;if(this.om)return!0;var f=a,h=b,k=this.kr(a,b,d);a=k.x;b=k.y;this.log("onMouseUp(%s,%s)",a,b);var l=!1;if(k.dd(this.kc))if(this.nE){if(this.duplicate){var n=[];a=0;for(b=this.Da;a<b.length;a++)n.push(b[a].id);this.view.aa.transaction(function(){c.view.aa.Yb(n)},!0)}(f=this.view.aa.Db(f,h,this.view.scale,this.view.Rb).node)&&f.uf()?(this.log("Didn't move, and has edit mode. Selecting node %s",f.id),this.view.ub(),this.view.rg(f)):l=!0}else this.log("Didn't move, but toggleEditNode=false"),
l=!0;else return this.log("Moved by %s,%s",a-this.kc.x,b-this.kc.y),d=this.handle.fg(new F(k.x-this.kc.x,k.y-this.kc.y),this.view.Ip(d)),this.Kv(d),this.wa(d,a,b),!0;if(l){var r=this.handle.click(d);this.log("handle.click returned %s",r);r&&this.view.aa.transaction(function(){c.view.aa.xg(Ie(c.Da),r)})}this.Dt();return!0};c.prototype.Kv=function(a){var b=this.view.ha.get("confine");switch(b){case "page":case "view":if(a.Zp()){var d=this.kw.clone();b="view"===b?this.view.Ub():this.view.rf();d.x+=a.Fa;
d.y+=a.Ga;d=d.Ho(b);a.Fa+=d.x;a.Ga+=d.y}}};c.prototype.Dt=function(){this.view.yn(new H);this.view.Ph();this.view.update(!0);this.view.Ab()};c.prototype.Dc=function(){this.view.Kb("default");this.view.Xe(!1)};c.prototype.Dd=function(){return"pick"};return c}();var Le=function(){function c(a,b){this.view=a;this.ba=b;this.Jl=!1;this.Ja=this.bg=this.ka=null;this.fillStyle=q.Oa;this.vn=!1;this.za=new pb;this.vr="normal";this.log=u.create("Text");this.multiline=a.ha.get("multilineText");this.Tb=document.createElement("div");a.ha.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.vr="top")}c.prototype.Bd=function(){this.log("Entering text mode");this.view.Kb("text")};c.prototype.Dc=function(){this.Jl&&this.gj();this.view.Kb("default");
this.log("Leaving text mode");this.ka&&this.ka.parentNode&&this.ka.parentNode.removeChild(this.ka);this.ka=null;this.Tb.parentNode&&this.Tb.parentNode.removeChild(this.Tb);this.za.Ta()};c.prototype.yb=function(a,b,d){this.log("onMouseDown(%s)",d.type);if(this.Jl){if(d.target===this.ka)return this.log("Ignore click -- its in our own edit box."),this.view.Il=!0,!1;this.log("Editing somewhere else on mousedown; submit that first.");this.gj();this.view.ha.get("autoPickToolText")&&this.view.Ab()}else d=
this.view.aa.Db(a,b,this.view.scale,this.view.Rb).node,this.pr(d,a,b);this.log("Eating click");return this.view.Il=!0};c.prototype.Dz=function(){if(this.Tb&&this.ka){this.Tb.style.fontSize=this.ka.style.fontSize;this.Tb.style.fontFamily=this.ka.style.fontFamily;this.Tb.style.fontWeight=this.ka.style.fontWeight;this.Tb.style.fontStyle=this.ka.style.fontStyle;this.Tb.style.whiteSpace="break-spaces";this.Tb.style.position="absolute";this.Tb.style.visibility="hidden";this.Tb.style.backgroundColor="rgba(0,0,0,0.2)";
document.body.appendChild(this.Tb);this.Tb.style.left="0";for(this.Tb.style.top="0";this.Tb.firstChild;)this.Tb.removeChild(this.Tb.firstChild);this.Tb.appendChild(document.createTextNode(this.ka.value));var a=Math.ceil(this.Tb.clientWidth),b=this.ka.offsetWidth-this.ka.clientWidth;this.ka.clientWidth<a+4&&(a>500*this.view.scale&&(a=500*this.view.scale),this.ka.style.width=a+4+b+"px");this.ka.clientHeight<this.ka.scrollHeight+4&&this.ka.offsetHeight<this.ka.scrollHeight&&(this.log("Increase to scrollHeight of %s",
this.ka.scrollHeight),this.ka.style.height=""+this.ka.scrollHeight+"px")}};c.prototype.pr=function(a,b,d){function c(){null===J.Ja?J.Dz():h.ka&&h.ka.clientHeight<h.ka.scrollHeight+4&&h.ka.offsetHeight<h.ka.scrollHeight&&(h.log("Increase to scrollHeight of %s",h.ka.scrollHeight),h.ka.style.height=""+h.ka.scrollHeight+"px")}function f(){J.ka&&(J.ka.clientHeight<J.ka.scrollHeight&&(J.log("Increase to scrollHeight of %s",J.ka.scrollHeight),J.ka.style.height=""+J.ka.scrollHeight+"px"),J.ka.style.width=
""+J.ka.scrollWidth+"px");V=null}var h=this,k=0,l=0,n=0,r=0,v=0,x=0,w=0;this.vn=!1;r=a&&("PathNode"===a.type()||"SvgNode"===a.type());if(a&&"TextNode"===a.type()||r&&a&&this.view.ha.get("allowTextInShape")||!r&&a&&a.$g()){this.Ja=a;"top"!==this.vr&&"TextNode"===a.type()&&this.Ja.sg(!0);this.view.la();this.bg=new F(a.rect.x,a.rect.y);if(r=a.ia("font")){r=Td(r);var y=r.fontFamily||"arial";var A=parseFloat(r.fontSize)||10;var E="bold"===r.fontWeight;var M="italic"===r.fontStyle}else y=a.ia("fontName"),
A=a.ia("fontSize"),E=a.ia("bold"),M=a.ia("italic");"TextNode"!==a.type()||a.ia("wrap")||(A*=a.Pa().vb().y);"TextNode"===a.type()&&(l=a.rect.height);var K=a.ia("textDecoration");k=a.rect.width*this.view.scale;k=Math.max(k,50);k+=7;a.ia("text")?this.fillStyle=a.ia("textFillStyle")||this.La("textFillStyle"):this.fillStyle=this.view.ua.textFillStyle;var D=a.Pa().vb();n=a.ia("padding")||0;r=n*=this.view.scale;n*=D.x;r*=D.y;x+=1;--w;l+=2;v=.15*A*D.y;this.log("NodeWidth=%s scale=%s/%s padding=%s/%s, paddingShift=%s editWidth=%s",
a.rect.width,D.x,D.y,n,r,v,k)}else this.Ja=null,this.bg=new F(b,d),y=this.La("fontName"),A=this.La("fontSize"),E=this.La("bold"),M=this.La("italic"),K=this.La("textDecoration"),this.fillStyle=this.ba.fillStyle||this.La("textFillStyle")||this.La("fillStyle"),n=this.La("padding")||0,r=n*=this.view.scale,(l=this.La("width")||0)&&(k=l*this.view.scale+n),l=2*A*this.view.scale,this.La("wrap")&&(d-=A);var J=this;this.ka=document.createElement("textarea");this.ka.setAttribute("rows","1");this.ka.style.width=
k?""+k+"px":"auto";a=this.view.Xh(this.bg.x,this.bg.y);this.ka.classList.add("zwibbler-text-area");this.ka.style.minWidth="0";this.ka.style.maxWidth="none";this.ka.style.position="absolute";this.ka.style.fontFamily=y;this.ka.style.fontSize=""+A*this.view.scale+"px";this.ka.style.lineHeight="1";this.ka.style.overflow="hidden";this.ka.style.fontWeight=E?"bold":"normal";this.ka.style.fontStyle=M?"italic":"normal";this.ka.style.paddingTop=r+v+"px";this.ka.style.paddingBottom=r-v+"px";this.ka.style.paddingLeft=
n+"px";this.ka.style.paddingRight=n+"px";this.ka.style.border="1px dashed #888";this.ka.style.outline="none";this.ka.style.color=this.fillStyle;this.ka.style.boxSizing="border-box";this.ka.style.backgroundColor=this.La("background");this.Ja&&"PathNode"===this.Ja.type()&&(this.ka.style.backgroundColor="white");this.ka.style.textDecoration=K||"none";this.ka.style.textAlign=this.La("textAlign");this.ka.style.zIndex=""+(this.view.Zd()+1);this.ka.style.resize="both";l&&(this.log("Set editbox height initially to "+
l+"px"),this.ka.style.height=l+"px");l=this.ka.clientHeight;this.log("Using z-index %s",this.ka.style.zIndex);q.lf(this.fillStyle).toString()===q.Lc&&(this.ka.style.backgroundColor="#808080");y=this.view.canvas.parentElement;A=z(y).gc();E=k=0;"top"===this.vr?(E=z(this.view.canvas.first).gc(),v=this.view.canvas.width,k=this.ka.clientWidth,k=E.left+v/2-k/2,E=E.top):(k=Math.round(a.x),E=Math.round(a.y));k+=x;E=E-r/2+w;this.ka.style.WebkitTransitionDuration="0";this.ka.style.MozTransitionDuration="0";
this.ka.style.msTransitionDuration="0";this.ka.style.OTransitionDuration="0";this.ka.style.transitionDuration="0";Ke(this.ka);this.ka.style.left=k-A.left+"px";this.ka.style.top=E-A.top+"px";y.appendChild(this.ka);"center"===this.La("textAlign")&&(null===this.Ja?(x=this.ka.offsetWidth/2,this.ka.style.left=a.x-x-A.left+"px",b-=x/this.view.scale):(x=this.ka.offsetWidth/2-this.Ja.rect.width/2*this.view.scale,this.ka.style.left=k-x-A.left+"px",this.ka.style.top=E+r/2-A.top+"px"));this.Jl=!0;this.bg=new F(b,
d+l);fc(this.ka,y);this.Ja&&(this.ka.value=this.Ja.ia("text"));var V=null;J.ka&&J.log("editBox scollheight is %s",J.ka.scrollHeight);V=setTimeout(f,0);this.za.addEventListener(this.ka,"keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&J.multiline||13===a.keyCode&&a.shiftKey?(J.log("Enter pressed. create text."),J.gj(),J.view.Ra.Ob&&J.view.UD(a),J.view.ha.get("autoPickToolText")&&J.view.Ab()):27===a.keyCode?(J.log("ESC pressed; cancel."),J.cancel(),J.view.Ab(),J.view.Tc.ta("goto-toolbar")):
13===a.keyCode&&(V||(V=setTimeout(f,0))))});this.za.addEventListener(this.ka,"input",c);this.za.addEventListener(this.ka,"propertychange",c);this.view.ha.get("leaveTextToolOnBlur")&&(this.za.addEventListener(this.ka,"focus",function(){J.log("Text focus received.")}),this.za.addEventListener(this.ka,"blur",function(){J.ka&&!J.ka.Mq&&(J.log("Text blur received -- removing=%s",!0===J.ka.Mq),J.ka.Mq=!0,J.gj())}));setTimeout(function(){J.ka&&J.ka.focus()},200);this.ka.focus();this.view.xa.ta("edit-text-shown",
J.ka);this.view.xa.digest()};c.prototype.bE=function(a){a?this.gj():this.cancel()};c.prototype.cancel=function(){this.ka&&(this.ka.Mq=!0,this.ka.parentNode&&this.ka.parentNode.removeChild(this.ka),this.view.xa.ta("edit-text-hidden"),this.view.Ra.Ob&&this.view.Tc.ta("goto-canvas"));this.ka=null;this.Jl=!1;this.Ja&&(this.Ja.sg(!1),this.view.la())};c.prototype.La=function(a){if(this.Ja){var b=this.Ja.ia(a);if(b)return b}if(a in this.ba)return this.ba[a];switch(a){case "background":return this.view.ha.get("defaultTextBackground");
case "wrap":return this.view.ha.get("multilineText");case "lineWidth":return this.view.ua.textLineWidth}return this.view.ua[a]};c.prototype.Xg=function(){return{textFillStyle:this.La("textFillStyle"),fillStyle:this.La("textFillStyle"),bold:this.La("bold"),italic:this.La("italic"),textDecoration:this.La("textDecoration"),strokeStyle:this.La("strokeStyle"),lineWidth:this.La("lineWidth"),fontName:this.La("fontName"),fontSize:this.La("fontSize"),textAlign:this.La("textAlign"),"border-width":this.La("border-width")||
0,"border-color":this.La("border-color")||q.Oa,background:this.La("background")||"transparent"}};c.prototype.gj=function(){var a=this;if(this.ka){var b=this.ka.value,d=this.ka.offsetWidth;this.cancel();if(this.Ja&&this.Ja.ia("text")===b&&!this.vn)this.log("Text was not changed.");else if(null===this.Ja&&""===b)this.log("No text entered.");else if(this.Ja){this.log("Update text in node %s",this.Ja.id);var c={text:b,textFillStyle:this.fillStyle,textAlign:this.La("textAlign"),textDecoration:this.La("textDecoration"),
fontSize:this.La("fontSize")},f;for(f in this.ba)c[f]=this.ba[f];this.view.aa.transaction(function(){a.view.aa.Bb([a.Ja.id],c)})}else if(this.bg){this.log("Create new text node.");var h=f=0,k=this.La("fontSize");f=k;if("center"===this.La("textAlign")&&0===(this.La("width")||0)+(this.La("padding")||0)){var l=this.YA(b)*this.view.scale;h=Math.max(0,(d-l)/2);this.log("tw="+l+" ew="+d+" Offset text by "+h+" to center.")}var n=new pc(this.bg.x+h,this.bg.y+f);this.view.aa.transaction(function(){var d=a.view.aa.createNode("TextNode",
hc({text:b,background:a.La("background"),fontSize:k,fontName:a.La("fontName"),bold:a.La("bold"),italic:a.La("italic"),textAlign:a.La("textAlign"),textFillStyle:a.La("textFillStyle"),textDecoration:a.La("textDecoration"),strokeStyle:a.La("textStrokeStyle"),lineWidth:a.La("textLineWidth"),layer:a.ba.layer||a.view.ad,wrap:a.view.ha.get("multilineText")},a.ba));a.view.aa.xg([d],n)})}}};c.prototype.YA=function(a){var b=new jd;b.uk(this.La("fontName"),this.La("fontSize"),this.La("bold"),this.La("italic"),
"none");b.ug(a);a=document.createElement("canvas").getContext("2d");b.format(a,0,0);return b.rect.width};c.prototype.Eb=function(){return!1};c.prototype.Kd=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===this.ka&&(this.view.Ab(),this.view.Tc.ta("goto-toolbar"))};c.prototype.ve=function(a,b){b?this.kd("textFillStyle",a):this.kd("strokeStyle",a)};c.prototype.lg=function(a,b){this.view.fr(a,b)};c.prototype.Df=function(a,b){"defaultBold"===a?(a="bold",this.ka&&(this.ka.style.fontWeight=b?
"bold":"normal")):"defaultItalic"===a?(a="italic",this.ka&&(this.ka.style.fontStyle=b?"italic":"normal")):"defaultTextBackground"===a?(a="background",this.ka&&(this.ka.style.backgroundColor=b)):"defaultFont"===a?(a="fontName",this.ka&&(this.ka.style.fontFamily=b)):"defaultFontSize"===a?(a="fontSize",this.ka&&(this.ka.style.fontSize=b+"px")):"defaultTextFillStyle"===a?(a="textFillStyle",this.ka&&(this.ka.style.color=b)):"defaultTextDecoration"===a?(a="textDecoration",this.ka&&(this.ka.style.textDecoration=
b)):"defaultTextAlign"===a&&(a="textAlign",this.ka&&(this.ka.style.textAlign=b));this.log("Update %s=%s",a,b);this.vn=!0;this.ba[a]=b};c.prototype.Dd=function(){return"text"};c.prototype.kd=function(a,b){b=ic(this.ba[a],b);this.ba[a]=b;this.vn=!0;switch(a){case "textFillStyle":case "fillStyle":this.ba.textFillStyle=b;this.view.ua.textFillStyle=b;break;case "strokeStyle":this.view.ua.textStrokeStyle=b;break;case "lineWidth":this.view.ua.textLineWidth=b}if(this.ka)switch(a){case "textFillStyle":case "fillStyle":this.ka.style.color=
b;break;case "fontSize":this.ka.style.fontSize=b+"px";break;case "fontName":this.ka.style.fontFamily=b;break;case "bold":this.ka.style.fontWeight=b?"bold":"normal";break;case "italic":this.ka.style.fontStyle=b?"italic":"normal";break;case "textDecoration":this.ka.style.textDecoration=b;break;case "textAlign":case "background":case "border":this.ka.style[a]=b;break;case "border-width":this.ka.style.borderWidth=b;break;case "border-color":this.ka.style.borderColor=b}};c.prototype.Kp=function(){return["TextNode"]};
return c}();function Ke(c){c.addEventListener("input",function(){var a=c.value,b=a.replace(/[\u2018\u2019\u201C\u201D]/g,function(a){return"''\"\"".substr("\u2018\u2019\u201c\u201d".indexOf(a),1)});if(a!==b){a=c.selectionStart;var d=c.selectionEnd;c.value=b;c.selectionStart=a;c.selectionEnd=d}})};var Me=function(){function c(a){this.view=a;this.start=new F(0,0);this.Dk=new F(0,0);this.active=!1;this.Hi=1;this.rect=null;this.log=u.create("PanZoomMixin");this.Hi=a.scale}c.prototype.Oe=function(){return this.active};c.prototype.xb=function(a){this.log("onGesture(%s)",a.type);if(!this.view.ha.get("allowZoom")||!this.view.ha.get("allowScroll"))return!1;if("gesturestart"===a.type)this.start=new F(a.pageX,a.pageY),this.Dk=this.view.Pd(a.pageX,a.pageY),this.rect=this.view.Ub(),this.Hi=this.view.scale,
this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.yi(a.scale*this.Hi)/this.Hi;a=new rc(1/a,1/a,this.Dk.x,this.Dk.y);a=(new pc(-b/this.Hi,-d/this.Hi)).multiply(a);b=this.rect.clone();b.transform(a);this.view.ze(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}(),Ne=function(){function c(a){this.view=a;this.state=0;this.log=u.create("MiddleButtonPan");this.start=new F(0,0);this.Dk=new F(0,0);this.rect=new G(0,0,
0,0)}c.prototype.Oe=function(){return 0!==this.state};c.prototype.Kd=function(a,b){switch(a){case "start-pan":0===this.state&&(this.log("Start panning due to key combo"),this.state=1,b.preventDefault());break;case "end-pan":this.state=0}};c.prototype.handleEvent=function(a){if(!this.view.ha.get("allowScroll"))return!1;var b=!1;if(1===this.state||0===this.state&&"down"===a.type&&a.buttons&4)this.start=new F(a.pageX,a.pageY),this.Dk=this.view.Pd(a.pageX,a.pageY),this.rect=this.view.Ub(),this.state=
1==this.state?3:2,b=!0;else{if(2===this.state&&0===(a.buttons&4))return this.state=0,!1;if(3===this.state||2==this.state)if("move"===a.type||"down"===a.type||"up"===a.type){b=new pc(-((a.pageX-this.start.x)/this.view.scale),-((a.pageY-this.start.y)/this.view.scale));var d=this.rect.clone();d.transform(b);this.view.ze(d);b=!0;"up"===a.type&&(this.state=0)}}return b};return c}();var Oe=function(c){function a(){var a=c.call(this)||this;a.vh=[];a.gh=0;a.canvas=null;a.ha=null;a.log=u.create("FORMAT",!0);return a}__extends(a,c);a.prototype.vm=function(){return 0<this.gh};a.prototype.Jt=function(a,d){for(var b=0;b<this.vh.length;b++){var c=this.vh[b];if(c.url===d&&c.jg===a)return b}return-1};a.prototype.yf=function(a,d,c){var b=this,e=this.Jt(a,d);-1===e?(e=this.vh.length,this.vh.push({jg:a,url:d,Ys:c,wF:!1}),this.gh+=1,lb.load(d,function(c){--b.gh;e=b.Jt(a,d);if(!(0>e)){var f=
b.vh[e];b.vh.splice(e,1);try{c?(b.log("Image request completed for item %s url %s",a,d.substr(0,64)),f.Ys(c,d)):b.log("Image request failed for url %s",d)}catch(n){console.log(n)}b.check()}})):this.vh[e].Ys=c};a.prototype.check=function(){this.vm()||this.ta("done")};a.prototype.yB=function(a,d){var b=this;this.gh++;var c=new de;c.wq(a).then(function(){c.ready&&d(c);b.gh--;b.check()},function(d){b.gh--;console.warn("Error loading %s: ",a,d);b.check()})};a.prototype.Ky=function(a,d){this.ta("convert-dom-request",
a,d)};a.prototype.qg=function(a){this.ta("reformat",a)};a.prototype.RC=function(a){this.ta("redraw",a)};a.prototype.nf=function(){if(null===this.canvas)return new G(0,0,0,0);var a=z(this.canvas).gc();return new G(a.left,a.top,this.canvas.width,this.canvas.height)};a.prototype.Bc=function(a){return this.ha?this.ha.get(a):null};return a}(sb);var Pe=function(){function c(a,b){this.De=a;this.key=b}c.prototype.toString=function(){return"LValue("+this.key+")"};return c}(),Qe=function(){function c(a,b,d){this.id=a;this.Bm=b;d&&(this.Bf=d)}c.prototype.Bf=function(){return this};c.prototype.Tu=function(a){return a};c.prototype.toString=function(){return"Token(id='"+this.id+"', lbp="+this.Bm+")"};return c}(),Re=function(){function c(a,b){return a[b]}function a(a,b,d){a[b]=d}function b(a){if(a instanceof Pe){if(a.De===A)return E(A,a.key);if(a.De)return a.De[a.key]}else return a}
function d(a,b){void 0===b&&(b=0);var d=K[a];d?d.Bm=Math.max(d.Bm,b):d=K[a]=new Qe(a,b);return d}function e(a,b){a=d(a);a.Bf=function(){return b};return a}function f(a){return new Qe("(literal)",0,function(){return a})}function h(a){var b=new Qe("(name)",0,function(){return new Pe(A,a)});b.toString=function(){return"Token(name: "+a+")"};return b}function k(a,d,c){l(a,d,function(a){return c(b(a),b(y(d-1)))})}function l(a,b,c){d(a,b).Tu=c}function n(a,c,e){d(a,c).Bf=function(){return e(b(y(c)))}}function r(a,
b,c){d(a,b).Bf=c}function v(a){return" "===a||"\t"===a||"\n"===a||"\r"===a}function x(){return ya<ka.length?ka[ya++]:K["(end)"]}function w(a){if(a&&Y.id!==a)throw Error("Error: expected "+a+" but got "+Y.id);return Y=x()}function y(a){var b=Y;Y=x();for(var d=b.Bf();a<Y.Bm;)b=Y,Y=x(),d=b.Tu(d);return d}var A={},E=c,M=a,K={},D=0,J,V;e("true",!0);e("false",!1);e("null",null);e("undefined",void 0);d("(end)");(function(a,d,c){l(a,d,function(a){return c(b(a),b(y(d)))})})(",",J=++D,function(a,b){return b});
l("=",V=++D,function(a){var d=y(V);if(!(a instanceof Pe))throw Error("Error: lhs of = must be assignable");d=b(d);if(a.De===A)M(A,a.key,d);else if(a.De instanceof Object)a.De[a.key]=d;else throw Error(a.De+"["+a.key+"] cannot be assigned to.");return d});k("&&",++D,function(a,b){return a&&b});k("||",++D,function(a,b){return a||b});k("|",++D,function(a,b){return a|b});k("^",++D,function(a,b){return a^b});k("&",++D,function(a,b){return a&b});k("===",++D,function(a,b){return a===b});k("!==",D,function(a,
b){return a!==b});k("==",D,function(a,b){return a==b});k("!=",D,function(a,b){return a!=b});k(">",++D,function(a,b){return a>b});k(">=",D,function(a,b){return a>=b});k("<",D,function(a,b){return a<b});k("<=",D,function(a,b){return a<=b});k("in",D,function(a,b){return a in b});k("<<",++D,function(a,b){return a<<b});k(">>",D,function(a,b){return a>>b});k(">>>",D,function(a,b){return a>>>b});k("+",++D,function(a,b){return a+b});k("-",D,function(a,b){return a-b});k("*",++D,function(a,b){return a*b});
k("/",D,function(a,b){return a/b});k("%",D,function(a,b){return a%b});n("!",++D,function(a){return!a});n("~",D,function(a){return~a});n("+",D,function(a){return+a});n("-",D,function(a){return-a});n("typeof",D,function(a){return typeof a});l(".",++D,function(a){var d=Y;if("(name)"!==d.id)throw Error("Error: '.' expects a name, not "+Y.id);if(a instanceof Pe)a.De=b(a),a.key=d.Bf().key;else if(a instanceof Object)a=new Pe(b(a),d.Bf().key);else throw Error("Error: '.' must be preceded by object");w();
return a});r("(",++D,function(){var a=y(0);w(")");return a});d(")");l("(",++D,function(a){var d=[];if(")"!==Y.id)for(;;){d.push(b(y(J+1)));if(","!==Y.id)break;w(",")}w(")");var c=null;a instanceof Pe&&(c=a.De);a=b(a);if("function"!==typeof a)throw Error("Tried to call a non-function; type was "+typeof a);return a.apply(c,d)});d(",");l("[",D,function(a){var d=y(0);if(!(a instanceof Pe))throw Error("Error: '[]' must be preceded by lvalue");w("]");a.De=b(a);a.key=b(d);return a});d("]");r("{",++D,function(){for(var a=
{};"}"!==Y.id;){if("(literal)"===Y.id)var d=Y.Bf();else if("(name)"===Y.id)d=Y.Bf().key;else throw Error("Bad {}; expecting name or string constant");w();w(":");a[d]=b(y(J+1));if(","!==Y.id)break;Y=w(",")}w("}");return a});r("[",D,function(){for(var a=[];"]"!==Y.id;){a.push(b(y(J+1)));if(","!==Y.id)break;Y=w(",")}w("]");return a});d(",");d(":");d("}");var wa=/(\d+(\.\d+)?)|(===|!==|==|!=|\+=|-=|&&|\|\||<=|>=|<<|>>>|>>|&&|\|\||[{}\(\)\[\]\+\-\.\*\/=!,\?&\|:%~<>])|([a-zA-Z\$_][\$_a-zA-Z0-9]*)|("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,
ka=[],ya=0,Y;return{parse:function(a){for(var b=[],d=0;d<a.length;){for(;v(a.charAt(d));)d++;wa.lastIndex=d;var c=wa.exec(a);if(c&&c.index===d)if(d+=c[0].length,c[1])b.push(f(parseFloat(c[1])));else if(c[3]&&c[3]in K)b.push(K[c[3]]);else if(c[4])switch(c[4]){case "true":case "false":case "null":case "in":case "typeof":case "undefined":b.push(K[c[4]]);break;default:b.push(h(c[4]))}else{if(c[5]){c=c[5].substr(1,c[5].length-2);for(var e="",k=!1,l=0;l<c.length;l++){var n=c[l];if(k){switch(n){case "n":n=
"\n";break;case "r":n="\r";break;case "t":n="\t"}e+=n;k=!1}else"\\"===n?k=!0:e+=n}b.push(f(e))}}else throw Error("Parse error: Expected stuff in "+a+" near: "+a.substr(d));}b.push(K["(end)"]);return b},evaluate:function(d,e,f,h){ya=0;ka=e;A=d;E=f||function(a,b){return a[b]};M=h||function(a,b,d){a[b]=d};Y=x();d=b(y(0));A={};E=c;M=a;return d}}}(),Se=Re.parse,Te=Re.evaluate;function Ue(c,a,b){try{return Te(c,Se(a),b)}catch(d){console.log("When evaluating: %s on scope ",a,c),console.log(d)}}
function Ve(c,a){if(c===a)return!0;if(!(c instanceof Object&&a instanceof Object)||c.constructor!==a.constructor)return!1;for(var b in c)if(c.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||c[b]!==a[b]&&("object"!==typeof c[b]||!Ve(c[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!c.hasOwnProperty(b))return!1;return!0}
var We=function(){function c(){this.Pf={};this.Wm=!1;this.qo=[];this.timeout=0}c.prototype.wc=function(a,b,d){a={scope:a,parsed:Se(b),mv:void 0,hv:d};b in this.Pf?this.Pf[b].push(a):this.Pf[b]=[a];this.check()};c.prototype.wE=function(a,b){if(a in this.Pf){for(var d=this.Pf[a],c=0;c<d.length;c++)if(d[c].hv===b){d.splice(c,1);break}0===d.length&&delete this.Pf[a]}};c.prototype.check=function(a){var b=this;this.Wm=!0;a&&this.qo.push(a);0===this.timeout&&(this.timeout=setTimeout(function(){for(var a=
0;10>a&&b.Wm;a++){b.Wm=!1;for(var c in b.Pf)for(var f=null,h=void 0,k=0;k<b.Pf[c].length;k++){var l=b.Pf[c][k];try{l.scope!==f&&(h=Te(l.scope,l.parsed),f=l.scope),Ve(l.mv,h)||(l.mv=h,l.hv(h),b.Wm=!0)}catch(n){console.log("Error when evaluating %s: ",c,n),console.log("Context was: %o",l.scope)}}h=b.qo;b.qo=[];for(f=0;f<h.length;f++)(0,h[f])()}b.timeout=0},0))};return c}();var Xe=u.create("Zeact"),Ze=function(){function c(a,b,d,c,f){this.Pk=a;this.scope=b;this.element=d;this.name=c;this.value=f}c.prototype.emit=function(a,b){this.Pk.ta(this.element,a,b)};c.prototype.listen=function(a,b,d){if(b instanceof EventTarget&&d)this.Pk.Ua(this.element,a,d,b);else if("function"===typeof b)this.Pk.Ua(this.element,a,b);else throw Error("listen: invalid arguments.");};c.prototype.watch=function(a,b){this.Pk.wc(this.scope,this.element,a,b)};c.prototype.eval=function(a){return Ye.Ll(this.scope,
a,this.element)};c.prototype.destructor=function(a){this.Pk.za(this.element,a)};return c}(),$e=function(){function c(){this.Sr=new We;this.nj={};this.Ee={};this.cc=new Ya;this.nx=1}c.prototype.kl=function(a){return a};c.prototype.Ta=function(){this.cc.Ta()};c.prototype.Cb=function(a,b,d){void 0===d&&(d=2);this.nj[a]={name:a,link:b,Ew:d}};c.prototype.dj=function(a,b){this.Ee[a.toUpperCase()]=b;"string"===typeof b.template&&(b.template=b.template.trim())};c.prototype.Ae=function(a,b){var d=this;this.Cb(a,
function(a,c,h,k){d.nn(a,function(){d.wc(a,c,k,function(d){b(c,d,a)})})})};c.prototype.wc=function(a,b,d,c){var e=this;this.Sr.wc(a,d,c);this.za(b,function(){e.Sr.wE(d,c)})};c.prototype.nn=function(a,b){a.hasOwnProperty("$issettled")?(b(),this.digest()):a.hasOwnProperty("$settledWaiters")?a.$settledWaiters.push(b):a.$settledWaiters=[b]};c.prototype.EB=function(a){if(!a.hasOwnProperty("$issettled")&&(a.$issettled=!0,a.$settledWaiters)){for(var b=a.$settledWaiters.length-1;0<=b;b--)a.$settledWaiters[b]();
delete a.$settledWaiters;this.digest()}};c.prototype.Ua=function(a,b,d,c){void 0===c&&(c=a);c.addEventListener(b,d);this.za(a,function(){c.removeEventListener(b,d)});a===c&&(a.zwibblerListeners||(a.zwibblerListeners={}),a.zwibblerListeners[b]||(a.zwibblerListeners[b]=[]),a.zwibblerListeners[b].push(d))};c.prototype.ta=function(a,b,d){var c=this;setTimeout(function(){c.rc(a,b,d)},0)};c.prototype.rc=function(a,b,d){if(a.zwibblerListeners&&b in a.zwibblerListeners)for(var c=0,f=a.zwibblerListeners[b];c<
f.length;c++){var h=f[c];try{h.call(a,d)}catch(k){console.log("Error while handling event "+b+": ",k)}}};c.prototype.za=function(a,b){a.zwibblerWatchers?a.zwibblerWatchers.push(b):a.zwibblerWatchers=[b]};c.prototype.detach=function(a){for(var b=a.firstChild;b;)this.detach(b),b=b.nextSibling;if(a.zwibblerWatchers){b=0;for(var d=a.zwibblerWatchers;b<d.length;b++)(0,d[b])();delete a.zwibblerWatchers}a.zwibblerListeners&&delete a.zwibblerListeners;a.vx&&delete a.vx;a.Uk&&delete a.Uk;delete a.Ce;delete a.Bg};
c.prototype.digest=function(a){this.Sr.check(a)};c.prototype.Hz=function(a,b){if(a=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase()))if(a=a[1],a in this.nj&&this.nj[a].Ew===b)return this.nj[a];return null};c.prototype.mB=function(a){return(a=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase()))&&this.nj[a[1]]};c.prototype.Ns=function(a,b,d,c){void 0===c&&(c=b);for(var e=b.parentNode,h=[],k=0;k<c.attributes.length;k++)h.push({name:c.attributes[k].name,value:c.attributes[k].value});for(k=0;k<h.length&&b.parentNode===
e;k++){c=h[k].name;var l=h[k].value,n=this.Hz(c,d);if(n&&n.Ew===d&&(c=n.link(a,b,c,l))&&c!==b)return{da:c,Nq:!0}}return{da:b,Nq:b.parentNode!==e}};c.prototype.fj=function(a,b,d,c){b=document.createElement(b);for(var e in d)b.setAttribute(e,d[e]);c&&(b.Mn=c);a=this.Mc(a,b);delete b.Mn;return a};c.prototype.Wx=function(a,b){var d=this,c=this.Ee[b.tagName];if(!c)return null;Xe("Attaching component %s",b.tagName);var f=c.template;if(f instanceof HTMLElement)var h=f.cloneNode(!0);else if("string"===typeof f)if("<"===
f[0]){Xe("Using elementsFromString to instantiate component");var k=z.Xo(f);if(0===k.length)throw Error("Component "+b.tagName+": Could not interpret as HTML: "+f);if(1<k.length)throw Error("Component "+b.tagName+": Should render as a single element, but got "+k.length);h=k[0]}else{Xe("Using querySelector to instantiate component");h=document.querySelector(f);if(null===h)throw Error("Component "+b.tagName+': querySelector("'+f+'") returned null');h=h.cloneNode(!0)}else throw Error("Component "+b.tagName+
": Could not interpret template "+f);f=null!==b.parentNode;null!==b.parentNode&&b.parentNode.replaceChild(h,b);var l=this,n={$emit:function(a,b){l.ta(h,a,b)},$emitNow:function(a,b){l.rc(h,a,b)},$listen:function(a,b){var d=this;l.Ua(h,a,function(a){b.call(d,a);l.digest()})},$destructor:function(a){l.za(h,a)},$watch:function(a,b){l.wc(n,h,a,b)}};if(b.Mn){k=b.Mn;for(var r in n)k[r]=n[r];n=k}this.kl(n);Object.defineProperty(n,"$element",{get:function(){return h}});Object.defineProperty(n,"$parent",{get:function(){return a}});
r=c.properties;var v={};r&&r.forEach(function(c){v[c]=1;var e=b.getAttribute(c);e&&d.nn(a,function(){Xe("Bind prop %s to %s",c,e);n[c]=Ue(a,e);d.wc(a,h,e,function(a){n[c]=a})})});h.lx=1;h.Bg=n;(r=h.querySelector("slot"))||(r=h);for(k=b.firstChild;k;){var x=k.nextSibling;r.appendChild(k);k.Ce=k.Ce||a;k=x}c.style&&this.cc.Qp(c.style);for(r=0;r<b.attributes.length;r++)if(x=b.attributes[r].name,k=b.attributes[r].value,!v[x]&&!this.mB(x))if("class"===x)for(x=0,k=k.split(" ");x<k.length;x++)h.classList.add(k[x]);
else{if("style"===x){var w=h.getAttribute("style");w&&(k=w+";"+k)}h.setAttribute(x,k)}Xe("apply directives from parent");for(r=1;2>=r;r++)if(k=this.Ns(a,h,r,b),f&&k.Nq)return{scope:n,node:k.da};Xe("apply directives from child");Xe("done applying");if(c.controller)try{c.controller(n,new Ze(this,n,h,"","")),this.digest()}catch(y){console.log(y),console.log("When running controller for %s",b.tagName)}return this.Mc(n,h)};c.prototype.Mc=function(a,b){var d=this;b=this.ls(b.Ce||a,b);this.digest(function(){d.EB(a)});
return b};c.prototype.ls=function(a,b){if(1===b.nodeType){if(b.Uk)return{node:b,scope:a};b.Uk=this.nx++;b.Ce=a;for(var d=0;2>=d;d++){var c=this.Ns(a,b,d);if(c.Nq)return{node:c.da,scope:a};if(0===d&&(c=this.Wx(a,b)))return c}for(d=b.firstChild;d;)c=d.nextSibling,d.lx||this.ls(d.Ce||a,d),d=c}return{node:b,scope:a}};return c}(),Ye;
(function(c){function a(a,b,d){var c=b.type?b.type.toLowerCase():"",e=d;if("zwibblerValue"in b)var f="zwibblerValue";else f="value",e=""+e;if("radio"===c)b.checked=b[f]===e;else if("checkbox"===c)b.checked=!!d;else{if("SELECT"===b.tagName){c=0;for(var h=b.querySelectorAll("option");c<h.length;c++){var v=h[c],x=v.getAttribute("z-value");if(x){if(Ue(v.Ce?v.Ce:a,x)===d){v.selected=!0;return}}else if(x=v.getAttribute("value")||v.textContent||v.outerHTML,x===e){v.selected=!0;return}}}else b.Bg&&(b.Bg.value=
d);b[f]=e}}function b(a,b){var d=b.type?b.type.toLowerCase():"";if("checkbox"===d)return"zwibblerValue"in b?b.zwibblerValue:b.checked;if("radio"===d)(a=b.getAttribute("name"))&&(a=document.querySelector('input[name="'+a+'"]:checked'))&&(b=a);else if("SELECT"===b.tagName){d=0;for(var c=b.querySelectorAll("option");d<c.length;d++){var e=c[d];if(e.selected){var f=e.getAttribute("z-value");if(f)return Ue(e.Ce?e.Ce:a,f)}}}else if(b.Bg)return b.Bg.value;return"zwibblerValue"in b?b.zwibblerValue:b.value}
function d(a,b,d,c,l){d&&(a["this"]=d);a.$event=c;return Ue(a,b,l)}c.CF=a;c.nA=b;c.Ll=d;c.zg=function(c){function e(a,b){var d=a.indexOf(b);return-1===d?"":a.substr(d+b.length+1)}var h=new $e;c&&(h.kl=c);h.Cb("init",function(a,b,c,e){d(a,e,b)});h.Ae("text",function(a,b){a.textContent=b});h.Ae("json",function(a,b){a.textContent=JSON.stringify(b)});h.Ae("html",function(a,b){a.innerHTML=b});h.Cb("model",function(d,c,e,f){function k(){l=b(d,c);Xe("input -> model: New value for %s: %s",f,l);d.anjnwjewaq=
l;Ue(d,f+"=anjnwjewaq");delete d.anjnwjewaq;h.digest()}var l=null;"checkbox"===c.type||"radio"===c.type?h.Ua(c,"change",k):c.Bg?h.wc(c.Bg,c,"value",k):h.Ua(c,"input",k);h.nn(d,function(){var b=c.getAttribute("z-value");b&&(h.wc(d,c,b,function(e){Xe("z-value for %s[%s] is %s",c.tagName,b,e);c.zwibblerValue=e;a(d,c,l)}),h.za(c,function(){delete c.zwibblerValue}));h.wc(d,c,f,function(b){Xe("model(%s) -> %s[%s] : new value is %s",f,c.tagName,c.type,b);l=b;a(d,c,b)})});"SELECT"===c.tagName&&h.Ua(c,"options-changed",
function(){setTimeout(function(){Xe("model(%s) -> %s[%s] due to <OPTION> creation",f,c.tagName,c.type);a(d,c,l)},1)})});h.Cb("on",function(a,b,c,f){var k=e(c,"on");""!==k&&h.Ua(b,k,function(c){Xe("Got %s, execute %s",k,f);var e=d(a,f,b,c);h.digest();c&&c.preventDefault&&!1===e&&c.preventDefault()})});var k={disabled:1,readonly:1};h.Cb("bind",function(a,b,d,c){var f=e(d,"bind").toLowerCase();""!==f&&h.wc(a,b,c,function(a){f in k?a?b.setAttribute(f,"TRUE"):b.removeAttribute(f):b.setAttribute(f,a);"value"===
f&&"SELECT"===b.tagName&&(b.value=a)})},1);h.Cb("for",function(a,b,d,c){d=c.indexOf(" in ");if(-1!==d){var e=c.substr(0,d),f=c.substr(d+4),k=[];Xe("z-for '%s' in '%s'",e,f);var l=b.parentNode,n=b.nextSibling;b.parentNode.removeChild(b);var r=[];h.wc(a,l,f,function(d){if("number"===typeof d){for(var c=[],v=0;v<d;v++)c.push(v);d=c}if("object"===typeof d&&null!==d&&"length"in d){for(v=c=0;v<Math.min(r.length,d.length);v++)if(Ve(r[v],d[v]))c+=1;else break;r=d.concat();for(v=2*c;v<k.length;v++){var x=
k[v];x.parentNode&&x.parentNode.removeChild(x);h.detach(x)}k.length=2*c;for(v=c;v<d.length;v++)c=document.createComment("z-for "+f+"["+v+"] = "+d[v]),l.insertBefore(c,n),k.push(c),c=Object.create(a),Object.defineProperty(c,"$parent",{get:function(){return a}}),c.$index=v,c[e]=d[v],x=b.cloneNode(!0),x.removeAttribute("z-for"),l.insertBefore(x,n),c=h.Mc(c,x).node,k.push(c);"OPTION"===b.tagName&&l.dispatchEvent(new CustomEvent("options-changed",{bubbles:!0}))}});h.za(l,function(){for(var a=0;a<k.length;a++){var d=
k[a];d.parentNode&&d.parentNode.removeChild(d);h.detach(d)}k.length=0;l.insertBefore(b,n);h.detach(b)})}},0);h.Cb("if",function(a,b,d,c){var e=document.createComment(d+" "+c),f=b.parentElement,k=null;f.replaceChild(e,b);h.wc(a,f,c,function(c){c&&!k?(k=b.cloneNode(!0),k.removeAttribute(d),f.replaceChild(k,e),k=h.Mc(a,k).node):!c&&k&&(h.detach(k),f.replaceChild(e,k),k=null)});h.za(f,function(){k?(h.detach(k),f.replaceChild(b,k)):e.parentNode&&f.replaceChild(b,e);h.detach(b)})},0);h.Ae("class",function(a,
b){for(var d in b)z(a).zr(d,b[d])});h.Ae("style",function(a,b){for(var d in b)a.style[d]=b[d]});h.Ae("selected",function(a,b){z(a).zr("selected",b)});h.Ae("disabled",function(a,b){b?a.setAttribute("disabled","true"):a.removeAttribute("disabled")});h.Ae("enabled",function(a,b){b?a.removeAttribute("disabled"):a.setAttribute("disabled","true")});h.Ae("hide",function(a,b){a.style.display=b?"none":""});h.Ae("checked",function(a,b){a.checked=b?!0:!1});h.Cb("ref",function(a,b,d,c){a[c]=b;h.za(b,function(){console.log("Destructor run");
a[c]===b&&delete a[c]})});return h}})(Ye||(Ye={}));var af=Ye;var bf={fontStyle:null,fontWeight:"normal",fontSize:12,fontFamily:"Times New Roman",colour:"black",align:"left",background:"none",underline:!1},cf={fontStyle:"fs",fontWeight:"fw",fontSize:"fh",fontFamily:"ff",colour:"fc",align:"ta",background:"fb",underline:"fu"},df=function(){function c(a){this.ua=a;this.options={}}c.prototype.tE=function(){var a=new c(this.ua),b;for(b in bf)bf.hasOwnProperty(b)&&(a.options[b]=this.get(b));return a};c.prototype.lE=function(){var a={},b;for(b in this.options)this.options.hasOwnProperty(b)&&
(a[b]=this.options[b]);return a};c.prototype.apply=function(a){a.fillStyle=this.get("colour");a.font=this.cA()};c.prototype.empty=function(){var a=0,b;for(b in this.options)this.options.hasOwnProperty(b)&&(a+=1);return 0===a};c.prototype.Ql=function(a,b){a=c.Ql(a,b);return a.empty()?this:a};c.prototype.Of=function(a){c.Of(this.options,a)};c.prototype.set=function(a,b){this.options[a]=b};c.prototype.get=function(a){return a in this.options?this.options[a]:this.ua[a]};c.prototype.has=function(a){return a in
this.options};c.prototype.eh=function(a){for(var b in a.options){var d=this.get(b),c=a.get(b);d!==c&&this.set(b,c)}};c.prototype.clone=function(){var a=new c(this.ua);a.eh(this);return a};c.prototype.cA=function(){var a=this.get("fontStyle"),b=this.get("fontWeight"),d=this.get("fontSize"),c=this.get("fontFamily"),f=[];a&&f.push(a);b&&f.push(b);f.push(d+"px");f.push(c);return f.join(" ")};c.prototype.dd=function(a){if(this===a)return!0;for(var b in this.options)if(!(b in a.options)||a.options[b]!==
this.options[b])return!1;for(b in a.options)if(!(b in this.options))return!1;return!0};c.prototype.mj=function(a){var b=new c(this.ua),d;for(d in bf)bf.hasOwnProperty(d)&&a.get(d)!==this.get(d)&&(b.options[d]=this.get(d));return b};c.prototype.toString=function(){var a=[],b;for(b in this.options)a.push(b+"="+this.options[b]);return a.join(",")};return c}();
(function(c){c.Ql=function(a,b){void 0===b&&(b="");var d=new c(bf);switch(b){case "B":d.set("fontWeight","bold");break;case "I":d.set("fontStyle","italic");break;case "U":d.set("underline",!0)}for(var e in a)if(b=a[e],"textDecoration"===e)d.set("underline",0<=b.indexOf("underline"));else if(""!==b)switch(e){case "fontStyle":case "fontFamily":case "fontWeight":case "background":d.set(e,b);break;case "fontSize":d.set(e,parseFloat(b)||2);break;case "textAlign":d.set("align",b);break;case "color":d.set("colour",
b)}return d};c.Of=function(a,b){for(var d in a){var c=a[d];switch(d){case "fontStyle":case "fontFamily":case "fontWeight":case "background":b[d]=c;break;case "fontSize":b[d]=c+"px";break;case "align":b.textAlign=c;break;case "colour":b.color=c;break;case "underline":b.textDecoration=c?"underline":""}}return b}})(df||(df={}));var ef=df;var ff=function(){function c(){this.Dq=null;this.Qm=[]}c.prototype.qr=function(){};c.prototype.Yo=function(){this.Qm.push("\n")};c.prototype.Ww=function(a){this.Dq=a=this.Dq?a.mj(this.Dq):a.tE();a=a.lE();for(var b in a)a.hasOwnProperty(b)&&this.Qm.push("/"+cf[b]+a[b]+";")};c.prototype.Xw=function(a){a=a.replace(/\//g,"//");this.Qm.push(a)};c.prototype.toString=function(){return this.Qm.join("")};return c}();
function gf(c,a){for(var b=0,d="",e="",f="",h=0;h<c.length;h++){var k=c.charAt(h);switch(b){case 0:"/"===k?b=1:d+=k;break;case 1:"/"===k?(d+=k,b=0):(--h,d.length&&(a("text",d.replace(/\/\//g,"/")),d=""),e="",b=2);break;case 2:e+=k;2===e.length&&(b=3,f="");break;case 3:";"===k?(a(e,f),b=0):f+=k}}d.length&&a("text",d.replace(/\/\//g,"/"))};var hf=u.create("InlineItem");var jf=function(c){function a(a,d){a=c.call(this,a)||this;a.text=d;return a}__extends(a,c);a.prototype.count=function(){return this.text.length};a.prototype.split=function(b){if(0<b&&b<this.text.length){var d=this.text.substr(b);this.text=this.text.substr(0,b);return new a(this.style.clone(),d)}return null};a.prototype.wj=function(a,d){d=this.text.charAt(d);return{width:a?a.measureText(d).width:0,height:this.style.get("fontSize"),Rj:0,jy:" "===d||"-"===d,ev:"\n"===d}};a.prototype.di=function(a,d){return this.text.substr(a,
d)};return a}(function(){function c(a){this.style=a;this.index=0}c.prototype.count=function(){return 1};c.prototype.Za=function(a){hf("Asked to set %s",a);this.style=this.style.clone();this.style.eh(a);hf("After merge: %s",this.style)};c.prototype.um=function(){};c.prototype.split=function(){return null};c.prototype.wj=function(){return{width:0,height:0,Rj:0,jy:!0,ev:!1}};c.prototype.di=function(){return""};return c}());var kf=u.create("TEXTSEQ"),lf=function(){function c(a){this.style=a;this.children=[];this.length=this.Lh=0;this.Ff=null}c.Ih=function(a){var b=new ef(bf),d=new c(b),e={},f;for(f in cf)cf.hasOwnProperty(f)&&(e[cf[f]]=f);gf(a,function(a,c){a in e?("fh"===a&&(c=parseFloat(c)),"null"===c&&(c=null),b.set(e[a],c)):"text"===a?d.append([new jf(b.clone(),c)]):kf("Bad key: %s",a)});return d};c.prototype.save=function(a,b,d){var c=!1;this.Nu(a,b,function(a,b,e){d.Ww(a.style);a=a.di(b,e);b=0;for(e=a.split("\n");b<
e.length;b++){var f=e[b];if(""===f){if(c||d.qr(),d.Yo(),c=!1,"\n"===a)break}else c||(d.qr(),c=!0),d.Xw(f)}});c&&d.Yo();return d};c.prototype.append=function(a){this.um(this.Lh,a)};c.prototype.um=function(a,b){kf("Insert %s item at index %s",b.length,a);var d,c=0;for(d=0;d<this.children.length;d++){var f=this.children[d];var h=f.count();if(c===a){kf("Found proper position");break}else if(c+h>a){kf("Splitting item from %s..(%s)..%s",f.index,a,f.index+h);this.dl(d,a-c);c=a;d+=1;break}c+=h}for(this.children.splice.apply(this.children,
[d,0].concat(b));d<this.children.length;d++)f=this.children[d],h=f.count(),kf("Bump item %s index %s->%s length=%s",d,f.index,c,h),f.index=c,c+=h,kf("   item %s: %s/%s",d,f.index,f.count());this.Lh=c;this.length=this.children.length;this.Ff=null};c.prototype.remove=function(a,b){var d=[];if(0===this.children.length)return d;this.xs(a);this.xs(a+b);for(var c=this.zj(a),f,h=c.item.index,k=c.index;k<this.children.length;k++){var l=this.children[k];f=l.count();h+f<=a+b?d.push(l):l.index=h-b;h+=f}this.children.splice(c.index,
d.length);this.length-=d.length;this.Lh-=b;this.Ff=null;return d};c.prototype.count=function(){return this.Lh};c.prototype.zj=function(a){for(var b=0,d=0;d<this.children.length;d++)if(b+=this.children[d].count(),b>a)return{index:d,item:this.children[d]};if(this.children.length)return{index:this.children.length-1,item:this.children[this.children.length-1]};throw Error("getItemAt() on empty sequence.");};c.prototype.dl=function(a,b){var d=this.children[a];if(b=d.split(b))b.index=d.index+d.count(),this.children.splice(a+
1,0,b),this.length+=1,kf("Split %s..%s..%s",d.index,b.index,b.index+b.count());return b};c.prototype.xs=function(a){var b=this.zj(a);b&&b.item.index<a&&this.dl(b.index,a-b.item.index)};c.prototype.hm=function(a){return 0===this.length?this.style:this.zj(a).item.style};c.prototype.ku=function(a,b){var d=[],c=0,f=0,h=null,k=0;if(0===b)return d.push({start:a,length:0,style:this.hm(a)}),d;for(var l=0;l<this.children.length;l++){var n=this.children[l];var r=n.count();k+=r;if(k>a){null===h&&(h=n.style,
c=n.index);var v=n.style.dd(h);v&&(f+=r);if(!v||k>=b)d.push({start:c,length:f,style:h}),c=n.index,f=0;if(k>=a+b)break}}return d};c.prototype.LD=function(a){for(var b=0;b<a.length;b++){var d=a[b];this.Za(d.style,d.start,d.length)}};c.prototype.Za=function(a,b,d){var c=0,f=b+d;kf("setStyle: %s:%s %s",b,d,a);for(d=0;d<this.children.length;d++){var h=this.children[d],k=h.count();c<b&&b<c+k?this.dl(d,b-c)?k=b-c:(h.Za(a),kf("Case 1")):b<=c&&f<c+k&&f>c?(this.dl(d,f-c),k=f-c,h.Za(a),kf("Case 2")):b<=c&&c+
k<=f&&(h.Za(a),kf("Case 3: fromChar=%s..%s count=%s..%s",b,f,c,c+k));c+=k}};c.prototype.eD=function(a,b,d){for(var c=b;;){b=this.wj(null,a);if(d(b)){a+=1;break}else if(0===a)break;--a}for(;;){b=this.wj(null,c);if(d(b))break;else if(c>=this.Lh-1)break;c+=1}return{start:a,length:c-a}};c.prototype.RA=function(a,b){return this.eD(a,b,function(a){return a.ev})};c.prototype.wj=function(a,b){if(0===this.length)throw Error("error: expected to have child items");if(null===this.Ff||b<this.Ff.index||b>=this.Ff.index+
this.Ff.count())this.Ff=this.zj(b).item;return this.Ff.wj(a,b-this.Ff.index)};c.prototype.di=function(a,b){var d="";this.Nu(a,b,function(a,b,c){console.log("Iterate: ",a,b,c);d+=a.di(b,c)});return d};c.prototype.Nu=function(a,b,d){var c=a+b;if(0!==b){var f=this.zj(a);if(f)for(b=f.item,f=f.index;a<c;){var h=Math.min(b.count(),c-a);d(b,a-b.index,h);a+=h;f+=1;if(f===this.children.length)break;b=this.children[f]}}};return c}();var mf=u.create("SpliceText"),nf=function(c){function a(a,d,e,f,h){var b=c.call(this)||this;b.fc=a;b.text=d;b.start=e;b.length=f;b.style=h;b.Cf=[];return b}__extends(a,c);a.prototype.eh=function(b){if(!(b instanceof a))return!1;mf("?merge(%s,%s,%s) and (%s,%s,%s)",this.start,this.length,this.text.substr(0,5),b.start,b.length,b.text.substr(0,5));return 0===this.length&&0===b.length&&this.start+this.text.length===b.start&&(null===this.style&&null===b.style||null!=this.style&&null!==b.style&&this.style.dd(b.style))?
(this.text+=b.text,mf("Merging SpliceTextAction"),!0):0!==this.text.length||0!==b.text.length||this.start!==b.start&&b.start+b.length!==this.start?!1:(this.length+=b.length,this.start<b.start?this.Cf=this.Cf.concat(b.Cf):(this.Cf=b.Cf.concat(this.Cf),this.start=b.start),mf("Merging Deletes"),!0)};a.prototype.sc=function(){mf("Execute SpliceTextAction(del=%s/%s insert %s...)",this.start,this.length,this.text.substr(0,5));this.fc.Xj(this.start);0<this.length&&(mf("Removing text"),this.Cf=this.fc.text.remove(this.start,
this.length));if(0<this.text.length){if(null===this.style)throw Error("style is null");var a=new jf(this.style,this.text);this.fc.text.um(this.start,[a])}};a.prototype.Xc=function(){mf("Undo SpliceTextAction(del=%s/%s insert %s)",this.start,this.length,this.text);0<this.text.length&&this.fc.text.remove(this.start,this.text.length);this.Cf.length&&this.fc.text.um(this.start,this.Cf);this.fc.Xj(this.start)};return a}(hb);var of=u.create("UNDO"),pf=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.fc=a;b.from=d;b.length=e;b.style=f;b.qq=[];return b}__extends(a,c);a.prototype.sc=function(){of("Do apply style");this.fc.Xj(this.from);this.qq=this.fc.text.ku(this.from,this.length);this.fc.text.Za(this.style,this.from,this.length)};a.prototype.Xc=function(){of("Undo apply style");console.log(this.qq);this.fc.Xj(this.from);this.fc.text.LD(this.qq)};a.prototype.eh=function(){return!1};return a}(hb);var qf=u.create("TextEditor"),rf=function(c){function a(a,d){var b=c.call(this)||this;b.nd=a;b.ua=d;b.Vi=0;b.Qh=0;b.Vf=null;b.tl=0;b.active=!1;b.text=new lf(d);return b}__extends(a,c);a.prototype.setActive=function(a){this.active=a;qf("setActive: %s",this.active)};a.prototype.Oe=function(){return this.active};a.prototype.Gj=function(){return Math.min(this.Vi,this.Qh)};a.prototype.Fj=function(){return Math.max(this.Vi,this.Qh)};a.prototype.save=function(a,d){void 0===a&&(a=0);void 0===d&&(d=this.text.length);
return this.text.save(a,d,new ff).toString()};a.prototype.gu=function(){return this.text.count()};a.prototype.jd=function(a,d){void 0===d&&(d=a);this.Qh=a;this.Vi=d;this.cg("selchange")};a.prototype.ub=function(){this.jd(0,0)};a.prototype.exec=function(a,d){var b=this.Qh;switch(a){case "bold":this.xn("fontWeight","bold","normal");return;case "italic":this.xn("fontStyle","italic","normal");return;case "underline":this.xn("underline",!0,!1);return;case "orange":this.xn("background","orange","transparent");
return;case "undo":qf("Processing undo");this.nd.Xc(this);this.jd(b);return;case "redo":qf("Processing redo");this.nd.ye(this);this.jd(b);return;case "font":this.ll("fontFamily",d);return;case "fontSize":"string"===typeof d&&(d=parseFloat(d)||2);this.ll("fontSize",d);return;case "align":this.ll("align",d);break;case "delete":qf("Delete text");this.Kq(!1);return;case "backspace":qf("Delete text backspace");this.Kq(!0);return;case "select-none":this.jd(b,b);return;case "select-all":this.jd(0,this.gu());
return}this.pg()};a.prototype.xn=function(a,d,c){var b=this.Gj();b=this.text.ku(b,this.Fj()-b);for(var e,k=0;k<b.length&&(e=b[k].style,e.get(a)===d);k++);this.ll(a,k<b.length?d:c)};a.prototype.Eu=function(a){var b=this.Gj(),c=this.Fj()-b;a=a.replace("\r","\n");qf("Delete %s/%s Insert char %s...",b,c,a.substr(0,5));if(this.Vf&&this.tl===b&&0===c){var f=this.Vf;qf("Using recording caret style: %s",f)}else f=0===c&&0<b?this.text.hm(b-1):this.text.hm(b);this.nd.wa(new nf(this,a,b,c,f),!1,this);this.jd(b+
a.length,b+a.length);this.Vf=null};a.prototype.ll=function(a,d){if("string"===typeof a){var b=new ef(bf);b.set(a,d||"")}else b=a;if(b.empty())qf("apply empty style; ignore");else{a=this.Gj();d=this.Fj();var c=[];if(b.has("align")){var h=new ef(bf);h.set("align",b.get("align"));var k=this.text.RA(a,d);0<k.length&&(qf("Apply paragraph style to %s:%s %s",k.start,k.start+k.length,b),c.push(new pf(this,k.start,k.length,h)))}qf("applystyle called set %s:%s %s",a,d,b);a!==d?c.push(new pf(this,a,d-a,b)):
(this.Vf=null===this.Vf||this.tl!==a?this.text.hm(a).clone():this.Vf.clone(),this.Vf.eh(b),this.tl=a,qf("Recording new caret style: %s",this.Vf));this.nd.wa(c,!1,this)}};a.prototype.Kq=function(a){var b=this.Gj(),c=this.Fj()-b;qf("Delete %s characters (totalCount=%s)",c,this.text.count());c?(this.nd.wa(new nf(this,"",b,c,null),!1,this),this.jd(b)):a&&0<b?(this.nd.wa(new nf(this,"",b-1,1,null),!1,this),this.jd(b-1)):b<this.text.count()&&this.nd.wa(new nf(this,"",b,1,null),!1,this);this.tl=-1};a.prototype.WA=
function(){var a=this.Gj(),d=this.Fj()-a;qf("getSelectedText()=%s",this.text.di(a,d));return this.text.di(a,d)};a.prototype.gk=function(a){var b=this;if(this.active)switch(qf("Received clipboard event: %s",a.type),a.type){case "copy":case "cut":qf("Cut/Copy to system clipboard.");var c=this.WA();qf("text=%s",c);c.length&&(a.clipboardData.setData("text/plain",c),a.preventDefault(),"cut"===a.type&&this.Kq(!1));break;case "paste":for(qf("There are %s items on the clipboard",a.clipboardData.items.length),
c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];qf("Item [%s] type is %s",c,f.type);"text/plain"===f.type&&f.getAsString(function(a){b.Eu(a)})}}};a.prototype.Xj=function(){};a.prototype.pg=function(){};return a}(sb);var sf=u.create("HTMLTextEditor"),xf=function(c){function a(a,d,e){void 0===e&&(e={});var b=c.call(this,new ib,(new ef(bf)).Ql(window.getComputedStyle(d),d.tagName))||this;b.da=d;b.options=e;b.gd=new tb;b.QD(a);a.addEventListener(document,"selectionchange",function(){b.gC()});a.addEventListener(document,"cut",function(a){b.gk(a)});a.addEventListener(document,"copy",function(a){b.gk(a)});a.addEventListener(document,"paste",function(a){b.gk(a)});tf(b.text,d,b.ua);b.pg();b.pa("reformat",function(){b.pg()});
return b}__extends(a,c);a.prototype.sw=function(a){this.da.innerHTML=a;this.text=new lf(this.ua);tf(this.text,this.da,this.ua);z(this.da).clear();a=this.text;var b=this.da,c=this.ua;a.save(0,a.count(),new uf(b,c));this.jd(0,0)};a.prototype.QD=function(a){var b=this;this.gd.map("ctrl+b,cmd+b","bold");this.gd.map("ctrl+i,cmd+i","italic");this.gd.map("ctrl+u,cmd+u","underline");this.gd.map("ctrl+z,cmd+z","undo");this.gd.map("ctrl+shift+z,cmd+shift+z","redo");this.gd.map("delete","delete");this.gd.map("backspace",
"backspace");this.gd.pa("*",function(a,d){sf("Keyboard event: ",a);d.preventDefault();d.stopPropagation();b.exec(a)});this.gd.Ss(this.da);a.add(function(){b.gd.detach(b.da)});a.addEventListener(this.da,"keypress",function(a){var d=a.charCode;13===d&&b.options.ir&&!a.shiftKey?b.ta("enter"):(b.Eu(String.fromCharCode(d)),a.preventDefault(),b.pg())})};a.prototype.setActive=function(a){c.prototype.setActive.call(this,a);a?(this.da.setAttribute("contenteditable","TRUE"),this.da.focus()):(this.da.setAttribute("contenteditable",
"FALSE"),this.da.blur())};a.prototype.gC=function(){if(this.active){var a=document.getSelection();if(null===a)this.ub();else if(null===a.focusNode||null===a.anchorNode)this.ub();else if(a.anchorNode===this.da)sf("Select-all %s..%s",0,this.text.length),c.prototype.jd.call(this,0,this.text.count());else{var d=vf(this.da,a.anchorNode,a.anchorOffset);a=vf(this.da,a.focusNode,a.focusOffset);-1!==d&&-1!==a&&(0===this.text.count()&&(a=d=0),a!==this.Qh||d!==this.Vi)&&(c.prototype.jd.call(this,a,d),sf("Selected %s..%s",
d,a))}}};a.prototype.jd=function(a,d){void 0===d&&(d=a);sf("self-set caret position: %s..%s",d,a);c.prototype.jd.call(this,a,d);var b=wf(this.da,a),f=wf(this.da,d),h=document.createRange();d<=a?(h.setStart(f.node,f.offset),h.setEnd(b.node,b.offset)):(h.setStart(b.node,b.offset),h.setEnd(f.node,f.offset));if(a=window.getSelection())a.removeAllRanges(),a.addRange(h)};a.prototype.Xj=function(a){sf("Mark for reformat: %s",a);this.cg("reformat")};a.prototype.pg=function(){z(this.da).clear();var a=this.text,
d=this.da,c=this.ua;a.save(0,a.count(),new uf(d,c));this.options.placeholder&&0===this.text.count()&&(a=z("div").Za({opacity:"0.5"}).ug(this.options.placeholder).Vd(this.da).da,this.ua.Of(a.style));this.jd(this.Qh,this.Vi)};a.prototype.exec=function(a,d){c.prototype.exec.call(this,a,d);this.pg()};return a}(rf);
function vf(c,a,b){function d(c){if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));if(c===a)return c instanceof Element&&c.children[0]&&"BR"===c.children[0].tagName&&1===b&&--e,h=!0;"DIV"===c.tagName&&(f=!0);for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){if(c===a)return h=!0;c=yf(c.nodeValue,f);e+=c.length;c.length&&(f=!1)}return!1}var e=0,f=!0,h=!1;for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return h?e+b:-1}
function wf(c,a){function b(c){d=c;f=0;if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));"DIV"===c.tagName&&(h=!0);for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){c=yf(c.nodeValue,h);if(e+c.length>=a)return f=a-e,!0;e+=c.length;c.length&&(h=!1)}return!1}var d=c,e=0,f=0,h=!0;for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return{node:d,offset:f}}
function yf(c,a){for(var b="",d=0;d<c.length;d++){var e=c[d];switch(e){case " ":case "\n":case "\r":case "\t":a||(b+=" ",a=!0);break;default:b+=e,a=!1}}return b}
function tf(c,a,b){function d(a,b){if(a.nodeType===Node.ELEMENT_NODE){switch(a.tagName){case "DIV":case "P":l||(f+="\n"),l=!1}"DIV"===a.tagName&&(n=!0);a instanceof HTMLElement&&(b=b.Ql(a.style,a.tagName));for(a=a.firstChild;a;)d(a,b),a=a.nextSibling}else a.nodeType===Node.TEXT_NODE&&(h.dd(b)||(e(h),h=b),b=yf(a.nodeValue,n),f+=b,b.length&&(n=!1))}function e(a){f.length&&(k.push(new jf(a,f)),f="")}var f="",h=b,k=[],l=!0,n=!0;for(a=a.firstChild;a;)d(a,b),a=a.nextSibling;e(h);k.length&&c.append(k)}
var uf=function(){function c(a,b){this.root=a;this.ak=this.mt=b;this.span=this.va=null;this.offset=0;this.style=b}c.prototype.Ww=function(a){sf("writeStyle("+a.toString());this.ak=a};c.prototype.qr=function(){sf("startLine");this.va=document.createElement("DIV");this.root.appendChild(this.va);this.va.setAttribute("t-off",this.offset.toString());this.va.style.whiteSpace="pre-wrap";this.style=this.mt;this.va.style.fontSize=this.ak.get("fontSize")+"px"};c.prototype.Yo=function(){sf("endLine");if(!this.va)throw Error("Expected div to exist");
null===this.va.firstChild&&this.va.appendChild(document.createElement("BR"));this.span=this.va=null;this.offset+=1};c.prototype.Xw=function(a){sf("writeText("+a+")");if(!this.va)throw Error("Expected div to exist");null!==this.span&&this.style.dd(this.ak)||(this.span=document.createElement("SPAN"),this.va.appendChild(this.span),this.ak.Of(this.span.style),this.style=this.ak);this.span.appendChild(document.createTextNode(a));this.offset+=a.length};return c}();function zf(c,a,b,d){c.fillStyle=q.Lc;c.fillRect(a,b,d,d);c.beginPath();c.strokeStyle=q.Oa;c.moveTo(a,b);c.lineTo(a+d,b+d);c.moveTo(a+d,b);c.lineTo(a,b+d);c.stroke()}function Af(c,a,b,d){for(var e,f=0;f<d;f+=5){e=0===f/5%2;for(var h=0;h<d;h+=5)c.fillStyle=e?q.Oa:q.Lc,e=!e,c.fillRect(a+h,b+f,5,5)}e=c.createLinearGradient(a+d,b+d,a,b);e.addColorStop(0,"rgba(255, 255, 255, 1.0)");e.addColorStop(1,"rgba(255, 255, 255, 0.0)");c.fillStyle=e;c.fillRect(a,b,d,d)}
function Bf(c){for(var a=[],b=[],d=[],e=0,f=0;360>f;f++){var h=new q(q.Fh,[f,1,1,1]);a.push(h);0<f&&(h=a[f-1].ez(h),b.push(h),e+=h)}e/=c;f=0;d.push(a[0]);for(h=1;h<a.length;h++){var k=b[h-1];f+k>=e&&(f-=e,d.push(a[h]));f+=k}d.length=c;return d}
function Cf(c,a,b){function d(a,d){if(a.target instanceof HTMLElement){var c=a.target.getAttribute("zwibbler-color")||"";if("opacity-50"===c)b.onOpacity(.5,!d);else if(c)b.onColour(c,!d);a.preventDefault()}}function e(a,b,d){return z("div",{"zwibbler-color":d,tabindex:"0"}).Za({width:b+"px",height:b+"px",display:"inline-block"}).Vd(a)}function f(a,b,d){var c=document.createElement("canvas");c.width=a;c.height=a;b(c.getContext("2d"),0,0,a);a=e(h,a,d);a.da.style.backgroundImage="url("+c.toDataURL()+
")";a.da.style.backgroundPosition="center";return a}void 0===b&&(b={});var h=z.tc(c),k=b.columns||16;c=b.rows||k;if(h){var l=new ve(h,{CE:!1});h.addEventListener("contextmenu",function(a){a.preventDefault()});l.pa("tap hold",function(a){d(a.qb,"hold"===a.type||1<a.buttons)});h.addEventListener("keydown",function(a){13===a.keyCode&&(d(a,!1),this.click())});f(a,zf,"transparent");f(a,Af,"opacity-50");for(l=0;1>=l;l+=1/(k-3)){var n=(new q(q.Fh,[0,0,Math.pow(l,1/2.2),1])).toString();e(h,a,n).Za({backgroundColor:n})}k=
Bf(k);for(l=1;l>1/(c-1);l-=1/c){n=0;for(var r=k;n<r.length;n++){var v=r[n];v.values[1]=1;v.values[2]=Math.pow(l,1/2.2);e(h,a,v.toString()).Za({backgroundColor:v})}}}}
(function(){function c(a,b){var d=this;this.Tm=null;var c=document.createElement("div");c.style.width="320px";c.style.lineHeight="0";c.style.position="absolute";b.appendChild(c);Cf(c,20,{onColour:function(a,b){d.Tm&&d.Tm.resolve({type:"colour",value:a,fill:b})}});this.Ro=Dd(c);a.add(function(){d.Ro&&d.Ro.destroy()})}c.prototype.show=function(a,b){this.Tm=new Xb;this.Ro.show(a,b,!0);return this.Tm};return c})();var Df=new (function(){function c(){this.cp={}}c.prototype.ml=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.ml()?window.localStorage.setItem(a,b):this.cp[a]=""+b};c.prototype.getItem=function(a){return this.ml()?window.localStorage.getItem(a):this.cp[a]};c.prototype.removeItem=function(a){this.ml()?window.localStorage.removeItem(a):delete this.cp[a]};return c}());var Ff=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.Vc=[];this.fonts={};this.images=[];this.zn={};this.uc=1;this.Gy=!0;this.page={};this.log=u.create("PdfWriter");this.ti=this.object("Pages",{Kids:[],Count:0});this.py=this.object("Catalog",{Pages:this.ti._id+" 0 R"});this.Gi()}c.prototype.oB=function(){if(null!==c.co)return c.co;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.co=
b;this.log("JPEG supported: %s",b);return b};c.prototype.Gi=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.y);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.ti._id+" 0 R"});this.ti.Kids.push(this.page._id+" 0 R");this.ti.Count+=1;this.zn={}};c.prototype.object=function(a,b){var d=this.Vc.length+1;a&&(b.Type=a);b._id=d;this.Vc.push(b);return b};c.prototype.Rx=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.Gy){var b=Gb.zg("LZWEncoder");b.Vw(a);b.flush();a=b.Vg().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.DE=function(a){if(!(a in this.fonts)){var b="F"+this.uc;this.uc+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Vk("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.Rw=function(a,b){var d=""+a+"-"+b;if(!(d in this.zn)){var c="gs"+this.uc;this.uc+=1;var f=this.object("ExtGState",{_name:c});b?f.ca=this.be(a):f.CA=this.be(a);this.zn[d]=c;this.Vk("ExtGState",f)}return this.zn[d]};c.prototype.Vk=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.$n=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].Mj===a&&b===this.images[d].zu)return this.images[d].fk;return null};c.prototype.Fn=function(a,b){var d,c=this.$n(a);if(!c){var f="I"+this.uc;this.uc+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));b=c.getContext("2d").getImageData(0,0,c.width,c.height);var h=!1;if(this.oB()){this.log("Using JPEG encoding");var k="[/DCTDecode]";var l=Gb.zg("");
for(d=0;d<b.data.length;d+=4)h=h||255>b.data[d+3];d=c.toDataURL("image/jpeg");var n=atob(d.split(",")[1]);for(d=0;d<n.length;d++)l.Ib(n.charCodeAt(d))}else{this.log("Using LZW encoding");k="[/LZWDecode]";l=Gb.zg("LZWEncoder");for(d=0;d<b.data.length;d+=4)l.Ib(b.data[d]),l.Ib(b.data[d+1]),l.Ib(b.data[d+2]),h=h||255>b.data[d+3];var r="[ <</EarlyChange 0 >> ]"}l.flush();l=l.Vg().toString();f=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:l.length,Interpolate:"true",Filter:k,_name:f,_stream:l});r&&(f.DecodeParms=r);if(h){l=Gb.zg("LZWEncoder");for(d=0;d<b.data.length;d+=4)l.Ib(b.data[d+3]);l.flush();l=l.Vg().toString();r=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:l.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:l});f.SMask=r._id+" 0 R"}this.images.push({Mj:a,zu:"",fk:f});c=f}this.Vk("XObject",c);return"/"+c._name};c.prototype.Gn=
function(a,b){var d=Ef(a.Na),c=this.$n(d,b.toString());if(!c){c="P"+this.uc;this.uc+=1;this.Fn(d,a.Na);d=this.$n(d);var f=new H(a.Na.width,0,0,-a.Na.height,0,a.Na.height);f=b.multiply(f);var h="1",k="1",l=b.vb();l=Math.max(l.x,l.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)h=""+Math.ceil(this.width/a.Na.width/l);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)k=""+Math.ceil(this.height/a.Na.height/l);c=this.object("Pattern",{_name:c,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:h,YStep:k,Matrix:"[ "+this.be(f.m11,f.m21,f.m12,f.m22,f.Fa,f.Ga)+"]",Resources:"<< /XObject << /"+d._name+" "+d._id+" 0 R >> >>"});c._stream="/"+d._name+" Do";this.images.push({Mj:a.Na,zu:b.toString(),fk:c})}this.Vk("Pattern",c);return"/"+c._name};c.prototype.th=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.Vc.length;d++)this.Bs(a,b,this.Vc[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.Vc.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.Vc.length;d++){for(var f=""+b[d];10>f.length;)f="0"+f;a.push(f+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.Vc.length+1)+"\n");a.push("   /Root "+this.py._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.th(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.Bs=function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var h=d[e];"object"===typeof h&&"[object Array]"===Object.prototype.toString.apply(h)?a.push("[ "+h.join(" ")+" ]"):"object"===typeof h?this.Bs(a,b,h,!0):a.push(h);a.push("\n")}c&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.zz=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.be=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.co=null;return c}(),Gf=function(c){function a(a,d){var b=c.call(this)||this;b.Lz=d;b.path=[];b.x=0;b.y=0;b.Fv=[];b.lh="";b.rh="";b.qh=-1;b.ph=
"";b.oh="";b.nh="";b.mh="";b.kh=-1;b.log=u.create("PDFContext");b.Ef=a.clone();b.Ef.transform(new rc(.75,.75,0,0));b.Lb=new Ff(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle=q.Oa;b.strokeStyle=q.Oa;b.ys=b.Dx;b.ws();return b}__extends(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.Fv.push({lh:this.lh,rh:this.rh,qh:this.qh,ph:this.ph,oh:this.oh,nh:this.nh,mh:this.mh,kh:this.kh})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.Fv.pop();a&&(this.stream.push("Q"),this.lh=a.lh,this.rh=a.rh,this.qh=a.qh,this.ph=a.ph,this.oh=a.oh,this.nh=a.nh,this.mh=a.mh,this.kh=a.kh)};a.prototype.Gi=function(a){var b=new rc(.75,.75,0,0);a&&(this.Ef=a.clone(),this.Ef.transform(b));this.Zo();this.Lb.Gi(this.Ef.x,this.Ef.y,this.Ef.width,this.Ef.height);this.ws();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.ws=function(){this.log("Start page: %s",this.Ef);this.setTransform(1,0,0,1,0,0);this.rh=
this.lh="";this.qh=-1;this.mh=this.nh=this.oh=this.ph="";this.kh=-1};a.prototype.Zo=function(){this.stream.length&&this.Lb.Rx(this.Lb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.Kw=function(){this.Zo();for(var a=this.Lb.th(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);return d};a.prototype.toString=function(){throw Error("Do not call PdfContext.toString()");};a.prototype.toBlob=function(){this.Zo();return this.Lb.toBlob()};a.prototype.setTransform=function(a,
d,c,f,h,k){var b=this.Ef.ne();this.ra=(new H(a,c,d,f,h,k)).multiply(new sc(0,b.x,b.y)).multiply(new rc(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};a.prototype.fill=function(){this.fo();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.ho();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.ra.apply(a,d);this.path.push(this.Lb.be(b.x,
b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.ra.apply(a,d);this.path.push(this.Lb.be(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){a=this.ra.apply(a,d);c=this.ra.apply(c,f);f=this.ra.apply(h,k);this.path.push(this.Lb.be(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=h;this.y=k};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.ys(a,
d,c,0)};a.prototype.strokeText=function(a,d,c){this.ys(a,d,c,1)};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.fo=function(){if(this.lh!==this.fillStyle){if(this.fillStyle instanceof Rd){var a=this.Lb.Gn(this.fillStyle,this.ra);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=q.lf(this.fillStyle).Th(q.RGBA),this.stream.push(this.Lb.be(a.values[0],a.values[1],
a.values[2])+" rg"),a=this.Lb.Rw(a.values[3],!0),this.stream.push("/"+a+" gs"));this.lh=this.fillStyle}};a.prototype.ho=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.rh!==this.strokeStyle){if(this.strokeStyle instanceof Rd){var c=this.Lb.Gn(this.strokeStyle,this.ra);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=q.lf(this.strokeStyle).Th(q.RGBA),this.stream.push(this.Lb.be(c.values[0],
c.values[1],c.values[2])+" RG"),c=this.Lb.Rw(c.values[3],!1),this.stream.push("/"+c+" gs"));this.rh=this.strokeStyle}this.qh!==this.lineWidth&&(this.qh=this.lineWidth,this.stream.push(this.Lb.be(72*this.lineWidth/96)+" w"));this.ph!==this.lineJoin&&(this.ph=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.oh!==this.lineCap&&(this.oh=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.Ex=function(a,d,c,f){var b=this.bl(this.font);if(this.nh!==b.fontSize||this.mh!==b.fontFamily){var e=
this.Lb.DE(b.fontFamily);this.stream.push(e+" "+this.Lb.be(parseFloat(b.fontSize))+" Tf");this.nh=b.fontSize;this.mh=b.fontFamily}this.kh!==f&&(this.stream.push(f+" Tr"),this.kh=f);0===f?this.fo():this.ho();this.stream.push("BT");d=this.ra.multiply(new H(1,0,0,-1,d,c));this.stream.push(this.Lb.be(d.m11,d.m21,d.m12,d.m22,d.Fa,d.Ga)+" Tm");this.stream.push(this.Lb.zz(a)+" Tj");this.stream.push("ET")};a.prototype.Dx=function(a,d,c,f){var b=this.bl(this.font),e=this.Lz.get(b.fontFamily);e?(0===f?this.fo():
this.ho(),this.beginPath(),e.rz(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.Ex(a,d,c,f)};a.prototype.bl=function(a){var b="",c="",f="normal",h="normal",k="normal",l="normal";a=a.split(/\s+/);a:for(;;){var n=a.shift();if(!n)break;switch(n){case "normal":break;case "italic":case "oblique":f=n;break;case "small-caps":k=n;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":h=n;break;
default:if(""===c)n=n.split("/"),c=n[0],1<n.length&&(l=n[1]);else{b=n;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,fontVariant:k,fontWeight:h,fontSize:c,lineHeight:l,fontFamily:b}};a.prototype.Yn=function(a,d,c,f,h,k,l,n,r){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,h,k,l,n,r);l+=r;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=Ef(a,d,c,f,h);b=this.Lb.Fn(a,b);this.stream.push("q");k=this.ra.multiply(new H(n,
0,0,-r,k,l));this.stream.push(this.Lb.be(k.m11,k.m21,k.m12,k.m22,k.Fa,k.Ga)+" cm");this.stream.push(b+" Do");this.stream.push("Q")};a.prototype.th=function(){return this.Lb.th()};a.prototype.bo=function(){return{}};a.prototype.eo=function(){};a.prototype.clip=function(){for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("W");this.stream.push("n");this.path.length=0};return a}(Ud);
function Ef(c){for(var a=[],b=1;b<arguments.length;b++)a[b-1]=arguments[b];return c instanceof HTMLCanvasElement?a.join("-")+c.toDataURL():a.join("-")+c.src};var Hf=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.As(a,"");return a.join("")};c.prototype.As=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.os(""+this.attributes[d])),
a.push('"')));if(this.children.length||""!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].As(a,b+"  ");""!==this.text&&a.push(b+"  "+this.os(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.sk=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.zd=function(a){this.children.push(a)};
c.prototype.os=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var If=function(){function c(){this.fa=[]}c.prototype.lineTo=function(a,b,d){this.fa.push({bj:"L",si:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){this.fa.push({bj:"M",si:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,c,f){this.fa.push({bj:"Q",si:a.apply(b,d),Rm:a.apply(c,f)})};c.prototype.bezierCurveTo=function(a,b,d,c,f,h,k){this.fa.push({bj:"C",si:a.apply(b,d),Rm:a.apply(c,f),yq:a.apply(h,k)})};c.prototype.closePath=function(){this.fa.push({bj:"Z"})};c.prototype.yr=function(a){a=
a.inverse();for(var b="",d=0;d<this.fa.length;d++){var c=this.fa[d];0<d&&(b+=" ");b+=c.bj;if(c.si){var f=a.apply(c.si.x,c.si.y);b+=f.x+","+f.y;c.Rm&&(f=a.apply(c.Rm.x,c.Rm.y),b+=","+f.x+","+f.y,c.yq&&(c=a.apply(c.yq.x,c.yq.y),b+=","+c.x+","+c.y))}}return b};return c}(),Jf=function(c){function a(a){var b=c.call(this)||this;b.ra=new H;b.fa=[];b.path=new If;b.Hg="";b.Vc=[];b.uc=0;b.log=u.create("SvgContext");b.Qi=1;b.Kh=2;b.Sn=4;b.log("SVG context rect: %s",a);b.root=new Hf("svg",{xmlns:"http://www.w3.org/2000/svg",
"xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.El=new Hf("defs",{});b.root.zd(b.El);b.groups=[b.root];return b}__extends(a,c);a.prototype.CB=function(){return"clip"+this.uc++};a.prototype.kk=function(a){a=new Hf("g",a||{});this.Oo().zd(a);this.groups.push(a)};a.prototype.jk=function(){var a=this.groups.pop();if(a&&1===a.children.length){var d=a.children[0];
d.sk(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.Oo=function(){return this.groups[this.groups.length-1]};a.prototype.node=function(a,d,c,f){function b(a,b){if(b instanceof Rd)c[a]="url(#"+e.Gn(b)+")";else if("string"===typeof b){b=q.lf(b);var d=b.values[3];1>d&&(b.values[3]=1,c[a+"-opacity"]=""+d);c[a]=b.toString()}}void 0===c&&(c={});var e=this;this.ra.Iu()||(c.transform="matrix("+this.ra.m11+" "+this.ra.m21+" "+this.ra.m12+" "+this.ra.m22+
" "+this.ra.Fa+" "+this.ra.Ga+")");d&this.Qi?b("fill",this.fillStyle):c.fill="none";d&this.Kh&&(b("stroke",this.strokeStyle),c["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(c["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(c["stroke-linecap"]=this.lineCap));d&this.Sn&&(d=this.bl(this.font),c["font-weight"]=d.fontWeight,c["font-size"]=parseFloat(d.fontSize),c["font-style"]=d.fontStyle,c["font-family"]=d.fontFamily);""!==this.Hg&&(c["clip-path"]="url(#"+this.Hg+")");this.Nx(new Hf(a,
c,f))};a.prototype.Nx=function(a){var b=!0,c=null,f={},h,k=this.Oo();0===k.children.length?b=!1:c=k.children[k.children.length-1];!c||a.name===c.name&&a.text===c.text||(b=!1);if(b&&c)for(h in c.attributes)if(c.attributes.hasOwnProperty(h))if(h in a.attributes){var l=c.attributes[h],n=a.attributes[h];if(l!==n)if(0===h.indexOf("fill")||0===h.indexOf("stroke"))if("none"===l)f[h]=n;else if("none"===n)f[h]=l;else{b=!1;break}else{b=!1;break}}else f[h]=c.attributes[h];if(b&&c)for(h in a.attributes)a.attributes.hasOwnProperty(h)&&
(h in c.attributes||(f[h]=a.attributes[h]));b&&c?c.sk(f):k.zd(a)};a.prototype.wm=function(a){if(a===this.Kh){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof Rd?!0:"string"===typeof a?0<q.lf(a).values[3]:!1};a.prototype.ps=function(a){for(var b=0;b<this.Vc.length;b++)if(this.Vc[b].Mj===a)return this.Vc[b].fk;return null};a.prototype.Fn=function(a){var b=this.ps(a);if(b)return b;b="image"+this.Vc.length;this.Vc.push({Mj:a,fk:b});var c=document.createElement("canvas"),
f=c.getContext("2d");c.width=a.width;c.height=a.height;f.drawImage(a,0,0);c=c.toDataURL();a=new Hf("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":c});this.El.zd(a);return b};a.prototype.Gn=function(a){var b=this.ps(a);if(b)return b;var c=this.Fn(a.Na);b="pattern"+this.Vc.length;this.Vc.push({Mj:a,fk:b});var f=new Hf("pattern",{id:b});"no-repeat"===a.repeat?(f.attributes.width="1",f.attributes.height="1"):"repeat-x"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=
a.Na.width,f.attributes.height=1E4):("repeat-y"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=1E4):(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.Na.width),f.attributes.height=a.Na.height);f.zd(new Hf("use",{"xlink:href":"#"+c}));this.El.zd(f);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.Kw=function(){return Sa(this.toString())};a.prototype.toBlob=function(){return new Blob([Sa(this.toString())],
{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new If};a.prototype.transform=function(a,d,c,f,h,k){a=new H(a,c,d,f,h,k);this.ra=this.ra.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.wm(this.Qi)&&this.node("path",this.Qi,{d:this.path.yr(this.ra)})};a.prototype.stroke=function(){this.wm(this.Kh)&&this.node("path",this.Kh,{d:this.path.yr(this.ra)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.ra,a,d)};a.prototype.lineTo=
function(a,d){this.path.lineTo(this.ra,a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(this.ra,a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){this.path.bezierCurveTo(this.ra,a,d,c,f,h,k)};a.prototype.fillText=function(a,d,c){this.wm(this.Qi)&&this.node("text",this.Qi|this.Sn,{x:d,y:c},a)};a.prototype.strokeText=function(a,d,c){this.wm(this.Kh)&&this.node("text",this.Kh|this.Sn,{x:d,y:c},a)};a.prototype.Yn=function(a,d,c,f,h,k,l,n,r){var b=document.createElement("canvas"),
e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=b.toDataURL();this.Oo().zd(new Hf("image",{transform:"matrix("+this.ra.m11+" "+this.ra.m21+" "+this.ra.m12+" "+this.ra.m22+" "+this.ra.Fa+" "+this.ra.Ga+")",x:k,y:l,width:n,height:r,"xlink:href":a}))};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.Gi=function(){};a.prototype.bo=function(){return{name:this.Hg}};a.prototype.eo=function(a){this.Hg=
a?a.name:""};a.prototype.clip=function(){var a=this.CB(),d=new Hf("clipPath",{id:a});d.zd(new Hf("path",{d:this.path.yr(this.ra)}));this.El.zd(d);this.Hg=a;this.path=new If};return a}(Ud);function Kf(c,a){function b(b){d&&clearTimeout(d);d=setTimeout(function(){d=null;a()},arguments.length?b:c)}var d=null;b.cancel=function(){d&&(clearTimeout(d),d=null)};return b};var Mf=function(){function c(a,b,d){var c=this;this.view=a;this.options=b;this.mode=d;this.ng={};this.log=u.create("Brush");this.view.ub(!0);this.$v=function(){return c.Ld()};this.Ec=new Me(this.view)}c.prototype.Ld=function(){this.kq(this.Le()/2)};c.prototype.xb=function(a){a=this.Ec.xb(a);this.Ec.Oe()&&this.reset();return a};c.prototype.Bd=function(){this.view.Kb("crosshair");this.kq(this.Le()/2);window.addEventListener("resize",this.$v)};c.prototype.Dc=function(){this.view.Kb("default");this.view.Do("brush");
window.removeEventListener("resize",this.$v)};c.prototype.reset=function(){this.ng={}};c.prototype.kq=function(a){var b=document.createElement("canvas");a*=this.view.scale*this.view.au();a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle=q.Lc;d.stroke();d.lineWidth=1;d.strokeStyle=q.Oa;d.stroke();b=b.toDataURL();this.view.Kb("url("+b+") "+(a+
1)+" "+(a+1)+", auto")};c.prototype.Di=function(a){this.options.strokeStyle=a};c.prototype.Le=function(){var a=this.options.lineWidth;this.view.ha.get("adaptiveBrushWidth")&&(a/=this.view.scale);return a};c.prototype.jn=function(a){this.options.lineWidth=a;this.kq(this.Le()/2)};c.prototype.yb=function(a,b,d){if(this.Ec.Oe())return!0;if(d.target instanceof HTMLElement&&d.target.matches("[z-fixture] *"))return this.view.Ab(),this.view.sa.yb&&this.view.sa.yb(a,b,d),!0;var c="freehand"===this.mode||"brush"===
this.mode?new Mc:new Kc;c.Dg(a,b);this.ng[d.pointerId]=c;return!0};c.prototype.wv=function(a){a.save();var b=this.view.ct(a);a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.Le();var d=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);gd(this.options.shadow,a);var c=Cc(this.options.dashes||"");a.beginPath();for(var f in this.ng)Dc(a,this.ng[f].Gp(),c);gc(a,this.options.strokeStyle);b&&a.restore();a.globalAlpha=d;a.restore()};
c.prototype.Eb=function(a,b,d){var c=this;d.pointerId in this.ng&&(this.ng[d.pointerId].Dg(a,b),"erase"===this.options.strokeStyle?this.view.la(function(a){return c.wv(a)}):this.view.Tv("brush",function(a){return c.wv(a)}));return!0};c.prototype.ac=function(a,b,d){this.Eb(a,b,d);this.view.Do("brush");this.wa();return!0};c.prototype.wa=function(){var a,b;this.view.aa.bb();var d="";for(var c in this.ng){var f=Ac(this.ng[c].Gp(),.5);if("brush"===this.mode||"freehand"===this.mode){Lf(f);var h=[];if(1<
f.length){d=a=0;for(b=f.length-1;a<=b;d=a+=1)h.push(f[d].x),h.push(f[d].y);d=this.view.aa.createNode("BrushNode",hc({points:h,layer:this.view.ad},this.options,{lineWidth:this.Le()}))}}else{if("shapebrush"===this.mode){f=Ac(f,20);var k;var l=f;if(!(2>l.length)){a=l[0];f=l[l.length-1];h=40>a.ec(f);for(b=0;b<l.length;b++){var n=l[b];for(k=b+1;k<l.length;k++){var r=l[k];20>Math.abs(n.x-r.x)&&(r.x=n.x);20>Math.abs(n.y-r.y)&&(r.y=n.y)}}n=G.Ag(l).ne();for(b=0;b<l.length;b++)k=l[b],20>Math.abs(k.x-n.x)&&
(k.x=n.x),20>Math.abs(k.y-n.y)&&(k.y=n.y);h&&(a.x=f.x,a.y=f.y)}f=l}else if("quadratic"===this.mode){f=Ac(f,10);a=Hd(f);d=a.fa[1];h=a.fa[2];l=a.fa[4];b=a.fa[5];f=a.fa[8];a=a.fa[9];l=((3*l-d)/2+(3*l-f)/2)/2;b=((3*b-h)/2+(3*b-a)/2)/2;k=new xc;k.moveTo(d,h);k.quadraticCurveTo(l,b,f,a);d=k;h=I.ex(d);d=this.view.aa.createNode("PathNode",hc({commands:h,fillStyle:this.view.zc,sloppiness:0,layer:this.view.ad},this.options,{lineWidth:this.Le()}));continue}Lf(f);if(1<f.length){h=new L;h.moveTo(f[0].x,f[0].y);
a=f[0].dd(f[f.length-1]);d=b=1;for(l=f.length-1;b<=l;d=b+=1)h.lineTo(f[d].x,f[d].y);a&&h.close();d=this.view.aa.createNode("PathNode",hc({commands:h.vc(),fillStyle:this.view.zc,sloppiness:0,lockEditMode:"shapebrush"!==this.mode,layer:this.view.ad},this.options,{lineWidth:this.Le()}))}}}this.view.aa.wa();this.view.ub();c=this.view.aa.Jb(d);this.view.ha.get("singleStrokeBrush")?(c&&this.view.bf(c),this.view.Ab()):this.reset();this.view.pc()};c.prototype.ve=function(a,b){this.options.strokeStyle=a;b?
(this.view.zc=a,this.view.oc=a,b="fillStyle"):(this.view.bd=a,b="strokeStyle");this.view.setProperty(b,a)};c.prototype.lg=function(a){this.view.oc=ec(this.view.oc,a);this.options.strokeStyle=ec(this.options.strokeStyle,a);this.view.zc=this.view.oc};c.prototype.Kd=function(a){this.log("keyboard: %s",a);switch(a){case "cancel":this.log("ESC pressed. Abort brush and go back to toolbar.");this.view.Ab();this.view.Tc.ta("goto-toolbar");break;case "undo":this.view.Xc();break;case "redo":this.view.ye()}};
c.prototype.Df=function(a,b){"defaultBrushWidth"===a?this.jn(b):"defaultBrushColour"===a&&this.Di(b)};c.prototype.kd=function(a,b){switch(a){case "lineWidth":this.jn(b);break;case "strokeStyle":case "fillStyle":this.Di(b);break;case "dashes":case "shadow":case "opacity":this.options[a]=b}};c.prototype.Dd=function(){return"circle"===this.mode?"ellipse":this.mode};c.prototype.Xg=function(){return hc({dashes:""},this.options)};c.prototype.Kp=function(){return["BrushNode"]};return c}();
function Lf(c){var a=!0;if(1<c.length)for(var b=1;b<c.length;b++)if(c[0].x!==c[b].x||c[0].y!==c[b].y)a=!1;a&&0<c.length&&c.push(new F(c[0].x+.1,c[0].y+.1))};var Nf=function(){function c(a,b,d,c,f,h){void 0===d&&(d={});void 0===c&&(c=!1);void 0===f&&(f=!1);void 0===h&&(h=!1);this.view=a;this.type=b;this.ba=d;this.ir=c;this.Jy=f;this.open=h;this.node=null;this.gp=new F(0,0);this.Am=new F(0,0);this.index=0;this.state="start";this.log=u.create("DRAWLINES");"wrap"in this.ba||(this.ba.wrap=this.view.ha.get("multilineText"));"fontSize"in this.ba||(this.ba.fontSize=this.view.ha.get("defaultFontSize"));"fontName"in this.ba||(this.ba.fontName=this.view.ha.get("defaultFont"));
this.Ec=new Me(this.view);this.view.ub(!0)}c.prototype.Bd=function(){this.log("Entering DrawLinesBehaviour");this.view.Kb("crosshair");this.view.ha.Li()||this.view.hn("click-to-place-first-point-of-line");this.view.la()};c.prototype.reset=function(){this.Bd()};c.prototype.xb=function(a){a=this.Ec.xb(a);this.Ec.Oe()&&this.node&&this.reset();return a};c.prototype.Kd=function(a){"cancel"===a&&(null!==this.node&&this.view.Ra.Ob&&"curve"===this.type&&this.wa(),null!==this.node&&(this.view.aa.bb(),this.view.aa.Yb([this.node.id]),
this.view.aa.wa(!0)),this.view.Ra.Ob?this.view.Tc.ta("goto-toolbar"):this.view.Ab())};c.prototype.done=function(){this.view.ny();this.view.ha.get("autoPickTool")?this.view.Ab():this.state="start"};c.prototype.Dg=function(a,b){this.node instanceof I&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.hj(a,b):this.node.lineTo(a,b))};c.prototype.yb=function(a,b,d){d=this.view.rb(new F(a,b),d);this.log("onMouseDown(%s, %s) state=%s, index=%s",a,b,this.state,this.index);if("start"===
this.state){this.gp=d;a={seed:Math.round(65535*Math.random()),strokeStyle:this.view.bd,lineWidth:this.Le(),sloppiness:this.view.ua.sloppiness,smoothness:this.view.ua.smoothness};"arrow"===this.type&&(a.arrowSize=this.view.ha.gb("defaultArrowSize"),a.arrowStyle=this.view.ha.gb("defaultArrowStyle"),a.arrowXOffset=this.view.ha.gb("defaultArrowXOffset"),a.doubleArrow=this.view.ua.doubleArrow||!1);for(var c in this.ba)this.ba.hasOwnProperty(c)&&(a[c]=this.ba[c]);this.view.aa.bb();c=this.view.aa.createNode("PathNode",
a);this.view.aa.wa(!0);this.node=this.view.aa.Jb(c);this.node.moveTo(d.x,d.y);this.Dg(d.x,d.y);this.index=3;this.view.update();this.state="predrag"}else if("placing"===this.state)if(c=this.Am.ec(d),this.log("Mouse moved by %s",c),"arrow"!==this.type&&8>this.gp.ec(d)&&3<this.index)this.log("Clicked close to start; automatically closing path"),this.node instanceof I&&!this.open&&this.node.close(),this.wa(),this.done();else if(8>this.Am.ec(d))this.log("Didn't move. Stop drawing."),this.ft(),this.done();
else{if(this.ir)return this.wa(),this.done(),!0;this.node&&(this.Dg(d.x,d.y),this.index+=3,this.view.aa.gg(this.node.id),this.view.update())}else return this.log("Invalid state %s",this.state),!0;this.Am=new F(d.x,d.y);return!0};c.prototype.ft=function(){3<this.index?(this.node instanceof I&&this.node.OC(this.index),this.wa()):this.cancel()};c.prototype.ac=function(a,b){var d=new F(a,b);d=this.gp.ec(d);this.log("onMouseUp (%s,%s) %s",a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",
d),10<d?(this.wa(),this.done()):(this.state="placing",this.view.hn("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.Eb=function(a,b,d){b=this.view.rb(new F(a,b),d);a=b.x;b=b.y;if(d.ctrlKey||this.Jy){d=this.Am;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=
d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.Nb(this.node.Ue(this.index,a,b)),this.node.format(this.view.ma,this.view.request),this.view.la());return!1};c.prototype.Ly=function(a){for(var b=0,d=[],c,f,h,k,l,n;b<a.length;){var r=a[b];switch(r){case I.Gh:h=a[b+1];k=a[b+2];d.push(r,h,k);break;case I.af:c=a[b+1],f=a[b+2],void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n&&d.push(I.Rk,c,f,(l+h)/2,(n+k)/2,(h+c)/2,(k+f)/2),l=h,n=k,h=c,k=f}b+=I.ob[r]+1}return d};c.prototype.wa=
function(){var a=this;if(this.node){this.node instanceof I&&!this.open&&this.node.ey();this.view.aa.bb();this.view.aa.Yb([this.node.id]);this.view.aa.wa(!0);var b=this.node.ia("commands");"linear-bezier"===this.type&&(b=this.Ly(b));var d=this.Xg();d.seed=this.node.ia("seed");d.commands=b;this.view.aa.transaction(function(){a.view.aa.createNode("PathNode",d)});this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.aa.bb(),this.view.aa.Yb([this.node.id]),this.view.aa.wa(!0),this.node=
null)};c.prototype.Dc=function(){this.ft();this.view.Kb("default");this.view.hn("");this.view.la()};c.prototype.ve=function(a,b){this.ba.strokeStyle=a;b?(this.view.zc=a,this.view.oc=a,b="fillStyle",this.log("We are drawing lines. Set strokeStyle instead of fillStyle")):(this.view.bd=a,b="strokeStyle");this.view.setProperty(b,a)};c.prototype.lg=function(a,b){b?(this.view.zc=ec(this.view.zc,a),this.view.oc=ec(this.view.oc,a)):this.view.bd=ec(this.view.bd,a);this.view.fr(a,b)};c.prototype.Dd=function(){return this.type};
c.prototype.Xg=function(){var a=this.view.ha.gb("defaultArrowSize");a={arrowSize:"arrow"===this.type?a:0,arrowStyle:this.view.ha.gb("defaultArrowStyle"),arrowXOffset:this.view.ha.gb("defaultArrowXOffset"),fillStyle:this.view.zc,strokeStyle:this.view.bd,lineWidth:this.Le(),dashes:"",sloppiness:this.view.ua.sloppiness,smoothness:this.view.ua.smoothness,layer:this.view.ad};a.doubleArrow="doubleArrow"in this.ba?this.ba.doubleArrow:this.view.ua.doubleArrow||!1;for(var b in this.ba)this.ba.hasOwnProperty(b)&&
(a[b]=this.ba[b]);this.open&&(delete a.fontName,delete a.fontSize);return a};c.prototype.kd=function(a,b){"doubleArrow"===a&&(b=ic(!0,b));this.ba[a]=b;switch(a){case "doubleArrow":this.view.ua[a]=b}};c.prototype.Le=function(){return this.view.oo(this.view.ua.lineWidth)};return c}();var Qf=function(){function c(a,b,d,c,f,h,k,l){var e=this;this.view=a;this.nodeType=b;this.Ov=d;this.width=c;this.height=f;this.hw=h;this.pE=k;this.state="initial";this.start=new F(0,0);this.end=new F(0,0);this.node=null;this.ba={};this.lv={};this.Bo={};this.log=u.create("DrawShape");this.view.Xe(!0);"rectangle-tl"===h&&(this.wt=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke();e.ut(a)});this.Vs=null===
l?this.view.ha.get("autoPickTool"):l;this.Ec=new Me(this.view);this.view.ub(!0);this.ba=Of(d)}c.prototype.wt=function(a){this.ut(a)};c.prototype.ut=function(a){var b=this.view.ha.St(Math.abs(this.end.x-this.start.x)),d=this.view.ha.St(Math.abs(this.end.y-this.start.y));d=b+"x"+d;var c=this.view.scale;b=new jd;b.text=d;b.uk("sans-serif",12/c,!1,!1,"");b.format(a,0,0);a.fillStyle=q.Oa;d=1/c;a.fillRect(this.start.x-d,this.start.y-d,b.rect.width+2*d,b.rect.height+2*d);a.fillStyle=q.Lc;b.fillText(a,this.start.x,
this.start.y)};c.prototype.Bd=function(){this.log("Entering DrawShapeBehaviour");this.view.Kb("crosshair")};c.prototype.Dc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel();this.view.Xe(!1)};c.prototype.cancel=function(){this.node&&(this.view.aa.bb(),this.view.aa.Yb([this.node.id]),this.view.aa.wa(!0),this.view.update(),this.node=null);this.state="initial"};c.prototype.xb=function(a){a=this.Ec.xb(a);this.node&&this.Ec.Oe()&&(this.view.aa.bb(),this.view.aa.Yb([this.node.id]),this.view.aa.wa(!0),
this.node=null,this.state="initial");return a};c.prototype.Kd=function(a){"cancel"===a&&this.view.Ab()};c.prototype.yb=function(a,b,d){"initial"===this.state&&(this.start=this.view.rb(new F(a,b),d),this.state="predraw",this.log("initial -> predraw"));return!0};c.prototype.Eb=function(a,b,d){var c=this;a=this.view.rb(new F(a,b),d);d=d.ctrlKey;"predraw"===this.state&&10<this.start.ec(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,
a,d),this.end=a,this.view.update(!1,function(a){return c.wt(a)}));return!0};c.prototype.ac=function(a,b,d){"predraw"===this.state?this.view.ha.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.wa(),this.Vs&&this.view.Ab(),this.state="initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.rb(new F(a,b),d),d.ctrlKey),this.wa(),this.Vs&&this.view.Ab(),this.state="initial");return!0};c.prototype.create=function(){this.view.aa.bb();this.ba=
Of(this.Ov);var a=this.view.aa.createNode(this.nodeType,this.ba);if(this.node=this.view.aa.Jb(a))this.lv=this.node.wd(new H);this.view.aa.wa(!0)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.hw){var c=a;a=a.ec(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.hw)a=a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new F(0,0);else{c=f[0].x;for(var h=f[0].y,k=1;k<f.length;k++)c+=f[k].x,h+=f[k].y;
c=new F(c/f.length,h/f.length)}f=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else c=a,a=f=1;d&&(a=f=Math.min(f,a));d=new pc(c.x,c.y);d=d.multiply(new rc(f,a));this.node&&(this.node.Nb(this.lv),this.Bo=this.node.wd(d),this.node.Nb(this.Bo),this.view.aa.gg(this.node.id))};c.prototype.wa=function(){var a=this;this.node&&(this.ba=hc(this.ba,this.Bo),this.view.aa.bb(),this.view.aa.Yb([this.node.id]),this.view.aa.wa(!0),this.node=null,this.view.aa.transaction(function(){a.view.aa.createNode(a.nodeType,
a.ba)}))};c.prototype.jn=function(a){this.ba.lineWidth=this.view.oo(a)};c.prototype.ve=function(a,b){Pf.prototype.ve.call(this,a,b);this.ba[b?"fillStyle":"strokeStyle"]=a};c.prototype.lg=function(a,b){Pf.prototype.lg.call(this,a,b);b=b?"fillStyle":"strokeStyle";var d=ec(this.ba[b],a);this.log("oldColour=%s+opacity %s = %s",this.ba[b],a,d);this.ba[b]=d};c.prototype.Dd=function(){return this.pE};c.prototype.kd=function(a,b){this.Ov[a]=b;this.ba[a]=b};c.prototype.Xg=function(){return this.ba};c.prototype.Df=
function(a,b){"defaultLineWidth"===a&&this.jn(b)};return c}();function Of(c){var a={},b;for(b in c){var d=c[b];d instanceof Array?d=d.concat():d instanceof H&&(d=d.clone());a[b]=d}return a};var Rf=function(){function c(a,b,d){var c=this;this.view=a;this.ba=b;this.PB=d;this.state="none";this.scale=1;this.log=u.create("ImageStamp");this.Na=document.createElement("img");this.url=this.Na.src=b.url;"scale"in this.ba&&(this.scale=this.ba.scale,delete this.ba.scale);N.xp(this.Na.src,function(a){"width"in c.ba&&(c.scale=c.ba.width/a,delete c.ba.width)})}c.prototype.Dd=function(){return"imagestamp"};c.prototype.Bd=function(){this.log("Entering ImageStampBehaviour");this.view.Kb("move")};c.prototype.Dc=
function(){this.log("Leaving ImageStampBehaviour");this.view.la()};c.prototype.rb=function(a,b,d){this.Na.complete&&(a-=this.Na.width/2*this.scale,b-=this.Na.height/2*this.scale);return this.view.rb(new F(a,b),d)};c.prototype.yb=function(a,b,d){var c=this;this.log("onMouseDown type %s",d.type);var f=this.rb(a,b,d);this.view.aa.transaction(function(){var d=c.view.aa.createNode("ImageNode",hc({},c.ba,{url:c.url,layer:c.view.ad,matrix:(new pc(f.x,f.y)).multiply(new rc(c.scale,c.scale))}));c.iD(d,a,b,
f)});this.PB||(this.log("MultiStamp not set; return to pick mode."),this.view.Ab());return!0};c.prototype.iD=function(a,b,d,c){a={docX:b,docY:d,nodes:[{id:a,rect:new Qd(c.x,c.y,this.Na.width*this.scale,this.Na.height*this.scale),shift:{x:0,y:0}}]};this.view.xa.rc("drop-shape",a)};c.prototype.Eb=function(a,b,d){this.Na.complete||this.log("Don't draw; image not loaded.");var c=this.rb(a,b,d);this.view.scrollIntoView(a,b);var f=this;this.view.la(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(f.Na,
c.x,c.y,f.Na.width*f.scale,f.Na.height*f.scale);a.globalAlpha=b});return!0};c.prototype.ac=function(){return!0};c.prototype.Kd=function(a){"cancel"===a&&(this.view.Ab(),this.view.Tc.ta("goto-toolbar"))};return c}();var Sf=function(){function c(a){var b=this;this.view=a;this.state="none";this.start=new F(0,0);this.Iw=this.Hw=0;this.Sq=null;this.log=u.create("PanTool");this.ov=function(a){a?b.view.Kb("grabbing"):b.view.Kb("not-allowed")};this.Ec=new Me(a)}c.prototype.aE=function(a,b,d,c){this.Sq=c;this.yb(a,b,d)};c.prototype.Bd=function(){this.log("Entering PanToolBehaviour");this.view.ha.pa("allowScroll",this.ov)};c.prototype.Dc=function(){this.log("Leaving PanToolBehaviour");this.view.ha.removeListener("allowScroll",
this.ov)};c.prototype.xb=function(a){return this.Ec.xb(a)};c.prototype.QA=function(a){return new F(a.pageX,a.pageY)};c.prototype.yb=function(a,b,d){this.log("onMouseDown type %s",d.type);if(!this.view.ha.get("allowScroll"))return this.log("Scrolling disabled."),!0;if(this.view.kB(d)){var c=new Pf(this.view);this.view.Ya(c);return c.yb(a,b,d)}this.state="dragging";this.start=new F(d.sb,d.tb);this.Hw=this.view.Gb;this.Iw=this.view.Hb;return!0};c.prototype.Eb=function(a,b,d){if("dragging"!==this.state)return!1;
a=this.QA(d);b=this.Iw+a.y-this.start.y;this.view.Gb=this.Hw+a.x-this.start.x;this.view.Hb=b;this.view.xd();this.view.la();return!0};c.prototype.ac=function(){this.state="none";this.Sq&&this.view.Ya(this.Sq);return!0};c.prototype.tq=function(a,b,d,c){if(!this.view.ha.get("allowZoom"))return this.log("Zooming is disabled."),!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);this.view.Yw(0>d.y?1/1.1:1.1,a,b);c.stopPropagation();c.preventDefault();return!0};c.prototype.Kd=function(a){"cancel"===a&&this.view.Ab()};
c.prototype.Dd=function(){return"pan"};return c}();function Tf(c){var a;void 0===a&&(a="");if(!c)throw a||"Assertion failed";}function Uf(c){return"object"===typeof c&&"[object Array]"===Object.prototype.toString.apply(c)}function Vf(c){return"string"===typeof c}function Wf(c){return"number"===typeof c}function Xf(c){return"object"===typeof c};var Yf=u.create("CONFIG"),Zf=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),$f={autoGroup:!1,adaptiveBrushWidth:!1,adaptiveLineWidth:!1,angleArcs:0,allowCrop:!1,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!0,
allowScroll:!0,allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,broadcastMouse:!1,confine:"none",collaborationServer:"wss://zwibbler.com/socket2",clickToDrawShapes:!1,clipToPage:!0,debug:!1,debugOutlineColour:"red",defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:q.Oa,defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",
defaultRoughness:0,defaultRoundRectRadius:10,defaultSmoothness:"smooth",defaultStrokeStyle:q.Oa,defaultText:"Lorum ipsum dolor",defaultTextBackground:q.Be,defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:q.Oa,defaultTextStrokeStyle:q.Oa,defaultTextLineWidth:0,defaultZoom:1,drawShapeStyle:"box",fastDraw:!0,fonts:["Arial","Times New Roman"],gridBlocks:10,gridColour:"#cccccc",gridSpacing:20,imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",
keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDragDuplicate:"Ctrl+Alt",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPan:"",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z,\u2318+Shift+Z,Ctrl+Y",keyRight:"Right,Ctrl+Right",
keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z,\u2318+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",latency:0,leaveTextToolOnBlur:!1,maximumZoom:0,magnet:!0,minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pagePlacement:"centre",pageSelectorDiv:"",pageShadow:!0,pageView:!1,pasteOffset:10,
pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,scrollbarHandleColour:"auto",showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,
showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,showOwnPointer:!0,showOtherPointers:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:1,symmetry:0,textMode:"interactive",toolbarButtonSize:50,touchRadius:0,useSelectionHandles:!0,useTouch:"auto",units:"",viewMargin:[0,0,0,0],zoomOnResize:!1,
colourPalette:"auto",colourPicker:"wheel",drawCircleStyle:"box",enableArrowKeysNudge:!1,showKeyboardHelp:!0,showMenu:!1},ag={},bg;for(bg in $f)ag[bg.toLowerCase()]=bg;
var cg={allowSelectBox:1,useSelectionHandles:1,useTouch:1},dg=function(c){function a(a,d){a=c.call(this,a,$f,d)||this;a.$d="";""===a.$d&&a.set("imageFolder",a.options.imageFolder);"auto"===a.options.useTouch&&Yf("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);Yf("Detect clipboard support: %s",a.Vp());return a}__extends(a,c);a.prototype.fq=function(){var a=Mb(),d;for(d in a)this.set(d,a[d])};a.jx=function(a){return a.toLowerCase()in ag};a.prototype.has=function(a){return c.prototype.has.call(this,
a)||a.startsWith("_")};a.prototype.Mt=function(a,d){"debug"===a&&(a="showDebug");if("defaultZoom"===a){if("page"!==d&&"width"!==d&&!Wf(d)&&(d=parseFloat(d),isNaN(d))){Yf("Error: Config option %s must be a number or 'page' or 'width'",a);return}}else if("imageFolder"===a){var b=this.UA();""===b?(this.$d=d.replace("$SCRIPT/",""),this.$d=this.$d.replace("$SCRIPT","")):this.$d=d.replace("$SCRIPT/","$SCRIPT").replace("$SCRIPT",b);""!==this.$d&&"/"!==this.$d[this.$d.length-1]&&(this.$d+="/");Yf("scriptPath=%s imageFolder=%s, result:%s",
b,this.options.imageFolder,this.$d)}else if("broadcastMouse"===a)"true"===d?d=!0:"false"===d&&(d=!1);else if("viewMargin"===a){b=null;if(Vf(d)){b=[];var c=0;for(d=d.split(",");c<d.length;c++)b.push(parseFloat(d[c]))}else"number"===typeof d?b=[d,d,d,d]:Uf(d)&&(b=d);b&&(1===b.length?b.push(b[0],b[0],b[0]):2===b.length&&b.push(b[0],b[1]));d=b||this.options.viewMargin}else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d)){console.log(Error("Config option "+a+" expects a number"));
return}}else if(!cg[a]&&"boolean"===typeof this.options[a]||cg[a]&&"auto"!==d)d="1"===d||"true"===d||""===d;return{name:a,value:d}};a.prototype.UA=function(){var a=Zf;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.DF=function(){return this.options.showBrushTool};a.prototype.GF=function(){return this.options.showPropertyPanel};a.prototype.EF=function(){return this.options.showColourPanel};a.prototype.FF=function(){return this.options.showDebug};a.prototype.HF=function(){return this.options.showToolbar};
a.prototype.gb=function(a){return this.get(a)};a.prototype.get=function(a){switch(a){case "useTouch":return this.Li();default:return c.prototype.get.call(this,a)}};a.prototype.Li=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.KE=function(a){return"boolean"===typeof this.options.useSelectionHandles?this.options.useSelectionHandles:!a};a.prototype.Uz=function(){if("auto"===this.options.allowSelectBox){var a=this.Li(),
d=document.documentElement.offsetHeight,c=window.innerHeight,f=!a||a&&0<c-d+50;Yf("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",f,a,d,c);return f}return this.options.allowSelectBox};a.prototype.hA=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.yp=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===a.indexOf("/")?a:this.$d+a};a.prototype.tc=
function(a){return z.tc(this.get(a))};a.prototype.Zx=function(a){function b(a){for(var b="",d=0;d<a.length;d++){var c=a.charAt(d);b=c===c.toUpperCase()?b+("-"+c.toLowerCase()):b+c}return b}function c(b){k&&(a.Hr(k,"start-pan"),a.Hr("up:"+k,"end-pan"));k=b;a.map(b,"start-pan");a.map("up:"+b,"end-pan")}var f=this,h={keyCut:1,keyCopy:1,keyPaste:1},k="",l;for(l in this.options)this.options.hasOwnProperty(l)&&("keyPan"===l?c(this.options[l]):0!==l.indexOf("key")||h[l]||a.map(this.options[l],b(l).substr(4)));
this.pa("update",function(d,e,f){"keyPan"===d?c(e):0!==d.indexOf("key")||h[d]||(d=b(d).substr(4),Yf("Unmap keyboard %s=>%s",f,d),a.Hr(f,d),Yf("Map keyboard %s=>%s",e,d),a.map(e,d))});this.pa("allowSystemClipboard",function(){var b=!f.Vp();b?Yf("Not using system clipboard. Mapping cut/copy/paste keys"):Yf("Using system clipboard. Ignore keyCut/keyCopy/keyPaste.");a.map(f.options.keyCut,"cut",b);a.map(f.options.keyCopy,"copy",b);a.map(f.options.keyPaste,"paste",b)})};a.prototype.bu=function(){return"radial"===
this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.yi=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&Yf("Zoom restricted to %s",a);return a};a.prototype.Vp=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};a.prototype.pB=function(a){for(var b=0,c=this.get("keyDragDuplicate").toLowerCase().split(",");b<
c.length;b++){var f=c[b],h=!1,k=!1,l=!1,n=!1;0<=f.indexOf("shift")&&(h=!0);0<=f.indexOf("alt")&&(n=!0);if(0<=f.indexOf("meta")||0<=f.indexOf("\u2318"))l=!0;if(0<=f.indexOf("ctrl")||0<=f.indexOf("control"))k=!0;if(!(!(k||h||n||l)||k&&!a.ctrlKey||n&&!a.altKey||h&&!a.shiftKey||l&&!a.metaKey))return!0}return!1};a.prototype.St=function(a){a/=this.get("pixelsPerUnit");var b=this.get("units");switch(b){case "px":case "":a=""+Math.round(a)+b;break;default:a=""+a+b}return a};return a}(Pb);var eg=function(){function c(){this.Hf=0;this.fn=null}c.prototype.request=function(a,b){var d=this;this.Xx=a;this.fn=b;0===this.Hf&&(this.Hf=window.requestAnimationFrame(function(a){d.Hf=0;d.fn&&d.fn(d.Xx,a)}))};c.prototype.cancel=function(){0!==this.Hf&&(window.cancelAnimationFrame(this.Hf),this.Hf=0)};return c}();var fg=u.create("MOVE"),jg=function(){function c(a,b,d,c){var e=this;this.Ba=a;this.node=d;this.ki=c;this.iv=this.kv="";this.Lr=!0;this.placeholder=this.Gv=null;this.Io="column";this.gq=function(){};this.vg=new Pd;this.so=new eg;this.He=null;fg("Moving node: %s istool=%s",d.id,c);this.Ba.Xe(!0);this.Ba.Kb("move");this.XB=d.da.style.position||"";this.Im=d.da.style.left||"";this.Km=d.da.style.top||"";this.Jm=d.da.parentElement;this.YB=z(d.da).Me("zIndex");this.WB=d.da.nextElementSibling;this.Hy=null!==
d.da.getAttribute("confine")||1===c;this.oi=d.Aj();this.$B=d.parent;this.kv=d.da.style.pointerEvents;this.iv=d.da.style.cursor;this.ZB=d.parent?d.parent.re(d):-1;d.da.style.cursor="move";var h=this.Ba.Pd(b.sb,b.tb,!0);this.start=h;if(2===c){a=gg(this.node.da);var k=this.Ba.Pd(a.x,a.y,!0);fg("Moving fixture from %s; tl=%s",a,k);a.x=k.x;a.y=k.y;this.node.rect=a;this.oi=this.node.rect}"IFRAME"===d.da.tagName&&(this.Lr=!1);d.da.style.position="absolute";this.Lr&&this.Ba.Ck.appendChild(d.da);d.da.style.zIndex=
"1";this.DB=z(d.da).am();1===c&&(this.node.rect=new G(h.x-this.node.da.offsetWidth/2,h.y-this.node.da.offsetHeight/2,this.node.da.offsetWidth,this.node.da.offsetHeight),this.oi=this.node.rect,d.da.style.pointerEvents="none",this.gq=function(){fg("Got image load event from dragged tool");e.GC(h)},this.node.da.addEventListener("load",this.gq,!0));this.rect=this.node.Aj();d.da.classList.add("dragging");this.Ba.aa.Ac(function(a){var b=a.rect;Vc(a)&&(b=a.Aj());e.vg.Hs(b,a.id)});this.Eb(h.x,h.y,b)}c.prototype.Bd=
function(){fg("Entering DragHTMLBehaviour")};c.prototype.xb=function(a){if(this.Ba.ha.get("allowZoom")&&"gesturestart"===a.type){fg("Switch to default behaviour");var b=new Pf(this.Ba);this.Ba.Ya(b);b.xb(a);return!0}return!1};c.prototype.Dc=function(){this.Ba.yn(new H);this.Ba.Xe(!1);this.Ba.Kb("default");this.node.da.style.left=this.Im;this.node.da.style.top=this.Km;this.node.da.style.position=this.XB;this.node.da.style.zIndex=this.YB;this.node.da.style.transform="";this.node.da.style.pointerEvents=
this.kv;this.node.da.style.cursor=this.iv;this.node.da.classList.remove("dragging");this.Jm?this.Lr&&this.Jm.insertBefore(this.node.da,this.WB):z(this.node.da).remove();this.He&&this.He.classList.remove("drop");fg("DragHTMLBehaviour.leave()");this.Wv();this.node.da.removeEventListener("load",this.gq,!0);1===this.ki&&this.node.Ta();this.so.cancel()};c.prototype.Iy=function(a,b){b=gg(b);b.transform(this.Ba.jm());a.x<b.x&&(a.x=b.x);a.y<b.y&&(a.y=b.y)};c.prototype.Eb=function(a,b,d){var c=this;this.so.request(d,
function(a){var b=c.Ba.Pd(a.pageX,a.pageY),d=b.tr(c.start),e=c.oi;c.rect.x=e.x+d.x;c.rect.y=e.y+d.y;c.Hy&&c.Jm&&c.Iy(c.rect,c.Jm);c.Ba.ha.get("magnet")&&(d=c.vg.YD(c.rect,c.node.id),c.rect.x+=d.x,c.rect.y+=d.y);(d="view"===c.Ba.ha.get("confine"))&&c.rect.Ho(c.Ba.Ub());c.node.da.style.left=c.rect.x+"px";c.node.da.style.top=c.rect.y+"px";c.node.xk(hg(c.rect,c.DB),new H);e=new pc(c.rect.x-c.oi.x,c.rect.y-c.oi.y);1!==c.ki&&c.Ba.yn(e);c.Ba.la();e=gg(c.node.da);e=c.Gz(e);null!==e?c.Px(e,a.pageX,a.pageY):
c.Wv();a=c.node.ia("$component");var f=null,r=gg(c.node.da);z(c.Ba.sf()).query('[z-drop-accept="'+a+'"]',function(a){var b=gg(a),d=Math.min(r.Wi(),b.Wi());a!==c.node.da&&b.Dv(r)>.7*d&&(f=a)});a=f;a!==c.He&&(c.He&&c.He.classList.remove("drop"),c.He=a,c.He&&c.He.classList.add("drop"));c.node.da.dispatchEvent(new CustomEvent("zwibbler-dragging",{cancelable:!0,detail:{node:c.node.id,iz:c.rect.x,jz:c.rect.y,width:c.rect.width,height:c.rect.height}}));d||c.Ba.scrollIntoView(b.x,b.y)});return!0};c.prototype.Gz=
function(a){var b=this.node.ia("$component"),d=null;z(this.Ba.sf()).query("[container-for]",function(c){ig(c,b)&&gg(c).Dv(a)>.5*a.Wi()&&(d=c)});return d};c.prototype.Px=function(a,b,d){var c=z(a).Me("flex-direction");this.Io=c.startsWith("row")?"row":c.startsWith("col")?"column":"none";a:{c=this.Io;var f=0,h=null,k,l=new F(b,d),n=null;if("none"===c)b=a.lastElementChild;else{for(k=a.firstElementChild;k;){if(!k.classList.contains("placeholder")){if(!k.getAttribute("nid")){fg("Place at end -- non-zwibbler nodes present in container-for.");
b=null;break a}n=gg(k);n=(new F(n.x,n.y)).ec(l);if(!h||n<f)h=k,f=n;n=k}k=k.nextElementSibling}h&&h===n&&(n=gg(h),"column"===c&&d>n.y||"row"===c&&b>n.x+n.width/2)&&(h=null);b=h}}if(this.placeholder&&this.placeholder.parentNode){if(a!==this.placeholder.parentElement||b!==this.Gv)this.Gv=b,a.insertBefore(this.placeholder,b)}else d={},d.flex="column"===this.Io?"0 0 "+this.node.da.clientHeight+"px":"0 0 "+this.node.da.clientWidth+"px",this.placeholder=z("div",{"class":"placeholder"}).Za(d).da,a.insertBefore(this.placeholder,
b)};c.prototype.Wv=function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)};c.prototype.ac=function(a,b,d){this.so.cancel();fg("onMouseUp()");if(1===this.ki&&!gg(this.Ba.canvas.first).Oc(d.pageX,d.pageY))return fg("Dropped nowhere!"),this.Ba.Ya(new Pf(this.Ba)),!0;a="static";var c=0,f=0,h=0;b=this.Ba.aa.se();if(this.placeholder&&this.placeholder.parentElement)if("flex"!==z(this.placeholder.parentElement).Me("display")&&(a="absolute"),d=this.Ba.aa.wp(this.placeholder)){b=
d;c=this.placeholder;f=this.placeholder.parentElement.firstElementChild;for(h=0;f&&f!==c;)f.getAttribute("nid")&&h++,f=f.nextElementSibling;h=Math.min(h,d.children.length-1);fg("Use placeholder, place at %s:%s",b.id,h);c=this.rect.x-d.rect.x;f=this.rect.y-d.rect.y}else fg("Placeholder is not in a NID node");else fg("No placeholder; add to root"),a="absolute",h=b===this.$B?this.ZB:-1,c=this.rect.x,f=this.rect.y;this.Ba.Ya(new Pf(this.Ba));this.node.da.dispatchEvent(new CustomEvent("zwibbler-drop",
{cancelable:!0,detail:{node:this.node.id,uF:b.id,tF:h,iz:c,jz:f}}))?(this.Ba.aa.bb(),0===this.ki||2===this.ki?this.Ba.aa.hd(this.node.id,b.id,h):b&&1===this.ki&&(d=this.node.mb(),"absolute"===a&&(d["style.position"]="absolute",d["style.left"]=c+"px",d["style.top"]=f+"px"),this.Ba.aa.createNode("HTMLNode",d,b.id,h),this.Ba.ub(),this.Ba.bf(this.node)),"absolute"===a?this.Ba.aa.Bb([this.node.id],{"style.left":c+"px","style.top":f+"px","style.position":a}):this.Ba.aa.Bb([this.node.id],{"style.left":"",
"style.top":"","style.position":""}),this.He&&(a=this.Ba.xa.iu(this.He))&&(a=this.Ba.xa.bm(a))&&a.element&&O.rc(a.element,"drop",this.node.bi(null)),this.Ba.aa.wa(!1)):fg("DragHTML was cancelled by element");return!0};c.prototype.GC=function(a){this.node.rect=new G(a.x-this.node.da.offsetWidth/2,a.y-this.node.da.offsetHeight/2,this.node.da.offsetWidth,this.node.da.offsetHeight);this.oi=this.node.rect};return c}();function gg(c){c=z(c).gc();return new G(c.left,c.top,c.width,c.height)}
function hg(c,a){c=c.clone();c.x+=a.left;c.width-=a.left+a.right;c.y+=a.top;c.height-=a.top+a.bottom;return c};var kg=u.create("Background"),mg=function(){function c(a){this.ha=a;this.rect=new G(0,0,0,0);this.ij=null;this.background=q.Be;this.update=!0;this.Ou=null;this.Pu=1;this.Da=[];this.canvas=document.createElement("canvas");this.qn=""}c.prototype.SC=function(){this.update=!0};c.prototype.pD=function(a){a!==this.background&&(this.background=a,this.update=!0)};c.prototype.tk=function(a){a!==this.ij&&(this.ij=a,this.update=!0)};c.prototype.mD=function(a){this.Da=lg(a,function(a,d){return a.Zd()-d.Zd()});
this.update=!0};c.prototype.TA=function(a,b,d){if(this.update||a!==this.Ou||!b.dd(this.rect)||d!==this.Pu)this.IC(b,d),this.Ou=a,this.Pu=d,this.update=!1;if(this.qn)return this.qn;var c;this.canvas.width&&this.canvas.height&&(c=a.createPattern(this.canvas,"no-repeat"));return c||"#ff00ff"};c.prototype.IC=function(a,b){this.rect=a;kg("Regenerate background for %s, %s",a,b);if("grid"===this.background||0!==this.Da.length||this.ij){this.qn="";dc()&&(this.canvas=document.createElement("canvas"));Math.floor(a.width*
b)!==Math.floor(this.canvas.width)&&(this.canvas.width=a.width*b);Math.floor(a.height*b)!==Math.floor(this.canvas.height)&&(this.canvas.height=a.height*b);var d=this.canvas.getContext("2d");d.setTransform(b,0,0,b,-a.x*b,-a.y*b);(b=q.Rl(this.background))?(d.fillStyle=b.toString(),d.fillRect(a.x,a.y,a.width,a.height)):"grid"===this.background?this.mC(d,a):"clear"===this.background&&d.clearRect(a.x,a.y,a.width,a.height);if(this.ij)try{this.ij(d,a.x,a.y,a.width,a.height)}catch(e){console.warn("Error in custom background function: ",
e)}a=0;for(b=this.Da;a<b.length;a++)b[a].la(d)}else this.qn="clear"===this.background?q.Be:this.background};c.prototype.mC=function(a,b){function d(d){var c=Math.ceil(b.x/d)*d,e=Math.ceil(b.y/d)*d,f=Math.floor(b.right()/d)*d,h=Math.floor(b.bottom()/d)*d;for(a.beginPath();c<=f;c+=d)a.moveTo(c,b.y),a.lineTo(c,b.bottom());for(;e<=h;e+=d)a.moveTo(b.x,e),a.lineTo(b.right(),e);a.stroke()}var c=this.ha.get("gridBlocks"),f=this.ha.get("gridSpacing"),h=(c||1)*f;a.strokeStyle=this.ha.get("gridColour");a.fillStyle=
q.Lc;a.fillRect(b.x,b.y,b.width,b.height);a.lineWidth=.5;d(f);c&&(a.lineWidth=2,d(h))};return c}();function lg(c,a){for(var b=[],d=0;d<c.length;d++)b.push(d);b.sort(function(b,d){var e=a(c[b],c[d]);return 0!==e?e:b-d});for(var e=[],f=0;f<b.length;f++)d=b[f],e.push(c[d]);return e};function ng(c){for(var a=[],b=0;b<c.length;b++)a.push(String.fromCharCode(c.charCodeAt(b)^"zwibbler3".charCodeAt(b%9)));return a.join("")}ng(">2$-");for(var og=[115,116,114,111,107,101,84,101,120,116],pg=[],qg=0;qg<og.length;qg++)pg.push(String.fromCharCode(og[qg]));
var sg=function(){function c(a,b,d,e,f,h,k,l,n,r,v,x){var w=this;this.Sc=a;this.canvas=b;this.aa=d;this.Tc=e;this.ha=f;this.language=h;this.xa=k;this.za=l;this.Ck=n;this.me=r;this.bw=v;this.Zw=x;this.je="none";this.Ik=this.Hk=0;this.scale=1;this.code=this.Hb=this.Gb=0;this.de=new G(0,0,0,0);this.Yq=new Bc;this.Ci=this.qk=this.cn=!0;this.Xq=new H;this.selection=[];this.xh=[];this.ad="default";this.ua={};this.Xp=this.Mf=this.Il=!1;this.pe=1;this.nl={};this.Xi=null;this.vo="";this.Ie=this.Ja=null;this.bs=
4;this.cs=3*this.bs;this.yg=this.pj=null;this.Mh=!1;this.oc=this.zc=this.bd=q.Oa;this.Uh=5;this.ei="";this.Wc=0;this.oq=new G(0,0,0,0);this.pq=new G(0,0,0,0);this.Ra={Ob:!1,qc:!1,yo:!1,x:100,y:100};this.Ru=!1;this.sm=new mb;this.lm=[];this.zt=0;this.vg=new Pd;this.jo=null;this.Xb=new G(0,0,0,0);this.hg=new Ne(this);this.log=u.create("VIEW");this.Au=0;this.Qu=new G(0,0,0,0);this.ma=this.canvas.get(0);this.canvas.Hx();this.Mf=!0===f.get("pageView");this.background=new mg(f);this.JC();this.sa=new Pf(this);
this.za.add(function(){w.sa&&w.sa.Dc&&w.sa.Dc();w.request.aj();w.Ed.aj();w.Hc.aj();w.sa={};w.aa.Ta()});this.Ed=new Ld(this.za,!0);this.Ed.Vd(this.canvas.get(0).canvas.parentNode);this.Hc=new Ld(this.za,!1);this.Hc.Vd(this.canvas.get(0).canvas.parentNode);this.ha.pa("scrollbarHandleColour",function(a){w.Ed.tw(a);w.Hc.tw(a)});var y=this;this.request=new Oe;this.request.canvas=this.canvas.get(0).canvas;this.request.ha=this.ha;this.request.pa("reformat",function(a){w.log("Node %s requests reformat",a);
w.aa.ed(a)&&(w.log("   Reformatting... zoom=%s",w.je),w.aa.gg(a));w.update();(a=w.aa.Jb(a))&&"background"===a.Cc()&&w.Kg();w.zi();w.xa.cg("resource-loaded")});this.request.pa("redraw",function(a){w.log("Node %s requests redraw",a);w.la()});this.request.pa("convert-dom-request",function(a,b){y.xa.ta("convert-dom-request",b,a)});this.request.pa("mouseevent",function(a){w.Lw.handleEvent(a)});f.pa("useTouch",function(){w.yg=null;w.cs=3*y.bs});this.Hc.pa("scroll",function(a){y.Hb=-a*y.scale;y.xa.ta("scroll");
w.aa.Vq(w.Ub());w.Er();y.la()});this.Ed.pa("scroll",function(a){y.Gb=-a*y.scale;y.la();w.aa.Vq(w.Ub());w.Er();y.xa.ta("scroll")});this.Kg();this.aa=this.zh(d);this.ha.pa("update",function(a,b){w.Df(a,b)});this.za.addEventListener(document,"webkitfullscreenchange",function(){dc()&&(w.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),w.requestAnimationFrame=c.prototype.requestAnimationFrame)});a=document;a.fonts&&this.za.addEventListener(a.fonts,"loadingdone",function(){w.log("Font loading done, redraw now.");
w.la()});this.Td(.5,0,0,-30,"","rotate");this.Td(0,0,0,0,"","scale");this.Td(1,0,0,0,"","scale");this.Td(1,1,0,0,"","scale");this.Td(0,1,0,0,"","scale");this.Td(.5,0,0,0,"","scale");this.Td(1,.5,0,0,"","scale");this.Td(.5,1,0,0,"","scale");this.Td(0,.5,0,0,"","scale");this.sa=this.Ab()}c.prototype.oo=function(a){this.ha.get("adaptiveBrushWidth")&&(a/=this.scale);return a};c.prototype.bB=function(a,b){var d,c=!1;for(d=0;d<a.Ym.length;d++){var f=a.Ym[d];f in this.nl&&(this.log("Background node has been removed"),
c=!0)}for(d=0;d<a.jl.length;d++){f=a.jl[d];var h=this.aa.Aa(f,!1);"background"===h.ia("layer")&&(this.log("Background node has been added"),c=!0)}for(d=0;d<a.Bn.length;d++)f=a.Bn[d],h=this.aa.Aa(f,!1),"background"===h.ia("layer")?(this.log("Background node has been changed"),c=!0):f in this.nl&&(this.log("Node removed from background layer"),c=!0);(this.aa.se().ia("background")||this.vo)!==this.vo&&(c=!0);c&&this.Kg();a.jl.length&&this.xa.ta("nodes-added",a.jl,{},b);a.Bn.length&&this.xa.ta("nodes-changed",
a.Bn,{},b);a.Ym.length&&this.xa.ta("nodes-removed",a.Ym,a.ba,b)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.Tz=function(){this.log("getActiveLayer() -> %s",Array(this.Rb.entries()));return Array.from(this.Rb).join(",")};c.prototype.en=function(a){this.log("setActiveLayer(%s)",a);a=a.split(",");this.Rb=new Set;for(var b=0;b<a.length;b++)this.Rb.add(a[b]);this.ad=a[0];this.ub();this.pc();this.la()};c.prototype.Ak=function(a,b){this.aa.Ak(a,b);this.fh(!1);"background"===a&&this.Kg();
!b&&this.Rb.has(a)&&(this.ub(),this.pc());this.la()};c.prototype.zh=function(a){var b=this;this.log("setDocument()");this.Ab();this.aa.Ta();this.aa=a;this.aa.zv=function(a,d,c,k,l){b.Mm(a,d,c,k,l)};this.scale=1;this.Hb=this.Gb=0;this.selection=[];this.Ie=this.Ja=null;this.Wc+=1;this.de=new G(0,0,0,0);this.Yq=new Bc(this.de);this.Xq=new H;this.ei="";this.Rb=new Set;this.Rb.add("default");this.zc=q.Lc;this.oc=this.ha.gb("defaultBrushColour");this.bd=this.ha.gb("defaultStrokeStyle");this.ua.lineWidth=
this.ha.gb("defaultLineWidth");this.ua.roughness=this.ha.gb("defaultRoughness");this.ua.sloppiness=.5;this.ua.fontName=this.ha.gb("defaultFont");this.ua.fontSize=this.ha.gb("defaultFontSize");this.ua.bold=this.ha.gb("defaultBold");this.ua.italic=this.ha.gb("defaultItalic");this.ua.smoothness=.3;this.ua.textFillStyle=this.ha.gb("defaultTextFillStyle");this.ua.textStrokeStyle=this.ha.gb("defaultTextStrokeStyle");this.ua.textLineWidth=this.ha.gb("defaultTextLineWidth");this.ua.textDecoration=this.ha.gb("defaultTextDecoration");
this.ua.textAlign=this.ha.gb("defaultTextAlign");this.Uh=this.ha.get("defaultBrushWidth");var d=this.rf(0);this.Gb=-d.x;this.Hb=-d.y;this.xd();this.aa.mr=this.ha.get("spotHighlightColour");this.aa.rn=this.ha.get("spotHighlightZIndex");this.aa.format(this.ma,this.request);this.pq=new G(0,0,0,0);this.oq=new G(0,0,0,0);"none"!==this.je?this.ee(this.je):(this.ee(this.ha.get("defaultZoom")),this.la());return a};c.prototype.Df=function(a,b){var d=!1;switch(a){case "allowResize":this.Ph();this.la();break;
case "defaultBrushColour":this.oc=b;break;case "defaultFillStyle":this.zc=this.ua.fillStyle=b;break;case "defaultStrokeStyle":this.bd=b;this.ua.strokeStyle=b;break;case "defaultLineWidth":this.ua.lineWidth=b;break;case "defaultRoughness":this.ua.roughness=b;break;case "defaultFont":this.ua.fontName=b;break;case "defaultBold":this.ua.bold=b;break;case "defaultTextAlign":this.ua.textAlign=b;break;case "defaultTextDecoration":this.ua.textDecoration=b;break;case "defaultItalic":this.ua.italic=b;break;
case "defaultFontSize":this.ua.fontSize=b;break;case "defaultTextFillStyle":this.ua.textFillStyle=b;break;case "defaultTextStokeStyle":this.ua.textStrokeStyle=b;break;case "defaultTextLineWidth":this.ua.textLineWidth=b;break;case "defaultBrushWidth":this.Uh=b;break;case "defaultZoom":this.ee(b);break;case "pageView":this.Mf=b;d=!0;break;case "pagePlacement":case "pageInflation":case "viewMargin":this.ee(this.je);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":"background"===
a&&(d=this.aa.se(),this.aa.Qd([d.id],"background",b));this.Xi=null;this.background.SC();this.Kg();d=!0;this.fh(!1);break;case "pageShadow":case "outsidePageColour":case "clipToPage":d=!0;break;case "readOnly":!0===b&&(this.Ab(),this.ub(),this.pc(),d=!0);this.aa.Fi(b);break;case "spotHighlightColour":this.aa.mr=b;d=!0;break;case "spotHighlightZIndex":this.aa.rn=b;d=!0;break;case "showRuler":case "pixelsPerUnit":case "units":d=!0;break;case "allowScroll":case "scrollbars":d=!0;this.xd();break;case "useSelectionHandles":this.Ph(),
d=!0}this.sa.Df&&this.sa.Df(a,b);d&&this.la()};c.prototype.Lf=function(a,b){this.log("Set default %s=%s",a,b);this.ua[a]=ic(this.ua[a],b);switch(a){case "fillStyle":this.oc=this.zc=b;break;case "strokeStyle":this.oc=this.bd=b}};c.prototype.ee=function(a){a!==this.je&&this.log("Zooming to: %s (scale %s)",a,this.scale);var b=this.nf(!0),d=b.width-20,c=this.aa.uu()||this.Mf;this.je=a;c||"number"===typeof a||this.log("WARNING: Zoom to page/width but document size has not been set.");if("number"===typeof a)this.scale=
a;else if("none"===a||this.aa.empty())"page"===a?this.ze(this.rf(),!1,!1):this.scale=1;else{if("page"===a){var f=this.pf();this.ze(f,"centre"===this.ha.get("pagePlacement"),!0);this.je=c?a:this.scale;this.sa.Ld&&this.sa.Ld();return!0}"width"===a&&(f=this.pf(),this.scale=d/f.width,this.Gb=-f.x*this.scale+b.x,this.Hb=-f.y*this.scale+b.y,this.log("RECT=%s scale=%s tx=%s ty=%s",f,this.scale,this.Gb,this.Hb),this.je=a)}0>=this.scale&&(this.scale=1);c||(this.je=this.scale);this.xd();this.la();this.sa.Ld&&
this.sa.Ld();return!0};c.prototype.Pd=function(a,b,d){void 0===d&&(d=!1);a=this.jm().apply(a,b);d||(a=this.rb(a,0));return a};c.prototype.Xh=function(a,b){return this.jm().inverse().apply(a,b)};c.prototype.SB=function(a,b,d){return a.Zb().multiply(this.jm()).apply(b,d)};c.prototype.Ze=function(a){return this.Pd(a.pageX,a.pageY,!0)};c.prototype.Kd=function(a,b){if(z.xf(b.target,b))this.log("Target is text entry -- ignore key command");else if(this.sa.Kd&&this.sa.Kd(a,b),this.hg.Kd(a,b),!this.cB(a,
b)){switch(a){case "next-page":this.Fc(this.aa.fb+1);break;case "previous-page":this.Fc(this.aa.fb-1);break;case "zoom-to-page":this.ha.get("allowZoom")&&this.ee("page");break;case "zoom-to-width":this.ha.get("allowZoom")&&this.ee("width")}b.preventDefault();b.stopPropagation()}};c.prototype.ui=function(a){var b=a instanceof me?a.qb.target:a.target;var d=this.ha.get("readOnly");d=(b=b?z(b):null)&&(!b.matches(".zwibbler-canvas-holder,.zwibbler-canvas-holder *, [z-drag-tool], [z-drag-tool] *, [z-fixture] *")||
b.matches(".zwibbler-passthrough, .zwibbler-passthrough *")&&(!(a instanceof me)||this.Ku(a)||b.matches(".zwibbler-scrollbar"))||d&&b.matches(".zwibbler-dom-node,.zwibbler-dom-node *"));if(a instanceof me)if(d=d&&!a.getData("not-passthrough")&&!this.Xp,!d&&"down"===a.type)a.setData("not-passthrough",!0);else if("gesturestart"===a.type)d=d&&this.Pe(a.sb,a.tb);else if(!d&&"wheel"===a.type&&!a.ctrlKey&&b&&b.matches("[nid] *, [nid]")&&this.Ku(a))for(a=b.da;a;){if(a.scrollHeight!==a.offsetHeight){this.log("wheel is over scrolling element; passthrough event.");
d=!0;break}if(a.hasAttribute("nid"))break;a=a.parentElement}return d};c.prototype.Ku=function(a){a=this.Ze(a);a=this.aa.Db(a.x,a.y,this.scale,this.Rb);return a.node&&Uc(a.node)};c.prototype.Pe=function(a,b){a=this.Pd(a,b);return this.Ub().Oc(a.x,a.y)};c.prototype.kB=function(a){return a.target instanceof HTMLElement?z(a.target).matches("[z-fixture], [z-fixture] *"):!1};c.prototype.ny=function(){this.Au=(new Date).getTime()+200};c.prototype.JC=function(){function a(a){d.log(a.type)}function b(a){a.stopPropagation();
a.preventDefault()}var d=this,c=this,f=new ve(this.Sc,{Ls:this.ha.get("allowPointerEvents"),Dn:!0});this.Lw=f;this.za.add(function(){f.Ta()});f.pa("gesturestart",function(a){c.log("GestureStart");d.ui(a)||(c.sa.xb&&!1!==c.sa.xb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser"))});f.pa("gesturechange",function(a){c.sa.xb&&!1!==c.sa.xb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});f.pa("gestureend",function(a){c.log("GestureEnd");c.sa.xb&&!1!==c.sa.xb(a)?
(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});var h="onpointerdown"in window,k="ongesturestart"in window,l="onmousedown"in window;this.log("Have TouchEvents: %s","ontouchstart"in window);this.log("Have PointerEvents: %s",h);this.log("Have GestureEvents: %s",k);this.log("Have MouseEvents: %s",l);h&&!this.ha.get("allowPointerEvents")&&this.log("Configuration does not allow PointerEvents");var n=!1,r;f.pa("down",function(a){c.log(a.toString());if(!d.ui(a))if(d.qy(),d.Ru=a.Yp(),
r=c.Ze(a),n=!0,d.xa.gf&&d.xa.gf.yb(r.x,r.y,a))a.stopPropagation(),a.preventDefault();else{var b=!1;c.sa.yb&&!1!==c.sa.yb(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault(),b=!0);b||d.hg.handleEvent(a);d.Il||z.xf(a.target)||d.Tc.ta("goto-canvas");d.Il=!1}});f.pa("move",function(a){if(!d.ui(a))if(n&&0===a.buttons&&(c.log("MISSED POINTERUP! Fixing."),a.setData("not-passthrough",!1),v(a)),d.hg.Oe()&&d.hg.handleEvent(a))a.stopPropagation(),a.preventDefault();else{var b=!1;r=c.Ze(a);d.xa.gf&&d.xa.gf.Eb(r.x,
r.y,a)?(a.stopPropagation(),a.preventDefault()):(c.sa.Eb&&!1!==c.sa.Eb(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault(),b=!0),b||d.hg.handleEvent(a))}});var v=function(a){if(!d.ui(a)||d.sa instanceof jg){var b=n=!1;d.hg.Oe()&&d.hg.handleEvent(a)?(a.stopPropagation(),a.preventDefault()):(c.log(a.toString()),r=c.Ze(a),d.xa.gf&&d.xa.gf.ac(r.x,r.y,a)?(a.stopPropagation(),a.preventDefault()):(c.sa.ac&&!1!==c.sa.ac(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault(),b=!0),b||d.hg.handleEvent(a)))}};
f.pa("up",v);f.pa("tap",function(a){c.log(a.toString());c.sa.sq&&(r=c.Ze(a),!1!==c.sa.sq(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault()))});f.pa("drag",function(a){c.log(a.toString());d.ui(a)||(d.xa.gf&&d.xa.gf.Nm(r.x,r.y,a)?(a.stopPropagation(),a.preventDefault()):c.sa.Nm&&(r=c.Ze(a),!1!==c.sa.Nm(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault())))});f.pa("doubletap",function(a){c.log("doubletap: "+a.toString());a.startTime<d.Au?c.log("ignoring doubletap: "+a.toString()):(c.log("doubletap: "+
a.toString()),c.sa.rq&&(r=c.Ze(a),!1!==c.sa.rq(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault())))});this.za.addEventListener(this.Sc,"pointerleave",function(a){c.sa.tv&&(r=c.Ze(a),!1!==c.sa.tv(r.x,r.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.za.addEventListener(this.Sc,"contextmenu",function(a){var b=c.Ze(a);c.sa.pv&&!1!==c.sa.pv(b.x,b.y,a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass contextmenu to browser")});this.za.addEventListener(this.Sc,"mouseenter",b);this.za.addEventListener(this.Sc,
"mouseleave",b);this.za.addEventListener(this.Sc,"mouseover",b);this.za.addEventListener(this.Sc,"mouseout",b);!window.parent&&this.ha.get("setFocus")&&this.Sc.focus();f.pa("wheel",function(a){if(!d.ui(a)){var b=a.iA();r=c.Ze(a);if(!c.sa.tq||!1===c.sa.tq(r.x,r.y,b,a.qb)){if(a.ctrlKey&&d.ha.get("allowZoom"))d.Yw(0>b.y?1/1.1:1.1,r.x,r.y);else if("page"!==d.je){var e=c.pf(),f=c.Ub(),h=20/d.scale;b.x&&c.Ed.Lu()&&(f.x+=0<b.x?h:-h,f.right()>e.right()&&(f.x-=f.right()-e.right()),f.x<e.x&&(f.x=e.x));b.y&&
c.Hc.Lu()&&(f.y+=0<b.y?h:-h,f.bottom()>e.bottom()&&(f.y-=f.bottom()-e.bottom()),f.y<e.y&&(f.y=e.y));c.ze(f)}a.stopPropagation();a.preventDefault()}}});this.za.addEventListener(this.Sc,"drop",a);this.za.addEventListener(this.Sc,"dragenter",a);this.za.addEventListener(this.Sc,"dragleave",a)};c.prototype.gk=function(a){this.log("Received clipboard event: %s",a.type);if(z.xf(a.target))this.log("   ignored due to being in a "+a.target.tagName);else if(this.ha.get("allowSystemClipboard"))if(null===a.clipboardData)this.log("Ignored; clipboardData is null.");
else{var b=this;switch(a.type){case "copy":case "cut":if(!this.tu())break;this.log("Cut to system clipboard.");var d=this.Ig(!0,this.Uc(!1));a.clipboardData.setData("application/zwibbler",d);a.preventDefault();"cut"===a.type&&this.kj();break;case "paste":if(this.ha.get("readOnly"))this.log("Ignore paste; we are in readOnly mode.");else for(this.log("There are %s items on the clipboard",a.clipboardData.items.length),d=0;d<a.clipboardData.items.length;d++){var c=a.clipboardData.items[d];this.log("Item [%s] type is %s",
d,c.type);if(b.Fq(c)){a.preventDefault();break}else if("application/zwibbler"===c.type){this.log("Pasting from system clipboard");c.getAsString(function(a){b.ik(a)});a.preventDefault();break}}}}else this.log("   ignored due to allowSystemClipboard setting.")};c.prototype.sf=function(){return this.Sc};c.prototype.Fq=function(a,b,d){var c=this;if(0!==a.type.indexOf("image/"))return!1;a instanceof Blob||(a=a.getAsFile());if("number"===typeof b&&"number"===typeof d){b=this.Pd(b,d);var f=b.x;var h=b.y}if(!1===
this.xa.rc("paste",a,f,h))this.log("paste of file is cancelled by external app.");else{var k=new FileReader;k.readAsDataURL(a);k.onloadend=function(){c.mq({url:k.result},f,h)};return!0}};c.prototype.cB=function(a,b){if(!this.Ra.Ob)return!1;if(!(b.target instanceof HTMLElement&&z(b.target).matches(".zwibbler-passthrough, .zwibbler-passthrough *"))){var d=0,c=0,f=this.ha.get("nudge");switch(a){case "right":d=f;break;case "left":d=-f;break;case "down":c=f;break;case "up":c=-f;break;case "enter":this.Ra.qc=
!this.Ra.qc;var h=this.Ra.qc?"down":"up"}if(d||c)h=this.nf(!1),this.Ra.x+=d,this.Ra.x=Math.max(this.Ra.x,0),this.Ra.x=Math.min(h.width,this.Ra.x),this.Ra.y+=c,this.Ra.y=Math.max(this.Ra.y,0),this.Ra.y=Math.min(h.height,this.Ra.y),this.la(),h="move";return h?(b.preventDefault(),b.stopPropagation(),this.la(),c=this.Xb,d=this.Ra.x+c.x-window.pageXOffset,a=this.Ra.y+c.y-window.pageYOffset,c=this.Pd(d,a),this.log("Simulate a %s at (%s,%s)",h,d,a),b=new me(h,d,a,d,a,(new Date).getTime(),(new Date).getTime(),
b.target,b,0,{},0,0,0,b.ctrlKey,b.shiftKey,b.altKey,b.metaKey),"down"!==h&&"tap"!==h||!this.sa.yb||this.sa.yb(c.x,c.y,b),"move"===h&&this.sa.Eb&&this.sa.Eb(c.x,c.y,b),"up"!==h&&"tap"!==h||!this.sa.ac||this.sa.ac(c.x,c.y,b),!0):!1}};c.prototype.hr=function(a){void 0===a&&(a=!1);this.Ra.Ob=!0;this.Ra.qc=!1;this.Ra.yo=a;this.log("Showing keyboard cursor, caret=%s",a);this.la()};c.prototype.UD=function(a){this.Ra.Ob=!0;this.Ra.yo=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");
this.Ra.qc=!0;var b=this.de.ne();this.Ra.x=b.x;this.Ra.y=b.y;this.Ab();this.Ya(new Je(this,new De(xe,this.selection[0].Pa(),this.selection[0].ya),!1,b.x-4,b.y-4,ne(a,a)))}this.la()};c.prototype.xu=function(){this.Ra.Ob&&(this.log("Hiding keyboard cursor"),this.Ra.Ob=!1,this.la())};c.prototype.rB=function(a){var b=this.Xb,d=this.Hc.Wg();var c=a.pageX-b.x;a=a.pageY-b.y;b=this.nf(!1);return this.yg&&c>b.width-this.yg.width-d&&a<this.yg.height};c.prototype.Mu=function(){return this.ha.KE(this.Ru)};c.prototype.Ip=
function(a){return"number"===typeof a?a||this.ha.get("snap")||0:a.altKey?0:this.ha.get("snap")||0};c.prototype.rb=function(a,b){var d=this.Ip(b);0<d?(b=Math.round(a.x/d)*d,a=Math.round(a.y/d)*d):(b=a.x,a=a.y);return new F(b,a)};c.prototype.Xd=function(a,b){void 0===b&&(b=this.Uc(!1));this.aa.bb();this.aa.Xd(b,a);this.aa.wa()};c.prototype.setProperty=function(a,b){var d=this.Uc(!0);this.ua[a]=b;if(d.length){this.aa.bb();this.aa.Qd(d,a,b);if("fillStyle"===a)for(var c=0;c<d.length;c++){var f=this.aa.Aa(d[c],
!1);f&&(this.log("nodeType=%s closed=%s",f.type(),f.ia("closed")),"PathNode"===f.type()&&!1===f.ia("closed")&&this.aa.Qd([d[c]],"strokeStyle",b))}this.aa.wa()}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.Uh=b:"textFillStyle"===a&&(this.ua.textFillStyle=b)};c.prototype.kd=function(a,b){this.sa.kd&&this.sa.kd(a,b);this.sa.ve&&("strokeStyle"===a?this.sa.ve(b,!1):"fillStyle"===a&&this.sa.ve(b,!0))};c.prototype.Yl=function(){return this.ua.fillStyle};c.prototype.Hj=
function(){return this.ua.strokeStyle};c.prototype.fr=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);var d=this.Uc(!0);this.aa.bb();b=b?"fillStyle":"strokeStyle";for(var c=0;c<d.length;c++){var f=d[c],h=this.aa.Aa(f);h&&(h=h.ia(b))&&(h=ec(h,a),this.aa.Qd([f],b,h),this.log("   set %s of %s to %s",b,f,h))}this.aa.wa()};c.prototype.group=function(){var a=this;this.aa.transaction(function(){a.aa.group(a.Uc(!1))})};c.prototype.Ki=function(){var a=this;this.aa.transaction(function(){a.aa.Ki(a.Uc(!1))})};
c.prototype.kj=function(){var a=this;this.aa.transaction(function(){a.aa.Yb(a.Uc(!1))})};c.prototype.ub=function(a){void 0===a&&(a=!1);var b=!1;if(0<this.selection.length){b=0;for(var d=this.selection;b<d.length;b++){var c=d[b];Vc(c)&&c.da.classList.remove("zwibbler-selected")}this.Wc+=1;this.selection.length=0;b=!0}null!==this.Ie&&(this.xa.ta("selected-edit-handle",null,null),b=!0);this.Ja&&(this.log("Clear edit node."),this.Ie=this.Ja=null,b=!0);b&&a&&(this.pc(),this.la())};c.prototype.bf=function(a,
b){void 0===b&&(b=!0);this.rg(null);if(a.Wc!==this.Wc&&this.Rb.has(a.Cc())){this.selection.push(a);a.Wc=this.Wc;Vc(a)&&(a.da.classList.add("zwibbler-selected"),this.log("Added to selection: %s",a.id));if(a.ym()){for(var d=a.parent,c=0;c<d.children.length;c++){var f=d.pb(c);Tc(f)&&this.bf(f)}Tc(d)&&this.bf(d)}if("GroupNode"===a.type())for(d=0;d<a.children.length;d++)f=a.pb(d),Tc(f)&&this.bf(f);if(this.ha.get("autoGroup")&&b)for(b=0,a=this.aa.Xz(a);b<a.length;b++)this.bf(a[b],!1)}};c.prototype.selectNodes=
function(a){this.ub();for(var b=0;b<a.length;b++)a[b].ia("locked")||"PageNode"===a[b].type()||this.bf(a[b]);this.pc()};c.prototype.gD=function(a,b){var d=this.aa.Jb(a,!1);d?d.uf()&&(d.Gu()?(d!==this.Ja&&this.rg(d),this.log("Select edit handle %s",b),this.Ie=b,this.xa.ta("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable.")):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.fD=function(a){a=this.aa.NA(a);for(var b=0;b<a.length;b++)this.bf(a[b])};
c.prototype.pc=function(){this.Ph();this.xa.cg("selected-nodes");this.la()};c.prototype.Jq=function(){for(var a=0,b=this.lm;a<b.length;a++){var d=b[a];""!==d.bh&&this.sm.release(d.bh)}this.lm.length=0};c.prototype.Td=function(a,b,d,c,f,h,k,l){this.lm.push({type:h,position:new F(a,b),offset:new F(d,c),bh:f,bt:k,Aw:l});""!==f&&this.sm.add(f,f)};c.prototype.Ph=function(){var a;this.Ci=this.qk=this.cn=!0;var b=!1;this.xh.length=0;if(0!==this.selection.length){for(a=0;a<this.selection.length;a++){var d=
this.selection[a];if("GroupNode"!==d.type()){0===a?this.de=d.rect.clone():this.de.Dh(d.rect);this.de.Dh(d.rect);if(d.ia("lockSize")||5===(d.nb&5))this.cn=!1;d.ia("lockRotation")&&(this.qk=!1);d.ia("lockAspectRatio")&&(b=!0);d.ia("lockPosition")&&(this.Ci=!1)}}this.Yq=1===this.selection.length?this.selection[0].Sl():new Bc(this.de);if(this.Mu()){if(1<this.selection.length){d=new H;a=null;var c=this.de}else a=this.selection[0],c=a.ya,d=a.Pa();var f=!1;a&&a.uf()&&a.gr()&&(this.rg(a),f=!0);for(var h=
this.xa.ai(),k=0,l=this.lm;k<l.length;k++){var n=l[k];if(n.Aw&&!n.Aw(h))return;if("scale"===n.type){if(!this.ha.get("allowResize")||!this.cn)continue;if("scale"===n.type&&(0!==n.position.x&&1!==n.position.x||0!==n.position.y&&1!==n.position.y)&&b)continue;if(f)continue}else if("rotate"===n.type&&(!this.qk||f))continue;this.xh.push(Ge(n,c,d))}if(this.qk&&a&&a.ia("rotationHandles"))for(b=a.ia("rotationHandles"),a=0;a<b.length;a+=4)f=new F(b[a+2],b[a+3]),this.xh.push(new Ce(ye,d,c,f))}}};c.prototype.sy=
function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.aa.ed(this.selection[b].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.Ja&&!this.aa.ed(this.Ja.id)&&(this.Ja=null,null!==this.Ie&&this.xa.ta("selected-edit-handle",null,null),this.Ie=null)};c.prototype.Hv=function(a,b){return this.selection.length&&this.Yq.Oc(a,b)};c.prototype.tu=function(){return 0!==this.selection.length||null!==this.Ja};c.prototype.hc=function(){var a=
this.selection.concat();this.Ja&&!this.dh(this.Ja)&&a.push(this.Ja);return a};c.prototype.MA=function(a){if(0===a.length)return new F(0,0);for(var b=a[0].rect.clone(),d=1;d<a.length;d++)b.Dh(a[d].rect);return b.ne()};c.prototype.ju=function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].id);return b};c.prototype.jm=function(){var a=this.Xb.clone();this.ha.get("showRuler")&&(a.x+=20,a.y+=20);return(new H).multiply(new rc(1/this.scale,1/this.scale)).multiply(new pc(-this.Gb,-this.Hb)).multiply(new pc(-a.x,
-a.y))};c.prototype.Uc=function(a){var b=this.hc();a||(b=this.aa.wl(b));return this.ju(b)};c.prototype.lp=function(a){for(var b=null,d=0;d<a.length;d++){var c=this.aa.Jb(a[d]);c&&0==(c.nb&2)&&(null===b?b=c.rect.clone():b.Dh(c.rect))}null===b&&(b=new G(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.aa.format(this.ma,this.request)||a)this.Ph(),this.la(b)};c.prototype.Kg=function(){var a=this,b=this.ha.get("background");this.Xi&&(b=this.Xi.ia("background")||b);this.background.pD(b);
this.vo=b;this.nl={};var d=[];this.aa.Ac(function(b){"background"===b.Cc()&&a.aa.zm("background")&&(d.push(b),a.nl[b.id]=!0,b.sg(!0))});this.background.mD(d)};c.prototype.kf=function(a,b,d,c,f,h,k,l,n){this.Xi!==this.aa.se()&&(this.Xi=this.aa.se(),this.Kg());k*=b;var e=this.background.TA(a,new G(d,c,f,h),k);a.save();a.scale(1/k,1/k);a.translate(-l*b,-n*b);a.fillStyle=e;a.fillRect(0,0,f*k,h*k);a.restore();a.xx=function(){a.strokeStyle=e;a.lineWidth*=k;a.scale(1/k,1/k);a.translate(-l*b,-n*b);a.stroke()};
a.Ri=e};c.prototype.mz=function(a,b){var d=this.aa.Fp();a.beginPath();a.fillStyle=q.Lc;this.ha.get("pageShadow")&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,d.width,d.height);a.fill();a.shadowColor=q.Be;a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.ha.get("pageBorderColour");a.stroke();var c=this.Ub().clone();c.Fu(d);this.kf(a,b,c.x,c.y,c.width,c.height,this.scale,0>c.x?c.x:-c.x*this.scale,0>c.y?c.y:-c.y*this.scale)};c.prototype.tk=
function(a){a?this.log("Setting a custom background function."):this.log("Clearing custom background function.");this.background.tk(a);this.Kg()};c.prototype.lz=function(a){if(this.Ra.Ob){var b=this.Ra.x,d=this.Ra.y,c=this.au();a.save();a.setTransform(c,0,0,c,0,0);a.beginPath();this.Ra.yo?(a.moveTo(b-3,d-10),a.lineTo(b+3,d-10),a.moveTo(b-3,d+10),a.lineTo(b+3,d+10),a.moveTo(b,d-10),a.lineTo(b,d+10)):(a.moveTo(b,d-3),a.lineTo(b,d-15),a.moveTo(b,d+3),a.lineTo(b,d+15),a.moveTo(b-3,d),a.lineTo(b-15,d),
a.moveTo(b+3,d),a.lineTo(b+15,d));this.Ra.qc&&this.ma.arc(b,d,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle=q.Oa;a.stroke();a.restore()}};c.prototype.qy=function(){var a=z(this.canvas.first).gc();if(a.left!==this.Xb.x||a.top!==this.Xb.y)this.log("Canvas was repositioned!"),this.Xb.x=a.left,this.Xb.y=a.top};c.prototype.Ld=function(a,b){this.canvas.tg(a,b);a=this.ha.get("showRuler")?20:0;b=z(this.canvas.first).gc();10===this.code&&.75<this.bw&&(b.left-=100,b.top-=80);var d=z(this.canvas.first.parentElement).gc(),
c=this.canvas.width,f=this.canvas.height,h=b.left-d.left;d=b.top-d.top;this.Hc.moveTo(h+c-20,d+a);this.Hc.tg(20,f-20);this.Ed.moveTo(h+a,d+f-20);this.Ed.tg(c-20,20);this.Xb=new G(b.left,b.top,b.width,b.height);a=this.canvas.qp();a!==this.pe&&(this.pe=a,this.log("Detected DPR change to %s",this.pe),this.sa.Ld&&this.sa.Ld());this.ha.get("zoomOnResize")&&(1>this.scale&&this.ee(1),a=this.pf(),b=this.Ub(),c=!1,a.x<b.x&&(b.width+=b.x-a.x,b.x=a.x,c=!0),a.y<b.y&&(b.height+=b.y-a.y,b.y=a.y,c=!0),a.x+a.width>
b.x+b.width&&(b.width+=a.x+a.width-b.x-b.width,c=!0),a.y+a.height>b.y+b.height&&(b.height+=a.y+a.height-b.y-b.height,c=!0),c&&this.ze(b));this.zi();this.la()};c.prototype.zi=function(){if(!this.$p()){var a=this.pf(),b=this.nf(!0);b=new G(0,0,b.width,b.height);a.dd(this.pq)&&b.dd(this.oq)||!this.ee(this.je)||(this.pq=a,this.oq=b)}};c.prototype.ct=function(a){if(this.Mf&&this.ha.get("clipToPage")){var b=this.aa.Fp();a.save();a.beginPath();a.rect(0,0,b.width,b.height);a.clip()}return this.Mf};c.prototype.la=
function(a){var b=this;this.$p()||this.canvas.Od(0,"main",function(d,c){d.globalAlpha=1;b.vt(d,c,a)})};c.prototype.vt=function(a,b,d){if(!this.xa.Vh){var c=this.Ub();this.Mf&&(a.fillStyle=this.ha.get("outsidePageColour"),a.fillRect(0,0,this.canvas.width,this.canvas.height));a.translate(this.Gb,this.Hb);a.scale(this.scale,this.scale);this.ha.get("showRuler")&&a.translate(20/this.scale,20/this.scale);var f=new pc(this.Gb,this.Hb);f=f.multiply(new rc(this.scale,this.scale));a.Oi=f;a.PF=this.scale;this.Mf?
this.mz(a,b):this.kf(a,b,c.x,c.y,c.width,c.height,this.scale,this.Gb,this.Hb);this.aa.TD();f=this.ct(a);this.aa.la(a,c,this.jo);this.xa.Ge&&(a.save(),this.xa.Ge(a),a.restore());f&&a.restore();0<this.selection.length&&this.Mu()&&(a.save(),this.oz(a),a.restore());this.Ja&&this.Ja.qj(a,1/this.scale,this.Ie);""!==this.ei&&this.ha.get("showHints")&&(a.save(),a.font=15/this.scale+"px Arial",a.fillStyle=q.Oa,a.textBaseline="top",a.fillText(this.ei,0,0),a.restore());this.lz(a);this.sa.vv&&this.sa.vv(a);d&&
d(a);this.xa.rc("draw",a);this.ha.get("showRuler")&&(a.setTransform(b,0,0,b,0,0),b=this.ha.get("pixelsPerUnit")*this.scale,d=this.ha.get("units"),a.fillStyle="#ccc",a.fillRect(0,0,20,20),Id(a,new G(20,0,this.canvas.width-20,20),0,d,b,-this.Gb),Id(a,new G(0,20,20,this.canvas.height-20),2,d,b,-this.Hb));a.setTransform(1,0,0,1,0,0);0<this.selection.length&&this.yg&&this.yg.naturalWidth&&(b=this.yg.width,a.drawImage(this.yg,this.canvas.width-b-this.Hc.Wg(),0));this.pj&&this.pj.complete&&this.pj.naturalWidth&&
(b=this.pj.naturalWidth,a.drawImage(this.pj,this.canvas.width-b-this.Hc.Wg(),0));a.globalAlpha=1}};c.prototype.Tv=function(a,b){var d=this;this.ha.get("fastDraw")?this.canvas.Od(1,a,function(a){a.translate(d.Gb,d.Hb);a.scale(d.scale,d.scale);d.ha.get("showRuler")&&a.translate(20/d.scale,20/d.scale);b(a)}):this.la(b)};c.prototype.Do=function(a){this.ha.get("fastDraw")?this.canvas.Od(1,a,function(){}):this.la()};c.prototype.oz=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();
for(var b=0,d=null,c=0;c<this.selection.length;c++){var f=this.selection[c];var h=f.Pa();if(!f.hidden()&&(b++,f!==this.Ja&&!Uc(f))){f=f.ya;var k=new xc(f);k.transform(h);h=h.vb();1E4>2*(f.width+f.height)*(h.x+h.y)/2/3*this.scale?k.Gl(a,[3/this.scale,3/this.scale]):k.la(a);b++;d?d.Dh(k.rl(5)):d=k.rl(5)}}if(0!==b)for(a.stroke(),b=d?Math.min(d.width,d.height):0,c=0;c<this.xh.length;c++)this.xh[c].la(a,this.sm,this.scale,this.Xq,b)};c.prototype.rg=function(a){this.Ja=a};c.prototype.tp=function(){return this.Ja};
c.prototype.yn=function(a){this.Xq=a};c.prototype.dh=function(a){return a.Wc===this.Wc};c.prototype.cu=function(a,b){for(var d=this.ha.get("touchRadius")||this.cs,c=null,f=0;f<this.xh.length;f++){var h=this.xh[f];if(h.Db(this.sm,a,b,d,this.scale)){c=h;break}}return c};c.prototype.Xc=function(){this.Pw(!1)};c.prototype.ye=function(){this.Pw(!0)};c.prototype.Pw=function(a){if(a?this.aa.cf():this.aa.df())a?this.aa.ye():this.aa.Xc(),a=this.aa.ji,this.log("Most recent change page=%s",a),a!==this.aa.fb?
(this.log("Undo/redo switched page %s->%s",this.aa.fb,a),this.Fc(a)):this.la(),this.fh(!1)};c.prototype.Mm=function(a,b,d,c,f){var e=this;if(b.length&&!a){for(var k=[],l=0;l<b.length;l++){var n=this.aa.Jb(b[l],!1);n&&k.push(n)}this.ha.get("autoPickTool")&&this.selectNodes(k)}else if(this.selection.length||this.Ja){k=0;this.Wc+=1;n=this.aa.fb;for(l=0;l<this.selection.length;l++)l!==k&&(this.selection[k]=this.selection[l]),this.aa.ed(this.selection[k].id)&&this.aa.qf(this.selection[k].id)===n||this.aa.qB(this.selection[k])?
(this.selection[k].Wc=this.Wc,k++):this.log("Node no longer exists; removing from selection %s",this.selection[k]);this.selection.length!==k&&(this.selection.length=k);this.Ja&&!this.aa.ed(this.Ja.id)&&(this.log("EditNode %s no longer exists",this.Ja.id),this.Ja=null,null!==this.Ie&&this.xa.ta("selected-edit-handle",null,null),this.Ie=null);0!==this.selection.length||this.Ja||this.ub();this.pc()}this.aa.format(this.ma,this.request);this.sy();this.Ph();this.zi();this.xd();this.la();this.vg.clear();
this.aa.Ac(function(a){5===(a.nb&5)&&e.vg.Hs(a.rect,a.id)});this.bB({jl:b,Ym:d,Bn:c,ba:f},a);this.fh(a)};c.prototype.Po=function(){this.Ig(!1,this.Uc(!0));this.kj()};c.prototype.Ig=function(a,b){b=this.aa.Ep(b,!1);var d=this.aa.dD(b);0<b.length&&(!0!==a&&Df.setItem("clipboard",d),this.log("Reset paste offset to 0"),this.Ik=this.Hk=0);return d};c.prototype.duplicate=function(){var a=this,b=this.Uc(!1),d=this.ha.get("pasteOffset"),c=d||this.ha.get("pasteOffsetX"),f=d||this.ha.get("pasteOffsetY");this.aa.transaction(function(){a.aa.duplicate(b,
new pc(c,f))})};c.prototype.ik=function(a){var b=this,c=[];if(!a){var e=Df.getItem("clipboard");if(e)a=e;else return c}var f=this.ha.get("pasteOffset");e=f||this.ha.get("pasteOffsetX");f=f||this.ha.get("pasteOffsetY");this.Hk+=e;this.Ik+=f;this.log("Using paste offset %s,%s",this.Hk,this.Ik);var h=new pc(this.Hk,this.Ik);this.aa.transaction(function(){c=b.aa.Vu(a,h,b.ad)});return c};c.prototype.hn=function(a){""!==a?(this.ei=this.language.get(a),this.xa.ta("hint",this.ei)):(this.ei="",this.xa.ta("hint",
""))};c.prototype.Ab=function(){return this.Ya(new Pf(this))};c.prototype.Qy=function(){return requestAnimationFrame.name.substr(0,2)+"d"};c.prototype.Ya=function(a){this.sa&&this.sa.Dc&&this.sa.Dc();this.sa=a;a.Bd&&a.Bd();a.Dd&&this.xa.ta("tool-changed",a.Dd());10===this.code&&.25>this.bw&&this.kd("fillStyle",this.Qy());return a};c.prototype.Yh=function(){var a=null;this.sa.Dd&&(a=this.sa.Dd());return a};c.prototype.wr=function(a){a=new Le(this,a);this.Ya(a);return a};c.prototype.sr=function(a){this.sa instanceof
Le&&this.sa.bE(a)};c.prototype.Uu=function(a,b,c,e){this.Ya(new Nf(this,"line",a,b,c,e))};c.prototype.To=function(a){a.lineWidth=a.lineWidth||this.Uh;a.strokeStyle=a.strokeStyle||this.oc;this.Ya(new Mf(this,a,"brush"))};c.prototype.pz=function(a){a.lineWidth=a.lineWidth||this.Uh;a.strokeStyle=a.strokeStyle||this.oc;this.Ya(new Mf(this,a,"shapebrush"))};c.prototype.tt=function(a,b){a.lineWidth=a.lineWidth||this.Uh;a.strokeStyle=a.strokeStyle||this.oc;this.Ya(new Mf(this,a,b))};c.prototype.jt=function(a){this.Ya(new Nf(this,
"curve",a))};c.prototype.Yx=function(a,b){this.Ya(new Nf(this,"arrow",a,b))};c.prototype.pf=function(){var a=this.ha.get("pageInflation");if(this.Mf){a=this.aa.Fp();var b=this.ha.get("pageInflation");a.Hd(b,b)}else a=this.rf(this.aa.fb,a);return a};c.prototype.rf=function(a,b){void 0===a&&(a=this.aa.fb);void 0===b&&(b=0);var c=new kc(0,0);this.ha.get("pageView")&&(c=rg);c=this.aa.fd(a,c);0===c.width&&0===c.height&&(c=this.Ub(),c.x=0,c.y=0,c.width*=this.scale,c.height*=this.scale,a=this.aa.kp(a),this.aa.lB(a)||
a.Hd(b),c.Dh(a));return c};c.prototype.eB=function(){return this.ha.get("pageView")||this.aa.uu()};c.prototype.Er=function(){var a=this.Xb.clone(),b=this.nf(!1);a.x+=b.x;a.y+=b.y;var c=z(this.Sc).gc(),e=a.x-c.left;a=a.y-c.top;this.aa.Gd.style.transform="translate("+(this.Gb+b.x)+"px, "+(this.Hb+b.y)+"px) scale("+this.scale+")";this.Ck.style.transform="translate("+(this.Gb+e)+"px, "+(this.Hb+a)+"px) scale("+this.scale+")"};c.prototype.xd=function(){if(!this.$p())if(this.Er(),this.xa.ta("scroll"),this.ha.get("scrollbars")&&
this.ha.get("allowScroll")){var a=this.nf(!1),b=this.pf(),c=this.Ub(),e=!1,f=!1;c.y<=b.y&&c.bottom()>=b.bottom()?this.Hc.wf():(this.Hc.show(),this.Hc.ww(Math.min(c.y,b.y),Math.max(c.bottom(),b.bottom()),c.height,-this.Hb/this.scale),e=!0);c.x<=b.x&&c.right()>=b.right()?this.Ed.wf():(this.Ed.show(),this.Ed.ww(Math.min(c.x,b.x),Math.max(c.right(),b.right()),c.width,-this.Gb/this.scale),f=!0);f&&e?(this.Hc.tg(20,a.height-20),this.Ed.tg(a.width-20,20)):e?this.Hc.tg(20,a.height):f&&this.Ed.tg(a.width,
20);this.aa.Vq(c)}else this.Hc.wf(),this.Ed.wf()};c.prototype.Ei=function(a,b,c){this.log("Set document size %s,%s",a,b);this.aa.bb();this.aa.setProperty("width",a);this.aa.setProperty("height",b);this.aa.wa(c);this.xd();this.zi();this.fh(!1)};c.prototype.Hm=function(a,b,c){var d=this;if(this.Ci)if(this.Ra.Ob)this.log("Not nudging; keyboard cursor shown.");else{a*=c/this.scale;b*=c/this.scale;this.log("Nudge selection by %s, %s",a,b);var f=this.Uc(!0),h=new pc(a,b);this.aa.transaction(function(){d.aa.xg(f,
h)});return 0<f.length}else this.log("Can't nudge; selection motion is locked.")};c.prototype.gm=function(a,b){return hc(a,this.Fs({fillStyle:this.zc,strokeStyle:this.bd,textFillStyle:this.ua.textFillStyle,seed:Math.round(65535*Math.random()),lineWidth:this.oo(this.ua.lineWidth),roughness:this.ua.roughness,sloppiness:this.ua.sloppiness,layer:this.ad,wrap:this.ha.get("multilineText"),fontSize:this.ha.get("defaultFontSize"),fontName:this.ha.get("defaultFont"),dashes:this.ua.dashes}),b)};c.prototype.Lk=
function(a){var b=new L;var c=new F(-50,-50);var e=new F(50,-50);var f=new F(50,50);var h=new F(-50,50);b.moveTo(c.x,c.y);b.lineTo(e.x,e.y);b.lineTo(f.x,f.y);b.lineTo(h.x,h.y);b.lineTo(c.x,c.y);b.close();a=this.gm({commands:b.vc()},a);this.log("Create an item on layer %s",this.ad);this.Ya(new Qf(this,"PathNode",a,100,100,"rectangle","rectangle",null))};c.prototype.Jr=function(a,b,c,e){var d=0,h=0;"matrix"in e&&(d=e.matrix.m12,h=e.matrix.m21,delete e.matrix);var k=G.Ag(Oc(a,50,b,c,e.matrix));e=this.gm({sides:a,
rotation:b,radius:50,oddRadiusScaling:c,skewX:d,skewY:h},e);this.log("Create an item on layer %s",this.ad);this.Ya(new Qf(this,"PathNode",e,k.width,k.height,this.ha.bu(),"polygon",null))};c.prototype.nC=function(){this.Ya(new Sf(this))};c.prototype.En=function(a){a=this.gm({commands:Cd()},a);this.Ya(new Qf(this,"PathNode",a,100,100,this.ha.bu(),"circle",null))};c.prototype.Kr=function(a,b,c,e,f,h){"PathNode"===a&&(b=this.gm({},b));this.Ya(new Qf(this,a,b,c,e,f,"shape",h))};c.prototype.FE=function(a,
b){this.Ya(new Rf(this,a,b))};c.prototype.Ir=function(a){var b=this.aa.Jb(a,!1);b?b.uf()?(this.Ab(),this.ub(),this.pc(),this.rg(b),this.la()):this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()):this.log("useEditHandleTool: node %s doesn't exist.",a)};c.prototype.Fs=function(a){"layer"in a||"default"===this.ad||(a=hc({layer:this.ad},a));return a};c.prototype.mq=function(a,b,c){var d=this;return new Promise(function(e){function f(b){b=b instanceof HTMLImageElement?new kc(b.naturalWidth,
b.naturalHeight):new kc(b.width,b.height);b.Lt(a.width,a.height);return b}function k(f,h){var k=d.Ub(),l=k.ne();"number"===typeof b&&"number"===typeof c&&(l=new F(b,c));var n=Math.min(1,k.width/h.width);n=Math.min(n,k.height/h.height);l.x-=h.width*n/2;l.y-=h.height*n/2;var r=(new rc(n,n)).multiply(new pc(l.x,l.y));d.aa.transaction(function(){var b=d.aa.createNode(f,hc(d.Fs({matrix:r,allowCrop:d.ha.get("allowCrop")}),a));e(b)});d.Ab()}var l=a.url;if(/^data:image\/svg|\.svg$/i.test(l)){var n=new de;
n.wq(l).then(function(){k("SvgNode",f(n.rect))})}else{var r=document.createElement("img");r.src=a.url;r.onload=function(){k("ImageNode",f(r))}}})};c.prototype.Zd=function(){return z.du()};c.prototype.aC=function(a,b){this.sa.ve?(this.log("Simulating click of colour %s",a),this.sa.ve(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.fC=function(a,b){this.sa.lg?(this.log("Simulating opacity change %s",a),this.sa.lg(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.Fc=
function(a){this.aa.Fc(a)&&(this.ub(),this.pc(),this.zi(),this.la(),this.xa.ta("set-page",a))};c.prototype.dr=function(a){this.Mf=a;a=this.pf();this.Gb=-a.x;this.Hb=-a.y;this.xd();this.la()};c.prototype.iw=function(a){var b=this.Ub(),c=b.width/a;a=b.height/a;b.x-=(c-b.width)/2;b.y-=(a-b.height)/2;b.width=c;b.height=a;this.ze(b)};c.prototype.Kn=function(){this.iw(this.ha.yi(1.1*this.scale)/this.scale)};c.prototype.Ln=function(){this.iw(this.ha.yi(this.scale/1.1)/this.scale)};c.prototype.vj=function(a,
b,c){var d=this;c=c||this.MA(a);var f=new sc(b,c.x,c.y);this.aa.transaction(function(){d.aa.xg(d.ju(a),f)})};c.prototype.Ot=function(a,b){this.tu()||this.log("flipSelection: selection is empty");this.vj(this.hc(),a,b)};c.prototype.au=function(){var a=this.ma;return(window.devicePixelRatio||1)/(a.QE||a.LB||a.OB||a.UB||a.gy||1)};c.prototype.np=function(){return new kc(this.canvas.width,this.canvas.height)};c.prototype.nf=function(a){var b=this.np();b=new G(0,0,b.width,b.height);a&&(a=this.ha.get("viewMargin"),
b.x+=a[3],b.y+=a[0],b.width-=a[1]+a[3],b.height-=a[0]+a[2]);return b};c.prototype.Ub=function(){var a=this.nf(!0);if(0<a.width){var b=this.ha.get("viewMargin");this.Qu=new G((0-this.Gb+b[3])/this.scale,(0-this.Hb+b[0])/this.scale,a.width/this.scale,a.height/this.scale)}return this.Qu};c.prototype.ze=function(a,b,c,e){void 0===b&&(b=!1);void 0===c&&(c=!1);void 0===e&&(e="centre"!==this.ha.get("pagePlacement"));this.log("setViewRect(%s)",a);e&&this.eB()&&(a=a.clone(),a.Ho(this.pf()));e=this.nf(!0);
var d=Math.min(e.width/a.width,e.height/a.height)||1,h=a.x*d-e.x,k=a.y*d-e.y;this.Gb=b?(e.width-a.width*d)/2-h:-h;this.Hb=c?(e.height-a.height*d)/2-k:-k;this.je=this.scale=d;this.sa.Ld&&this.sa.Ld();this.xd();this.la()};c.prototype.Oz=function(a){this.request.vm()?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Cm=function(a){!this.Mh&&a?(this.log("Locking updates."),this.Mh=
!0):this.Mh&&!a&&(this.log("Resuming updates"),this.Mh=!1,this.zi(),this.xd(),this.la())};c.prototype.$p=function(){this.Mh&&this.log("Updates are locked. Ignoring draw/format request");return this.Mh};c.prototype.fh=function(a){this.xa.cg("document-changed",{remote:a})};c.prototype.yi=function(a){return this.ha.yi(a)};c.prototype.Kb=function(a){this.me.style.cursor=a;this.Xp=0<=a.indexOf("resize")};c.prototype.scrollIntoView=function(a,b){if(this.ha.get("allowScroll")){var c=0,e=0,f=this.pf(),h=
this.Ub(),k=this.Xh(a,b),l=this.Xh(h.x,h.y),n=this.Xh(h.right(),h.bottom());l=new G(l.x,l.y,n.x-l.x,n.y-l.y);k.x>l.x-50&&k.x<l.x+100&&(c=-25/this.scale);k.y>l.y-50&&k.y<l.y+100&&(e=-25/this.scale);k.x>l.right()-100&&k.x<l.right()+50&&(c=25/this.scale);k.y>l.bottom()-100&&k.y<l.bottom()+50&&(e=25/this.scale);0<c?(c=Math.max(0,Math.min(c,f.right()-h.right())),c=Math.max(0,c)):0>c&&(c=Math.max(c,Math.min(0,f.x-h.x)));0<e?(e=Math.min(e,f.bottom()-h.bottom()),e=Math.max(0,e)):0>e&&(e=Math.max(e,Math.min(0,
f.y-h.y)));if(c||e)h.x+=c,h.y+=e,this.log("ScrollIntoView: offset %s,%s pt=%s,%s doc=%s view=%s",c,e,a,b,f,h),this.ze(h)}};c.prototype.Xe=function(a){a?(this.Zw.classList.add("dragging"),this.Sc.classList.add("zwibbler-dragging")):(this.Zw.classList.remove("dragging"),this.Sc.classList.remove("zwibbler-dragging"))};c.prototype.lD=function(a){a!==this.jo&&(this.jo=a,this.la())};c.prototype.Yw=function(a,b,c){var d=this.ha.yi(this.scale/a);d!==this.scale/a&&(a=this.scale/d);a=new rc(a,a,b,c);b=this.Ub();
b.transform(a);this.ze(b)};c.prototype.Lo=function(a,b,c,e){b.$type="HTMLNode";b.$component=a;a=this.aa.Wu(this.aa.Cj(),b);Tc(a)?(a.format(this.ma,this.request),this.Ya(new jg(this,{pageX:c,pageY:e,sb:c,tb:e},a,1))):this.log("Error: createHTMLNodeFromDrag: Node is not drawable.")};return c}();function tg(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||location.hostname===ng("        \u001d98$").toLowerCase()?1:0}
function ug(c,a){if(!(tg()||.04<a)){a=ng("2#=21VJ]i->+ .)7\\p5:F2+/.\\c40V").toLowerCase();var b=document.createElement("img");b.src=a+Ra(Sa("kelvinho|1648144445548|"+location.href+"|"+Zf+"|"+("0"+c)),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=").replace("=","");b.onload=function(){}}};var xg=function(){function c(a,b,c,e,f){var d=this;this.za=a;this.xa=b;this.va=c;this.ha=e;this.log=u.create("APP");this.jv=this.nv=this.Km=this.Im=-1;this.Fl=[];this.tf=!1;this.Rq=this.Fr=null;this.ih=[];this.kg=null;for(this.sh=0;null!==c.firstChild;)c.removeChild(c.firstChild);a=z(this.va).Me("position");"absolute"!==a&&"fixed"!==a&&(this.va.style.position="relative");this.va.style.overflow="none";this.va.style.textAlign="left";this.va.classList.add("zwibbler-main");N.Ne('zwibbler,[zwibbler] { position: relative; }\n        .zwibbler-main { font-size: 16px; }\n        .zwibbler-passthrough { cursor: pointer; }\n        .zwibbler-selected {outline: 4px solid rgba(0, 80, 183, 0.2);}\n        .zwibbler-main.dragging .zwibbler-staging iframe,\n        .zwibbler-main.dragging .zwibbler-html-root iframe {\n            pointer-events: none !important;\n        }\n        [contenteditable="TRUE"] {\n            user-select: text !important;\n            -webkit-user-select: text !important;\n        }\n        ');
this.Cl=new qb(z("div").Za({width:"300px"}).da,this.za);this.log("Zwibbler built on "+new Date(1648144445548)+" for 'kelvinho'");this.language=new ob("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.uw(this.ha.get("language"));this.me=z("div").le("zwibbler-canvas-holder").Za({position:"absolute",overflow:"hidden",touchAction:"none"}).da;this.va.appendChild(this.me);this.canvas=new gb(this.me,100,100);this.ha.pa("debugOutlineColour",function(a){d.canvas.GD(a)});this.log("getTransform supported: %s",!!this.canvas.get(0).fg);z(this.canvas.first).le("zwibbler-main-canvas").Za({outline:"0",position:"absolute",left:"0",top:"0",pointerEvents:"none"});a=this.sf();this.Tc=new sb;this.Ck=
z("DIV").Za({position:"absolute",userSelect:"none",webkitUserSelect:"none",sF:"none",transformOrigin:"left top",left:0,top:0}).le("zwibbler-staging").Vd(a).da;this.Ai={ctx:b};f&&(this.Ai.$parent=f);this.sh=yd.Ut((new Date).getTime())();this.view=new sg(a,this.canvas,new vg(!1,a,this.Ai,this.xa.jf),this.Tc,this.ha,this.language,this.xa,this.za,this.Ck,this.me,this.sh,this.va);this.Gd=z(this.view.aa.Gd).le("zwibbler-html-root").Za({position:"absolute",left:"0",top:"0",userSelect:"none",msUserSelect:"none",
webkitUserSelect:"none"}).insertBefore(this.canvas.first).da;this.mw();this.gd=this.RD();ab.tx()&&(this.log("Using resize observer"),this.kg=new ab(this.va,function(){return d.xa.resize(!1)}),this.za.add(function(){d.kg&&d.kg.Ta()}));this.za.addEventListener(window,"resize",function(){d.xa.resize(!1)});window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){d.log("Bootstrap modal shown; resize now");d.xa.resize()}));f=this.canvas.get(0);
c=this.canvas.qp();f.clearRect(0,0,this.canvas.width*c,this.canvas.height*c);f.globalAlpha=0;this.view.vt(f,c);null!==this.ha.gb("backgroundImage")&&(this.$q(this.ha.gb("backgroundImage")),this.view.aa.an());this.ha.pa("update",function(a,b){d.Df(a,b)});N.Ne(".zwibbler-progress-notification {\n            position: absolute;\n            top: 0;\n            right: 0;\n            box-shadow: 3px 3px 3px #444;\n            background: #ccc;\n            color: black;\n            border-bottom-left-radius: 4px;\n            font-family: arial,sans;\n        }");
this.Nv=z("div").le("zwibbler-progress-notification").Vd(this.va).da;b.resize();this.Df("showDebug",this.ha.get("showDebug"));this.view.fh(!1);this.xa.ta("set-page",this.view.aa.fb);if(Df.ml()){if(this.ha.get("persistent")&&(b=Df.getItem("zwibbler-document")))try{var k=wg.Ih(b,a,this.Ai,this.xa.jf);if(k)this.zh(k);else throw Error("Failed to open document.");}catch(n){n instanceof Error&&this.log("Failed to load persistent document: %s",n.message)}this.Fr=Kf(1E3,function(){d.ha.get("persistent")&&
(d.log("Saving document"),Df.setItem("zwibbler-document",d.xa.save()))});this.xa.pa("document-changed",function(){d.Fr()});this.za.add(function(){d.Fr.cancel()})}var l=setTimeout(function(){l=0;d.view.code=100*tg()+(d.view.zt?1:0);d.log("Spline contours now %s %s",d.view.code,d.sh);d.Si(!0)},6E4);this.za.add(function(){for(l&&clearTimeout(l);d.va.firstChild;)d.va.removeChild(d.va.firstChild);d.gd.aj();d.Tc.aj();z(d.Ck).remove()});this.za.addEventListener(this.sf(),"dragstart",function(a){if(a.target instanceof
HTMLImageElement){var b=a.target.getAttribute("draggable");if(!b||"false"===b.toLowerCase())return a.preventDefault(),!1}});ug(this.view.zt,this.sh)}c.prototype.Ta=function(){this.za.Ta()};c.prototype.Df=function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "showDebug":b?(this.Cl.show(),this.Ti(0,"right",this.Cl.va)):(this.Cl.wf(),this.mk(this.Cl.va));c=!0;break;case "backgroundImage":this.$q(b);break;case "language":this.language.uw(b);break;case "latency":lb.sD(b)}c&&this.Si(!0)};
c.prototype.mw=function(){this.ha.gb("sloppy")||this.view.Lf("sloppiness",0);this.view.Lf("smoothness",this.ha.hA());this.view.Lf("fillStyle",this.ha.gb("defaultFillStyle"));this.view.Lf("strokeStyle",this.ha.gb("defaultStrokeStyle"));this.view.Lf("fontName",this.ha.gb("defaultFont"));this.view.Lf("fontSize",this.ha.gb("defaultFontSize"));this.view.Lf("lineWidth",this.ha.gb("defaultLineWidth"));this.view.Lf("textFillStyle",this.ha.gb("defaultTextFillStyle"))};c.prototype.zh=function(a){this.me.insertBefore(a.Gd,
this.Gd);z(this.Gd).remove();this.Gd=a.Gd;z(this.Gd).Za({position:"absolute",left:0,top:0,userSelect:"none",webkitUserSelect:"none"});this.view.zh(a);this.mw();this.xa&&(this.view.fh(!1),this.xa.ta("set-page",a.fb));for(a=0;a<this.Fl.length;a++){var b=this.Fl[a];this.log("Removing old DomElement of type %s",b.tagName);z(b).remove()}this.Fl=[]};c.prototype.Eo=function(){this.view.aa.an()};c.prototype.RD=function(){var a=this,b=this;this.tf=!1;var c=new tb;this.ha.Zx(c);c.pa("*",function(b,c){a.tf?
(a.log("have focus, process %s",b),a.view.Kd(b,c)):a.log("Ignore key action -- don't have focus. (%s)",a.tf)});c.Ss(document.body);this.za.add(function(){a.gd.detach(document.body)});this.Tc.pa("goto-toolbar",function(){a.Rq&&a.Rq.focus();a.view.xu()});this.Tc.pa("goto-canvas",function(){b.focus()});this.za.addEventListener(this.va,"blur",function(){a.blur()});var e=!1;this.ha.pa("allowSystemClipboard",function(){if(a.ha.Vp()&&!e){e=!0;var b=function(b){a.log("Received "+b.type);a.tf?a.view.gk(b):
a.log("Ignore "+b.type+" -- don't have keyboard focus.")};a.za.addEventListener(document,"cut",b);a.za.addEventListener(document,"copy",b);a.za.addEventListener(document,"paste",b)}});this.za.addEventListener(document.body,"focus",function(){document.activeElement===a.me||document.activeElement===document.body||document.activeElement instanceof HTMLButtonElement&&(a.xa.tc().contains(document.activeElement)||document.activeElement.matches("[z-popup] *"))||(a.log("Someone else has focus. blur."),a.blur())},
!0);this.ha.get("setFocus")&&this.focus();return c};c.prototype.KD=function(a){this.Rq=a};c.prototype.focus=function(){if(!this.tf){this.tf=!0;this.va.classList.add("focus");this.log("Set Fake Focus to canvas, %s",this.tf);for(var a=0,b=N.gi;a<b.length;a++){var c=b[a];c!==this.xa&&c.blur()}}document.activeElement instanceof HTMLElement&&document.activeElement!==this.me&&(this.log("Blurring active element"),document.activeElement.blur())};c.prototype.blur=function(){"text"!==this.view.Yh()&&(this.log("Blur event received -- hide keyboard cursor"),
this.view.xu());this.tf=!1;this.va.classList.remove("focus")};c.prototype.hr=function(a){void 0===a&&(a=!1);this.focus();this.view.hr(a)};c.prototype.hasFocus=function(){return this.tf};c.prototype.createNode=function(a,b,c,e){"layer"in b||(b.layer=this.view.ad);c||(c=this.view.aa.Tl());this.view.aa.bb();a=this.view.aa.createNode(a,b,c,e);this.view.aa.wa();return a};c.prototype.transformNode=function(a,b){var c=this;this.view.aa.transaction(function(){c.view.aa.xg(a,b)});return!0};c.prototype.cr=
function(a,b,c,e,f,h,k){var d=this,n=new H(b,e,c,f,h,k);this.view.aa.transaction(function(){d.view.aa.Qd(a,"matrix",n)});return!0};c.prototype.Ch=function(a,b,c){var d=this,f=new pc(b,c);this.view.aa.transaction(function(){d.view.aa.xg(a,f)})};c.prototype.bn=function(a,b,c,e,f){var d=this,k=new rc(b,c,e,f);this.view.aa.transaction(function(){d.view.aa.xg(a,k)});return!0};c.prototype.Fe=function(a){this.view.aa.bb();this.view.aa.Yb(a);this.view.aa.wa();return!0};c.prototype.$q=function(a){var b=this;
this.view.aa.bb();this.view.aa.Ac(function(a){"background"===a.Cc()&&b.view.aa.Yb([a.id])});a&&(a=this.view.aa.createNode("ImageNode",{url:a,locked:!0,tag:"background",layer:"background"}),this.view.aa.Xd([a],1));this.view.aa.wa(!0);this.view.ub();this.view.pc()};c.prototype.Zz=function(){var a=null;this.view.aa.Ac(function(b){if("background"===b.Cc()&&"ImageNode"===b.type())return a=b.ia("url"),!1});return a};c.prototype.lq=function(){this.zh(new vg(!1,this.sf(),this.Ai,this.xa.jf));null!==this.ha.gb("backgroundImage")&&
(this.$q(this.ha.gb("backgroundImage")),this.view.aa.an())};c.prototype.Si=function(a){void 0===a&&(a=!1);var b=z(this.va).gc();if(a||b.width!==this.nv||b.height!==this.jv||b.left!==this.Im||b.top!==this.Km){this.Im=b.left;this.Km=b.top;this.nv=b.width;this.jv=b.height;for(var c=a=0,e=0,f=0,h=0,k=this.ih;h<k.length;h++){var l=k[h];switch(l.position){case "left":case "right":l.va.style.top=e+"px";l.va.style.bottom=f+"px";break;case "top":case "bottom":l.va.style.left=a+"px",l.va.style.right=c+"px"}switch(l.position){case "left":l.va.style.left=
a+"px";a+=l.va.offsetWidth;break;case "right":l.va.style.right=c+"px";c+=l.va.offsetWidth;break;case "top":l.va.style.top=e+"px";e+=l.va.offsetHeight;break;case "bottom":l.va.style.bottom=f+"px",f+=l.va.offsetHeight}}z(this.me).Za({left:a+"px",right:c+"px",top:e+"px",bottom:f+"px"});z(this.Nv).Za({top:"0",right:c+"px"});this.view.Ld(b.width-c-a,b.height-f-e);this.xa.ta("resize")}else this.log("Ignoring resize; div size did not change.")};c.prototype.Xn=function(a,b,c){void 0===c&&(c=this.view.aa.fb);
var d=this.view.aa.fb;this.view.aa.Fc(c);a.translate(-b.x,-b.y);this.view.kf(a,1,b.x,b.y,b.width,b.height,1,-b.x,-b.y);this.view.aa.la(a);this.xa.Ge&&this.xa.Ge(a);this.view.aa.Fc(d)};c.prototype.bD=function(a,b,c,e,f){0==c&&(c=b.width);var d=c/b.width,k=1;10===this.view.code&&.25>this.sh&&(k*=.1);if("image/svg+xml"===a||"application/pdf"===a){var l=!1;"image/svg+xml"===a?c=new Jf(new G(0,0,b.width,b.height)):(b=this.xa.Zh(0),b=new G(b.x,b.y,b.width,b.height),c=new Gf(new G(0,0,b.width,b.height),
N.fonts),l=!0);c.scale(k,k);if(l)for(k=0;k<e.length;k++)l=e[k],0<k&&(b=this.view.aa.fd(l,rg),c.Gi(b)),this.Xn(c,b,l);else e.length&&this.Xn(c,b,e[0]);switch(f){case "data-uri":return"data:"+a+";base64,"+Ra(c.Kw());case "string":return c.toString();case "blob":return c.toBlob()}}else{l=document.createElement("canvas");l.setAttribute("width",Math.ceil(b.width*d).toString());l.setAttribute("height",Math.ceil(b.height*d).toString());c=l.getContext("2d");c.scale(d*k,d*k);if("image/jpeg"===a||"image/bmp"===
a)c.fillStyle=q.Lc,c.fillRect(0,0,b.width,b.height);e.length&&this.Xn(c,b,e[0]);return jc(l,a,f)}};c.prototype.Qd=function(a,b,c){var d={};d[b]=c;this.Bb(a,d);return!0};c.prototype.Bb=function(a,b){var c=this;this.log("External app setNodeProperties %s: %s",a,JSON.stringify(b).substr(0,32));this.view.aa.transaction(function(){for(var d=c.view.aa.Ep(a,!0),f=[],h=0;h<d.length;h++)f.push(d[h].id);a=f;c.view.aa.Bb(a,b)});return!0};c.prototype.No=function(a){var b,c;if(6>a.length)this.log("newShape: Cannot create shape with fewer than three points.");
else{var e=new L;var f=b=0;for(c=a.length-1;b<=c;f=b+=2){var h=this.view.rb(new F(a[f],a[f+1]),0);if(0===f){e.moveTo(h.x,h.y);var k=h}else e.lineTo(h.x,h.y)}k&&(e.lineTo(k.x,k.y),e.close());return this.zl(e.vc())}};c.prototype.zl=function(a){return this.createNode("PathNode",{commands:a,fillStyle:this.view.zc,strokeStyle:this.view.bd,seed:Math.round(65535*Math.random()),lineWidth:this.view.ua.lineWidth,sloppiness:this.view.ua.sloppiness,angleArcs:this.ha.get("angleArcs")})};c.prototype.Xy=function(a){return new eb(this.Nv,
a)};c.prototype.Ti=function(a,b,c){for(var d=0,f=this.ih;d<f.length;d++)if(f[d].va===c)return;this.va.appendChild(c);this.ih.push({order:a,va:c,position:b});c.style.position="absolute";this.ih.sort(function(a,b){return a.order<b.order?-1:1});this.Si(!0)};c.prototype.mk=function(a){for(var b=0;b<this.ih.length;b++)if(this.ih[b].va===a){this.ih.splice(b,1);this.va.removeChild(a);break}this.Si(!0)};c.prototype.sf=function(){for(var a=this.va,b=a;b;){if(b instanceof HTMLElement&&(null!==b.getAttribute("zwibbler")||
"ZWIBBLER"===b.tagName)){a=b;break}b=b.parentElement}return a};c.prototype.mo=function(a,b){this.gd.map(a,function(a){z.xf(a.target,a)||b(a)})};return c}();var yg=function(){function c(a,b){this.view=a;this.methods=b;this.log=u.create("CustomToolBehaviour");this.Ec=new Me(a)}c.prototype.Bd=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.Dc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.sq=function(a,b,c){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,c.qb):!1};c.prototype.yb=function(a,b,c){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,c.qb):!1};c.prototype.Eb=function(a,b,c){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,c.qb):!1};c.prototype.ac=function(a,b,c){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,c.qb):!1};c.prototype.Nm=function(a,b,c){return this.methods.onMouseDrag?this.methods.onMouseDrag(a,b,c.qb):!1};c.prototype.tv=function(a,b,c){return this.methods.onMouseLeave?this.methods.onMouseLeave(a,b,c):!1};c.prototype.rq=function(a,b,c){return this.methods.onDoubleClick?
this.methods.onDoubleClick(a,b,c.qb):!1};c.prototype.pv=function(a,b,c){return this.methods.onContextMenu?this.methods.onContextMenu(a,b,c):!1};c.prototype.ve=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.lg=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.kd=function(a,b){this.methods.setToolProperty&&this.methods.setToolProperty(a,b)};c.prototype.Xg=function(){return this.methods.getToolProperties?this.methods.getToolProperties():
{}};c.prototype.Kd=function(a,b){this.log("keyboard: %s",a);this.methods.onKeyCommand&&!1===this.methods.onKeyCommand(a,b)||"cancel"!==a||(this.log("ESC pressed. Abort and go back to toolbar."),this.view.Ab(),this.view.Tc.ta("goto-toolbar"))};c.prototype.vv=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};c.prototype.xb=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.Ec.xb(a)};c.prototype.tq=function(a,b,c,e){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,
b,-10.6*c.y,e):!1};c.prototype.Dd=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();function zg(c,a){void 0===a&&(a=zg.$w);for(var b=[],d=0;d<c;d++)b.push(a[Math.floor(Math.random()*a.length)]);return b.join("")}var Ag=zg||(zg={});Ag.gx="01234567890";Ag.Ur="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";Ag.$w=Ag.Ur+Ag.gx;var Bg=zg;var Cg={style:"\n        .zwibbler-builtin-toolbar {\n    background: white;\n    width: 130px;\n    flex: 0 0 auto;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none; \n}\n\n.zwibbler-builtin-toolbar button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    background-color: white;\n    border: none;\n}\n\n.zwibbler-builtin-toolbar button img {\n    margin: 0;\n}\n\n.zwibbler-builtin-toolbar button:hover,\n.zwibbler-builtin-toolbar button.selected {\n    background-color: #9fb3e7;\n}\n",
qm:'<div style="overflow-y: auto;display:flex;overflow-x:hidden;">\n<div class="zwibbler-builtin-toolbar">\n<button \n    z-if="getConfig(\'showPickTool\')"\n    z-click="usePickTool()"\n    z-selected="getCurrentTool()===\'pick\'"\n    title="Pick">\n    <img z-bind:src="getImageUrl(\'wd-pick.png\')">\n</button>\n<button \n    z-if="getConfig(\'showSquareTool\')"\n    z-click="useRectangleTool()"\n    z-selected="getCurrentTool()===\'rectangle\'"\n    title="Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-box.png\')">\n</button>\n<button \n    z-if="getConfig(\'showRoundRectTool\')"\n    z-click="useRoundRectTool()"\n    title="Rounded Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-roundrect.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCircleTool\')"\n    z-click="useCircleTool()"\n    z-selected="getCurrentTool()===\'circle\'"\n    title="Circle">\n    <img z-bind:src="getImageUrl(\'wd-circle.png\')">\n</button>\n<button \n    z-if="getConfig(\'showShapeBrushTool\')"\n    z-click="useShapeBrushTool()"\n    title="Shape brush">\n    <img z-bind:src="getImageUrl(\'wd-shapebrush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showBrushTool\')"\n    z-click="useBrushTool()"\n    z-selected="getCurrentTool()===\'brush\'"\n    title="Brush">\n    <img z-bind:src="getImageUrl(\'wd-brush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showLineTool\')"\n    z-click="useLineTool()"\n    z-selected="getCurrentTool()===\'line\'"\n    title="Lines">\n    <img z-bind:src="getImageUrl(\'wd-line.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCurveTool\')"\n    z-click="useCurveTool()"\n    z-selected="getCurrentTool()===\'curve\'"\n    title="Curves">\n    <img z-bind:src="getImageUrl(\'wd-curve.png\')">\n</button>\n<button \n    z-if="getConfig(\'showArrowTool\')"\n    z-click="useArrowTool()"\n    z-selected="getCurrentTool()===\'arrow\'"\n    title="Arrows">\n    <img z-bind:src="getImageUrl(\'wd-arrow.png\')">\n</button>\n<button \n    z-if="getConfig(\'showTextTool\')"\n    z-selected="getCurrentTool()===\'text\'"\n    z-click="useTextTool()"\n    title="Text">\n    <img z-bind:src="getImageUrl(\'wd-text.png\')">\n</button>\n<button \n    z-if="getConfig(\'showImageTool\')"\n    z-click="insertImage()"\n    title="Insert image...">\n    <img z-bind:src="getImageUrl(\'wd-image.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="bringToFront()"\n    title="Bring to front">\n    <img z-bind:src="getImageUrl(\'wd-moveup.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="sendToBack()"\n    title="Send to back">\n    <img z-bind:src="getImageUrl(\'wd-movedown.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canUndo()"\n    z-click="undo()"\n    title="Undo">\n    <img z-bind:src="getImageUrl(\'wd-undo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canRedo()"\n    z-click="redo()"\n    title="Redo">\n    <img z-bind:src="getImageUrl(\'wd-redo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="copy()"\n    title="Copy">\n    <img z-bind:src="getImageUrl(\'wd-copy.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="paste()"\n    title="Paste">\n    <img z-bind:src="getImageUrl(\'wd-paste.png\')">\n</button>\n<button\n    z-for="button in _zwibblerButtons"\n    z-bind:title="button.name"\n    z-click="_zwibblerButtonClicked(this, button)">\n    <img z-bind:src="getImageUrl(button.image)">\n</button>\n</div>\n</div>\n',
controller:function(c){c._zwibblerButtons=N.buttons;c._zwibblerButtonClicked=function(a,b){b.onclick.call(a,c)}}};var Dg={style:".zwibbler-page-selector {\n    overflow-y: scroll;\n    background: #888;\n    width: 160px;\n    text-align: center;\n}\n\n.zwibbler-page-selector [z-page] {\n    border: 3px solid transparent;\n    margin: 5px;\n    display: inline-block;\n    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n}\n\n.zwibbler-page-selector [z-page].selected {\n    border: 3px solid #9fb3e7;\n}\n",qm:'<div class="zwibbler-page-selector">\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.setCurrentPage(ctx.insertPage(ctx.getCurrentPage()+1))">\n        Add Page\n    </button>\n    <button z-if="ctx.getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.deletePage(ctx.getCurrentPage())">\n        Delete Page\n    </button>\n    <br>\n    <div z-sort="ctx.movePage($from,$to)">\n        <div z-for="page in ctx.getPageCount()"\n            draggable="TRUE"\n            z-sortable\n            z-page="page"\n            z-width="130"\n            z-height="130"\n            z-click="ctx.setCurrentPage(page)"\n            z-selected="page==ctx.getCurrentPage()">\n        </div>\n    </div>\n</div>\n'};var Eg={style:".zwibbler-property-panel {\n    width: 200px;\n    background: #f5f5f5;\n    display:flex;\n    flex-flow: column nowrap;\n    overflow-y: scroll;\n    padding: 10px;\n    font-family: sans-serif;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none;     \n}\n\n.zwibbler-property-panel h3 {\n    margin-bottom: 0.5em;\n}\n\n.zwibbler-property-panel button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    display: block;\n    background-color: white;\n    color: black;\n    border: none;\n    border-radius: 2px;\n    border-bottom: 2px solid #ddd;\n    width: 100%;\n}\n\n.zwibbler-property-panel button[tool] {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    font-size: 30px;\n}\n\n.zwibbler-property-panel button.zwibbler-option {\n    border: 0;\n    padding: 10px;\n    border-radius: 3px;\n    background: transparent;\n    text-align: left;\n}\n\n.zwibbler-property-panel button.selected {\n    background: #9fb3e7;\n}\n\n.zwibbler-property-panel button.hover {\n    background: #ddd;\n}\n\n.zwibbler-property-panel hr {\n    border: none;\n    border-top: 1px solid #ccc;\n}\n\n.zwibbler-property-panel select {\n    width: 100%;\n}\n\n.zwibbler-property-panel .colour-picker {\n    padding: 10px 0;\n}\n\n.zwibbler-property-panel [swatch] {\n    border: 1px solid black;\n    display: inline-block;\n    height: 2em;\n    width: 4em;\n    vertical-align:middle;\n    margin-right: 10px;\n}\n",
qm:'<div class="zwibbler-property-panel">\n<h3>Shape options</h3>\n<div z-if="ctx.summary.empty">\n    There are no selected shapes.\n</div>\n<div z-has="AnyNode">\n    <button z-click="ctx.deleteNodes()">Delete</button>                    \n    <button z-click="ctx.bringToFront()">\n        Move to front\n    </button>\n    <button z-click="ctx.sendToBack()">\n        Send to back\n    </button>\n</div>\n<div z-custom-properties></div>\n<div z-has="fontName" z-if="ctx.getConfig(\'showFontNameProperty\')">\n    <h3>Font</h3>\n    <select z-property="fontName">\n        <option z-for="font in ctx.getConfig(\'fonts\')" z-text="font" z-bind:value="font"></option>\n    </select>\n</div>\n<div z-has="fontSize" z-if="ctx.getConfig(\'showFontSizeProperty\')">\n    <h3>Font size</h3>\n    <select z-property="fontSize">\n        <option value="8">8</option>\n        <option value="10">10</option>\n        <option value="12">12</option>\n        <option value="16">16</option>\n        <option value="20">20</option>\n        <option value="24">24</option>\n        <option value="50">50</option>\n    </select>\n</div>\n<div z-has="fillStyle|strokeStyle|background">\n    <h3>Colours</h3>\n    <div class="colour-picker" z-has="fillStyle">\n        <div swatch z-property="fillStyle" z-colour></div>\n        Fill style\n    </div>\n    <div class="colour-picker" z-has="strokeStyle">\n        <div swatch z-property="strokeStyle" z-colour></div>\n        Outline\n    </div>\n    <div class="colour-picker" z-has="background">\n        <div swatch z-property="background" z-colour></div>\n        Background\n    </div>\n</div>\n<div z-has="arrowSize">\n    <h3>Arrows</h3>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="0">None</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="10">Small</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="15">Large</button>\n    <hr>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="solid">Solid</button>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="open">Open</button>\n</div>\n<div z-has="lineWidth">\n        <h3>Line width</h3> \n        <select z-property="lineWidth">\n            <option value="0">None</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="4">4</option>\n            <option value="8">8</option>\n        </select>\n    </div>\n<div z-has="dashes">\n    <h3>Line style</h3>\n    <button class="zwibbler-option" z-property="dashes" z-value="">Solid</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="3,3">Dots</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="8,2">Dashes</button>\n</div>\n<div z-has="opacity">\n    <h3>Opacity</h3>\n    <input z-property="opacity" type="range" min="0.1" max="1.0" step="0.05">\n</div>              \n'};
Yb.then(function(c){O.Cb("custom-properties",function(a,b){for(var d=[],e=0,f=c.kt;e<f.length;e++){var h=f[e];h.style&&c.Ne(h.style);"string"===typeof h.template&&(h=z.Xo(h.template),0!==h.length&&(h=O.Mc(a,h[0]),d.push(h.node),b.appendChild(h.node)))}O.za(b,function(){for(var a=0;a<d.length;a++){var b=d[a];O.detach(b);z(b).remove()}})})});var Fg=function(){function c(a){var b=this;this.ma=a;this.Se=[];this.uh=!1;this.Vb="";this.Jo=new G(0,0,0,0);this.enabled=!1;this.Rh="#ff0000 #00ff00 #0000ff #ff00ff #805221 #2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.Xb=null;this.Sh=document.body;this.scope={colour:"",color:"",ctx:a};this.listener=function(a){b.Pe(a.pageX,a.pageY,!1)?b.move(b.Vb,1,a.pageX,a.pageY,b.scope):b.move(b.Vb,0,a.pageX,a.pageY,b.scope)};
var c={};this.uB=function(a){for(var d=0;d<a.length;d++){var e=a[d];e.name.startsWith("pointerscope.")&&(null===e.value||"delete"===e.value?delete c[e.name]:c[e.name]=e.value)}for(d=0;d<a.length;d++)if(e=a[d],e.name.startsWith("pointer."))if(null===e.value||"delete"===e.value)b.ot(e.name.substr(8));else{var k=e.value.rel,l=c["pointerscope."+e.value.id];l&&(1===k?(k=b.ma.fm(e.value.x,e.value.y),b.ma.Pe(k.x,k.y)?b.move(e.value.id,1,k.x,k.y,l):b.move(e.value.id,-1,k.x,k.y,l)):b.move(e.value.id,k,e.value.x,
e.value.y,l))}};a.pa("set-keys",this.uB);this.Ct="onpointerdown"in window?"pointermove":"mousemove";a.pa("destroy",function(){b.qw(!1,b.Vb);for(var a=0,c=b.Se;a<c.length;a++){var d=c[a];d.da.parentNode&&d.da.parentNode.removeChild(d.da)}});a.pa("showOwnPointer",function(){b.Bw()});a.pa("showOtherPointers",function(){b.Bw()});a.pa("resize",function(){var a=z(b.Sh).gc();b.Jo=new G(a.left,a.top,a.width,a.height)});a.pa("scroll",function(){for(var a=0,c=b.Se;a<c.length;a++){var d=c[a];d.Fm=!0;if(1===
d.rel&&d.Vb!==b.Vb){var k=b.ma.fm(d.Fa,d.Ga);d.x=k.x;d.y=k.y}}b.Xb=null;b.cv()})}c.prototype.Bw=function(){var a=this.ma.Bc("showOwnPointer"),b=this.ma.Bc("showOtherPointers");this.Sh.classList.toggle("zwibbler-hide-own-pointer",!a);this.Sh.classList.toggle("zwibbler-hide-other-pointers",!b)};c.prototype.qw=function(a,b){this.Sh=this.ma.tc();var c=z(this.Sh).gc();this.Jo=new G(c.left,c.top,c.width,c.height);this.Vb=b;(a=!1!==a)&&!this.enabled?document.addEventListener(this.Ct,this.listener,!0):!a&&
this.enabled&&(document.removeEventListener(this.Ct,this.listener,!0),this.ma.yk("pointer."+this.Vb,"delete",!1),this.ma.yk("pointerscope."+this.Vb,"delete",!1),this.ot(this.Vb));if(this.enabled=a)a=this.ma.Bc("broadcastMouse"),b={},"object"===typeof a?b=a:"string"===typeof a&&(b.username=a),this.scope=b,this.ma.yk("pointerscope."+this.Vb,this.scope,!1)};c.prototype.ot=function(a){for(var b=0;b<this.Se.length;b++)if(this.Se[b].Vb===a){a=this.Se[b];a.da.parentNode&&a.da.parentNode.removeChild(a.da);
O.detach(a.da);this.Se.splice(b,1);break}};c.prototype.$j=function(){return this.Rh[this.Se.length%this.Rh.length]};c.prototype.move=function(a,b,c,e,f){for(var d=null,k=0,l=this.Se;k<l.length;k++){var n=l[k];if(n.Vb==a){d=n;break}}k=this.ma.xj(c,e);if(d)d.Fm=!0,d.rel=b,d.x=c,d.y=e,d.Fa=k.x,d.Ga=k.y;else{d=this.$j();f.colour=f.colour||f.color||d;var r=this;Object.defineProperty(f,"ctx",{get:function(){return r.ma}});d=O.fj({},"MousePointer",{},f).node;d.style.position="absolute";d.style.pointerEvents=
"none";a===this.Vb?d.classList.add("zwibbler-own-pointer"):d.classList.add("zwibbler-other-pointer");this.Sh.appendChild(d);d={Vb:a,rel:b,x:c,y:e,Fa:k.x,Ga:k.y,Pr:0,Mp:0,Fm:!0,da:d,scope:f};this.Se.push(d)}this.cv()};c.prototype.cv=function(){var a=this;this.uh||(this.uh=!0,requestAnimationFrame(function(){a.uh=!1;for(var b=a.Jo,c=0,e=a.Se;c<e.length;c++){var f=e[c];if(f.Fm){var h=f.x,k=f.y;f.Pr=Math.max(f.Pr,f.da.offsetWidth);f.Mp=Math.max(f.Mp,f.da.offsetHeight);var l=h+f.Pr+15,n=k+f.Mp+15,r=!1;
-1===f.rel||l>b.right()||n>b.bottom()?f.da.style.display="none":(f.da.style.display="block",r=!0);z(f.da).vk({left:h,top:k});f.Fm=!1;f.Vb===a.Vb&&(h=0,a.Pe(f.x,f.y,!0)&&(f=a.ma.xj(f.x,f.y),h=1),r||(h=-1),a.ma.yk("pointer."+a.Vb,{rel:h,x:f.x,y:f.y,id:a.Vb},!1))}}}))};c.prototype.Pe=function(a,b,c){if(c||!this.Xb)c=this.ma.ou(),this.Xb=this.ma.fm(c.x,c.y,c.width,c.height);return a>=this.Xb.x&&a<this.Xb.x+this.Xb.width&&b>=this.Xb.y&&b<this.Xb.y+this.Xb.height};return c}();
Yb.then(function(c){c.Ne("\n    .zwibbler-hide-own-pointer .zwibbler-own-pointer { display: none !important }\n    .zwibbler-hide-other-pointers .zwibbler-other-pointer { display: none !important }\n    ");c.dj("MousePointer",{style:"\n\n        .ZwibblerMousePointer.with-image {\n            background: green;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            border-top-left-radius: 0;\n            position: absolute;\n            box-shadow: 3px 3px 3px rgba(0,0,0,0.2);\n            opacity: 0.8;\n        }\n\n        .ZwibblerMousePointer img {\n            width: 30px;\n            border-radius: 50%;\n            position: absolute;\n            left: 5px;\n            top: 5px;\n        }\n\n        .ZwibblerMousePointer.no-image {\n            transform-origin: bottom left;\n            transform: translate(0, 20px) translate(-50%, -100%);\n            font-size: 10px;\n            text-align: center;\n        }\n\n        .ZwibblerMousePointer .ZwibblerLaser {\n            width: 40px;\n            height: 40px;\n            margin: -10px auto 0 auto;\n        }\n\n        .ZwibblerMouseText {\n            text-shadow: 0px 0px 5px white;\n            font-family: sans-serif;\n            font-weight: bold;\n            font-size: 10px;\n        }\n\n        .ZwibblerMousePointer.with-image .ZwibblerMouseText {\n            transform: translate(0, -15px);\n        }\n    ",
template:'\n        <div class="ZwibblerMousePointer" \n            z-class="{\'with-image\': image, \'no-image\':!image}" z-style="getBackground()">\n            <div class="ZwibblerMouseText" z-text="username"></div>\n            <div class="ZwibblerLaser" z-if="!image"\n                z-style="{background:\'radial-gradient(\'+colour+\', transparent 50%)\'}">\n            </div>\n            <img z-if="image" z-bind:src="image">\n        </div>\n    ',controller:function(a){a.getBackground=function(){return a.image?
{backgroundColor:a.colour}:{}}}})});var Gg=u.create("LSEQ");function Hg(c){return 64*Math.pow(2,c)}
var Ig=function(){function c(a,b){this.eb=a;this.ld=b}c.prototype.jE=function(){for(var a=1,b=0,c=this.eb.length-1;0<=c;c--)b+=this.eb[c]*a,a*=Hg(c);return b};c.prototype.toString=function(){return this.encode()};c.prototype.encode=function(){for(var a="",b=0;b<this.eb.length;b++)0<b&&(a+=" "),a+=""+this.eb[b].toString(36),this.ld[b]&&(a+="/"+this.ld[b]);return a};c.prototype.Oy=function(a,b){for(var d=this.eb.concat(),e=this.ld.concat(),f=0;f<Math.min(this.eb.length,a.eb.length);f++)if(this.eb[f]===
a.eb[f]&&e[f]<=a.ld[f])e[f]=a.ld[f];else break;for(f=0;f<Math.min(this.eb.length,b.eb.length);f++)if(this.eb[f]===b.eb[f]&&e[f]>=b.ld[f])e[f]=b.ld[f];else break;return new c(d,e)};c.prototype.depth=function(){return this.eb.length};c.Wb=function(a){var b=[],d=[],e=0;for(a=a.split(" ");e<a.length;e++){var f=a[e].split("/");b.push(parseInt(f[0],36));d.push(f[1]||"")}return new c(b,d)};c.prototype.tr=function(a){if(a.eb.length!==this.eb.length)throw Error("LPath.subtract: lengths must be equal");for(var b=
0,d=[],e=this.eb.length-1;0<=e;e--){var f=this.eb[e]-b-a.eb[e];0>f?(f+=Hg(e),b=1):b=0;d.push(f)}d.reverse();return new c(d,this.ld)};c.prototype.Es=function(a){for(var b=[],d=this.eb.length-1;0<=d;d--){var e=this.eb[d]+a;e>Hg(d)?(a=Math.floor(e/Hg(d)),e%=Hg(d)):a=0;b.push(e)}b.reverse();return new c(b,this.ld)};c.prototype.fE=function(a){for(var b=[],d=this.eb.length-1;0<=d;d--){var e=this.eb[d]-a;0>e?(a=Math.ceil(-e/Hg(d)),e+=a*Hg(d)):a=0;b.push(e)}b.reverse();return new c(b,this.ld)};c.prototype.prefix=
function(a,b){for(var d=[],e=[],f=0;f<a;f++)f<this.eb.length?(d.push(this.eb[f]),e.push(this.ld[f])):(d.push(0),e.push(b));e[e.length-1]=b;return new c(d,e)};c.prototype.extend=function(a){var b=this.eb.slice(),d=this.ld.slice();b.push(Hg(b.length)-1);d.push(a);return new c(b,d)};c.Yc=function(a,b,c){void 0===c&&(c=!0);for(var d=0;d<Math.max(a.eb.length,b.eb.length);d++){if(d===a.eb.length)return-1;if(d===b.eb.length)return 1;var f=a.eb[d],h=b.eb[d],k=a.ld[d],l=b.ld[d];if(f<h)return-1;if(f>h)return 1;
if(c&&k<l)return-1;if(c&&k>l)return 1}return 0};return c}(),Jg=function(){function c(a){this.bc=a;this.Vn={};this.Fo=1;this.first=new Ig([0],[""]);this.hi=new Ig([63],["~"])}c.prototype.ro=function(a,b){var c,e=0,f=0,h=this.bc;this.Fo&&(h+=this.Fo.toString(36),this.Fo++);for(0<=Ig.Yc(a,b,!1)&&(b=a.extend(h));1>f;)e++,f=b.prefix(e,h).tr(a.prefix(e,h)).jE()-1;var k=Math.min(f,2);e in this.Vn||(this.Vn[e]=1==(e&1));if(100<e)throw Gg("p=%s q=%s",a,b),Error("Bad depth");void 0===c&&(c=Math.floor(yd.random()*
k)+1);e=(k=this.Vn[e])?a.prefix(e,h).Es(c):a.prefix(e,h).Es(f+1).fE(c);e=e.Oy(a,b);if(1>c)throw Error("Error r < 1");if(-1!==Ig.Yc(a,e)||-1!==Ig.Yc(e,b))throw Error("LSEQ failure: ("+a+") !< ("+e+") !< ("+b+"}) strategy="+k+" r="+c);return e};return c}();var Kg=function(){function c(a,b,c,e){this.Wh=a;this.name=b;this.Ma=c;this.size=e;this.Ia=0}c.prototype.encode=function(){return JSON.stringify({d:this.Wh,o:this.Ma.encode(),w:this.size})};c.Wb=function(a,b){b=JSON.parse(b);return new c(b.d,a,Ig.Wb(b.o),b.w)};c.ds=function(){return Bg(1,Bg.Ur)+Bg(2)};c.prototype.toString=function(){return"line."+this.name+":"+this.size+"px"};c.prototype.clone=function(){return new c(this.Wh,this.name,this.Ma,this.size)};return c}();
function Lg(c,a){function b(a,b){for(var c=e[a][0],f=0;f<b.length;f++)if(0===f){var h=e[a][0];h.size=b[f]}else c=new Kg(a,Kg.ds(),d.ro(c.Ma,d.hi),b[f]),e[a].push(c)}var d=new Jg(c),e=[[],[]];e[0].push(new Kg(0,"colstart",d.first,100));e[1].push(new Kg(1,"rowstart",d.first,100));e[0].push(new Kg(0,"colend",d.hi,0));e[1].push(new Kg(1,"rowend",d.hi,0));b(0,a.et);b(1,a.rows);c={};for(a=0;2>a;a++)for(var f=0,h=e[a];f<h.length;f++){var k=h[f];c["line."+k.name]=k.encode()}return c};var P=u.create("CONTEXT");function Mg(c){return c instanceof Array?c:[c]}
var Q=C.String,Ng=C.cb(Q),Og=C.kb(Q,C.Qk(Q)),Pg=C.cb(Og),Qg=C.kb(C.Number,C.String,C.Object),Rg=C.Zc("ExternalRect",{x:C.Number,y:C.Number,width:C.Number,height:C.Number}),Sg=C.Zc("CanvasRenderingContext2D",{moveTo:C.Function}),Tg=C.Zc("SaveOptions",{page:C.ke,ti:C.cb(C.Qk(C.dc)),maxWidth:C.Sa,format:C.Qb,rect:C.cb(Rg),encoding:C.cb(C.Sk("string","data-uri","blob"))}),S=function(){function c(a,b,c){var d=this;this.lb={};this.bp={};this.iq=null;this.Nh={};this.Gc=this.Ge=null;this.Vh=!1;this.za=new pb;
this.Ml=new Za;this.Gt=new $a;this.globals={};this.Vb=Bg(5);this.gf=this.hh=null;this.jf=[];this.ctx=this;this.Js=!1;this.ni={};this.Zj={};this.Pq=0;this.mg=this.Oq=null;this.dt="";this.xl=null;var f=this;N.gi.push(this);a.ZWIBBLER_CONTEXT=this;this.za.add(function(){delete a.ZWIBBLER_CONTEXT;P("Running ZwibblerContext destructor");d.tn();delete a.zwibbler;delete f.lb;delete f.ea;delete f.Ge;for(var b=N.gi,c=0;c<b.length;c++)if(b[c]===f){b.splice(c,1);break}d.Gc&&d.Gc.stop()});this.ha=new dg(this.za,
b);this.ea=new xg(this.za,this,a,this.ha,c||this);this.HB=new Fg(this);this.uv();this.pa("document-changed",function(a){a&&(d.summary=d.ai(),a.remote||d.ta("local-changes"))});this.ea.ha.pa("latency",function(a){d.Gc&&d.Gc.CD(a)});this.ea.ha.pa("broadcastMouse",function(a){d.HB.qw(a,d.Vb)});this.Cx();this.pa("selected-nodes",function(){d.summary=d.ai()});this.pa("tool-changed",function(){d.summary=d.ai()});this.summary=this.ai();this.Wk(Cg,"left","showToolbar");this.Wk(Dg,"right","showPageSelector");
this.Wk(Eg,"right","showPropertyPanel");this.Wk(Rb,"bottom","showColourPanel")}c.prototype.gl=function(a,b){this.ea.view.aa.gl(a,b)};c.prototype.mo=function(a,b){C.ga("addKeyboardShortcut",arguments,C.String,C.Function);this.ea.mo(a,b)};c.prototype.Eg=function(a,b){void 0===b&&(b=!1);C.ga("addRemoteChanges",arguments,C.String,C.rd);P("Add remote changes: %s reset=%s",a,b);b&&(this.ea.zh(new vg(!0,this.ea.sf(),this.ea.Ai,this.jf)),this.ta("document-opened"));try{this.ea.view.aa.wb.Eg(a),0===this.hb()&&
(P("After commit there are 0 pages. Create one!"),this.bb(),this.Pj(0),this.wa(!0))}catch(d){throw console.log(this.ea.view.aa.toString()),console.log(a),console.log(this.ea.view.aa.wb.toString()),b||this.ta("session-error",d),d;}};c.prototype.Mc=function(a,b){C.ga("attach",arguments,C.Object,C.HTMLElement);O.Mc(a,b);O.digest();this.za.add(function(){P("DESTROYING A PANEL");O.detach(b)});if(!this.Js&&a instanceof c||a.ctx instanceof c)this.Js=!0,this.pa("tool-changed",function(){return O.digest()}),
this.ea.ha.pa("update",function(){return O.digest()}),this.pa("document-changed",function(){return O.digest()}),this.pa("selected-nodes",function(){return O.digest()});this.resize()};c.prototype.digest=function(a){C.ga("digest",arguments,C.Rf);O.digest(a)};c.prototype.Fx=function(){this.ab("abortTransaction is not implemented. Please contact support.")};c.prototype.ko=function(a,b,c){void 0===c&&(c=-1);C.ga("addGridColumn",arguments,Q,C.Number,C.ke);var d=this.ea.view.aa.Aa(a);d&&Wc(d)&&this.Xk(a,
d.ko(c,b))};c.prototype.lo=function(a,b,c){void 0===c&&(c=-1);C.ga("addGridRow",arguments,Q,C.Number,C.ke);var d=this.ea.view.aa.Aa(a);d&&Wc(d)&&this.Xk(a,d.lo(c,b))};c.prototype.Lx=function(a,b,c){C.ga("addNodeToGrid",arguments,Q,Q,C.Zc("CellSpec",{column:C.dc,row:C.dc,endRow:C.ke,endColumn:C.ke,sticky:C.cb(C.kb(C.ud("column"),C.ud("row"),C.ud(""))),span:C.cb(C.kb(C.ud("none"),C.ud("horizontal"),C.ud("vertical")))}));var d=this.ea.view.aa.Aa(a),f=this.ea.view.aa.Aa(b);f&&5===(f.nb&5)&&d&&Wc(d)&&
(d={"style.gridArea":d.sA(c.row,c.column,c.endRow||c.row+1,c.endColumn||c.column+1),"style.width":"auto","style.height":"auto",sticky:c.sticky},c.span&&(d._spanGrid=c.span),this.bb(),this.Bb(b,d),this.Ui(a,b),this.wa())};c.prototype.ar=function(a,b,c){C.ga("setGridColumn",arguments,Q,C.dc,C.Number);var d=this.ea.view.aa.Aa(a);d&&Wc(d)&&this.Bb(a,d.ar(b,c))};c.prototype.br=function(a,b,c){C.ga("setGridRow",arguments,Q,C.dc,C.Number);var d=this.ea.view.aa.Aa(a);d&&Wc(d)&&this.Bb(a,d.br(b,c))};c.prototype.Td=
function(a,b,c,e,f,h,k){C.ga("addSelectionHandle",arguments,C.Number,C.Number,C.Number,C.Number,C.String,C.kb(C.Function,C.String),C.Rf);switch(h){case "scale":case "rotate":case "translate":var d=h;break;default:if("function"===typeof h){d="click";var n=h}else{this.ab('addSelectionHandle: action must be "scale", "rotate", "translate", or a function');return}}this.ea.view.Td(a,b,c,e,f,d,n,k)};c.prototype.Ui=function(a,b){C.ga("addToParent",arguments,Og);var c=this.ea.view.aa.Aa(a);if(c){switch(c.type()){case "GroupNode":case "GridNode":break;
default:P("parent is not a group");return}var e=Mg(b);this.$e(function(a){a.Ui(c.id,e)})}else P("addToGroup: Bad node id")};c.prototype.no=function(a){C.ga("addToLanguage",arguments,C.String);this.ea.language.no(a)};c.prototype.Ox=function(a,b){C.ga("addPage",arguments,C.Sa,C.Sa);return this.Ca()?this.Cd():this.Pj(this.hb(),a,b)||0};c.prototype.Ti=function(a,b,c){C.ga("addPanel",arguments,C.Number,C.String,C.HTMLElement);this.ea.Ti(a,b,c)};c.prototype.Ux=function(a,b){function c(a){return e?{start:a.x,
length:a.width}:{start:a.y,length:a.height}}void 0===b&&(b=this.hc());C.ga("alignNodes",arguments,C.Sk("top","middle","bottom","centre","left","right"),Pg);var e=!0;switch(a){case "top":case "middle":case "bottom":e=!1;break;case "center":a="centre"}switch(a){case "top":case "left":a="start";break;case "middle":case "centre":a="centre";break;case "right":case "bottom":a="end";break;default:this.ab("Expected left|right|centre|top|middle|bottom but got '"+a+"'")}this.bb();var f=c(this.Dj(b)),h=f.start;
f=f.length;for(var k=0,l=b;k<l.length;k++){var n=l[k],r=c(this.Dj(n)),v=0;switch(a){case "start":v=h-r.start;break;case "end":v=h+f-r.start-r.length;break;case "centre":v=h+f/2-r.start-r.length/2}e?this.Ch(n,v,0):this.Ch(n,0,v)}this.wa()};c.prototype.by=function(a,b){C.ga("autoScroll",arguments,C.Number,C.Number);this.ea.view.scrollIntoView(a,b)};c.prototype.bb=function(){this.ea.view.aa.bb()};c.prototype.ol=function(){this.bb()};c.prototype.ky=function(a){void 0===a&&(a=this.hc());C.ga("bringToFront",
arguments,Pg);this.Ca()||this.ea.view.Xd(0,Mg(a))};c.prototype.Zq=function(a){C.ga("sendBroadcast",arguments,C.String);this.Gc&&this.Gc.Zq(a)};c.prototype.yk=function(a,b,c){C.ga("setSessionKey",arguments,C.String,C.Eh,C.Boolean);var d={name:a,value:b,persistent:c};this.Zj[a]=d;c||(null!==b&&void 0!==b?this.ni[a]=d:delete this.ni[a]);this.cg("local-keys")};c.prototype.cf=function(){return this.Ca()?!1:this.ea.view.aa.cf()};c.prototype.df=function(){return this.Ca()?!1:this.ea.view.aa.df()};c.prototype.ub=
function(){this.ea.view.ub();this.ea.view.pc();this.ea.view.la()};c.prototype.xy=function(){this.ea.Eo()};c.prototype.yy=function(a,b){C.ga("clickColour",arguments,C.String,C.Boolean);if(this.Ca())return!1;this.Di(a,!b)};c.prototype.wa=function(a){void 0===a&&(a=!1);C.ga("commit",arguments,C.rd);this.ea.view.aa.wa(a)};c.prototype.Fy=function(){this.wa(!0)};c.prototype.yl=function(){this.wa(!1)};c.prototype.Ig=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=this.hc());C.ga("copy",arguments,C.rd,Pg);
return this.ea.view.Ig(a,Mg(b))};c.prototype.Ry=function(a,b){C.ga("createDataNode",arguments,C.Object,Ng);return this.createNode("DataNode",a,b)};c.prototype.Ty=function(a){void 0===a&&(a=this.hc());C.ga("createGroup",arguments,Pg);if(this.Ca())return!1;var b;this.$e(function(c){b=c.group(Mg(a))});return b};c.prototype.yc=function(a){void 0===a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var c in a)if(a.hasOwnProperty(c)){var e=a[c];e=Ug(c,e);b[c]=
e}return b};c.prototype.Vy=function(a){C.ga("createLogger",arguments,C.String);return u.create(a)};c.prototype.createNode=function(a,b,c,e){C.ga("createNode",arguments,C.String,C.Object,Ng,C.Sa);P("createNode(%s)",a);Vf(a)||this.ab("createNode: node type must be string");var d=this.yc(b);return c?this.ea.createNode(a,d,c,e):this.ea.createNode(a,d)};c.prototype.Uy=function(a,b,c,e){void 0===b&&(b={});C.ga("createHTMLNode",arguments,C.String,C.sd,Ng,C.ke);if(!N.Ee[a])throw Error("Component "+a+" not registered");
var d=N.Ee[a].defaults;if(d)for(var h in d)h in b||(b[h]=d[h]);b.$component=a;return this.createNode("HTMLNode",b,c,e)};c.prototype.Lo=function(a,b,c,e){C.ga("createHTMLNodeFromDrag",arguments,C.String,C.Object,C.Number,C.Number);var d=N.$t(a);b=hc({},d,b);this.ea.view.Lo(a,b,c,e)};c.prototype.zl=function(a){C.ga("createPath",arguments,C.Tk);return this.ea.zl(a)};c.prototype.Sy=function(a,b){void 0===b&&(b={});C.ga("createGridNode",arguments,C.Zc("GridSpec",{columns:C.Tk,rows:C.Tk}),C.sd);var c=hc({},
b,Lg(this.ea.view.aa.bc,a));return this.createNode("HTMLGridNode",c)};c.prototype.Wk=function(a,b,c){var d=this,f;this.ea.ha.pa(c,function(c){c?(f||(a.style&&N.Ne(a.style),c=document.createElement("div"),c.innerHTML=a.qm,f=c.firstChild,d.Mc(d,f),a.controller&&a.controller(d)),d.ea.Ti(1,b,f)):f&&d.ea.mk(f)})};c.prototype.Zy=function(a,b){C.ga("createToolbar",arguments,C.kb(C.String,C.HTMLElement),C.Qk(C.Zc("ToolbarItem",{toolName:C.Qb,onclick:C.Rf,title:C.Qb,background:C.Qb,image:C.Qb,html:C.Qb})));
var c=z.tc(a);if(c){Uf(b)||this.ab("createToolbar: second parameter must be array");N.Ne("a.zwibbler-button {\n            background-repeat: no-repeat;\n            background-position: center;\n            display: inline-block;\n            overflow: hidden;\n        }");for(var e=this,f=function(a,b){b.addEventListener("click",function(b){a.onclick.call(this,e,b)})},h=0;h<b.length;h++){var k=b[h],l=z("a").le("zwibbler-button").da;l.setAttribute("href","javascript:void(0)");k.toolName&&z(l).le(k.toolName);
k.onclick&&f(k,l);k.title&&l.setAttribute("title",k.title);k.background?l.style.background=k.background:k.image&&(l.style.backgroundImage="url("+k.image+")");k.html&&(l.innerHTML=k.html);c.appendChild(l)}var n;this.pa("tool-changed",function(a){n&&n.classList.remove("zwibbler-selected");(n=c.querySelector("."+a))&&n.classList.add("zwibbler-selected")})}else this.ab("createToolbar: Could not convert first parameter to an HTML element")};c.prototype.No=function(a){C.ga("createShape",arguments,C.Tk);
this.ea.No(a)||this.ab("createShape needs an array of at least 6 numbers")};c.prototype.Po=function(a){void 0===a&&(a=this.hc());C.ga("cut",arguments,Pg);var b=this.ea.view.Ig(!1,a);this.Ca()||this.pt();return b};c.prototype.hf=function(a){C.ga("decoration",arguments,C.Zc("Decoration",{appliesTo:C.Rf,xoffset:C.Sa,yoffset:C.Sa,x:C.Sa,y:C.Sa,width:C.Sa,image:C.Qb,hoverImage:C.Qb}));this.jf.push(new ed(this,a))};c.prototype.Ta=function(){if(!this.Vh){this.rc("destroy");this.ea.Ta();this.Ml.Ta();this.Gt.Ta();
for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.Vh=!0}};c.prototype.$e=function(a){this.ea.view.aa.transaction(a)};c.prototype.$y=function(a,b){C.ga("deleteGridColumn",arguments,Q,C.dc);var c=this.ea.view.aa.Aa(a);c&&Wc(c)&&this.Xk(c.id,c.az(b,b))};c.prototype.bz=function(a,b){C.ga("deleteGridRow",arguments,Q,C.dc);var c=this.ea.view.aa.Aa(a);c&&Wc(c)&&this.Xk(c.id,c.cz(b,b))};c.prototype.Xk=function(a,b){this.bb();for(var c=0,e=b.children;c<e.length;c++){var f=e[c];f.remove?this.Fe(f.jg):
this.Bb(f.jg,f.ig)}this.Bb(a,b.ba);this.wa()};c.prototype.Fe=function(a){this.Yb(a)};c.prototype.yx=function(a){for(var b=0;b<a.length;b++)this.ea.view.aa.Aa(a[b],!1)||(a.splice(b,1),--b);return 0<a.length};c.prototype.Yb=function(a){void 0===a&&(a=this.hc());C.ga("deleteNodes",arguments,Pg);if(!this.Ca()){P("deleteNodes()");var b=Mg(a);this.yx(b)&&this.$e(function(a){return a.Yb(b)})}};c.prototype.dz=function(a){var b=this;void 0===a&&(a=this.Cd());C.ga("deletePage",arguments,C.ke);if(!this.Ca())if((0>
a||a>=this.hb())&&this.ab("deletePage: Asked to delete "+a+" but there are only "+this.hb()+" pages"),1===this.hb())this.$e(function(a){a.Yb(Mg(b.ip()));var c=a.se(0),d=c.mb(),e={},l=0,n;for(n in d)"_"===n[0]&&(e[n]=void 0,l++);l&&a.Bb([c.id],e)});else{var c=this.ea.view.aa.se(a).id;this.$e(function(a){return a.Yb([c])})}};c.prototype.pt=function(){this.Ca()||this.ea.view.kj()};c.prototype.Yf=function(){1===arguments.length&&!1===arguments[0]&&this.ea.view.aa.Xu();return this.ea.view.aa.Yf()};c.prototype.dispatchEvent=
function(a,b){C.ga("dispatchEvent",arguments,C.Tn(Event),C.cb(C.Tn(HTMLElement)));P("dispatchEvent(%s)",a.type);b=b||a.target||this.ea.me;return ve.hx(b,a)};c.prototype.jq=function(a,b){var c=this;C.ga("mouseEvent",arguments,C.String,C.Object);if("click"===a){var e=this.jq("down",b);return e=e||this.jq("up",b)}var f={clientX:(b.pageX||0)-(document.documentElement.scrollLeft+document.body.scrollLeft),clientY:(b.pageY||0)-(document.documentElement.scrollTop+document.body.scrollTop),bubbles:!0,cancelable:!0,
buttons:b.buttons,ctrlKey:b.ctrlKey||!1,altKey:b.altKey||!1,pointerType:b.pointerType||""};try{e="onpointerdown"in window&&!("ontouchstart"in window)?new PointerEvent("pointer"+a,f):new MouseEvent("mouse"+a,f)}catch(h){return e=document.createEvent("MouseEvent"),e.initMouseEvent("mouse"+a,f.bubbles||!1,f.cancelable||!1,window,0,f.screenX||0,f.screenY||0,f.clientX||0,f.clientY||0,f.ctrlKey||!1,f.altKey||!1,f.shiftKey||!1,f.metaKey||!1,f.button||0,f.relatedTarget||null),Object.defineProperty(e,"buttons",
{get:function(){return f.buttons}}),Object.defineProperty(e,"target",{get:function(){return b.target||c.ea.me}}),this.ea.view.Lw.handleEvent(e),!e.defaultPrevented}return this.dispatchEvent(e,b.target)};c.prototype.tB=function(a,b){C.ga("keyboardEvent",arguments,C.String,C.Object);return this.dispatchEvent(function(a,b){try{var c=new KeyboardEvent(a,b);Object.defineProperty(c,"keyCode",{get:function(){return b.keyCode||0}});return c}catch(k){}c=document.createEvent("KeyboardEvent");var d=[];b.ctrlKey&&
d.push("Control");b.shiftKey&&d.push("Shift");b.altKey&&d.push("Alt");b.metaKey&&d.push("Meta");c.initKeyboardEvent(a,b.bubbles||!1,b.cancelable||!1,null,b.keyCode||0,0,d.join(" "),!1,"");Object.defineProperty(c,"keyCode",{get:function(){return b.keyCode||0}});return c}(a,b),document.body)};c.prototype.download=function(a,b,c,e){if("string"===typeof b){C.ga("download",arguments,C.String,C.String,C.cb(Rg),C.Sa);var d={format:a,rect:c,maxWidth:e};var h=b}else C.ga("download",arguments,C.String,Tg),
d=b,h=a;d=hc(d,{encoding:"data-uri"});d=this.save(d);this.Gt.cD(d,h)};c.prototype.la=function(a,b){void 0===b&&(b={});C.ga("draw",arguments,Sg,C.cb(C.Zc("DrawOptions",{page:C.ke,scaleHint:C.Sa})));var c=b.page||0,e=this.ea.view.aa.fb;var f="page"in b?this.rf(c):this.Zh();var h=1;if(b.gw)h=b.gw;else if(a.getTransform){var k=a.getTransform(),l=Math.sqrt(k.a*k.a+k.c*k.c),n=Math.sqrt(k.b*k.b+k.d*k.d);h=Math.min(1,.5*(l+n));console.log("BackgroundSCale is ",h,l,n,k,k.fl*k.fl+k.ql*k.ql,k.fy*k.fy+k.d+k.d,
k.fl,k.fl*k.fl,k.ql,k.ql*k.ql,JSON.stringify(k))}this.ea.view.aa.Fc(c);this.ea.view.kf(a,1,f.x,f.y,f.width,f.height,h,0,0);this.ea.view.aa.la(a);this.Ge&&this.Ge(a);this.ea.view.aa.Fc(e)};c.prototype.vz=function(a){C.ga("editNodeText",arguments,Q);if(!this.Ca()){var b=this.ea.view.aa.Jb(a,!1);if(b)if(b.$g()){var c=this.ea.view.wr({});c&&c.pr(b,b.rect.x,b.rect.y)}else P("editNodeText: node %s (%s) cannot contain text.",a,b.type());else P("editNodeText: ExtNodeID %s does not exist.",a)}};c.prototype.duplicate=
function(){this.Ca()||this.ea.view.duplicate()};c.prototype.Zn=function(a,b,c){var d=this;if(!(this.Vh||this.bp[a]||this.Bx(a))){var f=function(){if(!d.Vh){d.bp[a]=!1;if(a in d.lb)for(var c=0,e=d.lb[a];c<e.length;c++){var f=e[c];try{var n=f.apply(null,b)}catch(r){console.log("Error in handler for '"+a+"':",r)}}d.digest();return n}};"once"===c&&(this.bp[a]=!0);if("now"===c)return f();setTimeout(f,0);return this}};c.prototype.ta=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];
C.ga("emit",arguments,C.String);return this.Zn(a,b,"normal")};c.prototype.rc=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Zn(a,b,"now")};c.prototype.cg=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Zn(a,b,"once")};c.prototype.WD=function(a){C.ga("skipEvent",arguments,C.String);this.Nh[a]=a in this.Nh?this.Nh[a]+1:1};c.prototype.Bx=function(a){return a in this.Nh&&0<this.Nh[a]?(P("Skipped %s event",a),--this.Nh[a],!0):!1};
c.prototype.focus=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=null);C.ga("focus",arguments,C.rd,C.cb(C.HTMLElement));this.ea.KD(b);a?this.ea.hr("text"===this.Yh()):this.ea.focus()};c.prototype.blur=function(){this.ea.blur()};c.prototype.Mz=function(a){function b(b){return a(b.id)}C.ga("forEachNode",arguments,C.Function);this.ea.view.aa.Hl(b,this.ea.view.aa.Aa(this.ea.view.aa.root.id),!0);for(var c=0,e=this.ea.view.aa.uj;c<e.length;c++)this.ea.view.aa.Hl(b,e[c],!0)};c.prototype.Iz=function(a){C.ga("findNode",
arguments,C.String);var b=this.It(a);return b.length?b[0]:null};c.prototype.It=function(a){C.ga("findNodes",arguments,C.String);for(var b=this.ea.view.aa.Jz(a),c=[],e=0;e<b.length;e++)c.push(b[e].id);return c};c.prototype.Kz=function(a,b,c){C.ga("flip",arguments,C.Number,C.Sa,C.Sa);if(!this.Ca())if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.ab("flip: 2nd and 3rd args must be numbers.");else{var d=new F(b,c);this.ea.view.Ot(a/180*Math.PI,d)}else this.ea.view.Ot(a/180*Math.PI)};
c.prototype.vj=function(a,b,c,e){C.ga("flipNodes",arguments,C.Qk(Q),C.Number,C.Sa,C.Sa);if(!this.Ca()){var d=this.zs(Mg(a));if("number"===typeof c&&"number"===typeof e){var h=new F(c,e);this.ea.view.vj(d,b/180*Math.PI,h)}else this.ea.view.vj(d,b/180*Math.PI)}};c.prototype.Vt=function(a,b,c){var d=this;void 0===c&&(c={});C.ga("generatePalette",arguments,C.kb(C.String,C.HTMLElement),C.Number,C.cb(C.Zc("Options",{onColour:C.Rf,onOpacity:C.Rf})));c.onColour=c.onColour||c.onColor||function(a,b){d.Di(a,
b)};c.onOpacity=c.onOpacity||function(a,b){d.vw(a,b)};return Cf(a,b,c)};c.prototype.hp=function(){return this.ea.view.Tz()};c.prototype.ip=function(){var a=[];this.ea.view.aa.Ac(function(b){a.push(b.id)},this.Cd());return a};c.prototype.Yz=function(){return this.ea.Zz()};c.prototype.lp=function(a){C.ga("getBoundingRectangle",arguments,Og);return this.Cg(this.ea.view.lp(Mg(a)))};c.prototype.Bc=function(a){C.ga("getConfig",arguments,C.String);return this.ea.ha.get(a)};c.prototype.Cd=function(){return this.ea.view.aa.fb};
c.prototype.eA=function(){return this.ea.view.Yl()};c.prototype.fA=function(){return this.ea.view.Hj()};c.prototype.Yh=function(){return this.ea.view.Yh()};c.prototype.gA=function(a){C.ga("getCustomNode",arguments,Q);var b=this.ea.view.aa.Aa(a),c=null;b&&"CustomNode"===b.type()&&(c=b.Xa);return c};c.prototype.xj=function(a,b,c,e){void 0===c&&(c=0);void 0===e&&(e=0);C.ga("getDocumentCoordinates",arguments,C.Number,C.Number,C.Sa,C.Sa);var d=this.ea.view.Pd(a,b),h=this.mp();return{x:d.x,y:d.y,width:c/
h,height:e/h}};c.prototype.kA=function(a){C.ga("getDocumentProperty",arguments,C.String);return this.ea.view.aa.ia(a)};c.prototype.jA=function(){C.ga("getDocumentProperties",arguments);return this.ea.view.aa.mb()};c.prototype.Zh=function(a){void 0===a&&(a=this.Cd());C.ga("getDocumentSize",arguments,C.ke);var b;this.Bc("pageView")&&(b=rg);return this.Cg(this.ea.view.aa.fd(a,b))};c.prototype.tc=function(){return this.ea.sf()};c.prototype.Yl=function(){return this.ea.view.Yl()};c.prototype.tA=function(a){a=
this.ea.view.aa.Aa(a);if(!a)return null;for(var b=a.parent;b;){if(Wc(b)){var c=b.aA(a);if(c)return{gridID:b.id,row:c.$C,endRow:c.ZC,column:c.By,endColumn:c.Ay,sticky:a.ia("sticky")};break}a=b;b=b.parent}return null};c.prototype.vp=function(a){a=this.ea.view.aa.Aa(a);if(!a||!Wc(a))return null;a=a.vp();return{rows:a.rows,columns:a.et}};c.prototype.wA=function(){for(var a=[],b=0,c=this.ea.view.aa.Hp();b<c.length;b++){var e=c[b];a.push({cid:e.ty,ts:e.Pb})}return a};c.prototype.yp=function(a){C.ga("getImageUrl",
arguments,C.String);return this.ea.ha.yp(a)};c.prototype.AA=function(a){C.ga("getLanguageString",arguments,C.String);return this.ea.language.get(a)};c.prototype.Cp=function(){var a=this.ea.view.aa.wb.$z();if(!a.empty())return this.hh=a,a.toString();this.hh=null;return""};c.prototype.Cg=function(a){return new Qd(a.x,a.y,a.width,a.height)};c.prototype.$k=function(a){"object"!==typeof a&&this.ab("Error: Rectangle object expected.");a=new G(a.x||0,a.y||0,a.width||0,a.height||0);a.Xv();return a};c.prototype.mA=
function(){return this.Cg(this.ea.view.aa.kp())};c.prototype.vA=function(a){C.ga("getGroupParent",arguments,Q);var b=this.ea.view.aa.Jb(a);return null===b?(P("getGroupParent: No such node %s",a),null):b.parent&&"GroupNode"===b.parent.type()?b.parent.id:null};c.prototype.uA=function(a){C.ga("getGroupMembers",arguments,Q);var b=[],c=this.ea.view.aa.Aa(a);if(!c||"GroupNode"!==c.type())return P("getGroupMembers: Error node %s is not a group.",a),b;for(var e=0;e<c.children.length;e++)b.push(c.pb(e).id);
return b};c.prototype.yA=function(a,b){return this.$h(a,b)};c.prototype.DA=function(){var a=[],b={};this.ea.view.aa.Qc(!1,function(d){!(c=d.Cc())||c in b||(b[c]=1,a.push(c))});var c=this.hp();c in b||a.push(c);return a};c.prototype.BA=function(a){C.ga("getLayerNodes",arguments,C.String);var b=[];this.ea.view.aa.Qc(!1,function(c){c.Cc()===a&&b.push(c.id)});return b};c.prototype.GA=function(a,b,c){C.ga("getNodeCoordinates",arguments,Q,C.Number,C.Number);var d=this.ea.view.aa.Jb(a);if(null===d)return this.ab("Error: node %s does not exist",
a),null;d=this.ea.view.SB(d,b,c);return{x:d.x,y:d.y}};c.prototype.HA=function(a){return(a=this.ea.view.aa.Aa(a))&&a.parent?a.parent.re(a):-1};c.prototype.qf=function(a){C.ga("getNodePageNumber",arguments,Q);return this.ea.view.aa.qf(a)};c.prototype.$h=function(a,b){C.ga("getNodeProperty",arguments,Q,C.String);return this.ea.view.aa.$h(a,b)};c.prototype.Dj=function(a){C.ga("getNodeRectangle",arguments,Og);for(var b=null,c=0,e=this.ea.view.aa.Ep(Mg(a),!0);c<e.length;c++){var f=e[c];Tc(f)&&"GroupNode"!=
f.type()&&(Vc(f)&&this.ea.view.aa.Wp(f)?(f=z(f.da).gc(),f=this.xj(f.left,f.top,f.width,f.height),f=new G(f.x,f.y,f.width,f.height)):f=f.rect,b?b.Dh(f):b=f.clone())}b||(b=new G(0,0,0,0));return this.Cg(b)};c.prototype.IA=function(a){C.ga("getNodeScale",arguments,Q);var b=this.ea.view.aa.Jb(a);if(null===b)return this.ab("Error: node %s does not exist",a),null;b=b.Pa().vb();return{x:b.x,y:b.y}};c.prototype.JA=function(a){C.ga("getNodeTransform",arguments,Q);var b=this.ea.view.aa.Jb(a);if(null===b)this.ab("Error: node %s does not exist",
a);else return b=b.Pa(),[b.m11,b.m21,b.m12,b.m22,b.Fa,b.Ga]};c.prototype.KA=function(a){C.ga("getNodeType",arguments,Q);var b=this.ea.view.aa.Aa(a),c="";b&&(c=b.$m());return c};c.prototype.LA=function(a,b){C.ga("getNodeUnderPoint",arguments,C.Number,C.Number);var c=this.ea.view.aa.Db(a,b,this.ea.view.scale,this.ea.view.Rb).node;return c?c.id:this.ea.view.Hv(a,b)&&(c=this.hc(),c.length)?c[0]:null};c.prototype.OA=function(a,b,c){void 0===c&&(c=0);C.ga("getNodesUnderPoint",arguments,C.Number,C.Number,
C.Sa);for(var d=[],f=0,h=this.ea.view.aa.gB(a,b,c,this.ea.view.scale);f<h.length;f++)d.push(h[f].id);return d};c.prototype.hb=function(){return this.ea.view.aa.hb()};c.prototype.Ej=function(a){C.ga("getPageNode",arguments,C.dc);(0>a||a>this.hb())&&this.ab("getPageNode: Invalid page number "+a+". Must be 0.."+this.hb());var b=this.ea.view.aa.se(a);return b?b.id:null};c.prototype.rf=function(a){void 0===a&&(a=this.Cd());C.ga("getPageRect",arguments,C.ke);(0>a||a>=this.hb())&&this.ab("getPageRect: Invalid page number "+
a+". Must be 0.."+this.hb());return this.Cg(this.ea.view.rf(a))};c.prototype.cm=function(a){C.ga("getPathData",arguments,Q);var b=this.ea.view.aa.Jb(a,!1);if(!b||"PathNode"!==b.type())return null;var c=[],e=0;for(b=b.cm().clone().he();e<b.length;e++)for(var f=b[e],h=0;h<f.length;h++){var k=f[h];c.push(k.x);c.push(k.y)}return c};c.prototype.SA=function(a){C.ga("getPathAsPoints",arguments,Q);var b=this.ea.view.aa.Aa(a,!1);if(!b||"PathNode"!==b.type())return null;b=b.cm();for(var c=[],e=[],f=0;f<b.fa.length;){switch(b.fa[f]){case xc.Kc:e=
[{x:b.fa[f+1],y:b.fa[f+2]}];c.push(e);break;case xc.qd:e.push({x:b.fa[f+1],y:b.fa[f+2]})}f+=xc.td[b.fa[f]]}return c};c.prototype.mp=function(){return this.ea.view.scale};c.prototype.tp=function(){var a=this.ea.view.tp();return a?a.id:null};c.prototype.fm=function(a,b,c,e){C.ga("getScreenCoordinates",arguments,C.Number,C.Number,C.Sa,C.Sa);var d=this.ea.view.Xh(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};var h=this.ea.view.Xh(a+c,b+e);return this.Cg(new G(d.x,d.y,h.x-d.x,h.y-d.y))};c.prototype.VA=
function(){return this.ea.view.Ie};c.prototype.Hj=function(){return this.ea.view.Hj()};c.prototype.Xl=function(a,b){C.ga("getEditHandleType",arguments,Q,Qg);var c=this.ea.view.aa.Jb(a,!1);return c&&c.uf()?c.Xl(b):null};c.prototype.vD=function(a,b,c){C.ga("setEditHandle",arguments,Q,Qg,C.String);var d=this.ea.view.aa.Aa(a,!1);if(!d)return P("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return P("setEditHandle: node %s is not a PathNode.",a),!1;d=d.ia("commands");d=I.sx(d,b,
c);if(!d)return P("setEditHandle: failed"),!1;this.Qd(a,"commands",d);return!0};c.prototype.hc=function(a){void 0===a&&(a=!0);C.ga("getSelectedNodes",arguments,C.rd);return this.ea.view.Uc(a)};c.prototype.ai=function(a){function b(a,b){var c=e.properties[a];void 0!==b&&(e.properties[a]=c!==b&&void 0!==c?null:b);e.empty=!1}function c(a){var c=a.$m();e.types[c]=!0;e.types.AnyNode=!0;e.empty=!1;e.nodes.push(a.id);var d=a.mb();"PathNode"===c?(c=d.closed?"PathNode-closed":"PathNode-open",e.types[c]=!0):
"HTMLNode"===c&&(e.types[d.$component]=!0);d=a.mb();"TextNode"===c&&(d["border-color"]=a.ia("border-color"),d["border-width"]=a.ia("border-width"),d.background=a.ia("background")||"transparent",d.textFillStyle=a.ia("fillStyle"));for(var h in d)d.hasOwnProperty(h)&&"matrix"!==h&&("BrushNode"!==c||"fillStyle"!==h)&&("PathNode-open"!==c||"fontSize"!==h&&"fontName"!==h&&"fillStyle"!==h)&&("PathNode-closed"!==c||(f&&d.text||"fontSize"!==h&&"fontName"!==h)&&"arrowSize"!==h&&"arrowStyle"!==h)&&b(h,d[h])}
void 0===a&&(a=this.hc(!1));C.ga("getPropertySummary",arguments,Pg);for(var e={properties:{},types:{},nodes:[],empty:!0},f=this.ea.ha.get("allowTextInShape"),h=0;h<a.length;h++){var k=this.ea.view.aa.Aa(a[h],!1);k&&Tc(k)&&(c(k),this.ea.view.aa.Hl(c,k))}!e.nodes.length||"opacity"in e.properties||(e.properties.opacity=1);if(this.ea.view.sa.Xg){h=this.ea.view.sa.Xg();for(var l in h)b(l,h[l])}if(this.ea.view.sa.Kp)for(l=0,h=this.ea.view.sa.Kp();l<h.length;l++)e.types[h[l]]=!0;return e};c.prototype.ou=
function(){return this.Cg(this.ea.view.Ub())};c.prototype.aB=function(a){C.ga("goToRevision",arguments,C.kb(C.String,C.Hh));this.ea.view.aa.Lp(a);this.gn("readOnly",this.ea.view.aa.locked())};c.prototype.hasFocus=function(){return this.ea.hasFocus()};c.prototype.ab=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));b=c.join("");P(b);console.log(b);throw Error(b);};c.prototype.iC=
function(a){C.ga("openFile",arguments,C.cb(C.Zc("OpenFileArgs",{accept:C.Qb,format:C.Sk("text","data-uri","ArrayBuffer","File"),capture:C.Qb})));a||(a={});switch(a.format){case "ArrayBuffer":case void 0:case "File":case "data-uri":break;default:throw Error("openFile: requested format not known. Check docs.");}return this.Ml.open({accept:a.accept,format:a.format||"data-uri",capture:a.capture}).then(function(a){return{data:a.data,contentType:a.contentType}})};c.prototype.iB=function(a){var b=this;void 0===
a&&(a={});C.ga("insertImage",arguments,C.sd);return new Promise(function(c){b.Ca()||(a.url?b.ea.view.mq(a).then(c):b.Ml.open({accept:"image/*",format:"File"}).then(function(d){var e=b.ea.view.Ub().ne();if(!1===b.rc("paste",d.data,e.x,e.y))P("paste of file is cancelled by external app.");else{var h=new FileReader;h.readAsDataURL(d.data);h.onloadend=function(){b.ea.view.mq(hc(a,{url:h.result})).then(c)}}}))})};c.prototype.Pj=function(a,b,c){void 0===a&&(a=this.Cd());C.ga("insertPage",arguments,C.ke,
C.Sa,C.Sa);if(this.Ca())return this.Cd();var d={background:this.Bc("background")};Wf(b)&&Wf(c)&&(d.width=b,d.height=c);this.$e(function(b){return b.createNode("PageNode",d,b.root.id,a)});return a};c.prototype.zm=function(a){C.ga("isLayerVisible",arguments,C.String);return this.ea.view.aa.zm(a)};c.prototype.dh=function(a){C.ga("isNodeSelected",arguments,Q);var b=this.ea.view.aa.Jb(a);return null!==b&&this.ea.view.dh(b)};c.prototype.Pe=function(a,b){C.ga("isPointOverCanvas",arguments,C.Number,C.Number);
return this.ea.view.Pe(a,b)};c.prototype.load=function(a,b){C.ga("load",arguments,C.String,C.cb(C.kb(C.String,C.Object)));void 0===b&&(b=a);var c=wg.Ih(b,this.ea.sf(),this.ea.Ai,this.jf);if(c)return this.tn(),this.ea.zh(c),this.ta("document-opened"),!0;P("load(): Could not open file.");return!1};c.prototype.Cm=function(a){C.ga("lockUpdates",arguments,C.Number);var b=this;Wf(a)?(this.iq&&clearTimeout(this.iq),this.iq=setTimeout(function(){b.ea.view.Cm(!1)},a),b.ea.view.Cm(!0)):this.ab("lockUpdates: Expected a number")};
c.prototype.Wj=function(a){C.ga("markChangesSent",arguments,C.String);if(this.hh||a){if(!this.hh||a!==this.hh.toString())throw Error("markChangesSent: does not match last getLocalChanges()");P("Mark changes sent!");this.ea.view.aa.wb.Wj(this.hh.vB);this.hh=null}};c.prototype.IB=function(a){void 0===a&&(a=this.hc());C.ga("moveDown",arguments,Pg);this.Ca()||this.ea.view.Xd(3,Mg(a))};c.prototype.JB=function(a,b){C.ga("movePage",arguments,C.dc,C.dc);if(!this.Ca()){var c=this.hb();if(0>a||a>=c)this.ab("From page must be > 0 and less than getPageCount()");
else if(0>b||b>=c)this.ab("From page must be > 0 and less than getPageCount()");else{var e=this.Ej(a);null!==e&&this.$e(function(a){return a.Xd([e],4,b)})}}};c.prototype.KB=function(a){void 0===a&&(a=this.hc());C.ga("moveUp",arguments,Pg);this.Ca()||this.ea.view.Xd(2,Mg(a))};c.prototype.lq=function(){this.tn();this.ea.lq();this.uv()};c.prototype.nextPage=function(){this.yh(Math.min(this.Cd()+1,this.hb()-1))};c.prototype.pa=function(a,b){C.ga("on",arguments,C.String,C.Function);this.ha.has(a)?this.ha.pa(a,
b):"draw"===a?this.Ge=b:a in this.lb?this.lb[a].push(b):this.lb[a]=[b];return this};c.prototype.bC=function(a){var b=this;C.ga("onComplete",arguments,C.Function);this.ea.view.Oz(function(){a();b.digest()})};c.prototype.uv=function(){var a=this.ea.ha.get("defaultPaperSize");P("onNewDocument()");"none"!==a&&this.er(a);this.ta("document-opened")};c.prototype.jC=function(a){var b=this;C.ga("openFromComputer",arguments,C.String);return this.Ml.open({accept:"."+a,format:"text"}).then(function(a){if("string"===
typeof a.data&&b.load(a.data))return b;throw Error("Could not open the file.");})};c.prototype.ik=function(a){C.ga("paste",arguments,C.Qb);return this.Ca()?[]:this.ea.view.ik(a)};c.prototype.wC=function(a){C.ga("pauseSharedSession",arguments,C.Boolean);this.Gc&&this.Gc.JD(a)};c.prototype.AC=function(){this.yh(Math.max(this.Cd()-1,0))};c.prototype.print=function(a,b){C.ga("print",arguments,C.cb(C.kb(C.dc,C.kx)),C.cb(Rg));var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=
0;e<a.length;e++)if(Wf(a[e]))c.push(a[e]);else{this.ab("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.hb();e++)c.push(e);var f=b?this.$k(b):this.$k(this.Zh());var h=this.Cd(),k=document.createElement("canvas");k.width=f.width;k.height=f.height;var l=k.getContext("2d");l.translate(-f.x,-f.y);e=window.location.hostname;var n=window.open("about:blank","_blank");n.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.yh(c[e]),
this.ea.view.kf(l,1,f.x,f.y,f.width,f.height,1,0,0),this.ea.view.aa.la(l),0<e?n.document.write("<div style='page-break-before:always'>"):n.document.write("<div>"),n.document.write("<img style='width:100%' src='"),n.document.write(k.toDataURL()),n.document.write("'></div>"),l.clearRect(f.x,f.y,f.width,f.height);n.document.write("</body></html>");n.document.close();setTimeout(function(){n.focus();n.print();setTimeout(function(){n.close()},1E3)},1E3);this.yh(h)};c.prototype.Ca=function(){return this.ea.ha.get("readOnly")?
(P("readOnly; ignore tool click."),!0):!1};c.prototype.ye=function(){this.ea.view.ye()};c.prototype.Od=function(a){C.ga("redraw",arguments,C.Rf);this.ea.view.la(a)};c.prototype.removeEventListener=function(a,b){this.removeListener(a,b)};c.prototype.removeListener=function(a,b){C.ga("removeListener",arguments,C.String,C.Function);if(this.ha.has(a))this.ha.removeListener(a,b);else if("draw"===a)this.Ge===b&&(this.Ge=null);else if(a in this.lb){for(var c=this.lb[a],e=0;e<c.length;e++)if(c[e]===b){c.splice(e,
1);break}0===c.length&&delete this.lb[a]}};c.prototype.resize=function(a){var b=this;void 0===a&&(a=!0);return this.Pq?this.Oq:this.Oq=new Promise(function(c){b.Pq=setTimeout(function(){b.Vh||(b.Pq=0,b.Oq=null,b.ea.Si(a),c())},0)})};c.prototype.save=function(a,b,c){if("object"!==typeof a){C.ga("save",arguments,C.Qb,C.cb(Rg),C.Sa);var d={format:a||"zwibbler3",rect:b,maxWidth:c}}else C.ga("save",arguments,Tg),d=a;var f=d.format||"zwibbler3";f={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",
svg:"image/svg+xml",pdf:"application/pdf"}[f]||f;var h=d.rect,k=d.maxWidth||0;if(void 0!==d.pages)var l=d.pages;else if(void 0!==d.page)l=[d.page];else if("application/pdf"===f){l=[];for(var n=0;n<this.hb();n++)l.push(n)}else l=[this.Cd()];h=this.$k(h||this.Zh());switch(f){case "list":return wg.Wn(this.ea.view.aa,"list","object");case "image/png":case "image/jpeg":case "image/bmp":case "image/svg+xml":case "application/pdf":return this.ea.bD(f,h,k,l,d.encoding||"data-uri");case "zwibbler3":return wg.Wn(this.ea.view.aa,
"zwibbler3",d.encoding||"string");default:return"Unsupported format: "+f}};c.prototype.Kb=function(a){C.ga("setCursor",arguments,C.String);this.ea.view.Kb(a)};c.prototype.kd=function(a,b){C.ga("setToolProperty",arguments,C.String,C.Eh);this.Ca()||this.ea.view.kd(a,Ug(a,b))};c.prototype.zs=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.ea.view.aa.Jb(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){C.ga("selectNodes",arguments,Og);var b=this.zs(Mg(a));this.ea.view.selectNodes(b);
this.ea.view.pc();this.ea.view.la()};c.prototype.jD=function(a){C.ga("sendToBack",arguments,Pg);if(!this.Ca()){var b=Mg(a||this.hc());this.$e(function(a){return a.Xd(b,1)})}};c.prototype.en=function(a){C.ga("setActiveLayer",arguments,C.String);this.ea.view.en(a)};c.prototype.gn=function(a,b){C.ga("setConfig",arguments,C.String,C.Eh);"defaultPaperSize"===a&&this.er(b);return this.ea.ha.set(a,b)};c.prototype.rs=function(a,b){b=this.rc("colour-clicked",a,b);void 0===b?b=a:b||(b="");return b};c.prototype.Di=
function(a,b){C.ga("setColour",arguments,C.String,C.Boolean);if(this.Ca())return!1;this.rs(a,b)&&this.ea.view.aC(a,b);return!1};c.prototype.yh=function(a){C.ga("setCurrentPage",arguments,C.dc);this.ea.view.Fc(a)};c.prototype.tk=function(a){C.ga("setCustomBackgroundFn",arguments,C.Function);this.ea.view.tk(a)};c.prototype.rD=function(a){C.ga("useCustomTool",arguments,C.Object);this.gf=new yg(this.ea.view,a)};c.prototype.tD=function(a,b){C.ga("setDocumentProperty",arguments,C.String,C.ox);this.ea.view.aa.setProperty(a,
b)};c.prototype.Ei=function(a,b){C.ga("setDocumentSize",arguments,C.kb(C.Number,C.Hh),C.kb(C.Number,C.Hh));this.ea.view.Ei(a,b,!0)};c.prototype.nw=function(a,b){C.ga("setDocumentSizeInTransaction",arguments,C.kb(C.Number,C.Hh),C.kb(C.Number,C.Hh));this.ea.view.Ei(a,b,!1)};c.prototype.ow=function(a,b){C.ga("setDomElement",arguments,Q,C.HTMLElement);var c=this.ea.view.aa.Aa(a);c?("DomNode"!==c.type()&&this.ab("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.wD(b),this.ea.Fl.push(b)):
this.ab("setDomElement: Node %s does not exist",a)};c.prototype.uD=function(a,b){return this.ow(a,b)};c.prototype.Cx=function(){var a=this;P("Setting up dragdrop");this.za.addEventListener(document,"dragover",function(b){a.ea.view.Pe(b.pageX,b.pageY)?b.preventDefault():P("Ignore drag event -- not over canvas")});this.za.addEventListener(document,"drop",function(b){b.preventDefault();if(!a.ea.view.Pe(b.pageX,b.pageY))P("Ignore drop event -- not over canvas");else if(a.Bc("readOnly"))P("Ignore drop event -- readOnly mode");
else if(b.dataTransfer){if(b.dataTransfer.items)for(var c=0;c<b.dataTransfer.items.length;c++){if("file"===b.dataTransfer.items[c].kind){a.ea.view.Fq(b.dataTransfer.items[c],b.pageX,b.pageY);break}}else for(c=0;c<b.dataTransfer.files.length;){a.ea.view.Fq(b.dataTransfer.files[c],b.pageX,b.pageY);break}try{var e=JSON.parse(b.dataTransfer.getData("text"))}catch(n){return}if("object"===typeof e&&e["zwibbler-src"]){var f=parseFloat(e["zwibbler-width"]),h=parseFloat(e["zwibbler-size"]),k=e["zwibbler-src"],
l=e["zwibbler-props"];P("DragDrop received with src=%s size=%s",k,f);k&&N.xp(k,function(c,d){var e=1;h?e=Math.min(h/c,h/d):f&&(e=f/c);var n=a.xj(b.pageX,b.pageY);n.x-=c*e/2;n.y-=d*e/2;a.ol();l.url=k;c=a.createNode(/^data:image\/svg|\.svg$/i.test(k)?"SvgNode":"ImageNode",l);a.bn(c,e,e);a.Ch(c,n.x,n.y);a.yl();a.Qw()})}}})};c.prototype.lA=function(a){C.ga("getDomElement",arguments,Q);var b=this.ea.view.aa.Aa(a);return b?Uc(b)?b.da:(this.ab("getDomElement: Node %s is not a DomNode. It is %s",a,b.type()),
null):(this.ab("getDomElement: Node %s does not exist",a),null)};c.prototype.iu=function(a){for(C.ga("getNodeFromElement",arguments,C.HTMLElement);a;){var b=a.getAttribute("nid");if(b)return b;a=a.parentElement}return null};c.prototype.bm=function(a){C.ga("getNodeObject",arguments,Q);var b=this.ea.view.aa.Aa(a);return b?b.bi({ctx:this}):null};c.prototype.DD=function(a,b){C.ga("setLayerName",arguments,C.String,C.String);Vf(a)&&Vf(b)?(this.hp()===a&&this.en(b),this.ea.view.aa.Qc(!1,function(c){c.Cc()===
a&&c.setProperty("layer",b)})):this.ab("setLayerName() needs string arguments.")};c.prototype.HD=function(a,b){C.ga("setPageBackground",arguments,C.dc,C.String);var c=this.Ej(a);c&&this.Qd(c,"background",b)};c.prototype.er=function(a,b){C.ga("setPaperSize",arguments,C.kb(C.Number,C.String),C.cb(C.kb(C.Number,C.Boolean)));var c=null,e=null,f=null,h=!0,k=!1;if(2===arguments.length)Wf(arguments[0])&&Wf(arguments[1])?(f=arguments[0],c=arguments[1]):Vf(arguments[0])&&"boolean"===typeof arguments[1]?(e=
arguments[0],k=arguments[1]):h=!1;else if(1===arguments.length&&Vf(arguments[0]))for(var l=arguments[0].split(" "),n=0;n<l.length;n++)"landscape"===l[n]?k=!0:"portrait"===l[n]?k=!1:e=l[n];if(!1===h)return P("Bad arguments to setPaperSize()."),!1;if(null===e)return this.Ei(f,c),!0;switch(e.toLowerCase()){case "letter":f=816;c=1056;break;case "legal":f=816;c=1344;break;case "11x17":f=1056;c=1632;break;case "tabloid":f=1056;c=1632;break;case "a0":f=841/25.4*96;c=1189/25.4*96;break;case "a1":f=594/25.4*
96;c=841/25.4*96;break;case "a2":f=420/25.4*96;c=594/25.4*96;break;case "a3":f=297/25.4*96;c=420/25.4*96;break;case "a4":f=210/25.4*96;c=297/25.4*96;break;case "none":c=f=null;break;default:return P("Invalid paper size: %s",e),!1}k&&(e=f,f=c,c=e);this.Ei(f,c);return!0};c.prototype.AD=function(a,b,c){this.Qd(a,b,c)};c.prototype.Bb=function(a,b){C.ga("setNodeProperties",arguments,Og,C.Object);this.Ca()||this.ea.Bb(Mg(a),this.yc(b))};c.prototype.Qd=function(a,b,c){C.ga("setNodeProperty",arguments,Og,
C.String,C.Eh);if(!this.Ca()){c=Ug(b,c);var d={};d[b]=c;this.Bb(a,d)}};c.prototype.FD=function(a,b){C.ga("setNodeVisibility",arguments,Og,C.Boolean);for(var c=Mg(a),e=0;e<c.length;e++){var f=this.ea.view.aa.Jb(c[e],!0);if(f&&(f.sg(!b),Uc(f))){var h=f.parent;Uc(h)&&h.zk(h.re(f),b)}}this.ea.view.la()};c.prototype.vw=function(a,b){C.ga("setOpacity",arguments,C.Number,C.Boolean);this.Ca()||this.ea.view.fC(a,b)};c.prototype.ID=function(a,b,c){C.ga("setPageSize",arguments,C.dc,C.Number,C.Number);Wf(a)&&
Wf(b)&&Wf(c)||this.ab("setPageSize(): requires pageNo, width, height");var d=this.Ej(a);d?this.Bb(d,{width:b,height:c}):this.ab("setPageSize: no such page %s",a)};c.prototype.dr=function(a){C.ga("setPageView",arguments,C.Boolean);this.ea.view.dr(a)};c.prototype.Nb=function(a){C.ga("setProperties",arguments,C.Object);if(!this.Ca()){this.Bb(this.hc(),a);for(var b in a){var c=a[b];this.kd(b,c);"lineWidth"===b&&"brush"===this.Yh()?this.gn("defaultBrushWidth",Ug(b,c)):this.ea.view.Lf(b,Ug(b,c))}}};c.prototype.setProperty=
function(a,b){C.ga("setProperty",arguments,C.String,C.Eh);var c={};c[a]=b;this.Nb(c)};c.prototype.ND=function(a,b){void 0===b&&(b=!0);C.ga("setViewRectangle",arguments,Rg,C.rd);0!==a.width&&0!==a.height||this.ab("setViewRect: width and height must be non-zero.");this.ea.view.ze(this.$k(a),!1,!1,b)};c.prototype.ee=function(a,b,c){C.ga("setZoom",arguments,C.kb(C.String,C.Number),C.Sa,C.Sa);if(Wf(a)||"page"===a||"width"===a)if(1===arguments.length)this.ea.view.ee(a);else if(3===arguments.length&&"number"===
typeof a&&Wf(b)&&Wf(c)){var d=this.mp()/a,f=this.ea.view.Ub();f.transform(new rc(d,d,b,c));this.ea.view.ze(f)}else this.ab("setZoom: invalid arguments.");else P("setZoom: invalid parameter.")};c.prototype.Ak=function(a,b){void 0===b&&(b=!0);C.ga("showLayer",arguments,C.String,C.Boolean);this.ea.view.Ak(a,b)};c.prototype.rb=function(a,b,c){C.ga("snap",arguments,C.Number,C.Number,C.Sa);var d=this.ea.view.rb(new F(a,b),c||0);return{x:d.x,y:d.y}};c.prototype.sr=function(a){this.ea.view.sr(a)};c.prototype.xm=
function(){return N.xm()};c.prototype.iE=function(){return this.ea.view.aa.toString()};c.prototype.Gk=function(a){C.ga("toggleFullScreen",arguments,C.cb(C.kb(C.String,C.HTMLElement)));a?(a=z.tc(a))||this.ab("toggleFullScreen: can't find element from "+a):a=this.tc();a.style.backgroundColor=q.Lc;N.Gk(a)};c.prototype.Ch=function(a,b,c){C.ga("translateNode",arguments,Og,C.Number,C.Number);if(this.Ca())return!1;P("Translate node %s by %s,%s",a,b,c);return this.ea.Ch(Mg(a),b,c)};c.prototype.mk=function(a){C.ga("removePanel",
arguments,C.HTMLElement);this.ea.mk(a)};c.prototype.Jq=function(){this.ea.view.Jq()};c.prototype.XC=function(a){C.ga("rotateDocument",arguments,C.Number);if(!this.Ca()){var b=0===Math.round(a/(Math.PI/2))%2;this.ol();for(var c=0;c<this.hb();c++)this.dw(c,a);b||(b=this.ea.view.aa.ia("width"),c=this.ea.view.aa.ia("height"),b&&c||!this.Bc("pageView")||(b=rg.width,c=rg.height),b&&c&&this.nw(c,b));this.yl()}};c.prototype.cw=function(a,b,c,e){C.ga("rotateNode",arguments,Og,C.Number,C.Sa,C.Sa);if(this.Ca())return!1;
P("Rotate nodes by %s around (%s,%s)",b/Math.PI*180,c,e);for(var d=4===arguments.length,h=Mg(a),k=new F(0,0),l=0;l<h.length;l++){var n=h[l],r=this.ea.view.aa.Jb(n);r&&(r||d)?!d&&r&&(n=r.rect.ne(),k.x+=n.x,k.y+=n.y):P("rotateNode: Node %s does not exist",n)}d?(k.x=c,k.y=e):(k.x/=h.length,k.y/=h.length);d=new qc(b,k.x,k.y);return this.ea.transformNode(h,d)};c.prototype.dw=function(a,b){C.ga("rotatePage",arguments,C.dc,C.Number);a>=this.hb()&&this.ab("rotatePage: page "+a+" does not exist.");if(!this.Ca()){var c=
Math.round(b/(Math.PI/2));b=c*Math.PI/2;var e=0===c%2;this.ol();c=this.Cd();this.yh(a);var f=this.ip(),h=this.Zh(),k=h.width/2,l=h.height/2;this.cw(f,b,k,l);e||this.Ch(f,l-k,k-l);e=this.Ej(a);this.Bb(e,{width:h.height,height:h.width});this.yh(c);this.yl()}};c.prototype.bn=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);C.ga("scaleNode",arguments,Og,C.Number,C.Number,C.Sa,C.Sa);0!==b&&0!=c||this.ab("scaleNode("+a+", "+b+", "+c+") cannot scale by a zero-value.");if(this.Ca())return!1;P("Scale node %s by %s,%s",
a,b,c);return this.ea.bn(Mg(a),b,c,e,f)};c.prototype.cr=function(a,b,c,e,f,h,k){C.ga("setNodeTransform",arguments,Og,C.Number,C.Number,C.Number,C.Number,C.Number,C.Number);if(this.Ca())return!1;P("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,h,k);return this.ea.cr(Mg(a),b,c,e,f,h,k)};c.prototype.zw=function(a,b,c){var d=this;C.ga("showColourPicker",arguments,C.kb(C.String,C.Number),C.Number,C.Sa);if(!this.mg){var f=document.createElement("div");f.style.width="320px";f.style.lineHeight=
"0";f.style.position="absolute";f.style.webkitUserSelect="none";f.style.userSelect="none";f.style.boxShadow="2px 2px 2px rgba(0,0,0.2)";f.style.background="white";var h=this;this.Vt(f,20,{onColour:function(a,b){if(h.xl)h.xl(a),h.digest();else if(a=h.rs(a,b))for(var c=0,d=h.dt.split(",");c<d.length;c++){var e=d[c];""===e&&b?e="fillStyle":""!==e||b||(e="strokeStyle");h.setProperty(e,a)}}});this.mg=N.Rn(f);this.za.add(function(){d.mg&&(d.mg.destroy(),z(f).remove(),d.mg=null)})}this.xl=null;if("string"===
typeof a)this.dt=a,this.mg.show(b,c,!0);else return c=b,b=a,new Promise(function(a){d.xl=a;d.mg&&d.mg.show(b,c,!0)})};c.prototype.Yy=function(a){void 0===a&&(a=Bg(32));C.ga("createSharedSession",arguments,C.Qb);P("Creating shared session "+a);this.ss(a,2);return a};c.prototype.ss=function(a,b){var c=this;P("Attach to shared session %s, creating=%s",a,b);this.Gc&&this.Gc.stop();this.ea.view.aa.wb.TC();return new Promise(function(d,f){var e=c.ea.ha.get("collaborationServer");"custom"!==e?(e=new Eb(c,
e.replace("{name}",a),c.Bc("latency"),N.WebSocket),c.Gc=e,e.pa("connected",function(){c.ta("connected");var a=0,b;for(b in c.ni)a++,P("Sending non-persistent key %s",b),c.Zj[b]=c.ni[b];a&&c.ta("local-keys");c.digest()}),e.pa("connect-error",function(){c.ta("connect-error");c.digest()}),e.pa("broadcast",function(a){c.ta("broadcast",a);c.digest()}),e.pa("set-keys",function(a){c.ta("set-keys",a)}),e.start(a,b).then(function(){P("Session resolved");d(a)},function(a){P("Error joining session: %s",a.message);
f(a)})):d(a);return a})};c.prototype.sB=function(a,b){void 0===a&&(a="");void 0===b&&(b=!1);C.ga("joinSharedSession",arguments,C.Qb,C.rd);return this.ss(a,b?0:1).then(function(){P("Successfully connected to session.")},function(a){console.log("Error connecting to session:",a);throw a;})};c.prototype.tn=function(){this.Su()};c.prototype.Su=function(){this.Gc&&(this.Gc.stop(),this.Gc=null,this.ta("disconnected"))};c.prototype.XA=function(){return this.Gc?this.Gc.st:""};c.prototype.hu=function(){var a=
[],b;for(b in this.Zj)a.push(this.Zj[b]);this.Zj={};return a};c.prototype.FA=function(){var a=[],b;for(b in this.ni)a.push(this.ni[b]);return a};c.prototype.Xc=function(){this.Ca()||this.ea.view.Xc()};c.prototype.Ki=function(a){void 0===a&&(a=this.hc());C.ga("ungroup",arguments,Pg);this.Ca()||this.$e(function(b){b.Ki(Mg(a))})};c.prototype.upload=function(a,b){function c(){}function e(){}void 0===b&&(b="Working");C.ga("upload",arguments,C.Tn(HTMLFormElement),C.Qb);var f=this.ea.Xy(b),h=new XMLHttpRequest,
k=new FormData(a);h.upload.addEventListener("progress",function(a){f.update(a.loaded/a.total)},!1);h.addEventListener("load",function(){200===h.status?(f.done(),e(h.response,h)):(f.error("Error"),c(h))},!1);h.addEventListener("error",function(){f.error("Error");c(h)},!1);h.addEventListener("abort",function(){f.error("Aborted");c(h)},!1);h.open(a.method,a.action);h.send(k);var l={success:function(a){e=a;return l},error:function(a){c=a;return l}};return l};c.prototype.xE=function(a,b){void 0===b&&(b=
!1);C.ga("useArrowTool",arguments,C.sd,C.rd);this.Ca()||this.ea.view.Yx(this.yc(a),b)};c.prototype.yE=function(a,b){this.Ca()||(2===arguments.length?(C.ga("useBrushTool",arguments,C.String,C.Number),this.ea.view.To({lineWidth:b,strokeStyle:a})):1===arguments.length?(C.ga("useBrushTool",arguments,C.Object),this.ea.view.To(this.yc(arguments[0]))):this.ea.view.To({}))};c.prototype.zE=function(a){C.ga("useCircleTool",arguments,C.sd);this.Ca()||this.ea.view.En(this.yc(a))};c.prototype.AE=function(a){C.ga("useCurveTool",
arguments,C.sd);this.Ca()||this.ea.view.jt(this.yc(a))};c.prototype.BE=function(a){C.ga("useCustomTool",arguments,C.Object);if(!this.Ca())if(Xf(a)){var b=new yg(this.ea.view,a);this.ea.view.Ya(b)}else this.ab("useCustomTool(): requires an object as argument.")};c.prototype.Ir=function(a){C.ga("useEditHandleTool",arguments,Q);this.Ca()||this.ea.view.Ir(a)};c.prototype.En=function(a){void 0===a&&(a={});C.ga("useEllipseTool",arguments,C.sd);this.Ca()||this.ea.view.En(this.yc(a))};c.prototype.EE=function(a,
b,c){void 0===c&&(c="freehand");C.ga("useFreehandTool",arguments,C.cb(C.kb(C.String,C.Object)),C.cb(C.kb(C.Number,C.String)),C.Qb);if(!this.Ca()){if(Xf(arguments[0])){var d=this.yc(arguments[0]);c=arguments[1]||"freehand"}else d={strokeStyle:a||this.Hj(),lineWidth:b||this.Bc("defaultLineWidth")};this.ea.view.tt(d,c)}};c.prototype.NE=function(a,b){void 0===b&&(b=!0);C.ga("useStampTool",arguments,C.kb(C.String,C.Object),C.rd);if(!this.Ca()){var c=a;Vf(a)?c={url:a}:"url"in c||this.ab("useStampTool: missing url in properties");
this.ea.view.FE(c,1===arguments.length||!0===b)}};c.prototype.GE=function(a,b){C.ga("useLineTool",arguments,C.cb(C.Object),C.cb(C.kb(C.Boolean,C.Zc("LineToolOptions",{singleLine:C.rd,orthogonal:C.rd,open:C.rd}))));if(!this.Ca()){if(Xf(b)){var c=b.singleLine;var e=b.orthogonal;var f=b.open}else c=b;this.ea.view.Uu(this.yc(a),c,e,f)}};c.prototype.HE=function(){this.ea.view.nC()};c.prototype.Qw=function(){this.ea.view.Ab()};c.prototype.Jr=function(a,b,c,e){void 0===c&&(c=1);void 0===e&&(e={});C.ga("usePolygonTool",
arguments,C.dc,C.Sa,C.Sa,C.sd);this.Ca()||this.ea.view.Jr(a,b,c,this.yc(e))};c.prototype.IE=function(a){void 0===a&&(a={});C.ga("useQuadraticBezierTool",arguments,C.sd);this.Ca()||this.ea.view.tt(this.yc(a),"quadratic")};c.prototype.Lk=function(a){void 0===a&&(a={});C.ga("useRectangleTool",arguments,C.sd);this.Ca()||this.ea.view.Lk(this.yc(a))};c.prototype.JE=function(a){void 0===a&&(a={});C.ga("useRoundRectTool",arguments,C.sd);this.Ca()||this.ea.view.Lk(hc({roundRadius:this.ea.ha.get("defaultRoundRectRadius")},
a))};c.prototype.LE=function(a,b){C.ga("useShapeBrushTool",arguments,C.cb(C.kb(C.Object,C.String)),C.Sa);if(!this.Ca()){var c={};Xf(a)?c=this.yc(a):Vf(a)&&(c.stokeStyle=a);Wf(b)&&(c.lineWidth=b);this.ea.view.pz(c)}};c.prototype.Kr=function(a,b,c,e,f,h){void 0===f&&(f="rectangle-tl");void 0===h&&(h=null);C.ga("useShapeTool",arguments,C.String,C.Object,C.Number,C.Number,C.cb(C.Sk("rectangle","circle","rectangle-tl")),C.rd);this.Ca()||(b=this.yc(b),"SvgNode"===a&&"custom"===b.fillMode&&(b.fillStyle=
b.fillStyle||this.ea.view.ua.fillStyle,b.strokeStyle=b.strokeStyle||this.ea.view.ua.strokeStyle,"lineWidth"in b||(b.lineWidth=this.ea.view.ua.lineWidth)),this.ea.view.Kr(a,b,c,e,f,h))};c.prototype.ME=function(a){C.ga("useSquareTool",arguments,C.sd);this.Ca()||this.ea.view.Lk(this.yc(a))};c.prototype.OE=function(a){C.ga("useTextTool",arguments,C.sd);this.Ca()||this.ea.view.wr(this.yc(a))};c.prototype.Kn=function(){this.ea.view.Kn()};c.prototype.Ln=function(){this.ea.view.Ln()};return c}();
function Ug(c,a){switch(c){case "lineWidth":case "fontSize":case "arrowSize":case "arrowXOffset":case "brightness":case "contrast":case "cloudRadius":case "gamma":case "opacity":case "snap":case "zIndex":"string"===typeof a&&(a=parseFloat(a));break;case "matrix":"[object Array]"===Object.prototype.toString.apply(a)&&"Matrix"===a[0]?(a.splice(0,1),a=new H(a)):a instanceof H||(a=new H(a))}return a}S.prototype.addKeyboardShortcut=S.prototype.mo;S.prototype.addRemoteChanges=S.prototype.Eg;
S.prototype.attach=S.prototype.Mc;S.prototype.abortTransaction=S.prototype.Fx;S.prototype.addGridColumn=S.prototype.ko;S.prototype.addGridRow=S.prototype.lo;S.prototype.addNodeToGrid=S.prototype.Lx;S.setGridColumn=S.ar;S.setGridRow=S.br;S.prototype.addSelectionHandle=S.prototype.Td;S.prototype.addToGroup=S.prototype.Ui;S.prototype.addToLanguage=S.prototype.no;S.prototype.addPage=S.prototype.Ox;S.prototype.addPanel=S.prototype.Ti;S.prototype.alignNodes=S.prototype.Ux;S.prototype.autoScroll=S.prototype.by;
S.prototype.begin=S.prototype.bb;S.prototype.beginTransaction=S.prototype.ol;S.prototype.bringToFront=S.prototype.ky;S.prototype.sendBroadcast=S.prototype.Zq;S.prototype.setSessionKey=S.prototype.yk;S.prototype.canRedo=S.prototype.cf;S.prototype.canUndo=S.prototype.df;S.prototype.clearSelection=S.prototype.ub;S.prototype.clearUndo=S.prototype.xy;S.prototype.clickColour=S.prototype.yy;S.prototype.commit=S.prototype.wa;S.prototype.commitIrreversibleTransaction=S.prototype.Fy;
S.prototype.commitTransaction=S.prototype.yl;S.prototype.copy=S.prototype.Ig;S.prototype.createDataNode=S.prototype.Ry;S.prototype.createGroup=S.prototype.Ty;S.prototype.createLogger=S.prototype.Vy;S.prototype.createNode=S.prototype.createNode;S.prototype.createHTMLNode=S.prototype.Uy;S.prototype.createHTMLNodeFromDrag=S.prototype.Lo;S.prototype.createPath=S.prototype.zl;S.prototype.createGridNode=S.prototype.Sy;S.prototype.createToolbar=S.prototype.Zy;S.prototype.createShape=S.prototype.No;
S.prototype.cut=S.prototype.Po;S.prototype.decoration=S.prototype.hf;S.prototype.destroy=S.prototype.Ta;S.prototype.deleteGridColumn=S.prototype.$y;S.prototype.deleteGridRow=S.prototype.bz;S.prototype.deleteNode=S.prototype.Fe;S.prototype.deleteNodes=S.prototype.Yb;S.prototype.deletePage=S.prototype.dz;S.prototype.deleteSelection=S.prototype.pt;S.prototype.dirty=S.prototype.Yf;S.prototype.dispatchEvent=S.prototype.dispatchEvent;S.prototype.mouseEvent=S.prototype.jq;S.prototype.keyboardEvent=S.prototype.tB;
S.prototype.download=S.prototype.download;S.prototype.draw=S.prototype.la;S.prototype.editNodeText=S.prototype.vz;S.prototype.duplicate=S.prototype.duplicate;S.prototype.emit=S.prototype.ta;S.prototype.emitNow=S.prototype.rc;S.prototype.emitOnce=S.prototype.cg;S.prototype.skipEvent=S.prototype.WD;S.prototype.focus=S.prototype.focus;S.prototype.blur=S.prototype.blur;S.prototype.forEachNode=S.prototype.Mz;S.prototype.findNode=S.prototype.Iz;S.prototype.findNodes=S.prototype.It;S.prototype.flip=S.prototype.Kz;
S.prototype.flipNodes=S.prototype.vj;S.prototype.generatePalette=S.prototype.Vt;S.prototype.getActiveLayer=S.prototype.hp;S.prototype.getAllNodes=S.prototype.ip;S.prototype.getBackgroundImage=S.prototype.Yz;S.prototype.getBoundingRectangle=S.prototype.lp;S.prototype.getConfig=S.prototype.Bc;S.prototype.getCurrentPage=S.prototype.Cd;S.prototype.getCurrentFillColour=S.prototype.eA;S.prototype.getCurrentOutlineColour=S.prototype.fA;S.prototype.getCurrentTool=S.prototype.Yh;
S.prototype.getCustomNode=S.prototype.gA;S.prototype.getDocumentCoordinates=S.prototype.xj;S.prototype.getDocumentProperty=S.prototype.kA;S.prototype.getDocumentProperties=S.prototype.jA;S.prototype.getDocumentSize=S.prototype.Zh;S.prototype.getElement=S.prototype.tc;S.prototype.getFillColour=S.prototype.Yl;S.prototype.getGridCell=S.prototype.tA;S.prototype.getGridSize=S.prototype.vp;S.prototype.getHistory=S.prototype.wA;S.prototype.getImageUrl=S.prototype.yp;S.prototype.getLanguageString=S.prototype.AA;
S.prototype.getLocalChanges=S.prototype.Cp;S.prototype.getDrawingRectangle=S.prototype.mA;S.prototype.getGroupParent=S.prototype.vA;S.prototype.getGroupMembers=S.prototype.uA;S.prototype.getItemProperty=S.prototype.yA;S.prototype.getLayers=S.prototype.DA;S.prototype.getLayerNodes=S.prototype.BA;S.prototype.getNodeCoordinates=S.prototype.GA;S.prototype.getNodeIndex=S.prototype.HA;S.prototype.getNodePageNumber=S.prototype.qf;S.prototype.getNodeProperty=S.prototype.$h;S.prototype.getNodeRectangle=S.prototype.Dj;
S.prototype.getNodeScale=S.prototype.IA;S.prototype.getNodeTransform=S.prototype.JA;S.prototype.getNodeType=S.prototype.KA;S.prototype.getNodeUnderPoint=S.prototype.LA;S.prototype.getNodesUnderPoint=S.prototype.OA;S.prototype.getPageCount=S.prototype.hb;S.prototype.getPageNode=S.prototype.Ej;S.prototype.getPageRect=S.prototype.rf;S.prototype.getPathData=S.prototype.cm;S.prototype.getPathAsPoints=S.prototype.SA;S.prototype.getCanvasScale=S.prototype.mp;S.prototype.getEditNode=S.prototype.tp;
S.prototype.getScreenCoordinates=S.prototype.fm;S.prototype.getSelectedEditHandle=S.prototype.VA;S.prototype.getStrokeColour=S.prototype.Hj;S.prototype.getEditHandleType=S.prototype.Xl;S.prototype.setEditHandle=S.prototype.vD;S.prototype.getSelectedNodes=S.prototype.hc;S.prototype.getPropertySummary=S.prototype.ai;S.prototype.getViewRectangle=S.prototype.ou;S.prototype.goToRevision=S.prototype.aB;S.prototype.hasFocus=S.prototype.hasFocus;S.prototype.openFile=S.prototype.iC;
S.prototype.insertImage=S.prototype.iB;S.prototype.insertPage=S.prototype.Pj;S.prototype.isLayerVisible=S.prototype.zm;S.prototype.isNodeSelected=S.prototype.dh;S.prototype.isPointOverCanvas=S.prototype.Pe;S.prototype.load=S.prototype.load;S.prototype.lockUpdates=S.prototype.Cm;S.prototype.markChangesSent=S.prototype.Wj;S.prototype.moveDown=S.prototype.IB;S.prototype.movePage=S.prototype.JB;S.prototype.moveUp=S.prototype.KB;S.prototype.newDocument=S.prototype.lq;S.prototype.nextPage=S.prototype.nextPage;
S.prototype.on=S.prototype.pa;S.prototype.onComplete=S.prototype.bC;S.prototype.openFromComputer=S.prototype.jC;S.prototype.paste=S.prototype.ik;S.prototype.pauseSharedSession=S.prototype.wC;S.prototype.previousPage=S.prototype.AC;S.prototype.print=S.prototype.print;S.prototype.redo=S.prototype.ye;S.prototype.redraw=S.prototype.Od;S.prototype.removeEventListener=S.prototype.removeEventListener;S.prototype.removeListener=S.prototype.removeListener;S.prototype.resize=S.prototype.resize;
S.prototype.save=S.prototype.save;S.prototype.setCursor=S.prototype.Kb;S.prototype.setToolProperty=S.prototype.kd;S.prototype.selectNodes=S.prototype.selectNodes;S.prototype.sendToBack=S.prototype.jD;S.prototype.setActiveLayer=S.prototype.en;S.prototype.setConfig=S.prototype.gn;S.prototype.setColour=S.prototype.Di;S.prototype.setCurrentPage=S.prototype.yh;S.prototype.setCustomBackgroundFn=S.prototype.tk;S.prototype.setCustomMouseHandler=S.prototype.rD;S.prototype.setDocumentProperty=S.prototype.tD;
S.prototype.setDocumentSize=S.prototype.Ei;S.prototype.setDocumentSizeInTransaction=S.prototype.nw;S.prototype.setDomElement=S.prototype.ow;S.prototype.setDomNode=S.prototype.uD;S.prototype.getDomElement=S.prototype.lA;S.prototype.getNodeFromElement=S.prototype.iu;S.prototype.getNodeObject=S.prototype.bm;S.prototype.setLayerName=S.prototype.DD;S.prototype.setPageBackground=S.prototype.HD;S.prototype.setPaperSize=S.prototype.er;S.prototype.setItemProperty=S.prototype.AD;
S.prototype.setNodeProperties=S.prototype.Bb;S.prototype.setNodeProperty=S.prototype.Qd;S.prototype.setNodeVisibility=S.prototype.FD;S.prototype.setOpacity=S.prototype.vw;S.prototype.setPageSize=S.prototype.ID;S.prototype.setPageView=S.prototype.dr;S.prototype.setProperties=S.prototype.Nb;S.prototype.setProperty=S.prototype.setProperty;S.prototype.setViewRectangle=S.prototype.ND;S.prototype.setZoom=S.prototype.ee;S.prototype.showLayer=S.prototype.Ak;S.prototype.snap=S.prototype.rb;
S.prototype.stopEditingText=S.prototype.sr;S.prototype.isFullscreenSupported=S.prototype.xm;S.prototype.toDebugString=S.prototype.iE;S.prototype.toggleFullscreen=S.prototype.Gk;S.prototype.translateNode=S.prototype.Ch;S.prototype.removePanel=S.prototype.mk;S.prototype.removeSelectionHandles=S.prototype.Jq;S.prototype.rotateDocument=S.prototype.XC;S.prototype.rotateNode=S.prototype.cw;S.prototype.rotatePage=S.prototype.dw;S.prototype.scaleNode=S.prototype.bn;S.prototype.setNodeTransform=S.prototype.cr;
S.prototype.showColourPicker=S.prototype.zw;S.prototype.createSharedSession=S.prototype.Yy;S.prototype.joinSharedSession=S.prototype.sB;S.prototype.stopSharing=S.prototype.tn;S.prototype.leaveSharedSession=S.prototype.Su;S.prototype.getSharedSessionName=S.prototype.XA;S.prototype.getNewLocalSessionKeys=S.prototype.hu;S.prototype.getLocalSessionKeys=S.prototype.FA;S.prototype.undo=S.prototype.Xc;S.prototype.ungroup=S.prototype.Ki;S.prototype.upload=S.prototype.upload;S.prototype.useArrowTool=S.prototype.xE;
S.prototype.useBrushTool=S.prototype.yE;S.prototype.useCircleTool=S.prototype.zE;S.prototype.useCurveTool=S.prototype.AE;S.prototype.useCustomTool=S.prototype.BE;S.prototype.useEditHandleTool=S.prototype.Ir;S.prototype.useEllipseTool=S.prototype.En;S.prototype.useFreehandTool=S.prototype.EE;S.prototype.useStampTool=S.prototype.NE;S.prototype.useLineTool=S.prototype.GE;S.prototype.usePanTool=S.prototype.HE;S.prototype.usePickTool=S.prototype.Qw;S.prototype.usePolygonTool=S.prototype.Jr;
S.prototype.useQuadraticBezierTool=S.prototype.IE;S.prototype.useRectangleTool=S.prototype.Lk;S.prototype.useRoundRectTool=S.prototype.JE;S.prototype.useShapeBrushTool=S.prototype.LE;S.prototype.useShapeTool=S.prototype.Kr;S.prototype.useSquareTool=S.prototype.ME;S.prototype.useTextTool=S.prototype.OE;S.prototype.zoomIn=S.prototype.Kn;S.prototype.zoomOut=S.prototype.Ln;var Vg=u.create("zeact");function Wg(c){"BUTTON"===c.tagName&&(c.getAttribute("type")||c.setAttribute("type","button"))}var O=af.zg();
O.kl=function(c){c.showPopup=function(a,b){C.ga("showPopup",arguments,C.String,C.cb(C.Zc("ShowPopupArgs",{x:C.Sa,y:C.Sa,refElement:C.cb(C.HTMLElement),showPosition:C.Qb,parent:C.cb(C.HTMLElement),onhide:C.Rf,overlay:C.Qb,clickToDismiss:C.cb(C.kb(C.String,C.Hh))})));return Xg(c,a,b)};c.hidePopup=function(a){C.ga("hidePopup",arguments,C.String);var b=Yg(c,a);b&&b.Ng&&b.Ng.hide()};c.$listen=function(a,b,d,e){if(c.$element){var f=c.$element;if("string"===typeof a){var h=a;var k=b;var l=d}else if(a instanceof
HTMLElement)f=a,h=b,k=d,l=e;else throw Error("$listen: Invalid args");f.addEventListener(h,k,l);O.za(c.$element,function(){f.removeEventListener(h,k,l)})}}};
O.Cb("click",function(c,a,b,d){function e(b){var e="touchend"===b.type?b.changedTouches[0]:b,f=(new Date).getTime();if(300>f-l)Vg("z-click=["+d+"] received "+b.type+", ignore due to duplicate event");else{if("click"!==b.type||b.isTrusted||0!==b.clientX||0!==b.clientY)if(l=f,v&&(300<(new Date).getTime()-k||10<lc(e.pageX,e.pageY,n,r))){Vg("z-click=["+d+"] received "+b.type+", ignore due to lack of corresponding down");return}Vg("z-click=["+d+"] received "+b.type+" timediff="+((new Date).getTime()-k)+
", needDown="+v+" isTrusted="+(b.isTrusted||0!==b.clientX||0!==b.clientY)+" pageX="+b.pageX+" pageY="+b.pageY);af.Ll(c,d,a,b,h);O.digest();b.preventDefault()}}function f(a){k=(new Date).getTime();a="touchstart"===a.type?a.changedTouches[0]:a;n=a.pageX;r=a.pageY}function h(a,b){a instanceof S&&0<=b.indexOf("Tool")&&(Xe("Called %s",b),x=!0);return a[b]}var k=0,l=0,n=0,r=0,v=!1;Wg(a);b="onpointerdown"in window;"ontouchstart"in window?(v=!0,O.Ua(a,"touchstart",f),O.Ua(a,"touchend",e)):b?(v=!0,O.Ua(a,
"pointerup",e),O.Ua(a,"pointerdown",f)):(v=!0,O.Ua(a,"mouseup",e),O.Ua(a,"mousedown",f));O.Ua(a,"click",e);var x;O.Ua(a,"keydown",function(b){b.target===a&&13===b.keyCode&&(v=x=!1,e(b),x&&c.ctx.focus(!0,a))})});O.Cb("has",function(c,a,b,d){var e=a.style.display;b=[];var f=0;for(d=d.split("|");f<d.length;f++){var h=d[f];h=h.trim();b.push('("'+h+'" in ctx.summary.types || "'+h+'" in ctx.summary.properties)')}(b=b.join("||"))&&O.wc(c,a,b,function(b){a.style.display=b?e:"none"})});
O.Cb("property",function(c,a,b,d){var e='ctx.summary.properties["'+d+'"]',f=a.getAttribute("z-value"),h=null!==a.getAttribute("z-colour");O.nn(c,function(){O.wc(c,a,e,function(b){"value"in a&&(a.value=b);null!==f&&z(a).zr("selected",""+b===f);h&&(a.style.backgroundColor=b)})});"BUTTON"===a.tagName?(Wg(a),O.Ua(a,"click",function(){var b=a.getAttribute("z-value")||"";c.ctx.setProperty(d,b)})):O.Ua(a,"change",function(){var b=af.nA(c,a);void 0!==b&&c.ctx.setProperty(d,b)})});
function Zg(c){c.hasOwnProperty("$popups")||(c.$popups={});return c.$popups}function Yg(c,a){for(;c;){if(c.$popups&&c.$popups[a])return c.$popups[a];c=c.$parent}}
O.Cb("popup",function(c,a,b,d){if(!a.hasAttribute("z-ignore-popup-hack")){var e=a.parentNode;if(!e)throw Error("z-popup: no parent node?!");var f=document.createComment("z-popup="+d);e.replaceChild(f,a);a.setAttribute("z-ignore-popup-hack","");var h=Zg(c);O.za(e,function(){a.removeAttribute("z-ignore-popup-hack");e&&e.replaceChild(a,f);if(h[d]){var b=h[d];b.Ng&&b.Ng.destroy();delete h[d]}});h[d]={da:a,Ng:null}}},0);
function Xg(c,a,b){void 0===b&&(b={});var d=Yg(c,a);if(!d)throw Error("Popup "+a+" not found");Vg("show-popup "+a);var e=d.da;if(d.Ng)Vg("Dialog %s already shown by another button",a);else{"string"!==typeof b.clickToDismiss&&(b.clickToDismiss=e.getAttribute("z-click-dismiss"));var f=e.getAttribute("z-popup");e=e.cloneNode(!0);var h="none"!==b.clickToDismiss,k=!1;""===b.clickToDismiss?k=!0:"string"===typeof b.clickToDismiss?k=b.clickToDismiss:b.clickToDismiss&&(k=!0);e=O.Mc(c,e).node;b.parent&&b.parent.appendChild(e);
f&&e.setAttribute("z-popup",f);var l=Dd(e,{overlay:b.overlay||"transparent"});d.Ng=l;l.onhide=function(){if(b.onhide)b.onhide();Vg("Popup "+a+" is hidden.");l&&(l.destroy(),d.Ng=null,O.detach(e),z(e).remove())};c=b.showPosition||e.getAttribute("z-show-position")||"";if("centre"===c||"center"===c)l.show(void 0,void 0,k,h);else if(c&&b.refElement)l.show(b.refElement,c,k,h);else if("number"===typeof b.x&&"number"===typeof b.y)l.show(b.x,b.y,k,h);else throw Error("Invalid arguments to showPopup; you must have one of x/y, or showPosition and refElement.");
}}O.Cb("show-popup",function(c,a,b,d){Wg(a);O.Ua(a,"click",function(b){Xg(c,d,{refElement:a,showPosition:a.getAttribute("z-show-position"),x:b.pageX,y:b.pageY,clickToDismiss:a.getAttribute("z-click-dismiss"),parent:c.ctx?c.ctx.tc():document.body})})});O.Cb("colour",function(c,a,b){O.Ua(a,"click",function(d){c.ctx.zw(a.getAttribute(b)||a.getAttribute("z-property")||"",d.pageX,d.pageY)})});
O.Cb("page",function(c,a,b,d){function e(){if(!(k>=f.hb())){var a=f.rf(k);a.x=0;a.y=0;v&&(a=v);var b=Math.min(l/a.width,n/a.height);1<b&&(b=1);h.width=a.width*b|0;h.height=a.height*b|0;r.save();r.scale(b,b);r.translate(-a.x,-a.y);r.fillStyle="white";r.fillRect(0,0,a.width,a.height);f.la(r,{page:k,gw:b});r.restore()}}if(!a.ZE){var f=c.ctx,h=document.createElement("canvas"),k=Ue(c,d)||0,l=parseInt(a.getAttribute("z-width")||"1000000"),n=parseInt(a.getAttribute("z-height")||"1000000");b=a.parentNode;
h.style.backgroundColor="white";var r=h.getContext("2d");d=a.getAttribute("z-rect");var v=null;d&&(v=Ue(c,d));for(var x=0;x<a.attributes.length;x++){var w=a.attributes[x];"z-page"!==w.name&&h.setAttribute(w.name,w.value)}a.parentNode&&a.parentNode.replaceChild(h,a);e();d&&O.wc(c,a,d,function(a){v=a;e()});var y=Kf(100,e);f.pa("document-changed",e);f.pa("resource-loaded",e);f.pa("resize",y);b&&O.za(b,function(){f.removeListener("document-changed",e);f.removeListener("resource-loaded",e);f.removeListener("resize",
y);y.cancel();h.parentNode&&h.parentNode.replaceChild(a,h)});for(x=0;x<a.attributes.length;x++)h.setAttribute(a.attributes[x].name,a.attributes[x].value);h.ZE=!0;return O.Mc(c,h).node}},1);O.Cb("sort",function(c,a,b,d){N.Ne(".zwibbler-sort-highlight { outline: 3px solid orange }");var e=db({parent:a,Us:"z-sortable",xq:"zwibbler-sort-highlight",eC:function(a,b){c.$from=a;c.$to=b;Ue(c,d);O.digest()}});O.za(a,function(){e()})});
O.Cb("fixture",function(c,a,b,d){setTimeout(function(){var b=N.getContext(a);b?b.gl(a,d):console.warn("z-fixture: no ctx in scope; scope is ",c)})});function $g(){Xe("Document loaded.");Array.prototype.forEach.call(document.querySelectorAll("zwibbler,[zwibbler]"),function(c){ah(c,null,!1)})}function bh(c,a,b){z(c).matches(a)&&b(c);Array.prototype.forEach.call(c.querySelectorAll(a),b)}
function ah(c,a,b){if(c.Uk)return c.Ce;"ZWIBBLER"===c.tagName&&N.Ne("zwibbler {display: block}");if(b||null===c.getAttribute("z-no-auto-init")){bh(c,"[z-component]",function(a){var b=a.getAttribute("z-component"),c=a.getAttribute("z-controller"),d=(a.getAttribute("z-properties")||"").split(/[ ,]+/);if(b){var e=null;if(c)if(c in N.controllers)e=N.controllers[c];else if("function"===typeof window.zcontroller)e=window.zcontroller;else throw Error("While processing component: "+b+" could not find controller function "+
c);N.dj(b,{template:a,properties:d,controller:function(a){a.$parent.ctx&&!a.ctx&&(a.ctx=a.$parent.ctx);e&&e(a)}});a.parentNode.removeChild(a)}});var d,e={};for(b=0;b<c.attributes.length;b++){var f=c.attributes[b];N.ru(f.name)&&(e[f.name]=f.value)}bh(c,"z-canvas,[z-canvas]",function(b){d=N.create(b,e,a)});a||(a=d||{});a.$digest=function(a){if(a)O.digest(a);else return new Promise(function(a){O.digest(a)})};a.$watch=function(b,d){O.wc(a,c,b,d)};a.$apply=function(b){if(b)return Ue(a,b);O.digest()};a.$element=
c;O.kl(a);d?(a.ctx=d,d.Mc(a,c)):O.Mc(a,c);b=c.getAttribute("z-controller")||"";b in N.controllers?(Xe("Running controller: %s",b),N.controllers[b](a)):"function"===typeof window[b]?(Xe("Running controller: %s",b),window[b](a)):b&&console.log("Controller not found: %s",b);O.digest();return a}}document.addEventListener("DOMContentLoaded",function(){$g()});
O.Cb("editable",function(c,a,b,d){function e(){var b=a.innerHTML;f=b;Ue(c,d+"="+JSON.stringify(b));Vg("Text editor no longer selected. Blurring");k&&k.exec("select-none");k&&k.setActive(!1)}a.hasAttribute("tabindex")||a.setAttribute("tabindex","0");var f="";O.wc(c,a,d,function(a){f!==a&&(f=""+a,k&&k.sw(f))});var h=new pb,k=null;setTimeout(function(){k=new xf(h,a,{ir:!0,placeholder:a.getAttribute("placeholder")||""});k.sw(f);k.pa("enter",e)});O.za(a,function(){h.Ta()});O.Ua(a,"focus",function(){Vg("Got text focus event");
k&&k.setActive(!0);k&&-1==f.indexOf("\n")&&k.exec("select-all")});O.Ua(a,"click",function(){Vg("Clicked on text");k&&k.setActive(!0)});O.Ua(a,"blur",function(){Vg("Got text blur event")});c.ctx&&c.ctx.pa("selected-nodes",function(){!c.ctx.dh(c.id)&&k&&k.Oe()&&e()})});
O.Ae("clear-glyph",function(c,a,b){Vg("Drawing colour panel, width=%s tag=%s",JSON.stringify(a),c.tagName);"CANVAS"===c.tagName&&(c.width=a.width,c.height=a.width,"clear"===a.style?zf(c.getContext("2d"),0,0,a.width):Af(c.getContext("2d"),0,0,a.width),b.ctx.resize())});
O.Cb("drag",function(c,a,b,d){var e=!1,f=new F(0,0),h=null;O.Ua(a,"mousedown",function(a){e=!0;f=new F(a.pageX,a.pageY);h=a});O.Ua(document.body,"mousemove",function(b){e&&(0===b.buttons?(e=!1,h=null):10<(new F(b.pageX,b.pageY)).ec(f)&&(af.Ll(c,d,a,h),e=!1,h=null))});O.Ua(a,"mouseup",function(){e=!1;h=null})});var ch=u.create("HTMLNode");
function dh(c){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.da=null;b.children=[];b.nb|=6;return b}__extends(b,a);b.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);Uc(b.node)&&b.node.da&&b.node.da.parentNode&&(b.node.da.parentNode?b.node.da.parentNode.removeChild(b.node.da):b.ef.parentNode&&b.ef.parentNode.removeChild(b.ef));return b.node};b.prototype.nq=function(a){for(a+=1;a<this.children.length;a++){var b=
this.children[a];if(Uc(b.node)&&b.node.da)return b.node.da.parentNode?b.node.da:b.ef}return null};b.prototype.Tp=function(a,b){this.children.splice(b,0,{node:a,ef:document.createComment("node "+a.id)});this.da&&Uc(a)&&a.da&&this.Ax(a.da,this.nq(b),a.ia("$component"))};b.prototype.Ax=function(a,b,c){if(b){c=b.parentNode;if(!c)for(var d=0,e=this.children;d<e.length;d++){var f=e[d];Uc(f.node)&&f.node.da===b&&(c=f.ef.parentNode,b=f.ef)}if(!c)throw Error("Could not find parent");c.insertBefore(a,b)}else this.da&&
(c=c||a.getAttribute("z-type")||"",eh(this.da,c).appendChild(a))};b.prototype.pb=function(a){if(0>a||a>=this.children.length)throw Error("getChild("+a+") but there are only "+this.children.length+" children");return this.children[a].node};b.prototype.zk=function(a,b){ch("showChild("+a+", "+b+")");if(a>=this.children.length||0>a)throw Error("showChild: Asked to show "+a+" but only "+this.children.length+" children");a=this.children[a];if(Uc(a.node)&&a.node.da){var c=a.node.da.parentNode||a.ef.parentNode;
c?b&&!a.node.da.parentNode?c.replaceChild(a.node.da,a.ef):!b&&a.node.da.parentNode&&c.replaceChild(a.ef,a.node.da):ch("Could not find HTML parent for "+a.node.type())}};b.prototype.Aj=function(){return new G(0,0,0,0)};b.prototype.xk=function(){};b.prototype.ln=function(){};return b}(c)}
var gh=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Vo=null;b.nk=null;b.ce=new G(0,0,0,0);b.Nt=!1;b.zq={};b.GB=new H;for(var f in b.ba)switch(f){case "layer":case "matrix":break;default:delete b.ba[f]}"ResizeObserver"in window&&(b.nk=new window.ResizeObserver(function(){b.Ld()}));return b}__extends(a,c);a.prototype.type=function(){return"HTMLNode"};a.prototype.Ta=function(){this.da&&!this.Nt&&(O.detach(this.da),z(this.da).remove(),this.nk&&this.nk.unobserve(this.da))};a.prototype.ln=
function(a){this.zq=a};a.prototype.wd=function(a){return{"style.left":parseFloat(this.ba["style.left"]||"0")+a.Fa+"px","style.top":parseFloat(this.ba["style.top"]||"0")+a.Ga+"px"}};a.prototype.setProperty=function(a,d){"matrix"===a||"object"!==typeof d||d instanceof Array?(d=c.prototype.setProperty.call(this,a,d),this.Za(a,d)):this.Nb(fh(d,{},a+"."))};a.prototype.ia=function(a){switch(a){case "lockRotation":return!0}return c.prototype.ia.call(this,a)};a.prototype.Za=function(a,c){"opacity"===a&&(a=
"style.opacity");this.da&&"style."===a.substr(0,6)&&(this.da.style[a.substr(6)]=c||"")};a.prototype.createElement=function(){var a=this.ba.$component;ch("Create component element of type %s",a);var c=Yc(this.zq,this);if(!(a in N.Ee))throw Error("Error: No component registered for "+a);c=N.fj(this.zq,a,{nid:this.id,"z-type":a},c);this.Vo=N.Ee[a].draw||null;this.scope=c.scope;return c.node};a.prototype.format=function(a,c){var b=this;this.Yv=c;ch("FORMAT type %s",this.ba.$component);if(null===this.da){this.da=
this.createElement();this.da.style.boxSizing="border-box";this.da.zF=function(){return!1};this.parent&&Uc(this.parent)&&this.cC();this.nk&&this.nk.observe(this.da);for(var d in this.ba)this.Za(d,this.ba[d]);this.da.addEventListener("load",function(){ch("Something loaded; request reformat.");c.ta("reformat",b.id)})}d=this.Pa();"style.left"in this.ba&&(this.da.style.left=parseFloat(this.ba["style.left"])+d.Fa+"px");"style.top"in this.ba&&(this.da.style.top=parseFloat(this.ba["style.top"])+d.Ga+"px");
for(d=0;d<this.children.length;d++){var h=this.pb(d);Tc(h)&&h.format(a,c)}};a.prototype.Ld=function(){if(this.da&&this.da.offsetWidth){var a=this.da.offsetWidth,c=this.da.offsetHeight;this.ce.width=a;this.ce.height=c;this.rect.width=a;this.rect.height=c;this.ya.width=a;this.ya.height=c;this.Yv&&(this.log("%s size has changed: %sx%s",this,a,c),this.Yv.RC(this.id))}};a.prototype.xk=function(a,c){this.rect=a;this.ya=a.clone();this.ce=a.clone();this.GB=c};a.prototype.mn=function(a,d){c.prototype.mn.call(this,
a,d);this.da&&(this.da.style.transform="translate("+a+"px, "+d+"px)",this.da.style.zIndex=a||d?"1":"")};a.prototype.Jp=function(){for(var a=[],c=0;c<this.children.length;c++){var e=this.pb(c);if(Tc(e)){var f=e.ia("sticky");f&&(e={jg:e.id},"row"===f?(e.In=this.rect.width,a.push(e)):"column"===f&&(e.Jn=this.rect.height,a.push(e)))}}return a};a.prototype.la=function(a){if(!this.hidden())if(this.log("%s: Drawing %sx%s",this,this.ce.width,this.ce.height),a.Oi){a.translate(this.offsetX,this.offsetY);var b=
a.globalCompositeOperation;a.globalCompositeOperation="destination-out";var c=this.ce;this.da&&this.da.classList.contains("zwibbler-selected")&&(c=c.clone(),c.Hd(8,8));a.fillRect(c.x,c.y,c.width,c.height);a.globalCompositeOperation=b;a.strokeStyle="rgba(255,0,0,0.2)";a.lineWidth=3;a.translate(-this.offsetX,-this.offsetY)}else if(this.Vo)this.Vo(this.scope,a);else if(this.da){b="VIDEO"===this.da.tagName?this.da:this.da.querySelector("video");c=!1;var f=this.ce;b&&3<=b.readyState&&!z.nB(b)&&(a.drawImage(b,
f.x,f.y,f.width,f.height),c=!0);c||(a.fillStyle="#cccccc",a.fillRect(f.x,f.y,f.width,f.height))}};a.prototype.nc=function(){return!0};a.prototype.cC=function(){if(this.parent&&Uc(this.parent)&&this.parent.da){var a=this.parent.re(this);if(-1===a)throw Error("Child node not found");var c=eh(this.parent.da,this.ba.$component);a=this.parent.nq(a);c&&this.da&&c.insertBefore(this.da,a)}};a.prototype.Aj=function(){if(!this.da)return this.rect;var a=z(this.da).am();return new G(this.rect.x-a.left,this.rect.y-
a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};a.prototype.$g=function(){return!1};a.prototype.Sg=function(a,d){switch(a){case "style.width":case "style.left":case "style.top":case "style.height":if("number"===typeof d)return d+"px"}return c.prototype.Sg.call(this,a,d)};a.prototype.uf=function(){return!1};return a}(dh(hd));Zc.vd("HTMLNode",gh);
function eh(c,a){if(c.classList.contains("zwibbler-page"))return c;for(var b=c.querySelectorAll("[container-for]"),d=null,e=0;e<b.length;e++)if(ig(b[e],a)){d=b[e];break}if(d){a=d.parentElement;for(b=!0;a;){if(a.getAttribute("nid")){b=a==c;break}a=a.parentElement}if(b)return d}return c}function ig(c,a){return(c=c.getAttribute("container-for"))&&0<=c.indexOf(a)}
function fh(c,a,b){void 0===a&&(a={});void 0===b&&(b="");for(var d in c){var e=c[d];e instanceof Object&&!(e instanceof Array)?fh(e,a,d+"."):a[b+d]=e}return a};var hh=function(c){function a(a,d){d=c.call(this,a,d)||this;d.nb|=2;d.da=document.createElement("div");d.da.classList.add("zwibbler-page");d.da.setAttribute("nid",a);return d}__extends(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.format=function(a,c){for(var b=0;b<this.children.length;b++){var d=this.pb(b);Tc(d)&&d.format(a,c)}};return a}(dh(hd));hd.vd("GroupNode",hh);var ih=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Fu=function(a){var b;Tf(a instanceof c);var d=new c;for(b in this.keys)a.contains(b)&&d.add(b)};c.prototype.mj=function(a){var b;Tf(a instanceof c);var d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.vc=
function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(a);return b};c.prototype.kE=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.Qc=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var jh=function(c){function a(a,d){d=c.call(this,a,d)||this;d.log=u.create("PAGE",!0);d.da=document.createElement("div");d.da.classList.add("zwibbler-page");d.da.setAttribute("nid",a);return d}__extends(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.setProperty=function(a,d){if(void 0===d)delete this.ba[a];else switch(a){case "width":case "height":case "background":this.ba[a]=d;break;default:c.prototype.setProperty.call(this,a,d)}};a.prototype.fd=function(){return"width"in this.ba&&
"height"in this.ba?new kc(this.ba.width,this.ba.height):null};return a}(dh(Zc));hd.vd("PageNode",jh);var kh=u.create("crdt"),lh=function(){function c(a,b,c){this.Id=a;this.bc=b;this.Jk=c}c.prototype.before=function(a){return this.Id<a.Id||this.Id===a.Id&&(this.bc<a.bc||this.bc===a.bc&&this.Jk<a.Jk)};c.prototype.encode=function(){return this.Id.toString(36)+":"+this.bc+":"+this.Jk.toString(36)};c.prototype.toString=function(){return this.encode()};c.Wb=function(a){for(var b=a.split(":"),d,e;3===b.length;){d=parseInt(b[0],36);e=parseInt(b[2],36);if(isNaN(d)||isNaN(e))break;return new c(d,b[1],e)}throw Error("Could not decode Timestamp: "+
a);};return c}(),mh=function(){function c(a,b){void 0===b&&(b=[]);this.Pb=a;this.ops=b}c.prototype.qe=function(){return this.Pb.bc+"-"+this.Pb.Jk.toString(36)};c.prototype.before=function(a){return this.Pb.before(a.Pb)};c.Yc=function(a,b){return a.before(b)?-1:b.before(a)?1:0};c.prototype.clone=function(a){void 0===a&&(a=this.Pb);for(var b=[],d=0,e=this.ops;d<e.length;d++)e[d].clone(b);return new c(a,b)};c.prototype.inverse=function(a){void 0===a&&(a=this.Pb);for(var b=[],d=this.ops.length-1;0<=d;d--)this.ops[d].inverse(b);
return new c(a,b)};c.prototype.toString=function(){for(var a="  "+this.Pb+" --\x3e\n",b=0,c=this.ops;b<c.length;b++)a+="    "+c[b]+"\n";return a};return c}(),nh=function(){function c(a,b){this.xe=a;this.Ma=b}c.prototype.encode=function(){return this.xe+":"+this.Ma.encode()};c.prototype.toString=function(){return this.encode()};c.Wb=function(a){var b=a.split(":");if(2!==b.length)throw Error("Could not decode treepath: "+a);return new c(b[0],Ig.Wb(b[1]))};return c}(),qh=function(){function c(a,b,c){this.Ka=
a;this.cd=b;this.ba=c;this.type="c"}c.prototype.encode=function(){var a=JSON.stringify(this.ba);return"C"+this.Ka+";"+this.cd.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(a){a.push(new oh(this.Ka))};c.prototype.toString=function(){return"CREATE "+this.Ka+" "+(this.ba.$type||this.ba.type||this.ba.name||"")+" at "+this.cd+" len="+JSON.stringify(this.ba).length};c.prototype.inverse=function(a){a.push(new ph(this.Ka))};c.Wb=function(a,b){var d=/C([^;]+);([^;]+);(\d+);/g;d.lastIndex=b;var e=
d.exec(a);return e&&e.index===b?(b=parseInt(e[3],10),a=JSON.parse(a.substr(d.lastIndex,b)),{Wf:new c(e[1],nh.Wb(e[2]),a),position:d.lastIndex+b+1}):null};c.prototype.pk=function(a){this.cd=a.pk(this.cd,this.Ka)};c.prototype.sc=function(a){a.createNode(this.Ka,this.cd,this.ba)};return c}();
(function(){function c(a){this.hC=a;this.type="n"}c.prototype.clone=function(a){a.push(this)};c.prototype.inverse=function(a){a.push(this)};c.prototype.encode=function(){return""};c.prototype.sc=function(){};c.prototype.toString=function(){return"NULLIFIED "+this.hC};return c})();
var ph=function(){function c(a){this.Ka=a;this.type="d";this.ck=!1}c.prototype.clone=function(a){a.push(new c(this.Ka))};c.prototype.inverse=function(a){a.push(new oh(this.Ka))};c.prototype.encode=function(){return"D"+this.Ka+";"};c.prototype.toString=function(){return"DELETE "+this.Ka};c.Wb=function(a,b){var d=/D([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{Wf:new c(a[1]),position:d.lastIndex}:null};c.prototype.sc=function(a){a.Fe(this.Ka)};return c}(),oh=function(){function c(a){this.Ka=
a;this.type="u"}c.prototype.clone=function(a){a.push(new c(this.Ka))};c.prototype.inverse=function(a){a.push(new ph(this.Ka))};c.prototype.encode=function(){return"U"+this.Ka+";"};c.prototype.toString=function(){return"UNDELETE "+this.Ka};c.Wb=function(a,b){var d=/U([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{Wf:new c(a[1]),position:d.lastIndex}:null};c.prototype.sc=function(a){a.Ow(this.Ka)};return c}(),rh=/^\\*undefined$/;
function sh(c,a){return"undefined"===typeof a?"undefined":"string"===typeof a&&a.match(rh)?"/"+a:a}
var th=function(){function c(a,b,c){void 0===c&&(c=null);this.Ka=a;this.ba=b;this.Ve=c;this.type="s";this.ck=!1;a:{for(var d in b){a=!1;break a}a=!0}if(a)throw Error("Empty properties in constructor");}c.prototype.clone=function(a){a.push(new c(this.Ka,this.ba))};c.prototype.inverse=function(a){if(null===this.Ve){if(this.ck)return;throw Error("SetPropertiesOp was not executed before inversion: "+this);}a.push(new c(this.Ka,this.Ve))};c.prototype.encode=function(){var a=JSON.stringify(this.ba,sh);
return"S"+this.Ka+";"+a.length+";"+a+";"};c.prototype.toString=function(){return"SET "+this.Ka+" "+JSON.stringify(this.ba,sh)};c.Wb=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){b=parseInt(e[2],10);a=JSON.parse(a.substr(d.lastIndex,b));for(var f in a){var h=f;var k=a[f];k="undefined"===k?void 0:"string"===typeof k&&k.match(rh)?k.substr(1):k;a[h]=k}return{Wf:new c(e[1],a,null),position:d.lastIndex+b+1}}return null};c.prototype.sc=function(a){var b=a.mb(this.Ka);
this.Ve={};for(var c in this.ba)this.Ve[c]=b[c];a.Nb(this.Ka,this.ba)};return c}(),uh=function(){function c(a,b,c){void 0===c&&(c=null);this.Ka=a;this.cd=b;this.src=c;this.type="m";this.ck=!1}c.prototype.clone=function(a){a.push(new c(this.Ka,this.cd,this.src))};c.prototype.inverse=function(a){if(!this.src){if(this.ck)return;throw Error("moveOp: Must be executed before inversion");}a.push(new c(this.Ka,this.src,this.cd))};c.prototype.encode=function(){return"M"+this.Ka+";"+this.cd.encode()+";"};c.prototype.toString=
function(){return"MOVE "+this.Ka+" -> "+this.cd};c.Wb=function(a,b){var d=/M([^;]+);([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{Wf:new c(a[1],nh.Wb(a[2])),position:d.lastIndex}:null};c.prototype.pk=function(a){this.cd=a.pk(this.cd,this.Ka)};c.prototype.sc=function(a){var b=a.Da[this.Ka];b&&b.parent&&a.has(this.cd.xe)?(this.src=new nh(b.parent.Ka,b.Ma),a.hd(this.Ka,this.cd)):this.ck=!0};return c}();
function vh(c,a){for(var b=-1,d,e;1<c-b;){d=c+b>>1;e=a(d);if(0==e)return d;0>e?b=d:c=d}return c}function wh(c){for(var a=[],b=1;b<arguments.length;b++)a[b-1]=arguments[b];for(b=0;b<a.length;b++){var d=a[b],e;for(e in d)c[e]=d[e]}}
var xh=function(){function c(a,b){this.Va=b;this.Da={};this.zf=new Jg(a);this.il("0")}c.prototype.il=function(a){this.Da[a]={Ka:a,parent:null,Ma:new Ig([],[]),children:[],index:0,Yd:!1,oe:null,Mr:0}};c.prototype.has=function(a){return a in this.Da};c.prototype.ed=function(a){a=this.Da[a];if(!a)return!1;for(;;){if(a.Yd)return!1;if(!a.parent)break;a=a.parent}return!0};c.prototype.pk=function(a,b){if(!this.has(a.xe))return a;kh("Attempt to retarget %s",a);var c=this.yj(a);b=this.Bp(a.xe,b,c);var e=this.yj(a);
if(c!==e)throw Error("retarget failed: index="+c+" newIndex="+c+" "+a+"   "+b);kh("Retarget %s -> %s",a,b);return b};c.prototype.Bp=function(a,b,c){var d=this.Da[a];if(!d)throw Error("getInsertPath: "+a+" does not exist.");var f=0,h;for(h=0;h<d.children.length;h++){var k=d.children[h];if(!k.Yd){k.Ka===b&&c++;if(f===c)break;f++}}if(0>h||h>d.children.length)throw Error("getInsertPath: index="+h+" wanted="+c+" but "+a+" has "+d.children.length+" children.");kh("Move "+a+" index="+h+" children.length="+
d.children.length);0===d.children.length?(b=this.zf.first,c=this.zf.hi):0===h?(b=this.zf.first,c=d.children[h].Ma):h===d.children.length?(b=d.children[d.children.length-1].Ma,c=this.zf.hi):(b=d.children[h-1].Ma,c=h<d.children.length?d.children[h].Ma:this.zf.hi);try{var l=new nh(a,this.zf.ro(b,c))}catch(n){kh("Path between %s and %s, index=%s children=%s",b,c,h,d.children.length);kh("debug info: index is %s",h);for(a=0;a<d.children.length;a++)kh("Child %s nid=%s lpath %s",a,d.children[a].Ka,d.children[a].Ma);
throw n;}kh("Path between "+b+" and "+c+" is "+l.Ma);a=this.yj(l);if(a!==h){kh("debug info: wanted index is %s, got %s",h,a);for(a=0;a<d.children.length;a++)kh("Child %s nid=%s lpath %s",a,d.children[a].Ka,d.children[a].Ma);throw Error("getInsertPath() failed; ("+l+") index="+h);}return l};c.prototype.yj=function(a){var b=this.Da[a.xe];if(!b)throw Error("getInsertIndex: parent "+a.xe+" does not exist");var c=vh(b.children.length,function(c){return Ig.Yc(b.children[c].Ma,a.Ma)});if(0>c||c>b.children.length)throw Error("Asked to insert at "+
a.xe+":"+c+" but parent has "+b.children.length+" children.");return c};c.prototype.createNode=function(a,b,c){if(a in this.Da)this.Ow(a);else{var d=this.Da[b.xe],f=this.yj(b),h={Ka:a,parent:d,children:[],Ma:b.Ma,index:f,Yd:!1,oe:null,Mr:0};this.Da[a]=h;d.children.splice(f,0,h);d.Mr=f-1;this.$s(d.children,f);this.ed(a)?this.Va&&this.Va.createNode(a,b.xe,this.Ap(h),c):h.oe=c}};c.prototype.$s=function(a,b){if(0<b&&0<=Ig.Yc(a[b-1].Ma,a[b].Ma)){kh("debug info: index is %s",b);for(var c=0;c<a.length;c++)kh("Child %s nid=%s lpath %s",
c,a[c].Ka,a[c].Ma);throw Error("Error: LPaths out of order. "+a[b-1].Ma+" >=  "+a[b].Ma);}if(b<a.length-1&&0<=Ig.Yc(a[b].Ma,a[b+1].Ma)){kh("debug info: index is %s",b);for(c=0;c<a.length;c++)kh("Child %s nid=%s lpath %s",c,a[c].Ka,a[c].Ma);throw Error("Error: LPaths out of order. "+a[b].Ma+" >=  "+a[b+1].Ma);}};c.prototype.Fe=function(a){(a=this.Da[a])&&a.parent&&!a.Yd&&(a.Yd=!0,this.remove(a))};c.prototype.remove=function(a){for(var b=a.children.length-1;0<=b;b--){var c=a.children[b];c.Yd||this.remove(c)}this.Va?
(a.oe=this.Va.mb(a.Ka),this.Va.Fe(a.Ka)):a.oe={}};c.prototype.Ap=function(a){if(!a.parent)throw Error("Expected parent");for(var b=a.parent,c=0,e=0;e<b.children.length;e++){if(b.children[e]===a)return c;b.children[e].Yd||c++}throw Error("node "+a.Ka+" not in parent's child list");};c.prototype.Ow=function(a){(a=this.Da[a])&&a.Yd&&a.parent&&(a.Yd=!1,this.Uv(a))};c.prototype.Uv=function(a){if(this.Va&&this.ed(a.Ka)&&a.parent){if(!a.oe)throw Error("Properties of "+a.Ka+" should have been saved");this.Va.createNode(a.Ka,
a.parent.Ka,this.Ap(a),a.oe)}a.oe={};var b=0;for(a=a.children;b<a.length;b++){var c=a[b];c.Yd||this.Uv(c)}};c.prototype.Aa=function(a){a in this.Da||(this.Da[a]={Ka:a,Yd:!0,children:[],index:0,oe:{},Ma:this.zf.first,Mr:0,parent:null});return this.Da[a]};c.prototype.hd=function(a,b){var c=this.Da[a];if(c&&c.parent){var e=this.Da[b.xe];if(e){for(var f=0;f<c.parent.children.length;f++)if(c.parent.children[f]===c){c.parent.children.splice(f,1);break}f=this.yj(b);c.parent=e;c.Ma=b.Ma;e.children.splice(f,
0,c);this.$s(e.children,f);this.Va&&this.ed(a)&&this.Va.hd(a,b.xe,this.Ap(c))}}};c.prototype.Nb=function(a,b){var c=this.Aa(a);this.Va&&this.ed(a)?this.Va.Nb(a,b):c.oe&&wh(c.oe,b)};c.prototype.mb=function(a){var b=this.Da[a];return b&&b.Yd?b.oe:this.Va?this.Va.mb(a):{}};c.prototype.wa=function(a,b){this.Va&&this.Va.wa(a,b)};return c}(),Ah=function(){function c(a,b){this.bc=b;this.Id=0;this.all=[];this.Kj={};this.nd=[];this.next=0;this.Wd=!1;this.hq="";this.Ji=[];this.local=[];this.Kk="";this.cq=0;
this.Hq=!1;this.Va=new xh(this.bc,a)}c.prototype.gv=function(){var a=(new Date).getTime();a<=this.cq&&(a=this.cq+1);return this.cq=a};c.prototype.sc=function(a){var b=0;for(a=a.ops;b<a.length;b++){var c=a[b];kh("Executing %s",c);c.sc(this.Va)}};c.prototype.locked=function(){return""!==this.hq};c.prototype.createNode=function(a,b,c,e){this.Wd||this.hl(new qh(a,this.Va.Bp(b,a,c),e));return a};c.prototype.Fe=function(a){this.Wd||this.hl(new ph(a))};c.prototype.hd=function(a,b,c){this.Wd||this.hl(new uh(a,
this.Va.Bp(b,a,c)))};c.prototype.Nb=function(a,b){var c=!1,e;for(e in b){c=!0;break}c&&!this.Wd&&this.hl(new th(a,b))};c.prototype.mb=function(a){return this.Va.mb(a)};c.prototype.hl=function(a){this.Ji.push(a);this.locked()||(kh("Executing %s",a),a.sc(this.Va))};c.prototype.wa=function(a,b){if(!this.Hq){if(!this.Wd&&this.Ji.length){a=new lh(this.Id,this.bc,this.gv());a=new mh(a);for(var c=0,e=this.Ji;c<e.length;c++)a.ops.push(e[c]);b||(this.nd.length=this.next++,this.nd.push(a));this.local.push(a);
this.all.push(a);this.Kj[a.qe()]=!0;this.Id++;this.Ji.length=0;this.Kk&&(this.Eg(this.Kk),this.Kk="")}else this.Wd&&(this.Hq=!0,this.Va.wa(a,b),this.Hq=!1);this.Ji.length=0}};c.prototype.encode=function(a){for(var b="",c=0;c<a.length;c++){var e=a[c];b+="B"+e.Pb.encode()+";";var f=0;for(e=e.ops;f<e.length;f++)b+=e[f].encode()}return b};c.prototype.Eg=function(a){if(this.locked()||this.Ji.length)this.Kk+=a,kh("Ignore remote changes while "+(this.locked()?"locked":"uncommitted"));else{var b=0;a=yh(a);
for(var c=0;c<a.length;c++)b=Math.max(b,a[c].Pb.Id),this.Kj[a[c].qe()]&&(a.splice(c,1),c--);if(0!==a.length){this.Id=Math.max(this.Id,b)+1;b=a[0];for(c=1;c<a.length;c++)a[c].before(b)&&(b=a[c]);for(var e=this.all.length-1;0<=e&&!this.all[e].before(b);e--);e++;this.Wd=!0;for(c=0;c<a.length;c++){var f=a[c];this.all.push(f);this.Kj[f.qe()]=!0}this.all.sort(mh.Yc);if(this.all[e]!==b){for(c=0;c<this.all.length;c++)c===e&&kh("MergePoint"),kh(this.all[c].toString());kh("New lists:");for(b=0;b<a.length;b++)kh(a[b].toString());
throw Error("Assumption violated");}kh("%s Executing new changes from %s",this.bc,e);for(c=e;c<this.all.length;c++)this.sc(this.all[c]);this.wa(!0,!1);this.Wd=!1;kh("%s addRemoteChanges done",this.bc)}}};c.prototype.TC=function(){this.local=this.all.concat()};c.prototype.$z=function(){return this.local.length?new zh(this.encode(this.local),this.local[this.local.length-1].qe()):new zh("","0")};c.prototype.Wj=function(a){for(var b=this.local.length-1;0<=b;b--)if(a===this.local[b].qe()){this.local.splice(0,
b+1);break}};c.prototype.df=function(){return 0<this.next&&!this.locked()};c.prototype.cf=function(){return this.next<this.nd.length&&!this.locked()};c.prototype.Xc=function(){this.df()&&this.Rv(this.nd[--this.next],!0)};c.prototype.ye=function(){this.cf()&&this.Rv(this.nd[this.next++],!1)};c.prototype.Eo=function(){this.next=this.nd.length=0};c.prototype.Rv=function(a,b){this.Wd=!0;var c=new lh(this.Id,this.bc,this.gv());a=b?a.inverse(c):a.clone(c);b=0;for(c=a.ops;b<c.length;b++){var e=c[b];"m"!==
e.type&&"c"!==e.type||e.pk(this.Va)}this.local.push(a);this.all.push(a);this.Kj[a.qe()]=!0;this.Id++;this.sc(a);this.wa(!1,!0);this.Wd=!1};c.prototype.Hp=function(){for(var a=[],b=0,c=this.all;b<c.length;b++){var e=c[b];a.push({ty:e.qe(),Pb:e.Pb.Jk})}return a};c.prototype.Lp=function(a){if(0!==this.all.length&&(!a||this.Kj[a])){var b=this.all[this.all.length-1].qe();a&&(b=a);for(var c=this.all.length-1,e=c,f=0;f<this.all.length;f++){var h=this.all[f];h.qe()===b&&(e=f);h.qe()===this.hq&&(c=f)}this.Wd=
!0;for(b=!1;c!==e;)c>e?this.sc(this.all[c--].inverse()):this.sc(this.all[++c]),b=!0;b&&this.wa(!1,!1);this.Wd=!1;this.hq=a?this.all[c].qe():""}};c.prototype.il=function(a){this.Va.il(a)};return c}(),zh=function(){function c(a,b){this.Co=a;this.vB=b}c.prototype.getData=function(){return this.Co};c.prototype.empty=function(){return 0===this.Co.length};c.prototype.toString=function(){return this.Co};return c}();
function yh(c){for(var a=[],b=0,d=/B([^;]+);/g;b<c.length;){var e;switch(c[b]){case "B":d.lastIndex=b;if((e=d.exec(c))&&e.index===b)b=lh.Wb(e[1]),b=new mh(b),a.push(b),b=d.lastIndex;else throw Error("Could not decode Batch from "+c.substr(b,256));continue;case "C":e=qh.Wb(c,b);break;case "D":e=ph.Wb(c,b);break;case "U":e=oh.Wb(c,b);break;case "S":e=th.Wb(c,b);break;case "M":e=uh.Wb(c,b);break;case "\r":case "\t":case "\n":case " ":b+=1;continue;default:throw Error("Could not decode Operation from "+
c.substr(b,256));}if(0===a.length)throw Error("Got change outside of batch");if(null===e)throw Error("change is null while decoding: "+c.substr(b,500));b=e.position;a[a.length-1].ops.push(e.Wf)}return a};var Bh=u.create("DOCTREE"),Ch=function(){function c(a,b){this.Af=a;this.Da={};this.Da["0"]=b}c.prototype.Qx=function(a,b){if(a in this.Da)throw Error("Node "+a+" already exists");this.Da[a]=b};c.prototype.createNode=function(a,b,c,e){Bh("createNode("+a+", "+b+", "+c+")");if(a in this.Da)throw Error("createNode "+a+" already exists");b=this.Aa(b);if(b.children.length+1<c)throw Error("Asked to insert at index "+c+" but parent only has "+b.children.length+" children");e=this.Af.Wu(a,e);b.Tp(e,c);e.parent=
b;this.Da[a]=e;this.Af.qv&&this.Af.qv(e)};c.prototype.Aa=function(a){if(a in this.Da)return this.Da[a];throw Error("nid "+a+" does not exist");};c.prototype.ed=function(a){return a in this.Da};c.prototype.Fe=function(a){Bh("deleteNode("+a+")");var b=this.Aa(a),c=b.parent;if(!c)throw Error("Parent of "+a+" is null?!");var e=c.re(b);if(0>e)throw Error("Asked to delete "+a+" but it is not in parent's children");if(0!==b.children.length)throw Error("Asked to delete "+a+" but it still has children.");
for(a=b.children.length-1;0<=a;a--){var f=b.pb(a);this.Fe(f.id)}this.Af.rv&&this.Af.rv(b);c.removeChild(e);delete this.Da[b.id]};c.prototype.hd=function(a,b,c){Bh("moveNode("+a+", dest="+b+":"+c+")");var d=this.Aa(a),f=this.Aa(b),h=d.parent;if(null===h)throw Error("node "+a+" does not have any parent");a=h.re(d);if(f.children.length<(d.parent===f?c+1:c))throw Error("asked to shift node at "+b+":"+c+" but it only has "+f.children.length+" children");h.removeChild(a);f.Tp(d,c);d.parent=f};c.prototype.Nb=
function(a,b){if(a in this.Da){a=this.Aa(a);for(var c in b)a.setProperty(c,b[c]);this.Af.xv&&this.Af.xv(a,b)}};c.prototype.mb=function(a){return a in this.Da?this.Aa(a).mb():{}};c.prototype.wa=function(a){this.Af.Mm&&this.Af.Mm(a)};c.prototype.Qc=function(a){for(var b in this.Da)a(this.Da[b])};return c}();var Dh=u.create("BRUSH"),Eh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.oa=[];a.Sb=[];Dh("New BrushNode created.");a.ba.points=[];a.ba.strokeStyle="#ff00ff";a.ba.lineWidth=10;return a}__extends(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.mb=function(){var a=c.prototype.mb.call(this);a.dashes=a.dashes||"";return a};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");"dashes"===a||"lineCap"===a?this.ba[a]=d:c.prototype.setProperty.call(this,a,d)};
a.prototype.ia=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.ia.call(this,a)};a.prototype.format=function(){var a,c;this.oa.length=0;var e=this.ba.points;var f=a=0;for(c=e.length-1;a<=c;f=a+=2)this.oa.push(new F(e[f],e[f+1]));f=G.Ag(this.oa);e=this.Pa().vb();a=this.ba.lineWidth;f.Hd(a/e.x,a/e.y);this.ya=f.clone();f=new Bc(f);f.transform(this.ba.matrix);this.rect=G.Ag(f.oa);this.Sb=Cc(this.ba.dashes||"")};a.prototype.Db=function(a,c,e,f){return this.rect.Oc(a,c,e)&&(a=this.Zb().apply(a,
c),c=this.Zb().vb(),wc(this.oa,a.x,a.y,.5*(c.x+c.y)*Math.max(12/f,e,this.ba.lineWidth/2)))?this:null};a.prototype.Tf=function(a){var b,c;var f=this.ba.points;if(0!==f.length){a.save();a.beginPath();var h=this.ia("lineCap")||"round";a.lineCap=h;a.lineJoin="round"===h?"round":"bevel";if(1<this.Sb.length)Dc(a,this.oa,this.Sb);else for(a.moveTo(f[0],f[1]),h=b=2,c=f.length-1;b<=c;h=b+=2)a.lineTo(f[h],f[h+1]);this.Zb().mc(a);gc(a,this.ba.strokeStyle);a.restore()}};a.gF=!1;return a}(hd);
hd.vd("BrushNode",Eh);function Fh(c){return{m11:c.m11,m12:c.m21,m21:c.m12,m22:c.m22,dx:c.Fa,dy:c.Ga}}function Gh(c){return c?c instanceof H?c:new H(c.m11||1,c.m21||0,c.m12||0,c.m22||1,c.dx||0,c.dy||0):new H}
var T=function(){function c(a){this.node=a;this.request=null}c.prototype.yD=function(a){this.request=a};c.prototype.em=function(){if(!this.request)throw Error("Cannot call this method before format() is called.");return this.request};c.prototype.Pz=function(a,b,c){C.ga("formatFill",arguments,Hh,C.String,C.String);this.node.Rt(b,a,this.em(),c)};c.prototype.oA=function(a){C.ga("getFill",arguments,C.String);return this.node.up(a)};c.prototype.pg=function(){this.em().qg(this.node.id)};c.prototype.yf=
function(a,b){C.ga("loadImage",arguments,C.String,C.Function);this.em().yf(this.node.id,a,b)};c.prototype.Fz=function(a){C.ga("fillEraser",arguments,Hh);a.save();this.node.Zb().mc(a);this.node.Bt(a,!0);a.restore()};c.prototype.eE=function(a){C.ga("strokeEraser",arguments,Hh);a.save();this.node.Zb().mc(a);this.node.Bt(a,!1);a.restore()};c.prototype.Pl=function(a,b){return N.Pl(a,b)};c.prototype.vb=function(){return 1};c.prototype.rC=function(a){C.ga("parseFont",arguments,C.String);return new Vd(a)};
c.prototype.Bc=function(a){C.ga("getConfig",arguments,C.String);return this.em().Bc(a)};c.prototype.qE=function(a,b){C.ga("transformPoint",arguments,C.Number,C.Number);var c=this.node.Pa().apply(a,b);return{x:c.x,y:c.y}};c.prototype.rE=function(a,b,c,e){C.ga("transformRectangle",arguments,C.Number,C.Number,C.Number,C.Number);var d=new G(a,b,c,e);d.transform(this.node.Pa());return{x:d.x,y:d.y,width:d.width,height:d.height}};c.prototype.vE=function(a,b){C.ga("untransformPoint",arguments,C.Number,C.Number);
var c=this.node.Zb().apply(a,b);return{x:c.x,y:c.y}};c.prototype.mc=function(a){this.node.Pa().mc(a)};c.prototype.uE=function(a){C.ga("untransformCanvas",arguments,Hh);this.node.Zb().mc(a)};c.prototype.bm=function(){return this.node.bi({})};c.prototype.ia=function(a){C.ga("getProperty",arguments,C.String);return this.node.ia(a,!0)};c.prototype.$h=function(a,b){C.ga("getNodeProperty",arguments,C.String,C.String);var c=this.node.aa.Aa(a);if(c)return c.ia(b)};c.prototype.Ju=function(a){C.ga("isNode",
arguments,C.String);return null!==this.node.aa.Aa(a)};c.prototype.Dj=function(a){C.ga("getNodeRectangle",arguments,C.String);var b=this.node.aa.Aa(a);return b&&Tc(b)?(b=b.rect,new Qd(b.x,b.y,b.width,b.height)):new Qd(0,0,0,0)};return c}(),Ih=function(c){function a(a,d){a=c.call(this,a,d)||this;a.Xa=null;a.children=[];a.log=u.create("CUSTOM");a.fc=new T(a);a.setProperty("matrix",new H);return a}__extends(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.$m=function(){return this.ba.nodeType||
this.type()};a.prototype.nc=function(){return!0};a.prototype.Ul=function(){return this.Xa&&this.Xa.getDependencies?this.Xa.getDependencies():[]};a.prototype.setProperty=function(a,d){if(null===this.Xa&&"nodeType"===a){a=N.Al[d];this.Xa=new a(this.id,this.fc);for(var b in this.ba)this.setProperty(b,this.ba[b]);this.ba.nodeType=d}else d=c.prototype.setProperty.call(this,a,d),"matrix"===a&&(d=Fh(d)),this.Xa&&this.Xa.setProperty&&this.Xa.setProperty(a,d)};a.prototype.uf=function(){return this.Xa&&this.Xa.hasEditMode?
this.Xa.hasEditMode():!1};a.prototype.sp=function(){var a=[];this.Xa&&this.Xa.getEditHandles&&(a=this.Xa.getEditHandles());for(var c=this.Pa(),e=[],f=0;f<a.length;f++){var h=a[f];e.push(c.apply(h.x||0,h.y||0))}return e};a.prototype.Db=function(a,c,e,f){a=this.Zb().apply(a,c);c=this.Zb().vb();c=.5*(c.x+c.y);var b=this.ya;if(b.width<5*f||b.height<5*f)b=b.clone(),b.Hd(10);return this.hidden()||this.ia("locked")||!b.Oc(a.x,a.y,e*c)||this.Xa&&this.Xa.hittest&&!this.Xa.hittest(a.x,a.y,e,f)?null:this};a.prototype.qj=
function(a,c){a.beginPath();var b=10*c;c*=2;for(var d=0,h=this.sp();d<h.length;d++){var k=h[d];a.moveTo(k.x+b,k.y);a.arc(k.x,k.y,b,0,2*Math.PI,!1)}a.strokeStyle="#0050B7";a.lineWidth=c;a.stroke()};a.prototype.Wl=function(a){"number"===typeof a&&this.sp()};a.prototype.fi=function(a,c,e){for(var b=this.sp(),d=0;d<b.length;d++)if(20>b[d].ec(new F(a,c))/e)return d;return null};a.prototype.Ue=function(a,c,e){var b={};this.Xa&&this.Xa.moveEditHandle&&(c=this.Zb().apply(c,e),b=this.Xa.moveEditHandle(a,c.x,
c.y),b||(console.warn("moveEditHandle(): Must update your code."),b={}));return b};a.prototype.ia=function(a,d){void 0===d&&(d=!1);var b;!d&&this.Xa&&this.Xa.getProperty&&(b=this.Xa.getProperty(a));void 0===b&&(b=c.prototype.ia.call(this,a));"matrix"===a&&(b=Gh(b));return b};a.prototype.sg=function(a){c.prototype.sg.call(this,a);this.Xa.setHidden&&this.Xa.setHidden(a)};a.prototype.format=function(a,c){this.Xa&&(this.fc.yD(c),"format"in this.Xa&&this.Xa.format(a,this.fc),this.Xa.getUntransformedRect?
(a=this.Xa.getUntransformedRect(),this.ya=new G(a.x||0,a.y||0,a.width||0,a.height||0),this.rect=this.ya.clone(),this.rect.transform(this.Pa())):this.log("Error: NodeType %s missing getUntransformedRect()",this.ba.nodeType))};a.prototype.Tf=function(a){this.hidden()||(a.save(),a.getTransform=function(){return a.Oi?Fh(a.Oi):Fh(new H)},this.fc.getScale=function(){return a.Oi?a.Oi.vb().x:1},this.Xa.draw(a,this.fc),a.restore())};a.prototype.gr=function(){var a=!1;this.Xa.shouldEditOnSelect&&(a=this.Xa.shouldEditOnSelect);
return a};a.prototype.wd=function(a){if(this.Xa.applyTransform){a=this.Xa.applyTransform(Fh(a));if("object"!==typeof a)throw Error("Error! applyTransform must return {properties}");"matrix"in a&&(a.matrix=Gh(a.matrix))}else a=c.prototype.wd.call(this,a);return a};return a}(hd);hd.vd("CustomNode",Ih);T.prototype.formatFill=T.prototype.Pz;T.prototype.getFill=T.prototype.oA;T.prototype.reformat=T.prototype.pg;T.prototype.loadImage=T.prototype.yf;T.prototype.fillEraser=T.prototype.Fz;
T.prototype.strokeEraser=T.prototype.eE;T.prototype.formatText=T.prototype.Pl;T.prototype.getScale=T.prototype.vb;T.prototype.parseFont=T.prototype.rC;T.prototype.getConfig=T.prototype.Bc;T.prototype.transformPoint=T.prototype.qE;T.prototype.transformRectangle=T.prototype.rE;T.prototype.untransformPoint=T.prototype.vE;T.prototype.transformCanvas=T.prototype.mc;T.prototype.untransformCanvas=T.prototype.uE;T.prototype.getNodeObject=T.prototype.bm;T.prototype.getProperty=T.prototype.ia;
T.prototype.getNodeProperty=T.prototype.$h;T.prototype.isNode=T.prototype.Ju;T.prototype.getNodeRectangle=T.prototype.Dj;var Jh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.da=null;a.Bl=void 0;a.jc=new Bc;a.Rp=new Bc;a.ag=new H;a.readOnly=!1;a.Ob=!1;a.Ke=null;a.width=0;a.height=0;a.Nd=null;a.Lv="";a.log=u.create("DomNode",!0);a.Ni=-1;a.canvas=null;a.ba.data="";a.ba.locked=!1;a.nb|=4;return a}__extends(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.nq=function(){return null};a.prototype.setProperty=function(a,d){if("data"===a)this.da&&(z(this.da).remove(),this.Bl=this.da=null);else if("border"===
a||"lockSize"===a||"lockRotate"===a||"preview"===a){this.ba[a]=d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.wD=function(a){null!==this.Ke&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.da&&(this.log("   Remove existing DOM element"),z(this.da).remove()),this.da=a,this.da.style.position="absolute",z(this.da).Sp(this.Ke.canvas),this.width=this.da.offsetWidth||parseFloat(this.da.getAttribute("width")||"0"),this.height=this.da.offsetHeight||parseFloat(this.da.getAttribute("height")||
"0"),z(this.da).remove(),this.Fi(this.readOnly,!0),this.da.style.top="0px",this.da.style.left="0px",this.da.style.boxSizing="border-box",this.da.classList.add("zwibbler-dom-node"),this.da.setAttribute("zwibbler-node-id",""+this.id),this.io("transformOrigin","top left"),this.log("element height: %s, %s",this.da.offsetWidth,this.da.offsetHeight),this.Ke.qg(this.id))};a.prototype.tc=function(){return this.da};a.prototype.io=function(a,c){if(null!==this.da){for(var b=a.charAt(0).toUpperCase()+a.substr(1),
d=["ms","Webkit","O","Moz"],h=0;h<d.length;h++)this.da.style[d[h]+b]=c;this.da.style[a]=c}};a.prototype.sg=function(a){hd.prototype.sg.call(this,a);this.da&&(this.da.style.visibility=this.Zk?"hidden":"visible")};a.prototype.Fi=function(a,c){void 0===c&&(c=!1);if(c||this.readOnly!==a)this.readOnly=a,this.da&&this.Ke&&this.Ob&&(this.Bq(this.Ni),z(this.da).Sp(this.Ke.canvas))};a.prototype.format=function(a,c){var b=this;this.canvas=c.canvas;null===this.da&&this.Bl!==this.ia("data")&&c&&(this.Bl=this.ia("data"),
this.Ke=c,this.log("DomNode %s requests conversion to DOM element",this.id),this.Ke.Ky(this.Bl,this.id));if(this.da){this.da.iF=this.id;a=this.Pa();var d=a.vb();this.da.style.width=this.width*d.x+"px";this.da.style.height=this.height*d.y+"px";a=a.multiply(new rc(1/d.x,1/d.y));d=this.ag;d=d.multiply(a);d.Zp()?(this.io("transform",""),this.da.style.left=""+d.Fa+"px",this.da.style.top=""+d.Ga+"px"):(this.da.style.left="0px",this.da.style.top="0px",this.io("transform","matrix("+d.m11+","+d.m21+","+d.m12+
","+d.m22+","+d.Fa+","+d.Ga+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.da.style.visibility=this.Zk?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.jc=new Bc(this.rect);this.ya=this.rect.clone();this.rect.transform(this.Pa());this.jc.transform(this.Pa());if(a=this.ba.border)this.rect.Hd(a),this.Rp=this.jc.clone(),this.Rp.Hd(a/2),this.jc.Hd(a);!this.ba.preview||null!==this.Nd&&this.Lv===this.ba.preview?
this.ba.preview||(this.Nd=null):(this.log("Requesting new preview image for %s",this.ba.preview),this.Nd=document.createElement("img"),this.Lv=this.Nd.src=this.ba.preview,this.Nd.onload=function(){b.log("Preview image loaded.");c.qg(b.id)},this.Nd.onerror=function(){b.log("Failed to load preview image")})};a.prototype.Tf=function(a){var b=a.Oi;b&&this.Ke&&(b.m11!==this.ag.m11||b.m21!==this.ag.m21||b.m12!==this.ag.m12||b.m22!==this.ag.m22||b.Fa!==this.ag.Fa||b.Ga!==this.ag.Ga)&&(this.log("Moving DOM element as result of draw zooming"),
this.ag=b,this.format(a,this.Ke));if(this.da){var c=this.ba.border;if(c){var f=this.Rp;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=c;a.strokeStyle="#cccccc";a.moveTo(f.oa[0].x,f.oa[0].y);a.lineTo(f.oa[1].x,f.oa[1].y);a.lineTo(f.oa[2].x,f.oa[2].y);a.lineTo(f.oa[3].x,f.oa[3].y);a.lineTo(f.oa[0].x,f.oa[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",
0,0);if(this.Nd&&this.Nd.naturalHeight&&!b&&this.Ob){this.log("Drawing preview image %s,%s ->%s,s",this.Nd.naturalWidth,this.Nd.naturalHeight,this.width,this.height);try{a.drawImage(this.Nd,0,0,this.Nd.naturalWidth,this.Nd.naturalHeight,0,0,this.width,this.height)}catch(h){h instanceof Error&&this.log("Tried to draw image, got error: %s",h.toString())}}else b&&(b=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",a.fillRect(this.ya.x,this.ya.y,this.ya.width,this.ya.height),a.globalCompositeOperation=
b)};a.prototype.clip=function(a){this.jc.la(a)};a.prototype.Db=function(a,c,e,f){return!this.ba.locked&&this.rect.Oc(a,c,e)&&this.jc.Oc(a,c,Math.max(3/f,e))?this:null};a.prototype.Lm=function(){this.da&&this.Ke&&(this.log("Added DOM NODE %s",this.id),this.Bq(this.Ni));this.Ob=!0};a.prototype.Om=function(){this.log("Removed DOM NODE %s",this.id);this.da&&z(this.da).remove();this.Ob=!1};a.prototype.Bq=function(a){if(this.da&&this.canvas&&!(0>a)){a!==this.Ni?(this.da.classList.remove("zwibbler-zorder-"+
this.Ni),this.da.classList.add("zwibbler-zorder-"+a),this.Ni=a,this.log("Add class zwibbler-zorder-%s",a)):this.log("order=zorder=%s",this.Ni);var b=null;for(--a;0<=a;a--){var c=this.canvas.parentElement.querySelector(".zwibbler-zorder-"+a);if(c){b=c;this.log("Found element zorder-%s",a);break}this.log("Did not find element zorder-%s",a)}if(this.da.previousSibling!==b||null===b)b?(this.log("Insert after previous."),z(this.da).Sp(b)):(this.log("Insert before canvas %s",this.canvas),z(this.da).insertBefore(this.canvas))}};
a.prototype.Ta=function(){this.da&&(this.log("DomNode %s destroyed",this.id),O.detach(this.da))};a.prototype.pw=function(a){this.Bq(a)};a.prototype.Aj=function(){if(!this.da)return this.rect;var a=z(this.da).am();return new G(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};a.prototype.xk=function(a){this.rect=a;this.ya=a.clone()};a.prototype.ln=function(){};a.prototype.zk=function(){throw Error("DomNode: showChild not implemented!");};return a}(hd);
hd.vd("DomNode",Jh);var Kh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.od=null;a.dg=null;a.scale=1;a.jc=new Bc;a.Pg=[];a.ic=new G(0,0,100,20);a.$c=new G(0,0,100,20);a.log=u.create("IMAGE",!0);a.Zv="";delete a.ba.fillStyle;delete a.ba.strokeStyle;delete a.ba.lineWidth;a.ba.url="";return a}__extends(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.toString=function(){return c.prototype.toString.call(this)+" url="+this.ia("url").substr(0,64)};a.prototype.setProperty=function(a,d){switch(a){case "url":d!==
this.ba.url&&(this.dg=this.od=null);break;case "brightness":case "contrast":case "gamma":this.dg=null;break;case "colour":this.dg=null}c.prototype.setProperty.call(this,a,d)};a.prototype.nc=function(a){switch(a){case "url":case "brightness":case "gamma":case "colour":case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":return!0}return c.prototype.nc.call(this,a)};a.prototype.qD=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.ic.width);
a.height=Math.min(a.height,this.ic.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);return{crop:[a.x,a.y,a.width,a.height].join()}};a.prototype.Zt=function(a){var b=this.ba.crop;a=new G(0,0,this.ic.width*a,this.ic.height*a);b&&(b=b.split(","),a.x=parseFloat(b[0])|0,a.y=parseFloat(b[1])|0,a.width=parseFloat(b[2])|0,a.height=parseFloat(b[3])|0);return a};a.prototype.aD=function(){var a={brightness:this.ia("brightness"),contrast:this.ia("contrast"),gamma:this.ia("gamma"),Nc:this.ia("colour")};
this.dg=void 0!==a.brightness&&void 0!==a.contrast&&void 0!==a.gamma&&this.od?this.Ht(this.od,a)||this.od:void 0!==a.Nc&&this.od?this.Ht(this.od,{brightness:1,contrast:0,gamma:0,Nc:a.Nc})||this.od:this.od};a.prototype.format=function(a,c){function b(a,b,c){l.Pg.push({x:l.$c.x+a*l.$c.width,y:l.$c.y+b*l.$c.height,Fd:c})}var d=this;if(null===this.od&&"ImageSurface"in window)this.od=new window.ImageSurface(this.ba.url);else if(null===this.od){this.ic=new G(0,0,100,20);this.Zv!==this.ba.url&&(this.Zv=
this.ba.url,c.yf(this.id,this.ba.url,function(a){d.log("%s Got image response. Request reformat",d.id);d.od=a;return c.qg(d.id)}));return}this.ic=new G(0,0,this.od.width,this.od.height);null===this.dg&&this.aD();this.scale=(new kc(this.ic.width,this.ic.height)).Lt(this.ia("width"),this.ia("height"));this.$c=this.Zt(this.scale);this.rect=this.$c.clone();if(a=this.ia("boundingPolygon")){for(var h=[],k=0;k<a.length;k+=2)h.push(new F(a[k],a[k+1]));this.jc=new Bc(h)}else this.jc=new Bc(this.rect);this.ya=
this.rect.clone();this.jc.transform(this.ba.matrix);this.rect.transform(this.ba.matrix);this.Pg.length=0;var l=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.Sl=function(){return this.jc};a.prototype.Db=function(a,c,e,f){return!this.ba.locked&&this.jc.Oc(a,c,Math.max(3/f,e))?this:null};a.prototype.Tf=function(b){var c,e,f=!1;if(this.dg)try{var h=b.globalCompositeOperation,k=b.globalAlpha,l=this.ia("blendMode"),n=this.ia("opacity");l&&(b.globalCompositeOperation=""+l,this.log("Using globalCompsiteOperation=%s (requested %s)",
b.globalCompositeOperation,l));void 0!==n&&(b.globalAlpha=n);var r=this.ia("lineWidth")||0;if(r){b.save();this.Zb().mc(b);var v=this.jc.clone();v.Hd(r/2);b.beginPath();v.la(b);b.lineWidth=r;b.strokeStyle=this.ia("strokeStyle")||q.Oa;b.stroke();b.restore()}var x=this.scale;b.drawImage(this.dg,this.$c.x/x,this.$c.y/x,this.$c.width/x,this.$c.height/x,this.$c.x,this.$c.y,this.$c.width,this.$c.height);b.globalAlpha=k;b.globalCompositeOperation=h;if(a.Yr){var w=this.jc.oa;b.save();b.setTransform(1,0,0,
1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle=q.Oa;b.moveTo(w[0].x,w[0].y);var y=c=1;for(e=w.length-1;c<=e;y=c+=1)b.lineTo(w[y].x,w[y].y);b.closePath();b.stroke();b.restore()}}catch(A){A instanceof Error&&this.log("Error drawing image: %s",A.message),f=!0}if(null===this.dg||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.ic.width,this.ic.height),b.restore()};a.prototype.uf=function(){return!0===this.ia("allowCrop")&&!0!==this.ia("lockEditMode")};a.prototype.qj=function(a,
c){a.save();a.beginPath();a.lineWidth=1*c;a.strokeStyle="#0050B7";for(var b=this.Pa(),d=0;d<this.Pg.length;d++){var h=this.Pg[d],k=b.apply(h.x,h.y),l;if(h.Fd){var n=20;var r=l=0;var v=3;h=k.x-10;k=k.y-6}else n=0,l=20,r=3,v=0,h=k.x-6,k=k.y-10;for(var x=0;5>x;x++)a.moveTo(h,k),a.lineTo(h+n*c,k+l*c),h+=r*c,k+=v*c}a.stroke();a.restore()};a.prototype.fi=function(a,c,e){var b=this.Pa();e*=10;for(var d=0;d<this.Pg.length;d++){var k=this.Pg[d];k=b.apply(k.x,k.y);if(k.x-e<=a&&a<k.x+e&&k.y-e<=c&&c<k.y+e)return d}return null};
a.prototype.Wl=function(a){a=this.Pg[a];this.Pa().apply(a.x,a.y)};a.prototype.Ue=function(a,c,e){var b=this.Zt(this.scale);c=this.Zb().apply(c,e);c.x=Math.round(c.x);c.y=Math.round(c.y);0===a?(0>c.y&&(c.y=0),c.y>this.ic.height&&(c.y=this.ic.height),b.height-=c.y-b.y,b.y=c.y):1===a?(0>c.x&&(c.x=0),c.x>this.ic.width&&(c.x=this.ic.width),b.width=c.x-b.x):2===a?(0>c.y&&(c.y=0),c.y>this.ic.height&&(c.y=this.ic.height),b.height=c.y-b.y):3===a&&(0>c.x&&(c.x=0),c.x>this.ic.width&&(c.x=this.ic.width),b.width-=
c.x-b.x,b.x=c.x);return this.qD(b)};a.prototype.Ht=function(a,c){var b=a.width,d=a.height;if(!(a instanceof HTMLCanvasElement)){var h=document.createElement("canvas");h.width=b;h.height=d;h.getContext("2d").drawImage(a,0,0);a=h}h="number"===typeof c.brightness?c.brightness:-1;var k="number"===typeof c.contrast?c.contrast:-1,l="number"===typeof c.gamma?c.gamma:-1,n="string"===typeof c.Nc?q.lf(c.Nc):null,r=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(c));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",
h,k,l,b,d);r.width=b+1;r.height=d;try{var v=a.getContext("2d").getImageData(0,0,b,d).data}catch(A){return this.log("Cannot filter external image."),null}a=r.getContext("2d").getImageData(0,0,b,d);c=a.data;for(b=0;b<v.length;b+=4){d=v[b]/255;var x=v[b+1]/255,w=v[b+2]/255,y=v[b+3];0<=l&&(d=Math.pow(d,l),x=Math.pow(x,l),w=Math.pow(w,l));0<=h&&(d*=h,w*=h,x*=h);0<=k&&(d=d*k-.5*k+.5,x=x*k-.5*k+.5,w=w*k-.5*k+.5);n&&0<y&&(d=n.values[0],x=n.values[1],w=n.values[2]);c[b]=Math.min(255*d|0,255);c[b+1]=Math.min(255*
x|0,255);c[b+2]=Math.min(255*w|0,255);c[b+3]=y}r.getContext("2d").putImageData(a,0,0);return r};a.Yr=!1;return a}(hd);hd.vd("ImageNode",Kh);var Nh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.log=u.create("SvgNode",!0);a.fe=null;a.Rr="";a.jc=new Bc;a.$a=new jd;a.scale=1;a.bv=0;a.zo=0;delete a.ba.lineWidth;delete a.ba.fillStyle;delete a.ba.strokeStyle;a.ba.url="";return a}__extends(a,c);a.prototype.type=function(){return"SvgNode"};a.prototype.nc=function(a){switch(a){case "url":case "textFillStyle":case "textAlign":case "fontSize":case "fontName":case "bold":case "italic":case "textDecoration":case "text":case "width":case "fillStyle":case "strokeStyle":case "lineWidth":case "fillMode":case "centerShift":return!0}return c.prototype.nc.call(this,
a)};a.prototype.setProperty=function(a,d){"fillStyle"===a&&this.fe&&!this.fe.closed&&(a="strokeStyle");c.prototype.setProperty.call(this,a,d)};a.prototype.$g=function(){return!0};a.prototype.format=function(a,c){var b=this,d=this.ia("url");this.Rr!==d?(this.Rr=d,c.yB(d,function(a){a&&a.src===b.Rr&&(b.fe=a,c.qg(b.id))})):this.fe&&(d="",this.ba.fillStyle&&(d+="\n               .fill {\n                 fill: "+this.ba.fillStyle+";\n               }"),this.ba.strokeStyle&&(d+="\n               .stroke {\n                fill: "+
this.ba.strokeStyle+";\n                 stroke: "+this.ba.strokeStyle+";\n               }"),this.fe.Za(d),this.ya=this.fe.rect.clone(),this.scale=this.ba.width?this.ba.width/this.ya.width:1,this.ya.width*=this.scale,this.ya.height*=this.scale,this.jc=new Bc(this.ya),d=this.Pa(),this.jc.transform(d),this.rect=this.jc.Ws(),d=this.ba.text)&&(this.$a.uk(this.ba.fontName||"sans-serif",this.ba.fontSize||10,this.ba.bold||!1,this.ba.italic||!1,this.ba.textDecoration||""),this.$a.ug(d),this.$a.rk(this.ia("textAlign"),
"middle"),d=Lh(this.fe,this.Pa().multiply(new rc(this.scale,this.scale))),this.$a.kn([d]),this.$a.nD(this.ba.centerShift||0),this.bv=Mh(d),this.$a.format(a,0,0))};a.prototype.ia=function(a){if("custom"===this.ba.fillMode)switch(a){case "fillStyle":return this.ba.fillStyle||"transparent";case "strokeStyle":return this.ba.strokeStyle||q.Oa;case "lineWidth":return this.ba.lineWidth||1}switch(a){case "textAlign":return this.ba.name||"center";case "text":return this.ba.text||""}return c.prototype.ia.call(this,
a)};a.prototype.mb=function(){var a=c.prototype.mb.call(this);"custom"===a.fillMode&&(a.fillStyle=this.ia("fillStyle"),a.strokeStyle=this.ia("strokeStyle"),a.lineWidth=this.ia("lineWidth"));return a};a.prototype.Tf=function(a){if(this.fe){a.scale(this.scale,this.scale);if("custom"===this.ba.fillMode){a.save();a.beginPath();this.fe.la(a,null,!0);a.fillStyle=this.ia("fillStyle");a.fill();var b=this.Zb();b.An().multiply(b).mc(a);a.strokeStyle=this.ia("strokeStyle");a.lineWidth=this.ia("lineWidth")/this.scale;
a.stroke();a.restore()}else this.fe.la(a);a.scale(1/this.scale,1/this.scale);this.ba.text&&(a.save(),a.beginPath(),this.Zb().mc(a),a.fillStyle=this.ba.textFillStyle||q.Oa,this.$a.fillText(a,0,this.bv),a.restore())}};return a}(hd);hd.vd("SvgNode",Nh);function Lh(c,a){var b=new xc,d=new Wd(b);a.mc(d);c.la(d);c=[];a=0;for(b=b.Fk(1).he();a<b.length;a++)c.push.apply(c,b[a]);return Rc(c)}function Mh(c){if(0===c.length)return 0;for(var a=c[0].y,b=1;b<c.length;b++)c[b].y<a&&(a=c[b].y);return a};var Oh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.el="UnknownNode";a.width=100;a.height=20;a.$a=new jd;a.log=u.create("UNKNOWN",!0);a.$a.rk("center","middle");return a}__extends(a,c);a.prototype.MD=function(a){this.el=a;this.$a.ug(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.el};a.prototype.setProperty=function(a,c){this.ba[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.el);this.rect=new G(0,0,this.width,
this.height);this.rect.transform(this.ba.matrix);this.$a.format(a,this.width,this.height)};a.prototype.Tf=function(a){this.log("Drawing placeholder for for %s",this.el);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle=q.Oa;this.$a.la(a,0,0);a.restore()};a.Yr=!1;return a}(hd);hd.vd("UnknownNode",Oh);var Ph=u.create("HTMLGridNode"),Rh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.lines=[[],[]];a.nb|=8;a.zf=new Jg(a.aa.bc);a.Nb(Lg(a.aa.bc,{columns:[100],rows:[100]}));return a}__extends(a,c);a.prototype.type=function(){return"GridNode"};a.prototype.nc=function(a){return 0===a.indexOf("line.")||c.prototype.nc.call(this,a)};a.prototype.setProperty=function(a,d){if(0===a.indexOf("line.")){var b=a.substr(5);d?this.QC(Kg.Wb(b,d)):this.MC(b)}return c.prototype.setProperty.call(this,a,d)};a.prototype.QC=
function(a){for(var b=a.Wh,c=0;c<this.lines[b].length;c++)if(this.lines[b][c].name===a.name){this.lines[b][c]=a;this.Cw();return}this.lines[b].push(a);this.Cw()};a.prototype.MC=function(a){for(var b=0;1>=b;b++)for(var c=0;c<this.lines[b].length;c++)if(this.lines[b][c].name===a){this.lines[b].splice(c,1);return}};a.prototype.Cw=function(){this.lines[0].sort(function(a,c){return Ig.Yc(a.Ma,c.Ma)});this.lines[1].sort(function(a,c){return Ig.Yc(a.Ma,c.Ma)})};a.prototype.EA=function(a){for(var b=0;1>=
b;b++)for(var c=0,f=this.lines[b];c<f.length;c++){var h=f[c];if(h.name===a)return h}return null};a.prototype.Zl=function(a,c){var b=0,d=null,h=0;for(a=this.lines[a];h<a.length;h++){d=a[h];if(c===b)return d;b++}return-1===c?d:null};a.prototype.$l=function(a,c){var b=0,d=0;for(a=this.lines[a];d<a.length;d++){if(a[d].name===c.name)return b;b++}return-1};a.prototype.ko=function(a,c,e){void 0===e&&(e={});return this.Is(0,c,a,e)};a.prototype.lo=function(a,c,e){void 0===e&&(e={});return this.Is(1,c,a,e)};
a.prototype.cz=function(a,c){return this.Vv(1,a,c)};a.prototype.az=function(a,c){return this.Vv(0,a,c)};a.prototype.ar=function(a,c,e){void 0===e&&(e={});return this.rw(0,a,c,e)};a.prototype.br=function(a,c,e){void 0===e&&(e={});return this.rw(1,a,c,e)};a.prototype.rw=function(a,c,e,f){if(0>c||c>=this.lines[a].length-1)return Ph("Error: asked to set grid index "+c+" but there are "+this.lines[a].length+" grid lines"),f;var b=this.lines[a][c];b=new Kg(b.Wh,b.name,b.Ma,e);f["line."+b.name]=b.encode();
Ph("Set grid %s, index=%s, size=%s, props",a,c,e,f);return f};a.prototype.Is=function(a,c,e,f){var b={ba:{},children:[]};var d=this.lines[a];var l=!1;if(-1==e||e==d.length-1){var n=d[d.length-2];d=d[d.length-1];l=!0}else n=d[e],d=d[e+1];if(!n||!d)return Ph("Can't addToGrid(%s,%s,%s)",a,c,e,n,d),b;if(c!==n.size){var r=n.clone(),v=r.size;r.size=c;c=v;b.ba["line."+r.name]=r.encode()}r=new Kg(a,Kg.ds(),this.zf.ro(n.Ma,d.Ma),c);b.ba["line."+r.name]=r.encode();Ph("Add grid %s, %s, %s, props",a,c,e,f);c=
1===a?"vertical":"horizontal";for(e=0;e<this.children.length;e++)if(f=this.pb(e),f.ia("_spanGrid")!==c&&(v=this.op(f))){var x=!1;l&&v.end[a].name===d.name?(v.end[a]=r,x=!0):v.start[a].name===n.name&&(v.start[a]=r,x=!0);x&&(x={},x["style.gridArea"]=v.start[1].name+" / "+v.start[0].name+" / "+v.end[1].name+" / "+v.end[0].name,b.children.push({jg:f.id,remove:!1,ig:x}))}for(e=0;e<this.lines[a].length;e++);return b};a.prototype.Vv=function(a,c,e){var b={ba:{},children:[]},d=this.lines[a],k=d[c],l=d[e+
1];l||(l=d[d.length-1]);for(var n=0;n<this.children.length;n++){var r=this.pb(n),v=this.op(r);if(v){var x=0>=Ig.Yc(k.Ma,v.start[a].Ma)&&0<=Ig.Yc(l.Ma,v.start[a].Ma),w=0>=Ig.Yc(k.Ma,v.end[a].Ma)&&0<=Ig.Yc(l.Ma,v.end[a].Ma),y=!1;x&&w?b.children.push({jg:r.id,remove:!0,ig:{}}):x?(v.start[a]=0<c?l:k,y=!0):w&&(v.end[a]=l,y=!0);y&&(x={},x["style.gridArea"]=v.start[1].name+" / "+v.start[0].name+" / "+v.end[1].name+" / "+v.end[0].name,b.children.push({jg:r.id,remove:!1,ig:x}))}}for(n=0;n<this.lines[a].length;n++);
for(n=c+1;n<=e;n++)a=d[n+1],b.ba["line."+a.name]=void 0;if(0!==c||e!==this.lines.length-1)0===c?(a=d[0].clone(),a.size=d[1].size,b.ba["line."+a.name]=a.encode(),b.ba["line."+d[c+1].name]=void 0):b.ba["line."+d[c].name]=void 0;return b};a.prototype.sA=function(a,c,e,f){a=this.Zl(1,a);c=this.Zl(0,c);e=-1===e?this.lines[1][this.lines[1].length-1]:this.Zl(1,e);f=-1===f?this.lines[0][this.lines[0].length-1]:this.Zl(0,f);return a&&c&&e&&f?a.name+" / "+c.name+" / "+e.name+" / "+f.name:""};a.prototype.op=
function(a){var b=a.ia("style.gridArea");if(!b)return null;a=[];var c=0;for(b=b.replace(/ /g,"").split("/");c<b.length;c++){var f=b[c],h=this.EA(f);if(!h)return Ph("HTMLGridNode: Could not get line by name: %s",f),null;a.push(h)}return{start:[a[1],a[0]],end:[a[3],a[2]]}};a.prototype.aA=function(a){var b=this.op(a);if(!b)return null;var c=this.$l(1,b.start[1]),f=this.$l(1,b.end[1]),h=this.$l(0,b.start[0]);b=this.$l(0,b.end[0]);return-1===c||-1===f||-1===h||-1===b?(Ph("Child %s has invalid gridArea: %s",
a,a.ia("style.gridArea")),null):{$C:c,ZC:f,By:h,Ay:b}};a.prototype.dA=function(){function a(a,b){for(var c=0;c<a.length;c++){var d=a[c];c<a.length-1?b.push("["+d.name+"] "+d.size+"px"):b.push("["+d.name+"]")}}var c=[];a(this.lines[1],c);c.push("/");a(this.lines[0],c);return c.join(" ")};a.prototype.createElement=function(){var a=document.createElement("div");a.style.display="grid";return a};a.prototype.format=function(a,d){for(var b=0;1>=b;b++)for(var f=0,h=0,k=this.lines[b];h<k.length;h++){var l=
k[h];l.Ia=f;f+=l.size}c.prototype.format.call(this,a,d);this.da&&(this.da.style.qF=this.dA())};a.prototype.la=function(a){c.prototype.la.call(this,a);a.beginPath();for(var b=this.ce,e=0,f=this.lines[0];e<f.length;e++){var h=f[e];a.moveTo(b.x+h.Ia,b.y);a.lineTo(b.x+h.Ia,b.bottom())}e=0;for(f=this.lines[1];e<f.length;e++)h=f[e],a.moveTo(b.x,b.y+h.Ia),a.lineTo(b.right(),b.y+h.Ia);a.rect(b.x,b.y,b.width,b.height);a.strokeStyle="#000";a.lineWidth=1;a.setLineDash&&a.setLineDash([3,2]);a.stroke()};a.prototype.qj=
function(a){var b=this.ce;a.beginPath();for(var c=0,f=this.lines[0];c<f.length;c++){var h=f[c];a.moveTo(b.x+h.Ia,b.y);a.lineTo(b.x+h.Ia,b.bottom())}c=0;for(f=this.lines[1];c<f.length;c++)h=f[c],a.moveTo(b.x,b.y+h.Ia),a.lineTo(b.right(),b.y+h.Ia);a.rect(b.x,b.y,b.width,b.height);a.strokeStyle="blue";a.lineWidth=3;a.setLineDash&&a.setLineDash([3,2]);a.stroke()};a.prototype.pu=function(){return!0};a.prototype.fi=function(a,c,e){function b(b){if(0===b){var e=d.ce.x;var f=a}else e=d.ce.y,f=c;for(var h=
0;h<d.lines[b].length-1;h++){var k=d.lines[b][h];e+=k.size;if(Math.abs(e-f)<l)return new Qh(k,f)}return null}var d=this,k=this.Pa().apply(a,c);if(!this.ce.Oc(k.x,k.y))return null;var l=5/e;return b(0)||b(1)};a.prototype.Ue=function(a,c,e){var b={};if(!(a instanceof Qh))return b;var d=a.line.clone();e=(1===d.Wh?e:c)-a.Fw;d.size=Math.max(10,d.size+e);Ph("Adjust from %s to %s, offset=%s, newSize=%s",a.Fw,c,e,d.size);b["line."+d.name]=d.encode();return b};a.prototype.vp=function(){return{rows:this.lines[1].length-
1,et:this.lines[0].length-1}};return a}(gh),Qh=function(){function c(a,b){this.line=a;this.Fw=b}c.prototype.eg=function(){return 1===this.line.Wh?"row-resize":"col-resize"};return c}();hd.vd("HTMLGridNode",Rh);var Sh=u.create("RootNode"),Th=function(c){function a(a,d,e){a=c.call(this,a,d)||this;Sh("Root node is constructed: Traits=%s",a.nb);a.da=e;return a}__extends(a,c);a.prototype.nc=function(){return!0};return a}(dh(Zc));var rg=new kc(816,1056),Uh=u.create("DOC"),vg=function(){function c(a,b,c,e){this.yu=c;this.jf=e;this.Gd=document.createElement("DIV");this.bc=Bg(3);this.Od=new ih;this.Qt=!0;this.uc="0";this.Yj=new ih;this.removedNodes=new ih;this.Lq={};this.$i=new ih;this.rn=0;this.mr="magenta";this.readOnly=!1;this.So=new ih;this.Lj=new ih;this.Tr=new ih;this.Ye=[];this.fw=this.ji=this.oj=this.fb=0;this.zv=function(){};this.uj=[];this.Lg=new dd;this.li=0;this.Np=!1;this.Tw=new ih;this.Gd.setAttribute("nid","0");
this.root=new Th(this.Cj(),this,this.Gd);this.Va=new Ch(this,this.root);this.wb=new Ah(this.Va,this.bc);a||(this.bb(),this.Fc(this.Pj(0,{})),this.wa(!0));b&&this.Jx(b);this.Xu()}c.prototype.Jx=function(a){var b=this;z(a).query("[z-fixture]",function(a){var c=a.getAttribute("z-fixture")||"";b.gl(a,c)})};c.prototype.gl=function(a,b){var c=new gh(b,this);c.da=a;c.Nt=!0;c.ln(this.yu);Uh("Register fixture %s",b);c.da.setAttribute("nid",b);this.wb.il(b);this.Va.Qx(b,c);this.uj.push(c)};c.prototype.empty=
function(){return 0===this.root.children.length};c.prototype.Xu=function(){this.fw=this.wb.next};c.prototype.Yf=function(){return this.fw!==this.wb.next};c.prototype.Ta=function(){this.Va.Qc(function(a){a.Ta()})};c.prototype.Cj=function(){var a=this.uc;this.uc=((2147483647*Math.random()|0)+1).toString(36);return a};c.prototype.ed=function(a){return this.Va.ed(a)};c.prototype.qv=function(a){Uh("onCreateNode: %s",a);"PageNode"!==a.type()&&(this.Yj.add(a.id),this.removedNodes.remove(a.id));a.ia("spotHighlight")&&
"PathNode"===a.type()&&this.Ye.push(a);this.ji=this.qf(a.id)||0;"DomNode"===a.type()?this.So.add(a.id):"PageNode"===a.type()&&(this.oj=-1);Tc(a)&&(a.Lm(),a.Fi(this.readOnly),this.Od.add(a.id),this.Tr.add(a.Zd()));Tc(a)&&a.Ul&&this.Lg.lw(a.id,a.Ul())};c.prototype.gg=function(a){this.$i.add(a);this.Od.add(a);var b=0;for(a=this.Lg.jp([a]);b<a.length;b++){var c=a[b];this.$i.add(c);this.Od.add(c)}};c.prototype.Aa=function(a,b){void 0===b&&(b=!1);if(this.Va.ed(a)){var c=this.Va.Aa(a);b&&this.gg(a);return c}return null};
c.prototype.Jb=function(a,b){void 0===b&&(b=!1);return(a=this.Aa(a,b))&&Tc(a)?a:null};c.prototype.qf=function(a){for(a=this.Aa(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;a=this.root.re(a);return 0<=a?a:null};c.prototype.Ep=function(a,b){for(var c=[],e=0;e<a.length;e++){var f=this.Aa(a[e],!1);f&&c.push(f)}return c=b?this.Cz(c):this.wl(c)};c.prototype.Jz=function(a){var b=[];this.Va.Qc(function(c){c.ia("tag")===a&&b.push(c)});return b};
c.prototype.bb=function(){this.li++;Uh("begin(); nested transactions=%s",this.li)};c.prototype.wa=function(a){void 0===a&&(a=!1);this.li=Math.max(this.li-1,0);Uh("commit(skip=%s); nested transactions=%s",a,this.li);0===this.li?(this.wb.wa(!1,a),this.Va.wa(!1)):Uh("In a nested transaction; not committing.")};c.prototype.transaction=function(a,b){void 0===b&&(b=!1);this.bb();a(this);this.wa(b)};c.prototype.Mm=function(a){Uh("onCommit occured");this.zv(a,this.Yj.vc(),this.removedNodes.vc(),this.$i.mj(this.Yj).mj(this.removedNodes).vc(),
this.Lq);this.Yj=new ih;this.removedNodes=new ih;this.$i=new ih;this.Lq={}};c.prototype.Xc=function(){this.wb.Xc()};c.prototype.ye=function(){this.wb.ye()};c.prototype.df=function(){return this.wb.df()};c.prototype.cf=function(){return this.wb.cf()};c.prototype.an=function(){this.wb.Eo()};c.prototype.Rz=function(a,b,c){for(var d=[],f=0;f<c.length;f++){var h=c[f];d.push(h.id)}d=this.Lg.jp(d);c=c.concat();for(f=0;f<d.length;f++)(h=this.Va.Aa(d[f]))&&Tc(h)&&c.push(h);this.rt(a,b,c)};c.prototype.format=
function(a,b){var c=this,e=[];this.Qt?this.Va.Qc(function(a){Tc(a)&&e.push(a)}):this.Od.Qc(function(a){a=c.Va.Aa(a);Tc(a)&&e.push(a);return!1});return this.rt(a,b,e)};c.prototype.rt=function(a,b,c){c=this.wl(c);this.Lg.sort(c);for(var d=0,f=c;d<f.length;d++){var h=f[d];h.format(a,b)}if(!this.Np)for(a=0,b=c;a<b.length;a++)h=b[a],h.Jp().length&&(this.Np=!0);this.Od.clear();this.Qt=!1;this.gt();return c.length};c.prototype.qz=function(a,b,c){if(0!==this.Ye.length&&b===this.rn){a.save();a.beginPath();
b=c||this.fd();a.moveTo(b.x,b.y);a.lineTo(b.x,b.bottom());a.lineTo(b.right(),b.bottom());a.lineTo(b.right(),b.y);a.closePath();c=!1;for(var d=0;d<this.Ye.length;d++)this.qf(this.Ye[d].id)===this.fb&&(this.Ye[d].clip(a),c=!0);c&&(a.clip(),a.fillStyle=this.mr,a.fillRect(b.x,b.y,b.width,b.height));a.restore()}};c.prototype.kf=function(a,b){b=b||this.fd();var c=this.ia("background");c&&(c=q.Rl(c))&&(a.fillStyle=c.toString(),a.fillRect(b.x,b.y,b.width,b.height))};c.prototype.la=function(a,b,c){function d(d){k.Ac(function(b){if(!k.Lj.contains(b.Cc())&&
b.Zd()===d&&!b.hidden()){b.pw(n++);b.la(a);for(var e=0,h=f.jf;e<h.length;e++){var l=h[e];l.Ms(b)&&l.la(a,b,l===c)}}});k.qz(a,d,b)}var f=this,h,k=this;this.Tr.add(this.rn);var l=this.Tr.kE();l.sort(function(a,b){return a-b});var n=0;var r=0;for(h=l.length;r<h;r++)d(l[r])};c.prototype.Db=function(a,b,c,e,f){var d=this,k={node:null,hf:null};this.Ac(function(h){if(e.has(h.Cc())){for(var l=h.Db(a,b,0,c),r=null,v=0,x=d.jf;v<x.length;v++){var w=x[v];if(w.Ms(h)&&w.Db(h,a,b,0)){r=w;break}}!l&&!r||!(null===
k.node||k.node.Zd()<=h.Zd())||f&&f!==h.type()||(k.node=h,k.hf=r)}});return k};c.prototype.gB=function(a,b,c,e){var d=[],h=0,k={};this.Ac(function(f){f.Db(a,b,c,e)&&(d.push(f),k[f.id]=h,h+=1)});d.sort(function(a,b){return a.Zd()!=b.Zd()?a.Zd()-b.Zd():k[a.id]-k[b.id]});d.reverse();return d};c.prototype.NA=function(a){var b=[];this.Ac(function(c){a.contains(c.rect)&&b.push(c)});return b};c.prototype.wl=function(a){var b,c=[],e={};var f=0;for(b=a.length;f<b;f++){var h=a[f];if("PageNode"!==h.type()){if(!Tc(h))continue;
for(;h.ym()&&h.parent;)if(Uh("Node type %s:%s is a group member",h.id,h.type()),Tc(h.parent))h=h.parent;else break}h.id in e||(e[h.id]=h,c.push(h))}this.ZD(c);return c};c.prototype.Cz=function(a){function b(a){if(!(a.id in e)&&(e[a.id]=a,c.push(a),0!=(a.nb&2)))for(var d=0;d<a.children.length;d++)b(a.pb(d))}for(var c=[],e={},f=0;f<a.length;f++)b(a[f]);return c};c.prototype.Qc=function(a,b){function c(d){if(d.children.length){a&&Tc(d)&&b(d);for(var e=0;e<d.children.length;e++)c(d.pb(e))}else Tc(d)&&
b(d)}c(this.root)};c.prototype.Hl=function(a,b,c){function d(b){if((Tc(b)||c)&&!1===a(b))return!1;if(0!=(b.nb&2)){for(var e=[],f=0;f<b.children.length;f++)e.push(b.pb(f));for(b=0;b<e.length;b++)if(!1===d(e[b]))return!1}return!0}void 0===c&&(c=!1);for(var f=0;f<b.children.length;f++)d(b.pb(f))};c.prototype.Ac=function(a,b){void 0===b&&(b=this.fb);b<this.root.children.length&&this.Hl(a,this.root.pb(b||0))};c.prototype.Xz=function(a){var b=!1,c=a.Sl(),e=[];this.Ac(function(d){b?d.Sl().jB(c)&&e.push(d):
d===a&&(b=!0)});return e};c.prototype.ZD=function(a){var b=0,c={};this.Qc(!0,function(a){c[a.id]=b++});a.sort(function(a,b){return c[a.id]-c[b.id]})};c.prototype.dD=function(a){var b=[],c=0;a=this.wl(a);for(var e=0;e<a.length;e++)c=this.vs(a[e],b,c,null);return"zwibblerclip."+JSON.stringify(b)};c.prototype.vs=function(a,b,c,e){var d=a.mb(),h={},k;for(k in d){var l=d[k];l instanceof H&&(l=["Matrix",l.m11,l.m12,l.m21,l.m22,l.Fa,l.Ga]);h[k]=l}null===e&&a.parent&&"PageNode"!==a.parent.type()&&(e=a.parent.id);
b.push({type:"CreateAction",node:a.type(),parent:e,properties:h});h=c+1;for(e=0;e<a.children.length;e++)h=this.vs(a.pb(e),b,h,c);return h};c.prototype.Vu=function(a,b,c){var d,f;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var h=[];a=JSON.parse(a);var k={},l=0,n=0;var r=0;for(f=a.length;r<f;r++){var v=a[r];if("GroupAction"===v.type){var x=this.Cj();k[l++]=x;x=[];var w=0;for(v=v.members;w<v.length;w++)x.push(k[v[w]]);v=this.group(x);k[l++]=v;h.push(v)}else if("CreateAction"===v.type){var y=v.properties;
x={};for(d in y)y.hasOwnProperty(d)&&(w=y[d],"[object Array]"===Object.prototype.toString.apply(w)&&"Matrix"===w[0]&&(w.splice(0,1),w=new H(w)),x[d]=w);y=this.Tl();var A=-1;w=!0;if("parent"in v&&v.parent in k)y=k[v.parent],w=!1;else if("PageNode"===v.node)y=this.root.id,A=this.fb+1+n,n+=1;else if("string"===typeof v.parent){var E=this.Aa(v.parent,!1);E&&this.Wp(E)?y=E.id:E&&this.qf(E.id)===this.fb&&(y=E.id)}"PageNode"!==v.node&&(x.layer=c,"default"!==x.layer&&""!==x.layer||delete x.layer);x=this.createNode(v.node,
x,y,A);k[l++]=x;("HTMLNode"!==v.node||w)&&h.push(x)}}0!==n||b.Iu()||this.xg(h,b);return h};c.prototype.LC=function(a,b){var c="function"!==typeof b?function(a){return a===b}:b;for(var e=0,f=0;f<a.length;f++)c(a[f])?e+=1:e&&(a[f-e]=a[f]);a.length-=e};c.prototype.rv=function(a){var b=this.qf(a.id)||0;this.Yj.remove(a.id);this.$i.remove(a.id);this.removedNodes.add(a.id);this.Lq[a.id]=a.mb();Tc(a)&&a.Om();a.Ta();this.Od.remove(a.id);this.Lg.NC(a.id);a.ia("spotHighlight")&&this.LC(this.Ye,a);this.So.remove(a.id);
"PageNode"===a.type()?(b===this.fb?(Uh("Removed current page."),this.Fc(Math.min(b,this.hb()-2)),this.ji=this.fb):b<this.fb&&(this.Fc(this.fb-1),this.ji=this.fb),this.oj=-1):this.ji=b};c.prototype.kp=function(a){function b(a){if(!k||a.rect.x<c)c=a.rect.x;if(!k||a.rect.right()>e)e=a.rect.right();if(!k||a.rect.y<f)f=a.rect.y;if(!k||a.rect.bottom()>h)h=a.rect.bottom();k=!0}var c=0,e=0,f=0,h=0,k=!1;"number"===typeof a?this.Ac(b,a):this.Qc(!0,b);return k?new G(c,f,e-c,h-f):new G(0,0,10,10)};c.prototype.lB=
function(a){return 0===a.x&&0===a.y&&10===a.width&&10===a.height};c.prototype.uu=function(){var a=this.se(void 0),b=null;a instanceof jh&&(b=a.fd());return b||this.root.Zg("width")};c.prototype.fd=function(a,b){var c=null;if(void 0!==a){var e=this.se(a);e instanceof jh&&(c=e.fd())}return c?c.mE():this.ia("width")?new G(0,0,this.ia("width"),this.ia("height")):b?new G(0,0,b.width,b.height):this.kp(a)};c.prototype.ia=function(a){return this.root.ia(a)};c.prototype.Zg=function(a){return this.root.Zg(a)};
c.prototype.setProperty=function(a,b){this.Qd([this.root.id],a,b)};c.prototype.mb=function(){return this.root.mb()};c.prototype.Qd=function(a,b,c){var d={};d[b]=c;this.bb();this.Bb(a,d);this.wa()};c.prototype.$h=function(a,b){if(a=this.Aa(a))return a.ia(b)};c.prototype.Ju=function(a){return this.Va.ed(a)};c.prototype.Bb=function(a,b){var c=this;this.Og(a,function(a){c.wb.Nb(a.id,b)})};c.prototype.xv=function(a,b){Tc(a)&&a.Ul&&this.Lg.lw(a.id,a.Ul());this.gg(a.id);this.ji=this.qf(a.id)||0;if("spotHighlight"in
b&&"PathNode"===a.type()){for(var c=0;c<this.Ye.length;c++)if(this.Ye[c]===a){this.Ye.splice(c,1);break}b.spotHighlight&&"PathNode"===a.type()?(Uh("Added node %s to spotHighlightNodes",a.id),this.Ye.push(a)):Uh("Removed node %s from spotHighlightNodes",a.id)}};c.prototype.Ak=function(a,b){Uh("showLayer(%s, %s)",a,b);b?(this.Lj.remove(a),this.Ac(function(b){if(b.Cc()===a){b.Lm();var c=b.parent;Uc(c)&&(b=c.re(b),c.zk(b,!0))}})):(this.Lj.add(a),this.Ac(function(b){if(b.Cc()===a){b.Om();var c=b.parent;
Uc(c)&&(b=c.re(b),c.zk(b,!1))}}))};c.prototype.zm=function(a){return!this.Lj.contains(a)};c.prototype.Pj=function(a,b){Uh("Adding page to document with index %s",a);if(a>this.root.children.length)return Uh("Error: Can insert page with index %s",a),-1;this.createNode("PageNode",b,this.root.id,a);return a};c.prototype.hb=function(){return this.root.children.length};c.prototype.Fc=function(a){if(a!==this.fb)if(0<=a&&a<this.hb())Uh("Set current page to %s/%s",a,this.hb()),this.fb=a;else return Uh("Tried to set page to non-existing %s",
a),!1;return!0};c.prototype.TD=function(){if(this.oj!==this.fb){this.Ar(this.oj,!1);this.Ar(this.fb,!0);this.oj=this.fb;for(var a=0;a<this.hb();a++)this.root.zk(a,a===this.fb)}};c.prototype.Ar=function(a,b){var c=this;b?this.Ac(function(a){"DomNode"!==a.type()||c.Lj.contains(a.Cc())||a.Lm()},a):this.So.Qc(function(a){(a=c.Jb(a,!1))&&a.Om()})};c.prototype.se=function(a){void 0===a&&(a=this.fb);return 0===this.root.children.length?this.root:this.root.pb(a)};c.prototype.Fp=function(){return this.fd(this.fb,
rg)};c.prototype.Fi=function(a){this.Qc(!1,function(b){b.Fi(a)})};c.prototype.getRootNode=function(){return this.root};c.prototype.Wu=function(a,b){var c=b.$type||b.type||"",e=Zc.create(c,a,this);e||(c in N.Al?(e=new Ih(a,this),e.setProperty("nodeType",c)):(Uh("Bad node type: %s",c),a=Zc.create("UnknownNode",a,this),a.MD(c),e=a));5===(e.nb&5)&&e.ln(this.yu);e.Nb(b);return e};c.prototype.createNode=function(a,b,c,e,f){f||(f=this.Cj());c||(c=this.Tl());var d=this.Aa(c);if(!d)throw Error("createNode type="+
a+": parent "+c+" does not exist");if(void 0===e||-1==e)e=d.children.length;b.$type=a;this.wb.createNode(f,c,e,b);return f};c.prototype.Og=function(a,b){for(var c=0;c<a.length;c++){var e=a[c],f=this.Aa(e);f?b(f):Uh("Node %s does not exist",e)}};c.prototype.Yb=function(a){function b(a){for(var d=a.children.length-1;0<=d;d--)b(a.pb(d));c.wb.Fe(a.id)}var c=this;a.push.apply(a,this.Lg.jp(a));this.Og(a,function(a){a.parent?b(a):Uh("deleteNode(%s): node has no parent",a.id)})};c.prototype.xg=function(a,
b){var c=this;this.Og(a,function(a){Tc(a)&&c.Bb([a.id],a.wd(b))})};c.prototype.Ue=function(a,b,c,e){var d=this.Jb(a,!0);d&&0!=(d.nb&16)&&this.Bb([a],d.Ue(b,c,e))};c.prototype.Tl=function(){return this.root.pb(this.fb).id};c.prototype.group=function(a){var b=this.createNode("GroupNode",{});this.Ui(b,a);return b};c.prototype.Ui=function(a,b){var c=this,e=this.Aa(a);if(e&&0!=(e.nb&2)){var f=e.children.length;this.Og(b,function(b){if(!b.parent)throw Error("Expected node to have a parent");c.wb.hd(b.id,
a,f++)});this.gg(a)}};c.prototype.Ki=function(a){var b=this,c={};this.Og(a,function(a){if(a instanceof hh&&!(a.id in c)&&a.parent){c[a.id]=!0;for(var d=a.parent.children.length,e=a.children.length-1;0<=e;e--){var k=a.pb(e);b.wb.hd(k.id,a.parent.id,d)}b.Yb([a.id])}})};c.prototype.duplicate=function(a,b){function c(a,d){if(!f.has(a.id)){f.add(a.id);var k=a.mb();if(Tc(a)){var l=a.wd(b),v;for(v in l)k[v]=l[v]}d=e.createNode(a.type(),k,d);h.push(d);if(0!=(a.nb&2))for(k=0;k<a.children.length;k++)c(a.pb(k),
d)}}var e=this,f=new Set,h=[];this.Og(a,function(a){null!==a.parent&&c(a,a.parent.id)});return h};c.prototype.hd=function(a,b,c){var d=this.Aa(a);if(null===d)throw Error("moveNode: "+a+" does not exist");var f=this.Aa(b);if(null===f)throw Error("moveNode: New parent "+b+" does not exist");-1===c&&(c=d.parent!==f?f.children.length:f.children.length-1);if(null===d.parent)throw Error("Expected a parent");f===d.parent&&c===d.parent.re(d)?Uh("moveNode: Skip moving to the same place"):this.wb.hd(a,b,c)};
c.prototype.Xd=function(a,b,c){var d=this;void 0===c&&(c=-1);this.Og(a,function(a){if(a.parent){var e=a.parent.id,f=a.parent.re(a);switch(b){case 0:d.hd(a.id,e,-1);break;case 1:d.hd(a.id,e,0);break;case 3:0<f&&d.hd(a.id,e,f-1);break;case 2:f<a.parent.children.length-1&&d.hd(a.id,e,f+1);break;case 4:d.hd(a.id,e,c)}}})};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a,b){void 0===b&&(b="");if(!(a instanceof Zc))return b+"NOT A NODE: "+a+"\n";for(var c=b+" "+
a+"\n",e=0;e<a.children.length;e++)c+=this.encode(a.pb(e),b+"  ");return c};c.prototype.wp=function(a){if(a instanceof Element)for(;a;){var b=a.getAttribute("nid");if(b&&(b=this.Aa(b))&&5===(b.nb&5))return b;a=a.parentElement}return null};c.prototype.gt=function(){this.ns(this.Gd,new H,null,0,0)};c.prototype.ns=function(a,b,c,e,f){if(a instanceof HTMLElement){var d=a.offsetLeft-a.scrollLeft,k=a.offsetTop-a.scrollTop;c===a.offsetParent&&(d-=e,k-=f);b=b.multiply(new pc(d,k));c=a.getAttribute("nid")||
"0";(c=this.Aa(c))&&Vc(c)&&(e=new G(0,0,c.da.offsetWidth,c.da.offsetHeight),e.transform(b),c.xk(e,b));for(c=a.firstElementChild;c;)this.ns(c,b,a.offsetParent,a.offsetLeft,a.offsetTop),c=c.nextElementSibling}};c.prototype.Hp=function(){return this.wb.Hp()};c.prototype.locked=function(){return this.wb.locked()};c.prototype.Lp=function(a){return this.wb.Lp(a)};c.prototype.qB=function(a){return Vc(a)?z(a.da).matches("[z-fixture] *"):!1};c.prototype.Wp=function(a){return Vc(a)&&a.da.hasAttribute("z-fixture")};
c.prototype.Vq=function(a){var b=this;if(this.Np){var c=new ih;this.Va.Qc(function(d){if(Tc(d)){var e=0;for(d=d.Jp();e<d.length;e++){var h=d[e],k=b.Aa(h.jg);if(k&&Tc(k)){var l=0,n=0;void 0!==h.Jn&&(a.y>k.rect.y&&(n=a.y-k.rect.y),0<h.Jn&&n+k.rect.height>h.Jn&&(n=h.Jn-k.rect.height));void 0!==h.In&&(a.x>k.rect.x&&(l=a.x-k.rect.x),0<h.In&&l+k.rect.width>h.In&&(l=h.In-k.rect.width));if(0<n||0<l)k.mn(l,n),c.add(k.id)}}}});this.Tw.mj(c).Qc(function(a){(a=b.Aa(a))&&Tc(a)&&a.mn(0,0)});this.Tw=c}};return c}();var wg=new (function(){function c(){this.log=u.create("serializer");this.Wr={pdf:"application/pdf",svg:"image/svg+xml",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp"}}c.prototype.Ih=function(a,b,c,e){if(a instanceof Array)b=this.Cu(a,b,c,e);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.zB(a,b,c,e);else if(0===a.indexOf("zwibbler3."))a=JSON.parse(a.substr(10)),b=this.Cu(a,b,c,e);else if(0===a.indexOf("zwibblerclip."))b=
new vg(!1,b,c,e),b.Vu(a,new H,"default"),b.setProperty("background",q.Be),1<b.hb()&&b.Yb([b.se(0).id]),b.an();else{try{yh(a);var d=!0}catch(h){d=!1}if(d)b=new vg(!0,b,c,e),b.wb.Eg(a);else throw Error("Format detection failed.");}}for(a=1;a<b.hb();a++)b.Ar(a,!1);return b};c.prototype.zB=function(a,b,c,e){function d(a){var b=new H;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Fa=a.dx;b.Ga=a.dy;return b}function h(a,b){switch(a.type){case "Node":var c=[];a=a.children;for(var e=a.length-1;0<=e;e--)try{c.push(h(a[e],
b+1))}catch(K){}return 0<b?l.group(c):"";case "PathNode":case "ArrowNode":var f=a;c=0;"arrowSize"in f&&(c=f.arrowSize,f=f.path);b=d(f.matrix);c={strokeStyle:f.strokeStyle,fillStyle:f.fillStyle,lineWidth:f.lineWidth,smoothness:f.smoothness,sloppiness:f.sloppiness,shadow:f.shadow,arrowSize:c,seed:Math.round(65535*Math.random())};"textNode"in f&&(a=f.textNode,c.fontSize=a.fontSize,c.fontName=a.fontName,c.text=a.text,c.textFillStyle="textFillStyle"in a?a.textFillStyle:a.fillStyle);"path"in f&&(f=f.path);
var k=f.startX,n=f.startY;a=f.closed;e=new L;f=f.segments;k=b.apply(k,n);e.moveTo(k.x,k.y);for(k=0;k<f.length;k++){var r=f[k];switch(r.type){case 1:n=b.apply(r.x,r.y);e.lineTo(n.x,n.y);break;case 2:n=b.apply(r.x,r.y);e.hj(n.x,n.y);break;case 3:n=b.apply(r.x1,r.y1);r=b.apply(r.x,r.y);e.Jg(n.x,n.y,r.x,r.y);break;default:throw"Unknown path segment type: "+r.type;}}a&&e.close();c.commands=e.vc();return l.createNode("PathNode",c);case "TextNode":return b=d(a.matrix),b=b.multiply(new pc(0,1.3*a.fontSize)),
l.createNode("TextNode",{fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:b});default:throw Error("Unknown node type: "+a.type);}}var k=u.create("IMPORT"),l=new vg(!1,b,c,e);try{var n=JSON.parse(a)}catch(r){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{n=JSON.parse(a)}catch(v){throw k("Couldn't parse file."),"Couldn't parse file.";}}k("Successfully parsed!");h(n,0);l.wa(!0);return l};c.prototype.Cu=function(a,b,c,e){function d(a,b){if(void 0!==a){var c=
{};for(f in a)if(a.hasOwnProperty(f)&&"children"!==f&&"parent"!==f&&"id"!==f&&"type"!==f)if("matrix"===f){var e=new H(a[f]);if(!e.isFinite()){w.log("Tried to load node a with malformed Matrix. Skipping.");return}c[f]=e}else"__type"===f?c.type=a[f]:c[f]=a[f];if(a.fixture)var f=a.fixture;else if("id"in a)f=a.id.toString(36);else return;"0"!==b||k||(b=r.Tl());0===a.id||v[a.id]||r.createNode(a.type,c,b,-1,f);if(void 0!==a.children)for(b=0;b<a.children.length;b++)d(a.children[b],f)}}a=JSON.parse(JSON.stringify(a));
for(var h={},k=!1,l=0,n=a;l<n.length;l++)if("PageNode"===n[l].type){k=!0;break}var r=new vg(k,b,c,e),v={};b=0;for(c=r.uj;b<c.length;b++)v[c[b].id]=!0;r.bb();for(b=0;b<a.length;b++){e=a[b];if("document"===e.type||0===e.id){delete e.type;for(var x in e)r.setProperty(x,e[x])}if("parent"in e){if(!(e.parent in h))throw Error("Error: child "+e.id+" references parent "+e.parent+" before it was defined.");c=h[e.parent];void 0!==c.children?c.children.push(e):c.children=[e]}"GroupNode"!==e.type&&"PageNode"!==
e.type||void 0!==e.children||(e.children=[]);h[e.fixture||e.id]=e}var w=this;d(h[0],"0");for(var y in h)y in v&&d(h[y],"");r.wa(!0);return r};c.prototype.Et=function(a){function b(a,d){var f=d.id in e,h={type:d.type()};f?h.fixture=d.id:h.id=parseInt(d.id,36);c.push(h);a&&(h.parent=a.id in e?a.id:parseInt(a.id,36));a=d.mb();for(var k in a)a.hasOwnProperty(k)&&(a[k]instanceof H?h[k]=a[k].vc():"inverse"!==k&&("type"===k?h.__type=a[k]:h[k]=a[k]));for(h=0;h<d.children.length;h++)b(d,d.pb(h))}for(var c=
[],e={},f=0,h=a.uj;f<h.length;f++){var k=h[f];e[k.id]=!0}b(null,a.getRootNode());f=0;for(a=a.uj;f<a.length;f++)k=a[f],b(null,k);return c};c.prototype.Wn=function(a,b,c){b in this.Wr&&(b=this.Wr[b]);if("list"===b){a=this.Et(a);var d="application/json"}else if("zwibbler3"===b)a=this.Et(a),a="zwibbler3."+JSON.stringify(a),d="application/octet-stream";else if("image/svg+xml"===b){d=a.fd();var f=new Jf(d);a.kf(f);a.la(f);a=f;d="image/svg+xml"}else if("application/pdf"===b){d=a.fd(0);f=new Gf(new G(0,0,
d.width,d.height),N.fonts);var h=a.fb;for(b=0;b<a.hb();b++)0<b&&(d=a.fd(b),f.Gi(d)),f.translate(-d.x,-d.y),a.Fc(b),a.kf(f),a.la(f);a.Fc(h);a=f;d="application/pdf"}else if(!(d="image/png"===b||"image/bmp"===b)&&(d="image/jpeg"==b)&&(d=document.createElement("canvas"),f=!1,d.width=10,d.height=10,"toDataURL"in d&&(f=0<d.toDataURL("image/jpeg").indexOf("jpeg")),Zb("JPEG supported: %s",f),d=f),d)f=document.createElement("canvas"),d=a.fd(),f.width=d.width,f.height=d.height,h=f.getContext("2d"),h.translate(-d.x,
-d.y),a.kf(h),a.la(h),a=jc(f,b,"data-uri"),a=a.split(",")[1],a=atob(a),d=b;else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===c)var k=a;else if("data-uri"===c)k="data:"+d+";base64,"+btoa(a);else{if("blob"===c){c=new Uint8Array(a.length);for(b=0;b<a.length;b++)c[b]=a.charCodeAt(b);k=new Blob([c],{type:d})}}else if(a.toBlob&&a.toString)"string"===c?k=a.toString():"data-uri"===c?k="data:"+d+";base64,"+btoa(a.toString()):"blob"===c&&(k=a.toBlob());else if("object"===c)k=a;else throw"Error in ZwibblerDocument.save()";
return k};return c}());var Vh=u.create("OPENTYPE");function Wh(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw console.log(Error(a)),Error(a);}
var Xh=function(){function c(a,b){this.code=a;this.we=b}c.prototype.toString=function(){return(255<this.code?"code=12 "+(this.code&255):""+this.code)+" "+JSON.stringify(this.we)};return c}(),Yh=function(){function c(a,b,c){void 0===b&&(b=0);void 0===c&&(c=a.length-b);this.Os=a;this.start=b;this.length=c;this.Ia=0}c.prototype.na=function(a){for(var b=0;a--;)b=256*b+this.Os[this.Ia++ +this.start];return b};c.prototype.getInt16=function(){var a=this.na(2);a&32768&&(a-=65536);return a};c.prototype.ci=
function(a,b){void 0===b&&(b=1);for(var c="",e=0;e<a;e+=b)c+=String.fromCharCode(this.na(b));return c};c.prototype.Ug=function(){return this.getInt16()/16384};c.prototype.seek=function(a){if(a>this.length)throw Error("Seek to invalid location");var b=this.Ia;this.Ia=a;return b};c.prototype.slice=function(a,b){void 0===b&&(b=this.length-a);return new c(this.Os,a+this.start,b)};c.prototype.Pp=function(){var a;void 0===a&&(a=this.Ia);this.seek(a);var b=this.na(2);if(0<b){var c=this.na(1);this.seek(a+
3+c*b);var e=this.na(c);this.seek(a+3+(b+1)*c-1+e)}return a};c.prototype.zp=function(a){this.seek(a);a=this.na(2);var b=this.na(1);if(4<b)throw Error("Error: This is not an index; offsetSize="+b);return a};c.prototype.Oj=function(a,b){this.seek(a);var c=this.na(2);if(b>=c)throw Error("Tried to read past end of index");var e=this.na(1);this.seek(a+3+e*b);b=this.na(e);var f=this.na(e);return this.slice(a+3+(c+1)*e-1+b,f-b)};c.prototype.$o=function(){return this.Ia>=this.length};c.prototype.eu=function(a,
b){void 0===a&&(a=!1);void 0===b&&(b=[]);for(b=new Xh(0,b);;){if(this.$o())throw Error("Unexpected end of charstring");var c=this.na(1);if(12===c)return b.code=3072|this.na(1),b;if(28>c||a&&29<=c&&31>=c)return b.code=c,b;if(30===c){var e="";a:for(;;){c=this.na(1);for(var f=4;0<=f;f-=4){var h=c>>f&15;switch(h){case 10:e+=".";break;case 11:e+="E";break;case 12:e+="E-";break;case 14:e+="-";break;case 15:break a;case 14:break;default:e+=h.toString()}}}b.we.push(parseFloat(e))}else 29===c?(e=this.na(1),
c=this.na(1),f=this.na(1),h=this.na(1),b.we.push(e<<24|c<<16|f<<8|h)):28===c?(e=this.na(1),c=this.na(1),b.we.push(e<<8|c)):a&&255===c?b.we.push(this.na(4)/65536):251<=c?(e=this.na(1),b.we.push(256*-(c-251)-e-108)):247<=c?(e=this.na(1),b.we.push(256*(c-247)+e+108)):b.we.push(c-139)}};return c}(),Zh=function(){function c(a){this.Br=[];var b=this.n=0;for(a=a.split(/([:\[\]\(\)\-\.{}]|\d+)|\s+/);b<a.length;b++){var c=a[b];c&&c.length&&this.Br.push(c)}}c.prototype.next=function(){return this.Br[this.n++]};
c.prototype.match=function(a){return this.Br[this.n]===a?(this.n+=1,!0):!1};c.prototype.value=function(a){var b=this.next(),c=parseFloat(b);return isNaN(c)?a[b]:c};c.prototype.sj=function(a){this.n=a;return!1};return c}();function $h(c,a,b,d){if(c.match("{")){for(b={};ai(c,a,b,d););c.match("}");return b}return bi(c,a,b,d)}
function ai(c,a,b,d){var e=c.n;if(c.match("push")){var f=ci(c,b);for(a=a.slice(f);ai(c,a,b,d););return c.match("pop")?!0:!1}f=c.next();return c.match(":")?(c=bi(c,a,b,d),"_"!==f&&(b[f]=c),!0):c.sj(e)}
function bi(c,a,b,d){var e=c.n;if(c.match("[")){var f=ci(c,b),h="",k=[];c.match(".")&&(h=c.next(),k={});if(!c.match("]"))return c.sj(e);e=c.n;for(var l=0;l<f;l++){c.n=e;var n=$h(c,a,b,d);""===h?k.push(n):k[n[h]]=n}0===f&&$h(c,a,b,!0);return k}if(c.match("("))return b=ci(c,b),c.match(")"),b;if(c.match("uint"))return b=c.value(b)/8,d?0:a.na(b);if(c.match("int"))return c.next(),d?0:a.getInt16();if(c.match("offset"))return a.Ia;if(c.match("date"))return c=1E3*(4294967296*a.na(4)+a.na(4))+Date.UTC(1904,
1,1),new Date(c);if(c.match("fixed"))return d?0:a.na(4)/65536;if(c.match("string")){if(!c.match("("))return c.sj(e);b=ci(c,b);return c.match(")")?d?0:a.ci(b):c.sj(e)}return c.sj(e)}function ci(c,a){var b=c.value(a);c.match("-")?b-=c.value(a):c.match(":")&&(c=c.value(a),b=b>>c&1);return b}function di(c,a){return $h(new Zh(a),c,null,!1)}
var fi=function(){function c(){this.fonts=[]}c.prototype.add=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return[4,fetch(a)];case 1:return b=d.sent(),[4,b.arrayBuffer()];case 2:return c=d.sent(),[2,this.kC(new Uint8Array(c))]}})})};c.prototype.KC=function(){this.fonts.length=0};c.prototype.get=function(a){for(var b=0,c=this.fonts;b<c.length;b++){var e=c[b];if(e.mf===a||e.fontFamily===a)return e}return null};c.prototype.kC=
function(a){a=new Yh(a);var b=a.na(4);a.seek(0);a=1953784678===b?this.Mx(a):[new ei(a)];b=0;a:for(;b<a.length;b++){for(var c=a[b],e=0,f=this.fonts;e<f.length;e++)if(f[e].mf===c.mf){Vh("Not adding %s; already have it.");continue a}Vh("Opened font: %s weight=%s italic=%s",c.mf,c.weight,c.Qj);console.log(c);this.fonts.push(c)}return a};c.prototype.Mx=function(a){var b=di(a,"{\n    ttcTag:string(4)\n    majorVersion:uint16\n    minorVersion:uint16\n    numFonts:uint32\n    offsetTable:[numFonts] uint32\n}");
Vh(JSON.stringify(b,null,2));Vh("Collection contains %s fonts",b.numFonts);var c=[],e=0;for(b=b.offsetTable;e<b.length;e++)c.push(new ei(a,b[e]));return c};return c}(),ei=function(){function c(a,b){void 0===b&&(b=0);this.Ha=a;this.Rd={};this.mf=this.fontFamily="";this.weight=0;this.bold=this.Qj=!1;this.vl=[];this.Ao=null;this.aq=[];a.seek(b);this.ue=di(a,"{  \n    scalarType:uint32\n    numTables:uint16\n    searchRange:uint16\n    entrySelector:uint16\n    rangeShift:uint16\n    tables:[numTables.tag] {\n        tag:string(4)\n        checksum:uint32\n        offset:uint32\n        length:uint32\n    }\n}");
Vh(JSON.stringify(this.ue,null,2));for(var c in this.ue.tables)Vh("Table: %s",c);this.Xf("head","{\n    version:fixed\n    fontRevision:fixed\n    checksumAdjustment:uint32\n    magicNumber:uint32\n    flags:uint16\n    unitsPerEm:uint16\n    created:date\n    modified:date\n    xMin:int16\n    yMmin:int16\n    xMax:int16\n    yMax:int16\n    macStyle:uint16\n    lowestRectPPEM:uint16\n    fontDirectionHint:uint16\n    indexToLocFormat:uint16\n    glyphDataFormat:uint16\n\n    bold:(macStyle:0)\n    italic:(macStyle:1)\n}");
this.Xf("name","{\n    offset:offset\n    format:uint16\n    count:uint16\n    stringOffset:uint16\n    names:[count] {\n        platformID:uint16\n        platformSpecificID:uint16\n        languageID:uint16\n        nameID:uint16\n        length:uint16\n        offset:uint16\n    }\n}");this.Xf("cmap","{\n    offset:offset\n    version:uint16\n    numberSubtables:uint16\n    subTables:[numberSubtables] {\n        platformID:uint16\n        platformSpecificID:uint16\n        offset:uint32\n    }\n}");
this.Xf("hhea","{\n    version:fixed\n    ascent:int16\n    descent:int16\n    lineGap:int16\n    advanceWidthMax:uint16\n    minLeftSideBearing:int16\n    minRightSideBearing:int16\n    xMaxExtent:int16\n    caretSlopeRise:int16\n    caretSlopeRun:uint16\n    caretOffset:int16\n    reserved:uint64\n    metricDataFormat:int16\n    numOfLongHorMetrics:uint16\n}");this.Xf("kern","{\n    version:uint16\n    nTables:uint16\n    tables:[nTables] {\n        version:uint16\n        length:uint16\n        coverage:uint16\n        offset:offset\n        _:[length-6] uint8\n    }\n}");
this.Xf("maxp","{\n    version:fixed\n    numGlyphs:uint16\n}");this.Xf("OS/2","{\n    version:uint16\n    xAvgCharWidth:int16\n    usWeightClass:uint16\n    usWidthClass:uint16\n}");this.Xf("CFF ","{\n    offset:offset\n    major:uint8\n    minor:uint8\n}");this.uC(a,this.Rd.name);this.pC(a,this.Rd.cmap);this.sC(a);this.tC(a,this.Rd.kern);this.Qj=!!this.Rd.head.italic;this.bold=!!this.Rd.head.bold;this.weight=this.Rd["OS/2"].usWeightClass;"CFF "in this.Rd&&(this.Ao=new gi(a.slice(this.Rd["CFF "].offset)))}
c.prototype.Xf=function(a,b){a in this.ue.tables&&(Vh("Decoding %s",a),this.Ha.seek(this.ue.tables[a].offset),this.Rd[a]=di(this.Ha,b),Vh(a+" table:",JSON.stringify(this.Rd[a],null,2)))};c.prototype.uC=function(a,b){for(var c=0,e=b.names;c<e.length;c++){var f=e[c];a.seek(b.offset+b.stringOffset+f.offset);var h=0===f.platformID||3===f.platformID?a.ci(f.length,2):a.ci(f.length);switch(f.nameID){case 1:this.fontFamily=h;break;case 4:this.mf=h}}};c.prototype.pC=function(a,b){for(var c=0,e=b.subTables;c<
e.length;c++){var f=e[c],h=f.platformID,k=f.platformSpecificID;f=b.offset+f.offset;a.seek(f);var l=a.na(2),n=a.na(2);Vh("CMAP platform "+h+" "+k+" format "+l+" length "+n+" at "+f);switch(l){case 0:this.vl.push(new hi(a.slice(f,n)));break;case 4:this.vl.push(new ii(a.slice(f,n)))}}};c.prototype.sC=function(a){var b=this.ue.tables.GPOS;b&&this.aq.push(new ji(a.slice(b.offset,b.length)))};c.prototype.tC=function(a,b){if(b){var c=0;for(b=b.tables;c<b.length;c++){var e=b[c];0===e.coverage>>8&&(Vh("Format 0 kern table detected"),
this.aq.push(new ki(a.slice(e.offset,e.length))))}}};c.prototype.transform=function(a,b){b=this.vb(b);a.scale(b,-b)};c.prototype.Wo=function(a,b,c,e){if(this.Ao)this.Ao.Wo(a,b,c,e);else if(b=this.Qv(b),null!==b)for(var d=0,h=0,k=0,l=0,n;h<b.oa.length;h++){var r=b.oa[h];0===d?(a.moveTo(r.x+c,r.y+e),d=1):1===d?r.pi?a.lineTo(r.x+c,r.y+e):d=2:(n=b.oa[h-1],r.pi?(a.quadraticCurveTo(n.x+c,n.y+e,r.x+c,r.y+e),d=1):a.quadraticCurveTo(n.x+c,n.y+e,(n.x+r.x)/2+c,(n.y+r.y)/2+e));h===b.ff[k]&&(2===d&&(n=r,r=b.oa[l],
r.pi?a.quadraticCurveTo(n.x+c,n.y+e,r.x+c,r.y+e):a.quadraticCurveTo(n.x+c,n.y+e,(n.x+r.x)/2+c,(n.y+r.y)/2+e)),l=h+1,k+=1,d=0)}};c.prototype.Qv=function(a){var b=this.rA(a);a=this.Ha;var c=this.ue.tables.glyf;if(0===b||b>=c.offset+c.length)return null;Wh(b>=c.offset);Wh(b<c.offset+c.length);a.seek(b);b={ff:[],ek:a.getInt16(),oa:[],MF:a.getInt16(),OF:a.getInt16(),LF:a.getInt16(),NF:a.getInt16()};Wh(-1<=b.ek);-1===b.ek?this.DC(a,b):this.FC(a,b);return b};c.prototype.rA=function(a){Wh("loca"in this.ue.tables);
var b=this.ue.tables.loca,c=this.Ha;if(1===this.Rd.head.indexToLocFormat){b=c.seek(b.offset+4*a);a=c.na(4);var e=c.na(4)}else b=c.seek(b.offset+2*a),a=2*c.na(2),e=2*c.na(2);c.seek(b);return a===e?0:a+this.ue.tables.glyf.offset};c.prototype.DC=function(a,b){var c,e,f=32;b.ff=[];for(b.oa=[];f&32;){f=a.na(2);var h=a.na(2);var k=1;var l=c=0;var n=1;var r=e=0;if(f&1){var v=a.getInt16();var x=a.getInt16()}else v=a.na(1),x=a.na(1);f&2&&(e=v,r=x);f&8?n=k=a.Ug():f&64?(k=a.Ug(),n=a.Ug()):f&128&&(k=a.Ug(),c=
a.Ug(),l=a.Ug(),n=a.Ug());v=a.Ia;if(h=this.Qv(h)){var w=b.oa.length;for(x=0;x<h.ff.length;x++)b.ff.push(h.ff[x]+w);for(x=0;x<h.oa.length;x++){w=h.oa[x].x;var y=h.oa[x].y;w=k*w+c*y+e;y=l*w+n*y+r;b.oa.push({x:w,y:y,pi:h.oa[x].pi})}}a.seek(v)}b.ek=b.ff.length;f&256&&a.seek(a.na(2)+a.Ia)};c.prototype.FC=function(a,b){function c(b,c,d){for(var f=0,l=0;l<h;l++){var n=k[l];n&c?f=n&d?f+a.na(1):f-a.na(1):~n&d&&(f+=a.getInt16());e[l][b]=f}}b.ff=[];for(var e=b.oa=[],f=0;f<b.ek;f++)b.ff.push(a.na(2));a.seek(a.na(2)+
a.Ia);if(0!==b.ek){var h=Math.max.apply(null,b.ff)+1,k=[];for(f=0;f<h;f++)if(b=a.na(1),k.push(b),e.push({x:0,y:0,pi:0<(b&1)}),b&8){var l=a.na(1);Wh(0<l);for(f+=l;l--;)k.push(b),e.push({x:0,y:0,pi:0<(b&1)})}c("x",2,16);c("y",4,32)}};c.prototype.vb=function(a){return a/this.Rd.head.unitsPerEm};c.prototype.xA=function(a){Wh("hmtx"in this.ue.tables);var b=this.Ha,c=this.ue.tables.hmtx.offset;b.seek(c+4);var e=this.Rd.hhea.numOfLongHorMetrics;if(a<e){var f=this.Ha.seek(c+4*a);var h=b.na(2)}else f=b.seek(c+
4*(e-1)),h=b.na(2),b.seek(c+4*e+2*(a-e));a=b.getInt16();b.seek(f);return{Ks:h,wB:a}};c.prototype.qA=function(a){for(var b=0,c=this.vl.length-1;0<=c&&!(b=this.vl[c].map(a));c--);return b};c.prototype.rz=function(a,b,c,e,f){a.save();a.translate(c,e);this.transform(a,f);f=[];for(c=0;c<b.length;c++)f.push(new li(this.qA(b.charCodeAt(c))));c=0;for(e=this.aq;c<e.length;c++)e[c].Rj(f);for(var d=e=c=0;d<f.length;d++){var k=f[d],l=this.xA(k.te);Vh("Metrics for %s code %s index %s: %s %s",b.charAt(d),b.charCodeAt(d),
k.te,l.Ks,l.wB);this.Wo(a,k.te,c+k.vi.x,e+k.vi.y);c+=l.Ks+k.advance.x;e+=k.advance.y}a.restore()};return c}(),hi=function(){function c(a){this.Ha=a}c.prototype.map=function(a){return 0<=a&&255>=a?(this.Ha.seek(a+6),Vh("charCode %s maps to %s",a,this.Ha.na(1)),this.Ha.seek(a+6),this.Ha.na(1)):0};return c}(),ii=function(){function c(a){this.Ha=a;a.seek(6);this.Bi=a.na(2)/2}c.prototype.map=function(a){var b=this;Vh("Try to map charcode %s using %s ranges",a,this.Bi);var c=this.Ha,e=0,f=0,h=mi(this.Bi-
1,function(d){c.seek(14+2*d);var f=c.na(2);c.seek(2*b.Bi+16+2*d);e=c.na(2);return a<e?-1:a>f?1:0});if(0<=h){c.seek(6*this.Bi+16+2*h);f=c.na(2);c.seek(4*this.Bi+16+2*h);var k=c.getInt16();0===f?f=k+a&65535:(c.seek(6*this.Bi+16+2*h+(2*(a-e)+f)),f=c.na(2),0!==f&&(f=f+k&65535))}return f};return c}();function mi(c,a){for(var b=-1,d;1<c-b;){d=c+b>>1;var e=a(d);if(0==e)return d;0<e?b=d:c=d}return-1}
var gi=function(){function c(a){this.Ha=a;this.fp=null;this.ep=[];var b=a.na(1),c=a.na(1),e=a.na(1);Vh("CFF Version "+b+"."+c);a.seek(e);a.Pp();this.hz=a.Pp();this.dE=a.Pp();this.gE=a.Ia;b=this.Cr=this.Pv(a.Oj(this.hz,0));this.TB=a.zp(b.CharStrings);Vh("CFF Font contains "+this.TB+" glyphs");this.Cr.FDSelect?(this.fp=new ni(a.slice(b.FDSelect)),this.EC(a,b)):this.ep.push(b)}c.prototype.Pv=function(a){a=oi(a,{},this);if(a.Private){var b=a.Private[1];oi(this.Ha.slice(b,a.Private[0]),a,this);a.Subrs&&
(a.Subrs+=b)}return a};c.prototype.ci=function(a){if(a<pi.length)return pi[a];a=this.Ha.Oj(this.dE,a-pi.length);return a.ci(a.length)};c.prototype.EC=function(a,b){b=b.FDArray;var c=a.zp(b);Vh("There are %s items in FDArray",c);for(var e=0;e<c;e++)this.ep.push(this.Pv(a.Oj(b,e)))};c.prototype.lu=function(a,b){void 0===b&&(b=-1);if(-1===b){b=this.gE;var c=this.Cr.CharstringType}else c=this.ep[b],b=c.Subrs,c=c.CharstringType;var e=this.Ha.zp(b);return this.Ha.Oj(b,a+(0===c?0:1240>e?107:33900>e?1131:
32768))};c.prototype.pA=function(a){return this.fp?this.fp.Tj(a):0};c.prototype.Wo=function(a,b,c,e){a.translate(c,e);var d=this.Cr.CharStrings,h=this.pA(b);qi(this.Ha.Oj(d,b),a,h,this);a.translate(-c,-e)};return c}(),ri=0,si=1,U=2,ti=3,ui={};function W(c,a,b,d){var e=b instanceof Array;ui[a]={name:c,lt:d,type:e?b:[b],fn:function(a,d){a[c]=e||b===ti?d:d[0]}}}W("version",0,ri);W("Notice",1,ri);W("Copyright",12,ri);W("FullName",2,ri);W("FamilyName",3,ri);W("Weight",4,ri);W("isFixedPitch",3073,si,!1);
W("ItalicAngle",3074,U,0);W("UnderlinePosition",3075,U,-100);W("UnderlineThickness",3076,U,50);W("PaintType",3077,U,0);W("CharstringType",3078,U,2);W("FontMatrix",3079,ti,[.001,0,0,.001,0,0]);W("UniqueID",13,U);W("FontBBox",5,ti,[0,0,0,0]);W("StrokeWidth",3080,U,0);W("XUID",14,ti);W("charset",15,U,0);W("Encoding",16,U,0);W("CharStrings",17,U,0);W("Private",18,[U,U]);W("SyntheticBase",3092,U);W("PostSCript",3093,ri);W("BaseFontName",3094,ri);W("BaseFontBlend",3095,ri);W("ROS",3102,[ri,ri]);
W("CIDFontVersion",3103,U,0);W("CIDFontRevision",3104,U,0);W("CIDFontType",3105,U,0);W("CIDCount",3106,U);W("FDArray",3108,U);W("FDSelect",3109,U);W("FontName",3110,ri);W("BlueValues",6,U);W("OtherBlues",7,U);W("FamilyBlues",8,U);W("FamilyOtherBlues",9,U);W("BlueScale",3081,U,.039625);W("BlueShift",3082,8);W("BlueFuzz",3073,1);W("StdHW",10,U);W("StdVW",11,U);W("StemSnapH",3084,U);W("StemSnapV",3085,U);W("ForceBold",3086,si,!1);W("LanguageGroup",3089,U,0);W("ExpansionFactor",3090,U,.6);
W("initialRandomSeed",3091,U,0);W("Subrs",19,U);W("defaultWidthX",20,U);W("NominalWidthX",21,U);
function oi(c,a,b){for(;!c.$o();){var d=c.eu();if(d.code in ui){var e=ui[d.code],f=[],h=0;a:for(;h<e.type.length;h++){var k=e.type[h];if(h>=d.we.length)throw Error("Not enough operands for instruction:"+d);var l=d.we[h];switch(k){case ri:f.push(b.ci(l));break;case si:f.push(!!l);break;case ti:f=d.we;break a;case U:f.push(l)}}e.fn(a,f)}else Vh("Uknown dict opcode: %s",d.code)}for(var n in ui)e=ui[n],!e.lt||e.name in a||(a[e.name]=e.lt);return a}
function qi(c,a,b,d,e){for(e=e||{first:!0,width:0,dk:0,stack:[],x:0,y:0,Ah:!1,sb:0,tb:0};!c.$o();){switch(c.eu(!0,e.stack).code){case 1:case 3:e.stack.length&1&&vi(e);break;case 4:1<e.stack.length&&vi(e);e.y+=e.stack[0];wi(e,a);break;case 5:for(var f=0;f+1<e.stack.length;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);break;case 6:for(f=0;f<e.stack.length;f+=2)e.x+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.y+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 7:for(f=0;f<e.stack.length;f+=
2)e.y+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.x+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 8:xi(e,a);break;case 10:qi(d.lu(e.stack.pop(),b),a,b,d,e);continue;case 11:return;case 14:e.stack.length&&vi(e);e.Ah&&a.lineTo(e.sb,e.tb);break;case 18:case 23:e.stack.length&1&&vi(e);e.dk+=e.stack.length>>1;break;case 19:case 20:e.stack.length&1&&vi(e);e.dk+=e.stack.length>>1;f=e.dk+7>>3;for(var h=0;h<f;h++)c.na(1);break;case 21:e.stack.length&1&&vi(e);e.x+=e.stack[0];e.y+=e.stack[1];wi(e,a);
break;case 22:2===e.stack.length&&vi(e);e.x+=e.stack[0];wi(e,a);break;case 24:xi(e,a);e.y+=e.stack.pop();e.x+=e.stack.pop();a.lineTo(e.x,e.y);break;case 25:for(f=0;f<e.stack.length-6;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);xi(e,a,f);break;case 26:var k=e.stack.length&1;k&&(e.x+=e.stack[0]);for(;k<e.stack.length;k+=4){f=e.x;h=e.y+=e.stack[k+0];var l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],r=e.x,v=e.y+=e.stack[k+3];a.bezierCurveTo(f,h,l,n,r,v)}break;case 27:if(k=e.stack.length&1)e.y+=
e.stack[0];for(;k<e.stack.length;k+=4)f=e.x+=e.stack[k+0],h=e.y,l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],r=e.x+=e.stack[k+3],v=e.y,a.bezierCurveTo(f,h,l,n,r,v);break;case 29:qi(d.lu(e.stack.pop(),-1),a,b,d,e);continue;case 30:yi(e,!1,a);break;case 31:yi(e,!0,a);break;case 3075:case 3076:case 3077:case 3081:case 3082:case 3083:case 3084:case 3086:case 3087:case 3090:case 3092:case 3093:case 3094:case 3095:case 3096:case 3098:case 3099:case 3100:case 3101:case 3102:case 3106:case 3107:case 3108:case 3109:throw Error("Not implemented.");
}e.stack.length=0}}function wi(c,a){c.Ah&&a.lineTo(c.sb,c.tb);c.sb=c.x;c.tb=c.y;c.Ah=!0;a.moveTo(c.x,c.y)}function xi(c,a,b){for(void 0===b&&(b=0);b+5<c.stack.length;b+=6){var d=c.x+=c.stack[b+0],e=c.y+=c.stack[b+1],f=c.x+=c.stack[b+2],h=c.y+=c.stack[b+3],k=c.x+=c.stack[b+4],l=c.y+=c.stack[b+5];a.bezierCurveTo(d,e,f,h,k,l)}}
function yi(c,a,b){for(var d=0;d+1<c.stack.length;d+=4){var e=d==c.stack.length-5;if(a){var f=c.x+=c.stack[d+0],h=c.y,k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=e?c.x+=c.stack[d+4]:c.x;e=c.y+=c.stack[d+3]}else f=c.x,h=c.y+=c.stack[d+0],k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=c.x+=c.stack[d+3],e=e?c.y+=c.stack[d+4]:c.y;b.bezierCurveTo(f,h,k,l,n,e);a=!a}}function vi(c){c.first?(c.width=c.stack.shift(),c.first=!1):(Vh("Warning; already have width"),c.stack.shift())}
var ni=function(){function c(a){this.Ha=a;this.dv=0;this.format=a.na(1);Vh("Reading FDSelect format %s",this.format);if(3!==this.format&&0!==this.format)throw Error("Can't read format "+this.format+" FDSelect");3===this.format&&(this.dv=a.na(2))}c.prototype.Tj=function(a){var b=this;if(0===this.format)return this.Ha.seek(1+a),this.Ha.na(1);var c=-1;mi(this.dv,function(d){b.Ha.seek(3+3*d);d=b.Ha.na(2);c=b.Ha.na(1);var e=b.Ha.na(2);return a<d?-1:a>=e?1:0});return c};return c}(),pi=".notdef space exclam quotedbl numbersign dollar percent ampersand quoteright \nparenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven \neight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U\nV W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k \nl m n o p q r s t u v w x y z braceleft bar braceright asciitilde exclamdown cent sterling fraction\nyen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi\nfl endash dagger daggerdbl periodcentered paragraph bullet quotesinglbase quotedblbase quotedblright\nguillemotright ellipsis perthousand questiondown grave acute circumflex tilde macron breve dotaccent \ndieresis ring cedilla hungarumlaut ogonek caron emdash AE ordfeminine Lslash Oslash OE ordmasculine \nae dotlessi lslash oslash oe germandbls onesuperior logicalnot mu trademark Eth onehalf plusminus \nThorn onequarter divide brokenbar degree thorn threequarters twosuperior registered minus eth \nmultiply threesuperior copyright Aacute Acircumflex Adieresis Agrave Aring Atilde Ccedilla Eacute \nEcircumflex Edieresis Egrave Iacute Icircumflex Idieresis Igrave Ntilde Oacute Ocircumflex \nOdieresis Ograve Otilde Scaron Uacute Ucircumflex Udieresis Ugrave Yacute Ydieresis Zcaron aacute \nacircumflex adieresis agrave aring atilde ccedilla eacute ecircumflex edieresis egrave iacute \nicircumflex idieresis igrave ntilde oacute ocircumflex odieresis ograve otilde scaron uacute \nucircumflex udieresis ugrave yacute ydieresis zcaron exclamsmall Hungarumlautsmall dollaroldstyle \ndollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader \nonedotenleader zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle \nsixoldstyle sevenoldstyle eightoldstyle nineoldstyle commasuperior threequartersemdash \nperiodsuperior questionsmall asuperior bsuperior centsuperior dsuperior esuperior isuperior \nlsuperior msuperior nsuperior osuperior rsuperior ssuperior tsuperior ff ffi ffl parenleftinferior \nparenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall \nFsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall \nTsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall \nexclamdownsmall centoldstyle Lslashsmall Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall \nDotaccentsmall Macronsmall figuredash hypheninferior Ogoneksmall Ringsmall Cedillasmall \nquestiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds zerosuperior \nfoursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior \noneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior \neightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall \nAacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall \nEacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall \nEthsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall \nOslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall \nYdieresissmall 001.000 001.001 001.002 001.003 Black Bold Book Light Medium Regular Roman Semibold".split(/\s+/);
function li(c){this.te=c;this.vi={x:0,y:0};this.advance={x:0,y:0}}
var ji=function(){function c(a){this.po=[];this.wu=di(a,"{\n    majorVersion:uint16\n    minorVersion:uint16\n    scriptListOffset:uint16\n    featureListOffset:uint16\n    lookupListOffset:uint16\n    featureVariationsOffset:uint16\n\n    push scriptListOffset\n    scriptCount:uint16\n    scriptRecords:[scriptCount] {\n        tag:string(4)\n        scriptOffset:uint16\n        push scriptOffset\n        defaultLangSys:uint16\n        langSysCount:uint16\n        langSysRecords:[langSysCount] {\n            langSysTag:string(4)\n            langSysOffset:uint16\n            push langSysOffset\n            lookupOrder:uint16\n            requiredFeatureIndex:uint16\n            featureIndexCount:uint16\n            featureIndices:[featureIndexCount] uint16\n            pop\n        }\n        pop\n    }\n    pop\n\n    push lookupListOffset\n    lookupCount:uint16\n    lookups:[lookupCount] {\n        offset:uint16\n        push offset\n        lookupType:uint16\n        lookupFlag:uint16\n        subTableCount:uint16\n        subTables:[subTableCount] {\n            offset:uint16\n            push offset\n            posFormat:uint16\n            coverageOffset:uint16\n        }\n        pop\n    }\n    pop\n\n    push featureListOffset\n    featureCount:uint16\n    featureRecords[featureCount] {\n        featureTag:string(4)\n        featureOffset:uint16\n        push featureOffset\n        featureParams:uint16\n        lookupIndexCount:uint16\n        lookupListIndicies:[lookupIndexCount] uint16\n        pop\n    }\n    pop\n}");for(var b=
this.wu.lookupListOffset,c=0,e=this.wu.lookups;c<e.length;c++){var f=e[c],h=b+f.offset,k=f.lookupType;Vh("Lookup type %s has %s subtables",k,f.subTables.length);var l=0;for(f=f.subTables;l<f.length;l++){var n=f[l],r=h+n.offset;2===k&&1===n.posFormat?this.po.push(new zi(a.slice(r))):2===k&&2===n.posFormat&&this.po.push(new Ai(a.slice(r)))}}}c.prototype.Rj=function(a){for(var b=0,c=this.po;b<c.length;b++)c[b].Rj(a)};return c}(),Bi=function(){function c(a){this.Ha=a;this.pm=4;this.format=a.na(2);this.count=
a.na(2);Vh("CoverageTable format %s count %s",this.format,this.count)}c.prototype.pp=function(a){var b=this,c=-1;1===this.format?mi(this.count,function(d){b.Ha.seek(b.pm+2*d);d=b.Ha.na(2);if(a<d)return-1;if(a>d)return 1;c=d;return 0}):mi(this.count,function(d){b.Ha.seek(b.pm+6*d);d=b.Ha.na(2);b.Ha.na(2);var e=b.Ha.na(2);if(a<d)return-1;if(a>d)return 1;c=e+a-d;return 0});return c};return c}(),Ci=function(c){function a(a){var b=c.call(this,a)||this;b.Gw=0;1===b.format&&(b.Gw=b.count,b.count=a.na(2),
b.pm+=2);return b}__extends(a,c);a.prototype.Yt=function(a){return Math.max(0,this.pp(a-this.Gw))};return a}(Bi);function Di(c,a,b){b&1&&(a.vi.x=c.getInt16());b&2&&(a.vi.y=c.getInt16());b&4&&(a.advance.x=c.getInt16());b&8&&(a.advance.y=c.getInt16());b&16&&c.getInt16();b&32&&c.getInt16();b&64&&c.getInt16();b&128&&c.getInt16()}
var Ei=function(){function c(){}c.prototype.Rj=function(a){for(var b=0;b<a.length-1;b++)this.Tj(a[b],a[b+1])};return c}(),zi=function(c){function a(a){var b=c.call(this)||this;b.Ha=a;a.na(2);var e=a.na(2);b.Ko=new Bi(a.slice(e));b.Mk=a.na(2);b.Nk=a.na(2);b.count=a.na(2);b.HC=2*Fi(b.Mk)+2*Fi(b.Nk)+2;return b}__extends(a,c);a.prototype.Tj=function(a,c){var b=this,d=this.Ko.pp(a.te);if(-1===d)return 0;this.Ha.seek(10+2*d);this.Ha.seek(this.Ha.na(2));var h=this.Ha.Ia;d=this.Ha.na(2);return 0<=mi(d,function(d){b.Ha.seek(h+
d*b.HC);d=b.Ha.na(2);if(d<c.te)return-1;if(d>c.te)return 1;Di(b.Ha,a,b.Mk);Di(b.Ha,c,b.Nk);return 0})?1:0};return a}(Ei),Ai=function(c){function a(a){var b=c.call(this)||this;b.Ha=a;a.na(2);b.Ko=new Bi(a.slice(a.na(2)));b.Mk=a.na(2);b.Nk=a.na(2);b.vy=new Ci(a.slice(a.na(2)));b.wy=new Ci(a.slice(a.na(2)));b.oF=a.na(2);b.uy=a.na(2);b.Sv=2*Fi(b.Mk)+2*Fi(b.Nk);return b}__extends(a,c);a.prototype.Tj=function(a,c){if(-1===this.Ko.pp(a.te))return 0;var b=this.vy.Yt(a.te),d=this.wy.Yt(c.te);this.Ha.seek(16+
b*this.Sv*this.uy+d*this.Sv);Di(this.Ha,a,this.Mk);Di(this.Ha,c,this.Nk);return 1};return a}(Ei),ki=function(c){function a(a,d){void 0===d&&(d=a.na(2));var b=c.call(this)||this;b.Ha=a;b.count=d;Vh("Kern table has %s entries",b.count);return b}__extends(a,c);a.prototype.Tj=function(a,c){var b=this,d=a.te<<16|c.te,h=0;mi(this.count,function(a){b.Ha.seek(8+6*a);a=b.Ha.na(4);if(d<a)return-1;if(d>a)return 1;a=b.Ha.getInt16();c.vi.x+=a;c.advance.x+=a;h=1;return 0});return h};return a}(Ei);
function Fi(c){c-=c>>1&1431655765;c=(c&858993459)+(c>>2&858993459);return 16843009*(c+(c>>4)&252645135)>>24};var Hh=C.Zc("CanvasRenderingContext2D",{beginPath:C.Function}),Gi=C.Zc("TextOptions",{text:C.String,width:C.Sa,height:C.Sa,font:C.Qb,valign:C.cb(C.kb(C.ud("top"),C.ud("bottom"),C.ud("middle"))),halign:C.cb(C.kb(C.ud("left"),C.ud("right"),C.ud("centre"),C.ud("center"))),textDecoration:C.Qb});
"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new S(d,c,{});d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Z=function(){function c(){this.gi=[];this.buttons=[];this.Al={};this.fonts=new fi;this.Ee={};this.kt=[];this.NODEJS_INSTANCE="#nodejs-instance";this.log=u.create("ZWIBBLER");this.WebSocket=WebSocket;this.cc=new Ya;this.controllers={};this.fx=S}c.prototype.create=function(a,b,c){void 0===c&&(c={});"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);if(a!==this.NODEJS_INSTANCE){var d=z.tc(a);if(!d)throw alert("Zwibbler.create: Cannot find an element with id "+a),Error("Error in Zwibbler.create");
}else d=document.createElement("div");return new S(d,b,c)};c.prototype.Gx=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);return!0};c.prototype.Ix=function(a,b){this.Al[a]=b};c.prototype.qx=function(a,b){void 0===b&&(b={});return this.Rn(a,b)};c.prototype.Rn=function(a,b){void 0===b&&(b={});return Dd(a,b)};c.prototype.Wy=function(a,b){return this.th(a,b)};c.prototype.Cb=function(a,b){O.Cb(a,
function(a,c,f,h){b(new Ze(O,a,c,f,h))})};c.prototype.getContext=function(a){for(;a;){if(a.ZWIBBLER_CONTEXT)return a.ZWIBBLER_CONTEXT;if("ZWIBBLER"===a.tagName||a.getAttribute("zwibbler")){if(a=a.querySelector("[z-canvas]"))return a.ZWIBBLER_CONTEXT;break}a=a.parentElement}return null};c.prototype.th=function(a,b,c){function d(){var a=y.fd(),b=1,d=0,e=0;l&&(a.y=l);v&&(a.height=v-a.y);n&&(a.x=n);r&&(a.width=r-a.x);h&&k?b=Math.min(h/a.width,k/a.height):h?(b=h/a.width,k=a.height*b):k?(b=k/a.height,h=
a.width*b):(h=a.width,k=a.height);a.width*b<h&&(d=h/2-a.width*b/2);a.height*b<k&&(e=k/2-a.height*b/2);d-=a.x*b;e-=a.y*b;x.width=Math.ceil(h);x.height=Math.ceil(k);w.translate(d,e);w.scale(b,b);y.la(w);f.log("Drawn.");c(x)}var f=this;void 0===b&&(b={});void 0===c&&(c=function(){});var h=b.width||0,k=b.height||0,l=b.top||0,n=b.left||0,r=b.right||0,v=b.bottom||0,x=cc(null),w=x.getContext("2d"),y=wg.Ih(a,null,{},[]);if(!y)throw Error("Zwibbler.render: Could not open document");var A=new Oe;y.format(w,
A);A.pa("reformat",function(a){y.gg(a)});A.vm()?A.pa("done",function(){y.format(w,A);d()}):d();return x};c.prototype.save=function(a,b,c){if(2===arguments.length&&"object"===typeof b){C.ga("Zwibbler.save()",arguments,C.String,Tg);var d=b;var f=d.format||"zwibbler3"}else C.ga("Zwibbler.save()",arguments,C.String,C.String,C.cb(Tg)),d=c||{},f=b||d.format||"zwibbler3";return new Promise(function(b,c){var e=wg.Ih(a,null,{},[]);if(e){e.Zg("background")||e.setProperty("background","white");var h=cc(null).getContext("2d"),
k=new Oe;k.pa("reformat",function(a){e.gg(a)});var v=function(){try{e.format(h,k);d.page&&e.Fc(d.page);var a=wg.Wn(e,f,d.encoding||"string");b(a)}catch(w){c(w)}};k.pa("done",v);e.format(h,k);k.vm()||v()}else c(Error("Failed to open document"))})};c.prototype.hb=function(a){a=wg.Ih(a,null,{},[]);if(!a)throw Error("Failed to open document");return a.hb()};c.prototype.qC=function(a){a=q.lf(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.BB=function(a){return(new q(q.RGBA,
[a.r,a.g,a.b,a.a])).toString()};c.prototype.Sz=function(a){var b=document.createElement("a");b.href=a;return b.href};c.prototype.hy=function(a){return Ra(Sa(a))};c.prototype.Kx=function(a){var b=this;return this.fonts.add(a).then(function(c){b.Ne('\n@font-face {\n    font-family: "'+c[0].mf+'";\n    src: url("'+a+'");\n}');(new FontFace(c[0].mf,"url("+a+")")).load().then(function(a){document.fonts.add(a)});for(var d=0,f=b.gi;d<f.length;d++){var h=f[d],k=h.Bc("fonts").concat();k.push(c[0].mf);h.gn("fonts",
k)}return c[0].mf})};c.prototype.px=function(a){return new L(a)};c.prototype.Vr=function(a){var b=new L;Gc(b,a);return b.vc()};c.prototype.Ey=function(a){return this.Vr(a)};c.prototype.nz=function(a,b){Gc(a,b)};c.prototype.xp=function(a,b){var c=document.createElement("img");c.src=a;if(0<a.toLowerCase().indexOf(".svg")){var e=new de;e.wq(a).then(function(){b&&b(e.rect.width,e.rect.height,c)})}else c.onload=function(){b&&b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.yf=function(a){return new Promise(function(b,
c){var d=document.createElement("img");d.src=a;d.onerror=function(){c(Error("Error loading image "+a))};d.onload=function(){b(d)}})};c.prototype.oD=function(a,b){return ec(a,b)};c.prototype.oE=function(a){return this.Gk(a)};c.prototype.xm=function(){var a=document.createElement("DIV");return!!(a.requestFullscreen||a.msRequestFullscreen||a.NB||a.webkitRequestFullscreen)};c.prototype.Gk=function(a){var b=z.tc(a);if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.Hu()?document.exitFullscreen?
document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.MB?a.MB():a.webkitExitFullscreen&&a.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.NB?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):console.log("Element does not contain any requestFullscreen methods")};c.prototype.Hu=function(){var a=document;return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||
a.msFullscreenElement?!0:!1};c.prototype.xz=function(){u.wz()};c.prototype.ru=function(a){return dg.jx(a)};c.prototype.Ne=function(a){this.cc.Qp(a)};c.prototype.controller=function(a,b){this.controllers[a]=b};c.prototype.dj=function(a,b){O.dj(a,b);this.Ee[a]=b};c.prototype.CC=function(a){this.kt.push(a)};c.prototype.$t=function(a){return a in this.Ee?JSON.parse(JSON.stringify(this.Ee[a].defaults||{})):{}};c.prototype.fj=function(a,b,c,e){void 0===c&&(c={});void 0===e&&(e=null);if("object"!==typeof a||
"string"!==typeof b)throw Error("Bad arguments passed to createComponent");return O.fj(a,b,c,e)};c.prototype.gz=function(a){O.detach(a);z(a).remove()};c.prototype.Mc=function(a,b){var c=z.tc(a);if(!c)throw Error("Zwibbler.attach: Cannot find element from "+a);return ah(c,b,!0)};c.prototype.detach=function(a){O.detach(a)};c.prototype.Tx=function(a){return"string"!==typeof a.url?Promise.reject(Error("Zwibbler.ajax: settings.url missing")):Xa({url:a.url,method:a.method,oC:a.params,mimeType:a.mimeType,
contentType:a.contentType,withCredentials:a.withCredentials,data:a.data,nt:a.delay,cancel:a.cancel,headers:a.headers}).then(function(a){O.digest();return a},function(a){O.digest();throw a;})};c.prototype.zD=function(a,b){var c=Mb();c[a]=b;var e;b=[];a=!0;for(e in c)c.hasOwnProperty(e)&&("/"===e.charAt(0)?(a||b.unshift("&"),""!==c[e]&&(b.unshift(encodeURIComponent(c[e])),b.unshift("=")),b.unshift("/"+encodeURIComponent(e.substr(1))),a=!1):(a||b.push("&"),a=!1,b.push(encodeURIComponent(e)),""!==c[e]&&
(b.push("="),b.push(encodeURIComponent(c[e])))));window.location.hash=b.join("")};c.prototype.ZA=function(){return Mb()};c.prototype.$A=function(){return Nb()};c.prototype.fz=function(){for(var a=0,b=this.gi.concat();a<b.length;a++)b[a].Ta();this.cc.Ta();this.fonts.KC();O.Ta();this.buttons.length=0;this.Al.length=0};c.prototype.Pl=function(a,b){C.ga("formatText",arguments,Hh,Gi);var c=new jd;b.text&&c.ug(b.text);if(b.font){var e=Td(b.font);c.uk(e.fontFamily||"arial",parseFloat(e.fontSize),"bold"===
e.fontWeight,"italic"===e.fontStyle,b.textDecoration||"")}c.rk(b.halign||null,b.valign||null);c.format(a,b.width||0,b.height||0);return{draw:function(a,b,d){c.la(a,b,d)},width:c.rect.width,height:c.rect.height}};c.prototype.mx=function(a,b){C.ga("NewPointerListener",arguments,C.HTMLElement);var c=new ve(a,{Dn:b.useCapture});return{on:function(a,b){C.ga("on",arguments,C.String,C.Function);c.pa(a,function(a){b({type:a.type,originalEvent:a.qb,pageX:a.pageX,pageY:a.pageY,target:a.target,buttons:a.buttons,
pointerId:a.pointerId,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey,preventDefault:function(){a.preventDefault()},stopPropagation:function(){a.stopPropagation()}})})},removeListener:function(a,b){C.ga("removeListener",arguments,C.String,C.Function);c.removeListener(a,b)},destroy:function(){c.Ta()}}};c.prototype.QB=function(a,b){return new Hi(new G(0,0,a,b),this.fonts)};return c}(),Hi=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}__extends(a,c);a.prototype.download=
function(a){var b=this.toBlob(),c=new $a;c.ew(b,a);setTimeout(function(){c.Ta()},1010)};return a}(Gf);
document.addEventListener("dragstart",function(c){var a=c.target;if("IMG"===a.tagName){var b={},d=a.getAttribute("zwibbler-props");if(d)try{b=JSON.parse(d)}catch(e){console.log(Error("Could not parse z-property value as JSON:"+d))}a={"zwibbler-src":a.getAttribute("zwibbler-src"),"zwibbler-width":a.getAttribute("zwibbler-width"),"zwibbler-size":a.getAttribute("zwibbler-size"),"zwibbler-props":b};a["zwibbler-src"]&&c.dataTransfer.setData("text",JSON.stringify(a))}});var N=new Z,Ii=Nb(Zf).module||"Zwibbler";
"function"===typeof define&&define.amd&&define(Ii,["exports"],function(c){c.Zwibbler=N});"undefined"!==typeof globalModule&&globalModule.exports&&(globalModule.exports.Zwibbler=N);window[Ii]=N;Yb.resolve(N);N.instances=N.gi;Z.prototype.addButton=Z.prototype.Gx;Z.prototype.addCustomNode=Z.prototype.Ix;Z.prototype.Popup=Z.prototype.qx;Z.prototype.Dialog=Z.prototype.Rn;Z.prototype.createPreview=Z.prototype.Wy;Z.prototype.directive=Z.prototype.Cb;Z.prototype.getContext=Z.prototype.getContext;
Z.prototype.render=Z.prototype.th;Z.prototype.save=Z.prototype.save;Z.prototype.getPageCount=Z.prototype.hb;Z.prototype.parseColour=Z.prototype.qC;Z.prototype.makeColour=Z.prototype.BB;Z.prototype.getAbsoluteUrl=Z.prototype.Sz;Z.prototype.base64Encode=Z.prototype.hy;Z.prototype.addFont=Z.prototype.Kx;Z.prototype.PathCommands=Z.prototype.px;Z.prototype.CommandsFromSvgPath=Z.prototype.Vr;Z.prototype.commandsFromSVGPath=Z.prototype.Ey;Z.prototype.drawSVGPath=Z.prototype.nz;Z.prototype.getImageSize=Z.prototype.xp;
Z.prototype.loadImage=Z.prototype.yf;Z.prototype.setColourOpacity=Z.prototype.oD;Z.prototype.toggleFullScreen=Z.prototype.oE;Z.prototype.isFullscreenSupported=Z.prototype.xm;Z.prototype.toggleFullscreen=Z.prototype.Gk;Z.prototype.isFullScreen=Z.prototype.Hu;Z.prototype.enableConsoleLogging=Z.prototype.xz;Z.prototype.hasConfig=Z.prototype.ru;Z.prototype.injectStyle=Z.prototype.Ne;Z.prototype.controller=Z.prototype.controller;Z.prototype.component=Z.prototype.dj;Z.prototype.propertyPanel=Z.prototype.CC;
Z.prototype.createComponent=Z.prototype.fj;Z.prototype.destroyComponent=Z.prototype.gz;Z.prototype.attach=Z.prototype.Mc;Z.prototype.detach=Z.prototype.detach;Z.prototype.ajax=Z.prototype.Tx;Z.prototype.setHashValue=Z.prototype.zD;Z.prototype.getUrlHash=Z.prototype.ZA;Z.prototype.getUrlQuery=Z.prototype.$A;Z.prototype.destroyAll=Z.prototype.fz;Z.prototype.formatText=Z.prototype.Pl;Z.prototype.NewPointerListener=Z.prototype.mx;Z.prototype.newPdfContext=Z.prototype.QB;Z.prototype.Context=Z.prototype.fx;
Hi.prototype.download=Hi.prototype.download;window.Zwibbler=N;var Ji=u.create("RESIZE"),Ki=function(){function c(a,b,c){this.Ba=a;this.node=b;this.ib=c;Ji("Enter resize behaviour");this.rect=b.rect.clone();this.Ba.Xe(!0);this.Ba.Kb(Md(c))}c.prototype.Bd=function(){};c.prototype.Dc=function(){this.Ba.Xe(!1);this.Ba.Kb("default");Ji("Exit RESIZE")};c.prototype.Eb=function(a,b,c){b=(c.pageX-c.sb)/this.Ba.scale;var d=(c.pageY-c.tb)/this.Ba.scale;c=this.rect.clone();a=this.ib;if(a&16){var f=Math.min(Math.abs(b),Math.abs(d));b=Math.sign(b)*f;d=Math.sign(d)*f}switch(a){case 25:case 22:d=
b;break;case 19:case 28:d=-b}a&1&&(c.y+=d,c.height-=d);a&4&&(c.height+=d);a&8&&(c.x+=b,c.width-=b);a&2&&(c.width+=b);this.node.format(this.Ba.ma,this.Ba.request);this.Ba.la();if(this.node.da){a=this.node.da;f=a.offsetParent;b=c.x;for(d=c.y;f instanceof HTMLElement&&f!==this.Ba.aa.Gd;)b-=f.offsetLeft,d-=f.offsetTop,f=f.offsetParent;f=z(a).am();a.style.left=b-f.left+"px";a.style.top=d-f.top+"px";a.style.width=c.width-f.eq-f.Tq+"px";a.style.height=c.height-f.Dr-f.wo+"px";this.node.xk(c,this.node.Pa())}return!0};
c.prototype.ac=function(){if(!this.node.da)throw Error("Expected element to be created");this.Ba.Ya(new Pf(this.Ba));this.Ba.aa.bb();this.Ba.aa.Bb([this.node.id],{"style.left":this.node.da.style.left,"style.top":this.node.da.style.top,"style.width":this.node.da.style.width,"style.height":this.node.da.style.height});this.Ba.aa.wa(!1);return!0};return c}();var Li=u.create("DefaultBehaviour"),Pf=function(){function c(a){this.view=a;this.Uq=1;this.view.hn("");if(this.Li=this.view.ha.Li())this.Uq=2;this.Ec=new Me(a)}c.prototype.Bd=function(){Li("Entering pick tool.");this.view.Kb("default")};c.prototype.Dc=function(){Li("Leaving pick tool.")};c.prototype.xb=function(a){return this.Ec.xb(a)};c.prototype.yb=function(a,b,c){if(c.buttons&&1!==c.buttons)return Li("   -- not main button. ignore."),!1;if(this.view.ha.get("readOnly")){var d=this.view.aa.Db(a,
b,this.view.scale,this.view.Rb);d.node?(Li("layer=%s active=%s",d.node.Cc(),this.view.Rb),this.view.xa.ta("node-clicked",d.node.id,a,b),d.hf&&d.hf.click(d.node,c.qb)):Li("readOnly mode: Ignoring click.");return!1}this.view.selection.length&&this.view.rB(c)&&this.view.kj();if(this.view.Ja){var f=this.view.Ja;var h=f.fi(a,b,1/this.view.scale*this.Uq);if(null!==h)return this.view.Ya(new Mi(this.view,f,h,a,b,this,c)),!0}if(h=this.view.cu(a,b)){if(!h.Zs())return h.click(c),this.view.xa.digest(),!0;this.view.Ya(new Je(this.view,
h,!1,a,b,c));return!0}h=!1;d||(h=this.view.aa.Db(a,b,this.view.scale,this.view.Rb),d=h.node,h=null!==h.hf);d||(d=this.view.aa.wp(c.target));if(h)return!0;h=d&&Uc(d)&&2>this.view.selection.length&&!d.ym();f=this.view.vg.Dp(a,b);if(d&&this.view.Rb.has(d.Cc())&&!this.view.aa.Wp(d)){f=d===this.view.Ja;var k=this.view.dh(d);Li("wasEditNode: %s, wasSelected: %s curselsize=%s",f,k,this.view.selection.length);k||(c.shiftKey||this.view.ub(),this.view.bf(d),this.view.pc());var l=this.Wt(d,a,b,c),n=l.handle;
l=l.Ja;if(n&&l)return this.view.Ya(new Mi(this.view,l,n,a,b,this,c)),!0;if(h)return!1;this.view.Ya(new Je(this.view,this.view.Ci?new De(xe,d.Pa(),d.ya):new Ee,!f&&k,a,b,c))}else if(this.view.Hv(a,b)){if(h)return!1;this.view.Ya(new Je(this.view,this.view.Ci?new De(xe,this.view.selection[0].Pa(),this.view.selection[0].ya):new Ee,!0,a,b,c))}else{if(!this.view.ha.Uz())return Li("Disabled select box -- mobile touch active."),this.view.rg(null),this.view.ub(),this.view.pc(),this.view.la(),!1;0==f.length&&
(c.Yp()&&!0!==this.view.ha.get("allowSelectBox")?c.setData("clearOnClick",!0):(this.view.rg(null),this.view.Ya(new He(this.view,this,a,b))))}return!0};c.prototype.Eb=function(a,b,c){var d=this.view.vg.Dp(a,b),f="default",h="";d.length&&!z.xf(c.qb.target)&&(f=Md(d[0].ib),h=d[0].id);c.qb.target instanceof HTMLElement&&c.qb.target.matches("[z-editable], [z-editable] *")&&(f="text");d=this.view.aa.Db(a,b,this.view.scale,this.view.Rb);this.view.lD(d.hf);d.node&&((c=this.Wt(d.node,a,b,c).handle)?f=(c instanceof
Object?c.eg():"")||"default":d.node.id!==h&&(f="default"));"default"===f&&(c=this.view.cu(a,b))&&(f=c.eg());this.view.Kb(f);return!1};c.prototype.Wt=function(a,b,c,e){if(!z.xf(e.qb.target)){for(e=null;;){if(a&&0!=(a.nb&16)&&a.pu()){e=a;break}if(a&&a.parent&&Tc(a.parent))a=a.parent;else break}if(e)return{handle:e.fi(b,c,1/this.view.scale*this.Uq),Ja:e}}return{handle:null,Ja:null}};c.prototype.ac=function(){Li("onMouseUp");return!1};c.prototype.sq=function(a,b,c){var d=this.view.aa.Db(a,b,this.view.scale,
this.view.Rb);d.node&&(this.view.xa.ta("node-clicked",d.node.id,a,b),d.hf&&d.hf.click(d.node,c.qb));c.getData("clearOnClick")&&(this.view.rg(null),this.view.ub(),this.view.pc(),this.view.la());return!1};c.prototype.Nm=function(a,b,c){Li("Mouse drag!");if(this.Ec.Oe())return!0;var d=!1;if(1===c.buttons){if(z.xf(c.getData("target"))&&!this.view.Xp||this.view.ha.get("readOnly"))return!1;var f=this.view.Pd(c.sb,c.tb,!0);d=this.view.vg.Dp(f.x,f.y);if((f=d.length?this.view.aa.Jb(d[0].id):this.view.aa.Db(f.x,
f.y,this.view.scale,this.view.Rb).node)&&Vc(f)&&this.view.Rb.has(f.Cc())){var h=f.da.hasAttribute("z-fixture");if(!h){h=void 0;var k;if(k=d.length)a:{switch(d[0].ib){case 25:case 33:case 19:case 34:case 22:case 36:case 28:case 40:k=!0;break a}k=!1}k&&f.da.hasAttribute("z-sizeable")&&!f.ia("lockSize")?h=new Ki(this.view,f,d[0].ib):f.ia("lockPosition")||(c.ctrlKey&&c.altKey&&(f=this.view.aa.Aa(this.view.aa.duplicate([f.id],new H)[0],!1),this.view.update()),f&&Vc(f)&&(this.view.dh(f)&&1!==this.view.selection.length||
f.ym()?Li("Not dragging html -- multiple nodes selected."):h=new jg(this.view,c,f,0)));h&&this.view.Ya(h)}}d=!!f;if(!f){a:{for(d=c.qb.target;d;){if(d.hasAttribute("z-drag-to-create")){d={da:d,type:d.getAttribute("z-drag-to-create")};break a}d=d.parentElement}d=null}if(d){h=N.$t(d.type);h.$component=d.type;k=d.da;for(var l={},n=0;n<k.attributes.length;n++){var r=k.attributes[n].name,v=k.attributes[n].value;if(r.startsWith("z-prop:")){r=r.substr(7);for(var x=!1,w="",y=0;y<r.length;y++){var A=r[y];"-"===
A?x=!0:x?(w+=A.toUpperCase(),x=!1):w+=A.toLowerCase()}r=w;v=af.Ll(l,v,k);h[r]=v}}k=new gh(this.view.aa.Cj(),this.view.aa);k.Nb(h);k.format(this.view.ma,this.view.request);this.view.Ya(new jg(this.view,c,k,1))}else(f=this.view.aa.wp(c.target))&&Vc(f)&&((h=f.da.hasAttribute("z-fixture"))||this.view.Ya(new jg(this.view,c,f,2)));d=!!f||!!d}}!d&&c.Yp()&&(d=new Sf(this.view),this.view.Ya(d),f=this.view.Pd(c.sb,c.tb,!0),d.aE(f.x,f.y,c,this),d.Eb(a,b,c));return!1};c.prototype.Kd=function(a,b){Li("keyboard: %s on target %s",
a,b.target.tagName);if(!z.xf(b.target,b)){var c=!0,e=this.view.ha.get("nudge");b&&b.ctrlKey&&(e=this.view.ha.get("preciseNudge"));var f=this.view.Ra.Ob;switch(a){case "bring-to-front":this.view.Xd(0);break;case "send-to-back":this.view.Xd(1);break;case "left":f||this.view.Hm(-1,0,e)||(this.view.Gb=Math.min(this.view.Gb+16,0),this.view.xd(),this.view.la());break;case "right":f||this.view.Hm(1,0,e)||(a=this.view.np().width,this.view.Gb=Math.max(-(a*this.view.scale-a),this.view.Gb-16),this.view.xd(),
this.view.la());break;case "up":f||this.view.Hm(0,-1,e)||(this.view.Hb=Math.min(this.view.Hb+16,0),this.view.xd(),this.view.la());break;case "down":f||this.view.Hm(0,1,e)||(a=this.view.np().height,this.view.Hb=Math.max(-(a*this.view.scale-a),this.view.Hb-16),this.view.xd(),this.view.la());break;case "select-none":this.view.ub();this.view.pc();this.view.la();f&&this.view.Tc.ta("goto-toolbar");break;case "select-all":var h=[];this.view.aa.Ac(function(a){h.push(a)});this.view.selectNodes(h);this.view.la();
f&&this.view.Tc.ta("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Xd(2);break;case "move-down":this.view.Xd(3);break;case "delete":this.view.kj();break;case "curve-tool":this.view.jt({});break;case "line-tool":this.view.Uu({},!1,!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Ki();break;case "undo":this.view.Xc();break;case "redo":this.view.ye();break;case "cut":this.view.Po();break;case "copy":this.view.Ig(!1,this.view.Uc(!1));
break;case "paste":this.view.ik();break;case "zoom-normal":this.view.ha.get("allowZoom")?this.view.ee(1):Li("Zooming is disabled.");break;case "zoom-in":this.view.ha.get("allowZoom")?this.view.Kn():Li("Zooming is disabled.");break;case "zoom-out":this.view.ha.get("allowZoom")?this.view.Ln():Li("Zooming is disabled.");break;default:c=!1}c&&(b.preventDefault(),b.stopPropagation());return c}};c.prototype.ve=function(a,b){b?(this.view.zc=a,this.view.oc=a,b="fillStyle"):(this.view.bd=a,b="strokeStyle");
this.view.setProperty(b,a)};c.prototype.lg=function(a,b){b?(this.view.zc=ec(this.view.zc,a),this.view.oc=ec(this.view.oc,a)):this.view.bd=ec(this.view.bd,a);this.view.fr(a,b)};c.prototype.rq=function(a,b){Li("onDoubleClick");var c=this.view.aa.Db(a,b,this.view.scale,this.view.Rb).node;Li("hittest: %s, hasText: %s",null!==c,null!==c&&c.$g());this.view.xa.ta("double-click",a,b,c?c.id:null);if(!c||"PathNode"!==c.type()&&"SvgNode"!==c.type()||this.view.ha.get("allowTextInShape"))if(c&&c.$g()&&!this.view.ha.get("readOnly"))Li("Text double-clicked."),
this.view.wr({}),this.view.sa instanceof Le&&this.view.sa.pr(c,a,b);else return!1;else Li("Editing text in shape is disabled.");return!0};c.prototype.Dd=function(){return"pick"};return c}();var Mi=function(){function c(a,b,c,e,f,h,k){this.view=a;this.node=b;this.handle=c;this.xi=h;this.tb=this.sb=0;this.log=u.create("MoveEditNode");b.Wl(c);this.rb=b.ia("snap")||0;this.yb(e,f,k)}c.prototype.Bd=function(){this.log("Entering MoveEditNode")};c.prototype.Dc=function(){this.view.Xe(!1);this.log("Leaving MoveEditNode")};c.prototype.yb=function(a,b,c){b=this.view.rb(new F(a,b),this.rb||c);a=b.x;b=b.y;this.log("onMouseDown(%s,%s)",a,b);this.sb=a;this.tb=b;this.view.Xe(!0);return!0};c.prototype.Eb=
function(a,b,c){b=this.view.rb(new F(a,b),this.rb||c);a=b.x;b=b.y;this.node.Nb(this.node.Ue(this.handle,a,b));this.node.format(this.view.ma,this.view.request);this.view.la();return!1};c.prototype.ac=function(a,b,c){var d=this;c=this.view.rb(new F(a,b),this.rb||c);a=c.x;b=c.y;this.log("onMouseUp(%s,%s)",a,b,this.sb,this.tb);a!==this.sb||b!==this.tb?(this.node.Nb(this.node.Ue(this.handle,this.sb,this.tb)),this.view.aa.transaction(function(){d.view.aa.Ue(d.node.id,d.handle,a,b)})):this.view.gD(this.node.id,
this.handle);this.view.la();this.view.Ya(this.xi||new Pf(this.view));return!0};return c}();}).call(typeof module !== 'undefined' ? module : undefined);
//# sourceMappingURL=zwibbler2.js.map